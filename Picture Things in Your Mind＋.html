<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œæ•´å­¸ç¿’ç¶²é ç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&amp;family=Noto+Sans+TC:wght@400;500;700&amp;family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-soft: #e0e7ff;
            --accent: #f43f5e;
            --bg-color: #f8fafc;
        }

        * { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }

        body {
            font-family: 'Nunito', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: #334155;
        }

        .material-symbols-outlined,
        .material-symbols-rounded {
            font-family: 'Material Symbols Rounded';
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .vocab-word {
            background: linear-gradient(120deg, #dbeafe 0%, #dbeafe 100%);
            background-repeat: no-repeat;
            background-size: 100% 40%;
            background-position: 0 88%;
            padding: 2px 2px;
            cursor: pointer;
            color: #1e40af;
            font-weight: 700;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        .vocab-word:hover {
            background-size: 100% 100%;
            background-color: #bfdbfe;
            color: #1e3a8a;
        }
        .vocab-word-custom {
            background: linear-gradient(120deg, #fee2e2 0%, #fee2e2 100%);
            background-repeat: no-repeat;
            background-size: 100% 40%;
            background-position: 0 88%;
            padding: 2px 2px;
            cursor: pointer;
            color: #991b1b;
            font-weight: 700;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        .vocab-word-custom:hover {
            background-size: 100% 100%;
            background-color: #fecaca;
        }

        .selected-word {
            background-color: #fef3c7;
            border-bottom: 2px dashed #d97706;
            padding: 0 4px;
            border-radius: 4px;
            cursor: pointer;
        }

        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-enter { animation: slideUpFade 0.4s ease-out forwards; }

        #floating-card {
            transition: opacity 0.2s, transform 0.2s ease;
            pointer-events: none;
            z-index: 9999;
            animation: slideUpFade 0.3s ease;
        }
        #selection-popup {
            transition: all 0.2s ease;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .learning-card { transition: all 0.3s ease; }
        .learning-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.08);
        }

        #video-container.sticky-video {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 400px;
            height: 225px;
            padding-top: 0 !important;
            max-width: 90vw;
            z-index: 1000;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border-radius: 16px;
            border: 4px solid white;
            animation: slideUpFade 0.3s ease;
        }
        #video-container.sticky-video #player {
            pointer-events: auto;
            border-radius: 12px;
        }

        #floating-close-btn {
            position: fixed;
            top: 30px;
            right: 10px;
            z-index: 1001;
        }

        @media (max-width: 768px) {
            #video-container.sticky-video {
                width: 280px;
                height: 158px;
                right: 16px;
                top: 80px;
            }
            #floating-close-btn { top: 30px; right: 10px; }
        }
        
        /* æ¼¢å ¡é¸å–®æ¨£å¼ */
        #mobile-menu {
            transition: all 0.3s ease;
        }
        #mobile-menu.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .hamburger-line {
            transition: all 0.3s ease;
        }
        #hamburger-btn.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        #hamburger-btn.active .hamburger-line:nth-child(2) {
            opacity: 0;
        }
        #hamburger-btn.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
        /* Ensure Read and Pause buttons are visible in summary mode */
        body.summary-mode .flex.gap-1.items-center {
            display: flex !important;
        }
        
        /* Hide specific segment controls in summary mode */
        body.summary-mode .segment-time-btn,
        body.summary-mode .segment-time-inputs,
        body.summary-mode .segment-edit-btn,
        body.summary-mode .segment-insert-btn,
        body.summary-mode button[onclick^="jumpToTime"] {
            display: none !important;
        }

        .modal { transition: opacity 0.3s ease-in-out; }
        .modal.hidden { opacity: 0; pointer-events: none; }
        textarea { resize: none; }
        textarea:focus, input:focus { outline: none; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }

        .header-link-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            padding: 6px 8px;
            border-radius: 8px;
        }

        .header-link-item:hover {
            background-color: #f8fafc;
        }

        /* Import tabs styling */
        .import-tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid #e2e8f0;
        }
        .import-tab {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .import-tab:hover {
            color: #334155;
            background-color: #f8fafc;
        }
        .import-tab.active {
            color: #6366f1;
            border-bottom-color: #6366f1;
        }
            
        /* Hide time input fields */
        .flex.items-center.gap-0.bg-blue-50 {
            display: none !important;
        }
</style>
<!-- Code injected by Five-server -->
  
  <script src="https://www.youtube.com/iframe_api"></script><style id="_goober"> @keyframes go2264125279{from{transform:scale(0) rotate(45deg);opacity:0;}to{transform:scale(1) rotate(45deg);opacity:1;}}@keyframes go3020080000{from{transform:scale(0);opacity:0;}to{transform:scale(1);opacity:1;}}@keyframes go463499852{from{transform:scale(0) rotate(90deg);opacity:0;}to{transform:scale(1) rotate(90deg);opacity:1;}}@keyframes go1268368563{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}@keyframes go1310225428{from{transform:scale(0) rotate(45deg);opacity:0;}to{transform:scale(1) rotate(45deg);opacity:1;}}@keyframes go651618207{0%{height:0;width:0;opacity:0;}40%{height:0;width:6px;opacity:1;}100%{opacity:1;height:10px;}}@keyframes go901347462{from{transform:scale(0.6);opacity:0.4;}to{transform:scale(1);opacity:1;}}.go4109123758{z-index:9999;}.go4109123758 > *{pointer-events:auto;}</style><style>.rr--group{display:flex;width:100%;position:relative}.rr--box{display:flex;width:100%;flex-grow:1;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rr--svg{display:flex;aspect-ratio:1;width:100%;flex-grow:1;overflow:clip;pointer-events:none}@supports not (overflow: clip){.rr--svg{overflow:auto}}.rr--box:focus,.rr--box:focus-visible,.rr-reset:focus-visible,.rr-reset:focus{outline:none;box-shadow:none}.rr--focus-reset{outline:6px double #0079ff}.rr--box:focus-visible .rr--svg{outline:6px double #0079ff;isolation:isolate}.rr--reset{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0;right:0;bottom:50%}[dir=rtl] .rr--reset{left:0;right:auto}.rr--dir-y .rr--reset{bottom:0;right:50%}.rr--disabled{opacity:.5;cursor:not-allowed}.rr--disabled .rr--svg{pointer-events:none}.rr--pointer .rr--box{cursor:pointer}.rr--dir-x{flex-direction:row}.rr--dir-y{flex-direction:column}.rr--space-sm .rr--svg{padding:8%}.rr--space-md .rr--svg{padding:12.5%}.rr--space-lg .rr--svg{padding:17.5%}.rr--dir-x.rr--gap-sm .rr--svg{margin:0 6.25%}.rr--dir-x.rr--gap-sm .rr--box:focus-visible:after{width:87.5%;left:6.25%}.rr--dir-x.rr--gap-md .rr--svg{margin:0 12.5%}.rr--dir-x.rr--gap-md .rr--box:focus-visible:after{width:75%;left:12.5%}.rr--dir-x.rr--gap-lg .rr--svg{margin:0 25%}.rr--dir-x.rr--gap-lg .rr--box:focus-visible:after{width:50%;left:25%}.rr--dir-y.rr--gap-sm .rr--svg{margin:6.25% 0}.rr--dir-y.rr--gap-md .rr--svg{margin:12.5% 0}.rr--dir-y.rr--gap-lg .rr--svg{margin:25% 0}.rr--rx-sm .rr--svg{border-radius:5%}.rr--rx-md .rr--svg{border-radius:15%}.rr--rx-lg .rr--svg{border-radius:20%}.rr--rx-full .rr--svg{border-radius:100%}.rr--has-stroke .rr--svg{stroke-linecap:round;stroke-linejoin:round}.rr--has-border .rr--svg{border-width:var(--rr--border-width);border-style:solid}.rr--on .rr--svg{fill:var(--rr--fill-on-color, none)}.rr--off .rr--svg{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--on .rr--svg{stroke:var(--rr--stroke-on-color, currentColor)}.rr--has-stroke .rr--off .rr--svg{stroke:var(--rr--stroke-off-color, currentColor)}.rr--on .rr--svg{background-color:var(--rr--box-on-color, none)}.rr--off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--has-border .rr--off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}.rr--has-border .rr--on .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--fx-colors{--rr--easing: .2s cubic-bezier(.61, 1, .88, 1)}.rr--fx-colors .rr--svg{transition-duration:.2s;transition-timing-function:var(--rr--easing);transition-property:background-color,border-color,fill,stroke}.rr--fx-opacity .rr--off{opacity:.35;transition:opacity var(--rr--easing)}.rr--fx-opacity .rr--on{opacity:1}@media(hover: hover){.rr--fx-opacity .rr--box:hover{opacity:1}}@media(hover: hover){.rr--fx-zoom .rr--box{transition:transform var(--rr--easing);transform:scale(1)}.rr--fx-zoom .rr--box:hover{transform:scale(1.2)}}@media(hover: hover)and (prefers-reduced-motion){.rr--fx-zoom .rr--box:hover{transform:scale(1)}}@media(hover: hover){.rr--fx-position .rr--box{transition:transform var(--rr--easing);transform:translateY(0)}.rr--fx-position .rr--box:hover{transform:translateY(-15%)}}@media(hover: hover)and (prefers-reduced-motion){.rr--fx-position .rr--box:hover{transform:translateY(0)}}.rr--svg-stop-1{stop-color:var(--rr--fill-on-color, rgba(0, 0, 0, 0))}[dir=rtl] .rr--svg-stop-1,.rr--svg-stop-2{stop-color:var(--rr--fill-off-color, rgba(0, 0, 0, 0))}[dir=rtl] .rr--svg-stop-2{stop-color:var(--rr--fill-on-color, rgba(0, 0, 0, 0))}.rr--hf-svg-on{fill:var(--rr--fill-on-color, none)}.rr--hf-svg-off{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--hf-svg-on{stroke:var(--rr--stroke-on-color, currentColor)}.rr--has-stroke .rr--hf-svg-off{stroke:var(--rr--stroke-off-color, currentColor)}.rr--hf-svg-on .rr--svg,.rr--hf-svg-off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--has-border .rr--hf-svg-on .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--has-border .rr--hf-svg-off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}.rr--dir-x .rr--hf-box-int .rr--svg{background:linear-gradient(to right, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}[dir=rtl] .rr--dir-x .rr--hf-box-int .rr--svg{background:linear-gradient(to left, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}.rr--dir-y .rr--hf-box-int .rr--svg{background:linear-gradient(to bottom, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}.rr--hf-box-on .rr--svg{background-color:var(--rr--box-on-color, none)}.rr--hf-box-off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--hf-box-on .rr--svg,.rr--hf-box-off .rr--svg,.rr--hf-box-int .rr--svg{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--hf-box-on .rr--svg,.rr--has-stroke .rr--hf-box-off .rr--svg,.rr--has-stroke .rr--hf-box-int .rr--svg{stroke:var(--rr--stroke-off-color, currentColor)}.rr--has-border .rr--hf-box-on .rr--svg,.rr--has-border .rr--hf-box-int .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--has-border .rr--hf-box-off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}</style><style>.kw-overview-container{box-sizing:border-box;width:673px;padding:0;margin:0;margin-top:14px;font-size:12px;font-family:Figtree;-webkit-font-smoothing:antialiased}.kw-overview-container.youtube{box-sizing:border-box;width:645px;padding:0;margin:0;font-size:12px}</style></head>
<body class="min-h-screen flex flex-col summary-mode">

    <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-100 shadow-sm">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6">
                        <div class="flex justify-between h-16 items-center">
                            <div class="flex items-center gap-3">
                                <div class="relative">
                                    <button id="header-links-trigger-export" class="flex items-center gap-3 text-left rounded-lg px-2 py-1 -ml-2 hover:bg-slate-50 transition">
                                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                            <span class="material-symbols-outlined text-white text-xl">school</span>
                                        </div>
                                        <div class="flex flex-col">
                                            <div class="font-bold text-lg text-slate-900">StudyEngine</div>
                                            <div class="text-xs text-slate-500 hidden sm:block">è‹±èªå­¸ç¿’å¹³å°</div>
                                        </div>
                                    </button>
                                    <div id="header-links-menu-export" class="hidden absolute left-0 mt-2 w-64 bg-white border border-slate-200 rounded-xl shadow-lg z-50 p-2">
                                        <div class="text-xs font-semibold text-slate-600 px-2 py-1 mb-1">å›ºå®šé€£çµ</div>
                                        <div class="px-2 py-1 text-xs text-slate-400">ç„¡é€£çµ</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <button onclick="toggleExportMenu()" class="px-3 py-2 rounded-lg border border-purple-200 bg-purple-50 hover:bg-purple-100 text-purple-700 transition text-sm font-medium flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-lg">bookmark</span>
                                    <span class="hidden sm:inline">Export Words (</span><span class="sm:hidden">(</span><span id="selected-count">0</span><span>)</span>
                                </button>
                                <div id="export-menu" class="hidden absolute top-full right-0 mt-2 bg-white border border-slate-200 rounded-xl shadow-lg z-50 min-w-max overflow-hidden">
                                    <button onclick="copyExportPrompt()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 border-b border-slate-100 flex items-center gap-2 text-sm" title="è¤‡è£½ç”ŸæˆAIæŒ‡ä»¤çš„Prompt">
                                        <span class="material-symbols-outlined text-sm text-blue-600">content_copy</span> <span>è¤‡è£½ Prompt</span>
                                    </button>
                                    <button onclick="exportSelectedWords()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 flex items-center gap-2 text-sm" title="ä¸‹è¼‰é¸ä¸­çš„ç”Ÿå­—">
                                        <span class="material-symbols-outlined text-sm text-blue-600">download</span> <span>ä¸‹è¼‰æ–‡å­—æª”</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6 pb-32 space-y-8">
        
        <!-- Video Section (Will be included in export) -->
        <section id="video-section" class="bg-white rounded-3xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-slate-100 learning-card overflow-hidden">
            <div id="video-container" class="relative w-full bg-black overflow-hidden" style="padding-top: 56.25%;">
                <div id="player" class="absolute inset-0"></div>
                <button id="close-sticky-video" class="absolute top-2 right-2 z-10 p-1.5 bg-black/70 hover:bg-black/90 rounded-lg text-white transition hidden">
                </button>
            </div>
            <div id="video-placeholder" class="w-full hidden" style="padding-top: 30%;"></div>
            
            <!-- Controls below video -->
            <div class="p-4 sm:p-6 flex justify-between items-center gap-3 bg-white">
                <div class="flex items-center gap-3 flex-1">
                    <div class="p-2 bg-rose-50 text-rose-500 rounded-lg shrink-0">
                        <span class="material-symbols-outlined text-lg">play_circle</span>
                    </div>
                    <div class="min-w-0">
                        <h3 class="font-bold text-slate-800 text-sm sm:text-base">Learning Player</h3>
                        <p class="text-xs text-slate-400 truncate sm:truncate-none">Click timestamps to jump</p>
                    </div>
                </div>
                <div class="flex gap-2 shrink-0">
                    <button onclick="openModal('video')" class="px-2 sm:px-4 py-2 rounded-lg sm:rounded-xl bg-slate-50 text-slate-600 text-xs sm:text-sm font-bold hover:bg-slate-100 transition flex items-center gap-1 sm:gap-2">
                        <span class="material-symbols-outlined text-base sm:text-lg">edit</span> 
                        <span class="hidden sm:inline">Change Video</span>
                    </button>
                    <button onclick="manualToggleSticky()" class="px-3 sm:px-4 py-2 rounded-lg sm:rounded-xl border border-indigo-300 bg-indigo-50 text-indigo-600 text-xs sm:text-sm font-bold hover:bg-indigo-100 transition flex items-center gap-1 sm:gap-2">
                        <span class="material-symbols-outlined text-base sm:text-lg">picture_in_picture_alt</span> 
                        <span class="hidden sm:inline">Float</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Floating close button -->
        <button id="floating-close-btn" class="p-2 bg-white/95 hover:bg-white rounded-full text-slate-700 hover:text-slate-900 shadow-lg hover:shadow-xl transition-all hover:scale-110 hidden">
            <span class="material-symbols-outlined text-xl">close</span>
        </button>

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Transcript -->
            <main class="lg:w-2/3 bg-white p-8 rounded-3xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-slate-100">
                <div class="flex justify-between items-center mb-6 border-b pb-4">
                    <h2 id="transcript-title" class="text-2xl font-bold text-slate-900">æ‘˜è¦</h2>
                    <div class="flex gap-2">
                        <button id="view-toggle-btn" onclick="toggleViewMode()" class="px-4 py-2 rounded-lg border-2 border-blue-300 bg-blue-50 text-blue-700 text-sm font-semibold transition hover:bg-blue-100 flex items-center gap-2">
                            <span class="material-symbols-outlined text-base">swap_horiz</span> <span id="view-mode-text">åˆ‡æ›åˆ°é€å­—ç¨¿</span>
                        </button>
                        <button onclick="toggleTranslations()" class="px-3 py-2 rounded-lg border border-slate-200 bg-slate-50 hover:bg-slate-100 text-slate-600 text-sm font-medium transition flex items-center gap-2">
                            <span class="material-symbols-outlined text-base">translate</span> <span id="toggle-btn-text">é¡¯ç¤ºä¸­æ–‡</span>
                        </button>
                    </div>
                </div>
                
                <div id="transcript-content" class="space-y-8 text-lg leading-relaxed text-slate-700">
                    <div class="mb-6" id="seg-0">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" onclick="speakSegment(0)" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-0" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" onclick="togglePauseSegment(0)" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(0)">
                                âµ 00:00
                            </button>
                            
                            
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-0">In 2015, a photo of a dress became very famous on the internet. Some people saw the dress as blue and black. Others saw it as white and gold. This simple picture shocked everyone. Why? Because it showed us a big truth: two people can look at the same reality but <span class="vocab-word" data-id="perceive" onmouseenter="showCard(event, 'perceive')" onmouseleave="hideCard()" onclick="toggleCard(event, 'perceive')">perceive</span> it completely differently.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-0">2015å¹´ï¼Œä¸€å¼µæ´‹è£çš„ç…§ç‰‡åœ¨ç¶²è·¯ä¸Šè®Šå¾—éå¸¸æœ‰åã€‚æœ‰äº›äººçœ‹åˆ°çš„æ˜¯è—é»‘è‰²ï¼Œå…¶ä»–äººçœ‹åˆ°çš„å‰‡æ˜¯ç™½é‡‘è‰²ã€‚é€™å¼µç°¡å–®çš„ç…§ç‰‡éœ‡é©šäº†æ‰€æœ‰äººã€‚ç‚ºä»€éº¼ï¼Ÿå› ç‚ºå®ƒå‘æˆ‘å€‘å±•ç¤ºäº†ä¸€å€‹é‡è¦çš„çœŸç›¸ï¼šå…©å€‹äººçœ‹è‘—åŒæ¨£çš„ç¾å¯¦ï¼Œå»å¯èƒ½æœ‰å®Œå…¨ä¸åŒçš„æ„ŸçŸ¥ã€‚</p>
                    </div>
                    <div class="mb-6" id="seg-1">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" onclick="speakSegment(1)" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-1" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" onclick="togglePauseSegment(1)" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(10)">
                                âµ 00:10
                            </button>
                            
                            
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-1">I want to talk about two main ideas today. First, our minds are more different than we think. Second, you should work with people who think differently than you because that is how we create magic.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-1">ä»Šå¤©æˆ‘æƒ³è«‡è«‡å…©å€‹ä¸»è¦è§€é»ã€‚é¦–å…ˆï¼Œæˆ‘å€‘çš„å¿ƒæ™ºå·®ç•°æ¯”æˆ‘å€‘æƒ³åƒçš„é‚„è¦å¤§ã€‚å…¶æ¬¡ï¼Œä½ æ‡‰è©²èˆ‡æ€è€ƒæ–¹å¼ä¸åŒçš„äººåˆä½œï¼Œå› ç‚ºé€™æ­£æ˜¯æˆ‘å€‘å‰µé€ å¥‡è¹Ÿçš„æ–¹å¼ã€‚</p>
                    </div>
                    <div class="mb-6" id="seg-2">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" onclick="speakSegment(2)" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-2" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" onclick="togglePauseSegment(2)" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(20)">
                                âµ 00:20
                            </button>
                            
                            
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-2">I work as a writer and a game designer. A few years ago, I realized that my brain works differently from most people. Letâ€™s try a small experiment. Please close your eyes and <span class="vocab-word" data-id="visualize" onmouseenter="showCard(event, 'visualize')" onmouseleave="hideCard()" onclick="toggleCard(event, 'visualize')">visualize</span> this: A rocket ship lands on an alien planet. A creature knocks on the door, and someone opens it.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-2">æˆ‘çš„è·æ¥­æ˜¯ä½œå®¶å’ŒéŠæˆ²è¨­è¨ˆå¸«ã€‚å¹¾å¹´å‰ï¼Œæˆ‘æ„è­˜åˆ°æˆ‘çš„å¤§è…¦é‹ä½œæ–¹å¼èˆ‡å¤§å¤šæ•¸äººä¸åŒã€‚è®“æˆ‘å€‘ä¾†åšå€‹å°å¯¦é©—ã€‚è«‹é–‰ä¸Šçœ¼ç›ä¸¦æƒ³åƒé€™å€‹ç•«é¢ï¼šä¸€è‰˜ç«ç®­é™è½åœ¨å¤–æ˜Ÿçƒä¸Šã€‚ä¸€å€‹ç”Ÿç‰©æ•²äº†æ•²é–€ï¼Œç„¶å¾Œæœ‰äººæ‰“é–‹äº†é–€ã€‚</p>
                    </div>
                    <div class="mb-6" id="seg-3">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" onclick="speakSegment(3)" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-3" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" onclick="togglePauseSegment(3)" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(30)">
                                âµ 00:30
                            </button>
                            
                            
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-3">Now, answer these questions: What color was the planet? What did the creature look like? Here is what I see when I do this exercise: Nothing.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-3">ç¾åœ¨ï¼Œå›ç­”é€™äº›å•é¡Œï¼šé‚£å€‹æ˜Ÿçƒæ˜¯ä»€éº¼é¡è‰²çš„ï¼Ÿé‚£å€‹ç”Ÿç‰©é•·ä»€éº¼æ¨£å­ï¼Ÿç•¶æˆ‘åšé€™å€‹ç·´ç¿’æ™‚ï¼Œæˆ‘çœ‹åˆ°çš„æ˜¯ï¼šä¸€ç‰‡ç©ºç™½ï¼ˆä»€éº¼éƒ½æ²’æœ‰ï¼‰ã€‚</p>
                    </div>
                    <div class="mb-6" id="seg-4">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" onclick="speakSegment(4)" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-4" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" onclick="togglePauseSegment(4)" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(40)">
                                âµ 00:40
                            </button>
                            
                            
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-4">I have a condition called "<span class="vocab-word" data-id="aphantasia" onmouseenter="showCard(event, 'aphantasia')" onmouseleave="hideCard()" onclick="toggleCard(event, 'aphantasia')">aphantasia</span>." This means I do not have a "mindâ€™s eye." I cannot see pictures in my head. Human imagination is like a <span class="vocab-word" data-id="spectrum" onmouseenter="showCard(event, 'spectrum')" onmouseleave="hideCard()" onclick="toggleCard(event, 'spectrum')">spectrum</span> (a range). On one side, some people have "<span class="vocab-word" data-id="hyperphantasia" onmouseenter="showCard(event, 'hyperphantasia')" onmouseleave="hideCard()" onclick="toggleCard(event, 'hyperphantasia')">hyperphantasia</span>" and can see perfect images in their minds. On the other side, about 2% to 4% of people are like me. We see nothing.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-4">æˆ‘æœ‰ä¸€ç¨®ç¨±ç‚ºã€Œç„¡æƒ³åƒåŠ›ç—‡ã€ï¼ˆaphantasiaï¼Œæˆ–ç¨±å¿ƒç›²ç—‡ï¼‰çš„ç‹€æ³ã€‚é€™æ„å‘³è‘—æˆ‘æ²’æœ‰ã€Œå¿ƒéˆä¹‹çœ¼ã€ï¼Œæˆ‘ç„¡æ³•åœ¨è…¦æµ·ä¸­çœ‹åˆ°ç•«é¢ã€‚äººé¡çš„æƒ³åƒåŠ›å°±åƒä¸€å€‹å…‰è­œï¼ˆç¯„åœï¼‰ã€‚åœ¨ä¸€ç«¯ï¼Œæœ‰äº›äººæ“æœ‰ã€Œè¶…å¼·æƒ³åƒåŠ›ã€ï¼Œå¯ä»¥åœ¨è…¦æµ·ä¸­çœ‹åˆ°å®Œç¾çš„åœ–åƒã€‚åœ¨å¦ä¸€ç«¯ï¼Œå¤§ç´„ 2% åˆ° 4% çš„äººåƒæˆ‘ä¸€æ¨£ï¼Œæˆ‘å€‘ä»€éº¼ä¹Ÿçœ‹ä¸åˆ°ã€‚</p>
                    </div>
                    <div class="mb-6" id="seg-5">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" onclick="speakSegment(5)" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-5" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" onclick="togglePauseSegment(5)" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(50)">
                                âµ 00:50
                            </button>
                            
                            
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-5">For a long time, I thought everyone was like me. When people said, "I can see it in my mind," I thought it was just a figure of speech. When I learned about <span class="vocab-word" data-id="aphantasia" onmouseenter="showCard(event, 'aphantasia')" onmouseleave="hideCard()" onclick="toggleCard(event, 'aphantasia')">aphantasia</span>, I was scared. I thought, "Am I in the wrong job?"</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-5">å¾ˆé•·ä¸€æ®µæ™‚é–“ï¼Œæˆ‘ä»¥ç‚ºæ¯å€‹äººéƒ½è·Ÿæˆ‘ä¸€æ¨£ã€‚ç•¶äººå€‘èªªã€Œæˆ‘å¯ä»¥åœ¨è…¦æµ·ä¸­çœ‹åˆ°å®ƒã€æ™‚ï¼Œæˆ‘ä»¥ç‚ºé‚£åªæ˜¯å€‹æ¯”å–»ã€‚ç•¶æˆ‘å¾—çŸ¥ç„¡æƒ³åƒåŠ›ç—‡æ™‚ï¼Œæˆ‘æ„Ÿåˆ°å¾ˆå®³æ€•ã€‚æˆ‘æƒ³ï¼šã€Œæˆ‘æ˜¯ä¸æ˜¯å…¥éŒ¯è¡Œäº†ï¼Ÿã€</p>
                    </div>
                    <div class="mb-6" id="seg-6">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" onclick="speakSegment(6)" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-6" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" onclick="togglePauseSegment(6)" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(60)">
                                âµ 01:00
                            </button>
                            
                            
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-6">This condition changes how I process information. For example, when most people read a book, they see a movie in their heads. I cannot do that. For me, reading is a <span class="vocab-word" data-id="conceptual" onmouseenter="showCard(event, 'conceptual')" onmouseleave="hideCard()" onclick="toggleCard(event, 'conceptual')">conceptual</span> experience. I understand the ideas, but I donâ€™t see the scenes. This also affects my memory. I have a five-year-old daughter, but when I am not looking at her, I cannot see her face in my mind.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-6">é€™å€‹ç‹€æ³æ”¹è®Šäº†æˆ‘è™•ç†è³‡è¨Šçš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œç•¶å¤§å¤šæ•¸äººé–±è®€å°èªªæ™‚ï¼Œä»–å€‘è…¦ä¸­æœƒåƒåœ¨çœ‹é›»å½±ã€‚æˆ‘ç„¡æ³•é‚£æ¨£åšã€‚å°æˆ‘ä¾†èªªï¼Œé–±è®€æ˜¯ä¸€ç¨®æ¦‚å¿µæ€§çš„é«”é©—ã€‚æˆ‘ç†è§£é€™äº›æƒ³æ³•ï¼Œä½†çœ‹ä¸åˆ°å ´æ™¯ã€‚é€™ä¹Ÿå½±éŸ¿äº†æˆ‘çš„è¨˜æ†¶ã€‚æˆ‘æœ‰å€‹äº”æ­²çš„å¥³å…’ï¼Œä½†ç•¶æˆ‘æ²’çœ‹è‘—å¥¹æ™‚ï¼Œæˆ‘ç„¡æ³•åœ¨è…¦æµ·ä¸­æµ®ç¾å¥¹çš„è‡‰é¾ã€‚</p>
                    </div>
                    <div class="mb-6" id="seg-7">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" onclick="speakSegment(7)" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-7" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" onclick="togglePauseSegment(7)" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(70)">
                                âµ 01:10
                            </button>
                            
                            
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-7">So, how do I design games if I cannot imagine pictures? I focus on the structureâ€”the "skeleton"â€”rather than the "skin." I think about the rules and the story first. Then, I work with amazing artists who can <span class="vocab-word" data-id="visualize" onmouseenter="showCard(event, 'visualize')" onmouseleave="hideCard()" onclick="toggleCard(event, 'visualize')">visualize</span> the details.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-7">é‚£éº¼ï¼Œå¦‚æœæˆ‘ç„¡æ³•æƒ³åƒç•«é¢ï¼Œæˆ‘è¦å¦‚ä½•è¨­è¨ˆéŠæˆ²å‘¢ï¼Ÿæˆ‘å°ˆæ³¨æ–¼çµæ§‹â€”â€”ä¹Ÿå°±æ˜¯ã€Œéª¨æ¶ã€â€”â€”è€Œä¸æ˜¯ã€Œçš®è†šã€ã€‚æˆ‘å…ˆæ§‹æ€è¦å‰‡å’Œæ•…äº‹ã€‚ç„¶å¾Œï¼Œæˆ‘èˆ‡é‚£äº›èƒ½å¤ å°‡ç´°ç¯€å…·è±¡åŒ–çš„å„ªç§€è—è¡“å®¶åˆä½œã€‚</p>
                    </div>
                    <div class="mb-6" id="seg-8">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" onclick="speakSegment(8)" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-8" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" onclick="togglePauseSegment(8)" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(80)">
                                âµ 01:20
                            </button>
                            
                            
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-8">This experience taught me something important. <span class="vocab-word" data-id="aphantasia" onmouseenter="showCard(event, 'aphantasia')" onmouseleave="hideCard()" onclick="toggleCard(event, 'aphantasia')">Aphantasia</span> is just one example of <span class="vocab-word" data-id="neurological" onmouseenter="showCard(event, 'neurological')" onmouseleave="hideCard()" onclick="toggleCard(event, 'neurological')">neurological</span> diversity. There are many other types, like autism, ADHD, and <span class="vocab-word" data-id="dyslexia" onmouseenter="showCard(event, 'dyslexia')" onmouseleave="hideCard()" onclick="toggleCard(event, 'dyslexia')">dyslexia</span>. Society often treats these as illnesses or problems. I think that is wrong. There is no "normal" brain. Being different is not bad.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-8">é€™æ¬¡ç¶“æ­·æ•™æœƒäº†æˆ‘ä¸€ä»¶é‡è¦çš„äº‹ã€‚ç„¡æƒ³åƒåŠ›ç—‡åªæ˜¯ç¥ç¶“å¤šæ¨£æ€§çš„ä¸€å€‹ä¾‹å­ã€‚é‚„æœ‰è¨±å¤šå…¶ä»–é¡å‹ï¼Œå¦‚è‡ªé–‰ç—‡ã€ADHDï¼ˆæ³¨æ„åŠ›ä¸è¶³éå‹•ç—‡ï¼‰å’Œé–±è®€éšœç¤™ã€‚ç¤¾æœƒé€šå¸¸å°‡é€™äº›è¦–ç‚ºç–¾ç—…æˆ–å•é¡Œã€‚æˆ‘èªç‚ºé€™æ˜¯éŒ¯çš„ã€‚ä¸¦æ²’æœ‰æ‰€è¬‚ã€Œæ­£å¸¸ã€çš„å¤§è…¦ã€‚èˆ‡çœ¾ä¸åŒä¸¦ä¸æ˜¯å£äº‹ã€‚</p>
                    </div>
                    <div class="mb-6" id="seg-9">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" onclick="speakSegment(9)" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-9" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" onclick="togglePauseSegment(9)" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(90)">
                                âµ 01:30
                            </button>
                            
                            
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-9">In fact, research shows that teams with different types of people produce better results. Companies are starting to hire people who think differently, and they are seeing great success. In my career, I work with artists who have powerful visual imaginations. Because our minds are different, we make wonderful things together.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-9">äº‹å¯¦ä¸Šï¼Œç ”ç©¶é¡¯ç¤ºç”±ä¸åŒé¡å‹çš„äººçµ„æˆçš„åœ˜éšŠèƒ½ç”¢ç”Ÿæ›´å¥½çš„çµæœã€‚ä¼æ¥­é–‹å§‹åƒ±ç”¨æ€è€ƒæ–¹å¼ä¸åŒçš„äººï¼Œä¸¦ä¸”çœ‹è¦‹äº†å·¨å¤§çš„æˆåŠŸã€‚åœ¨æˆ‘çš„è·æ¥­ç”Ÿæ¶¯ä¸­ï¼Œæˆ‘èˆ‡æ“æœ‰å¼·å¤§è¦–è¦ºæƒ³åƒåŠ›çš„è—è¡“å®¶åˆä½œã€‚æ­£å› ç‚ºæˆ‘å€‘çš„å¿ƒæ™ºä¸åŒï¼Œæˆ‘å€‘ä¸€èµ·å‰µé€ äº†ç¾å¦™çš„äº‹ç‰©ã€‚</p>
                    </div>
                    <div class="mb-6" id="seg-10">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" onclick="speakSegment(10)" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-10" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" onclick="togglePauseSegment(10)" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(100)">
                                âµ 01:40
                            </button>
                            
                            
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-10">So, am I in the wrong field? No. I realized that my different mind is not a weakness. It is a gift. We should all look for minds that are different from ours. When we combine our different ways of thinking, we can do incredible things.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-10">æ‰€ä»¥ï¼Œæˆ‘å…¥éŒ¯è¡Œäº†å—ï¼Ÿä¸ã€‚æˆ‘æ„è­˜åˆ°æˆ‘ç¨ç‰¹çš„å¿ƒæ™ºä¸æ˜¯å¼±é»ï¼Œè€Œæ˜¯ç¦®ç‰©ã€‚æˆ‘å€‘éƒ½æ‡‰è©²å°‹æ‰¾èˆ‡æˆ‘å€‘ä¸åŒçš„å¿ƒæ™ºã€‚ç•¶æˆ‘å€‘çµåˆå½¼æ­¤ä¸åŒçš„æ€è€ƒæ–¹å¼æ™‚ï¼Œæˆ‘å€‘å°±èƒ½æˆå°±ä¸å¯æ€è­°çš„äº‹ã€‚</p>
                    </div></div>
            </main>

            <!-- Vocab + Quiz Sidebar -->
            <aside class="lg:w-1/3">
                <div class="sticky top-24 space-y-6">
                    <div class="bg-white rounded-3xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-slate-100 learning-card p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="font-bold text-xl flex items-center gap-3 text-slate-900">
                                <div class="p-2 bg-amber-100 rounded-lg">
                                    <span class="material-symbols-outlined text-amber-600 text-2xl">verified</span>
                                </div>
                                è©å½™è¡¨
                                <span class="text-sm bg-slate-200 px-2.5 py-1 rounded-full font-semibold" id="vocab-count">8</span>
                            </h3>
                            <button onclick="showAddVocabModal()" class="text-blue-600 hover:bg-blue-50 rounded-full p-2 transition hover:scale-110" title="æ–°å¢ç”Ÿå­—">
                                <span class="material-symbols-outlined text-2xl">add_circle</span>
                            </button>
                        </div>
                        <ul id="vocab-list" class="divide-y max-h-[60vh] overflow-y-auto">
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('aphantasia')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">1.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Aphantasia</div>
                                    <button onclick="event.stopPropagation(); speakWord('Aphantasia')" class="text-slate-400 hover:text-blue-600 transition" title="æ’­æ”¾ç™¼éŸ³">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ËŒeÉª.fÃ¦nËˆteÉª.Ê’É™/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A condition where a person cannot voluntarily create mental images in their mind.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">ç„¡æƒ³åƒåŠ›ç—‡ (åˆç¨±å¿ƒç›²ç—‡)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('conceptual')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">2.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Conceptual</div>
                                    <button onclick="event.stopPropagation(); speakWord('Conceptual')" class="text-slate-400 hover:text-blue-600 transition" title="æ’­æ”¾ç™¼éŸ³">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/kÉ™nËˆsep.tÊƒu.É™l/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Based on ideas or principles rather than concrete examples or physical reality.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">æ¦‚å¿µä¸Šçš„ï¼›è§€å¿µçš„</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('dyslexia')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">3.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Dyslexia</div>
                                    <button onclick="event.stopPropagation(); speakWord('Dyslexia')" class="text-slate-400 hover:text-blue-600 transition" title="æ’­æ”¾ç™¼éŸ³">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/dÉªsËˆlek.si.É™/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A learning disorder that affects a person's ability to read, write, and spell.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">é–±è®€éšœç¤™</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('hyperphantasia')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">4.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Hyperphantasia</div>
                                    <button onclick="event.stopPropagation(); speakWord('Hyperphantasia')" class="text-slate-400 hover:text-blue-600 transition" title="æ’­æ”¾ç™¼éŸ³">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ËŒhaÉª.pÉ™r.fÃ¦nËˆteÉª.Ê’É™/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">The condition of having extremely vivid mental imagery.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">è¶…å¼·æƒ³åƒåŠ› (å¿ƒåƒæ¥µåº¦æ¸…æ™°)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('neurological')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">5.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Neurological</div>
                                    <button onclick="event.stopPropagation(); speakWord('Neurological')" class="text-slate-400 hover:text-blue-600 transition" title="æ’­æ”¾ç™¼éŸ³">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ËŒnÊŠr.É™ËˆlÉ‘Ë.dÊ’Éª.kÉ™l/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Relating to the anatomy, functions, and organic disorders of nerves and the nervous system.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">ç¥ç¶“å­¸çš„ï¼›ç¥ç¶“ç³»çµ±çš„</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('perceive')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">6.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Perceive</div>
                                    <button onclick="event.stopPropagation(); speakWord('Perceive')" class="text-slate-400 hover:text-blue-600 transition" title="æ’­æ”¾ç™¼éŸ³">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/pÉ™rËˆsiËv/</div>
                                <div class="text-xs text-slate-500 mt-0.5">verb</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">To interpret or become aware of something through the senses or the mind.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">æ„ŸçŸ¥ï¼›å¯Ÿè¦ºï¼›ç†è§£</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('spectrum')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">7.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Spectrum</div>
                                    <button onclick="event.stopPropagation(); speakWord('Spectrum')" class="text-slate-400 hover:text-blue-600 transition" title="æ’­æ”¾ç™¼éŸ³">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/Ëˆspek.trÉ™m/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A range of different positions, opinions, or values between two extreme points.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">å…‰è­œï¼›ç¯„åœï¼›å¹…åº¦</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('visualize')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">8.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Visualize</div>
                                    <button onclick="event.stopPropagation(); speakWord('Visualize')" class="text-slate-400 hover:text-blue-600 transition" title="æ’­æ”¾ç™¼éŸ³">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ËˆvÉªÊ’.u.É™.laÉªz/</div>
                                <div class="text-xs text-slate-500 mt-0.5">verb</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">To form a mental image of something; to imagine.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">æƒ³åƒï¼›åœ¨è…¦æµ·ä¸­é¡¯ç¾åœ–åƒ</div>
                    </li></ul>
                    </div>
                    
                    <div class="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl p-8 shadow-xl shadow-indigo-200 text-white learning-card">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="p-2 bg-white/20 rounded-lg">
                                <span class="material-symbols-outlined text-2xl">quiz</span>
                            </div>
                            <h3 class="font-bold text-xl">çŸ¥è­˜æª¢æ¸¬</h3>
                        </div>
                        <p class="text-blue-100 text-sm mb-6 leading-relaxed">é€šéæ¸¬é©—éå›ºæ‰€å­¸ï¼Œè©•ä¼°å­¸ç¿’é€²åº¦ã€‚</p>
                        <button onclick="openQuiz()" class="w-full bg-white text-blue-600 py-3 px-4 rounded-xl font-bold shadow-md hover:shadow-lg hover:bg-blue-50 transition transform hover:scale-[1.02] flex justify-center items-center gap-2">
                            <span class="material-symbols-outlined">play_circle</span>
                            <span>é–‹å§‹æ¸¬é©—</span>
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Mobile Floating Action Button for Quiz -->
    <button onclick="openQuiz()" class="lg:hidden fixed bottom-32 right-6 bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-4 rounded-full shadow-xl hover:shadow-2xl hover:scale-110 z-50 flex items-center justify-center transition">
        <span class="material-symbols-outlined text-2xl">quiz</span>
    </button>

    <!-- Bottom Control Bar (Will be kept in export) -->
    <div id="bottom-controls" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-white/90 backdrop-blur-xl border border-white/50 shadow-2xl rounded-2xl z-40 px-2 py-2 flex items-center gap-2 max-w-[95vw] sm:max-w-2xl transition-all duration-300">
        <div class="flex flex-nowrap justify-center gap-2">
            <button id="play-pause-btn" onclick="togglePlayPause()" class="flex items-center gap-1.5 px-4 py-3 rounded-lg bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold shadow-md hover:shadow-lg active:scale-95 transition-all min-h-[44px]">
                <span class="material-symbols-outlined text-xl" id="play-icon">play_arrow</span>
                <span id="play-text" class="hidden sm:inline text-sm">æ’­æ”¾</span>
            </button>
            
            <div class="flex items-center rounded-xl border border-slate-300 bg-slate-100 overflow-hidden min-h-[44px]">
                <button onclick="decreaseFontSize()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-200 active:bg-slate-300 transition">
                    <span class="material-symbols-outlined text-lg">text_decrease</span>
                </button>
                <div class="w-px h-8 bg-slate-300"></div>
                <button onclick="increaseFontSize()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-200 active:bg-slate-300 transition">
                    <span class="material-symbols-outlined text-lg">text_increase</span>
                </button>
            </div>
            
            <div class="flex items-center rounded-xl border border-slate-300 bg-white overflow-hidden min-h-[44px]">
                <button onclick="decreasePlaybackSpeed()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-100 active:bg-slate-200 transition">
                    <span class="material-symbols-outlined text-lg">remove</span>
                </button>
                <div class="w-px h-8 bg-slate-300"></div>
                <div class="flex items-center px-3 py-3 text-sm font-bold min-w-[50px] justify-center text-slate-700">
                    <span id="speed-display">1.0x</span>
                </div>
                <div class="w-px h-8 bg-slate-300"></div>
                <button onclick="increasePlaybackSpeed()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-100 active:bg-slate-200 transition">
                    <span class="material-symbols-outlined text-lg">add</span>
                </button>
            </div>
            
            <button onclick="toggleTranslations()" class="flex items-center px-4 py-3 rounded-lg border border-blue-300 bg-blue-50 text-blue-700 text-sm font-medium active:bg-blue-100 hover:bg-blue-100 transition min-h-[44px]">
                <span class="material-symbols-outlined text-lg">translate</span> <span id="cn-toggle-text">ä¸­æ–‡</span>
            </button>
            <button onclick="resetSettings()" class="hidden sm:block px-4 py-3 rounded-lg border border-slate-300 bg-slate-50 text-slate-600 text-sm font-medium hover:bg-slate-100 active:bg-slate-200 transition min-h-[44px]">
                <span class="material-symbols-outlined text-lg">restart_alt</span>
            </button>
        </div>
    </div>

    <!-- Floating Card -->
    <div id="floating-card" class="fixed hidden bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl w-80 border border-white/50 z-50 overflow-hidden p-5"></div>

    <!-- Selection Popup -->
    <div id="selection-popup" class="fixed hidden bg-slate-800 text-white px-4 py-2 rounded-full shadow-xl z-50 text-sm font-bold cursor-pointer hover:bg-slate-900 active:scale-95 transition-all flex items-center gap-2 animate-enter">
        <span class="material-symbols-rounded text-lg text-emerald-400">add_circle</span> åŠ å…¥ç”Ÿå­—
    </div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="modal fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center p-4 z-[100] hidden">
        <div class="bg-white rounded-3xl w-full max-w-3xl flex flex-col max-h-[90vh] shadow-2xl animate-enter overflow-hidden">
            <div class="p-6 border-b border-slate-50 bg-gradient-to-r from-indigo-500 to-purple-600 text-white flex justify-between items-center">
                <h3 class="font-bold text-xl flex items-center gap-2"><span class="material-symbols-outlined">psychology</span> Knowledge Check</h3>
                <button onclick="closeQuiz()" class="w-8 h-8 flex items-center justify-center rounded-full bg-white/20 hover:bg-white/40 text-white transition"><span class="material-symbols-outlined">close</span></button>
            </div>
            <div id="quiz-language-selector" class="flex items-center gap-2 p-3 bg-white border-2 border-slate-200 rounded-xl mx-6 mt-4">
                <span class="text-sm font-semibold text-slate-700">Quiz Language:</span>
                <button onclick="selectQuizLanguage('english')" class="px-4 py-2 rounded-lg text-sm font-semibold border-2 transition bg-blue-600 text-white border-blue-600" id="quiz-select-en">
                    <span class="material-symbols-outlined text-sm align-middle">language</span> English
                </button>
                <button onclick="selectQuizLanguage('chinese')" class="px-4 py-2 rounded-lg text-sm font-semibold border-2 transition bg-white text-slate-700 border-slate-300" id="quiz-select-zh">
                    <span class="material-symbols-outlined text-sm align-middle">translate</span> ä¸­æ–‡
                </button>
            </div>
            <div id="quiz-content" class="p-8 overflow-y-auto flex-1 bg-slate-50">
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors" id="q-block-0">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">1</span>
                        According to the text, what is "aphantasia"?
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q0" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">The ability to see perfect images in the mind.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q0" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">The inability to voluntarily visualize mental images.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q0" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">A condition where one cannot recognize faces.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q0" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">A type of color blindness affecting how one sees clothing.</span>
                            </label>
                        
                    </div>
                    <div class="feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2"></div>
                </div>
            
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors" id="q-block-1">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">2</span>
                        How does the author approach game design without a "mind's eye"?
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q1" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">By focusing on the visual details first.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q1" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">By hiring someone else to do all the work.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q1" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">By focusing on the structure, rules, and story.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q1" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">By only writing books instead of games.</span>
                            </label>
                        
                    </div>
                    <div class="feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2"></div>
                </div>
            
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors" id="q-block-2">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">3</span>
                        Why did the author initially feel scared upon learning about their condition?
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q2" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">They thought they were losing their memory.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q2" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">They feared they were in the wrong career field.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q2" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">They were afraid of doctors.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q2" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">They thought they would eventually go blind.</span>
                            </label>
                        
                    </div>
                    <div class="feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2"></div>
                </div>
            
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors" id="q-block-3">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">4</span>
                        What does the author imply by comparing human imagination to a "spectrum"?
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q3" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">Everyone visualizes exactly the same way.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q3" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">Most people fall into the category of hyperphantasia.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q3" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">There is a wide range of visualization abilities among people.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q3" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">Imagination is strictly related to seeing colors like a rainbow.</span>
                            </label>
                        
                    </div>
                    <div class="feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2"></div>
                </div>
            
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors" id="q-block-4">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">5</span>
                        What is the main purpose of mentioning the "dress" photo in the introduction?
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q4" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">To teach the audience about fashion trends.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q4" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">To prove that some people have better eyesight than others.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q4" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">To show that people can perceive the same reality differently.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q4" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">To explain why the photo went viral on the internet.</span>
                            </label>
                        
                    </div>
                    <div class="feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2"></div>
                </div>
            
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors" id="q-block-5">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">6</span>
                        What is the author's core message regarding neurological diversity (like autism, ADHD, etc.)?
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q5" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">These are illnesses that need to be fixed immediately.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q5" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">Companies should avoid hiring people who think differently.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q5" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">There is only one "normal" way for a brain to function.</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q5" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">Different ways of thinking are gifts that create better outcomes.</span>
                            </label>
                        
                    </div>
                    <div class="feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2"></div>
                </div>
            </div>
            <div id="quiz-footer" class="p-6 border-t border-slate-100 bg-white flex justify-end"><button onclick="submitQuiz()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 shadow-md transition">Submit Answers</button></div>
        </div>
    </div>

    <!-- Add Vocab Modal -->
    <div id="add-vocab-modal" class="modal hidden fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl w-full max-w-3xl flex flex-col h-[80vh] shadow-2xl">
            <div class="p-6 border-b border-slate-50 flex justify-between items-center">
                <h3 class="font-extrabold text-xl text-slate-800">æ–°å¢ç”Ÿå­—</h3>
                <button onclick="closeAddVocabModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 text-slate-400 transition">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="p-4 flex-1 flex flex-col gap-3">
                <div id="add-vocab-hint" class="bg-blue-50 text-blue-800 p-3 rounded text-xs">
                    æ ¼å¼ï¼š[{ "word": "...", "def": "...", "pos": "n." }, ...]
                </div>
                <textarea id="add-vocab-input" class="flex-1 border rounded p-4 font-mono text-xs resize-none" placeholder="[{&quot;word&quot;:&quot;Example&quot;,&quot;def&quot;:&quot;ç¯„ä¾‹&quot;,&quot;pos&quot;:&quot;n.&quot;}]"></textarea>
            </div>
            
            <div class="p-6 border-t border-slate-50 flex justify-end gap-3 bg-slate-50/50 rounded-b-3xl">
                <div></div>
                <div class="flex gap-3">
                    <button onclick="closeAddVocabModal()" class="px-6 py-2.5 rounded-xl text-slate-500 font-bold hover:bg-slate-100 transition">Cancel</button>
                    <button onclick="addNewVocabFromJSON()" class="px-8 py-2.5 rounded-xl bg-indigo-600 text-white font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition">Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->

    <div id="edit-modal" class="modal hidden fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl w-full max-w-4xl flex flex-col h-[85vh] shadow-2xl">
            <div class="p-6 border-b border-slate-50 flex justify-between items-center">
                <h3 class="font-extrabold text-xl text-slate-800">ç·¨è¼¯é€å­—ç¨¿æ®µè½</h3>
                <button onclick="closeEditModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 text-slate-400 transition">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="p-6 flex-1 flex flex-col gap-4 overflow-y-auto">
                <div class="flex-1 flex flex-col">
                    <label class="font-semibold mb-2 text-sm text-slate-700">è‹±æ–‡å…§å®¹</label>
                    <textarea id="edit-en-input" class="flex-1 border-2 border-slate-300 rounded-lg p-4 font-sans text-base resize-none focus:border-blue-500 focus:outline-none min-h-[200px]" placeholder="è¼¸å…¥è‹±æ–‡å…§å®¹..."></textarea>
                </div>
                
                <div class="flex-1 flex flex-col">
                    <label class="font-semibold mb-2 text-sm text-slate-700">ä¸­æ–‡ç¿»è­¯</label>
                    <textarea id="edit-cn-input" class="flex-1 border-2 border-slate-300 rounded-lg p-4 font-sans text-base resize-none focus:border-blue-500 focus:outline-none min-h-[200px]" placeholder="è¼¸å…¥ä¸­æ–‡ç¿»è­¯ï¼ˆå¯é¸ï¼‰..."></textarea>
                </div>
                
                <div class="flex flex-col">
                    <label class="font-semibold mb-2 text-sm text-slate-700">æ™‚é–“æ¨™è¨˜ (ç§’)</label>
                    <div class="flex items-center gap-3">
                        <input type="number" id="edit-time-input" min="0" step="1" class="w-32 px-3 py-2 border-2 border-blue-300 rounded-lg bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0">
                        <span class="text-sm text-slate-600">ç§’</span>
                        <button onclick="previewEditTime()" class="px-4 py-2 rounded-lg border border-blue-300 bg-blue-50 text-blue-700 text-xs font-semibold hover:bg-blue-100 transition-colors">é è¦½æ™‚é–“</button>
                    </div>
                </div>
            </div>
            
            <div class="p-6 border-t border-slate-50 flex justify-end gap-3 bg-slate-50/50 rounded-b-3xl">
                <button onclick="closeEditModal()" class="px-6 py-2.5 rounded-xl text-slate-500 font-bold hover:bg-slate-100 transition">å–æ¶ˆ</button>
                <button onclick="saveEdit()" class="px-8 py-2.5 rounded-xl bg-indigo-600 text-white font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition">å„²å­˜</button>
            </div>
        </div>
    </div>

    <!-- Insert Transcript Modal -->
    <div id="insert-modal" class="modal hidden fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl w-full max-w-3xl flex flex-col h-[80vh] shadow-2xl">
            <div class="p-6 border-b border-slate-50 flex justify-between items-center">
                <h3 class="font-bold text-lg">å¾æ®µè½ <span id="insert-segment-index"></span> æ’å…¥é€å­—ç¨¿</h3>
                <div class="flex items-center gap-2">
                    <button id="copy-insert-prompt-btn" onclick="copyInsertPrompt()" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 hover:border-indigo-300 text-xs font-semibold transition" title="è¤‡è£½ AI Prompt">
                        <span class="material-symbols-outlined text-sm">auto_awesome</span>
                        AI Prompt
                    </button>
                    <button onclick="closeInsertModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 text-slate-400 transition">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
            </div>
            
            <div class="p-4 flex-1 flex flex-col gap-3">
                <div class="bg-purple-50 text-purple-800 p-3 rounded text-xs">
                    æ ¼å¼ï¼š[{ "en": "...", "cn": "...", "t": 0 }, ...]<br>
                    <strong>æ³¨æ„ï¼š</strong>æ­¤åŠŸèƒ½æœƒå¾é¸å®šçš„æ®µè½é–‹å§‹ï¼Œç”¨æ–°è³‡æ–™<strong>å–ä»£</strong>ä¹‹å¾Œæ‰€æœ‰æ®µè½ï¼Œä½†ä¿ç•™ä¹‹å‰çš„æ®µè½ã€‚
                </div>
                <textarea id="insert-input" class="flex-1 border rounded p-4 font-mono text-xs resize-none" placeholder="[{&quot;en&quot;:&quot;Hello&quot;,&quot;cn&quot;:&quot;ä½ å¥½&quot;,&quot;t&quot;:0}]"></textarea>
            </div>
            
            <div class="p-6 border-t border-slate-50 flex justify-end gap-3 bg-slate-50/50 rounded-b-3xl">
                <button onclick="closeInsertModal()" class="px-6 py-2.5 rounded-xl text-slate-500 font-bold hover:bg-slate-100 transition">Cancel</button>
                <button onclick="insertTranscriptFromIndex()" class="px-8 py-2.5 rounded-xl bg-indigo-600 text-white font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition">æ’å…¥é€å­—ç¨¿</button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="import-modal" class="modal hidden fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl w-full max-w-3xl flex flex-col max-h-[85vh] shadow-2xl animate-enter">
            <div class="p-6 border-b border-slate-50">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg" id="modal-title">Import</h3>
                    <div class="flex items-center gap-2">
                    <button id="copy-cefr-prompt-btn" onclick="openCEFRLevelSelector()" class="hidden inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-rose-200 bg-rose-50 text-rose-700 hover:bg-rose-100 hover:border-rose-300 text-xs font-semibold transition" title="è¤‡è£½ CEFR é›£åº¦èª¿æ•´ Prompt">
                        <span class="material-symbols-outlined text-sm">tune</span>
                        é›£åº¦èª¿æ•´
                    </button>
                    <button id="copy-transcript-prompt-btn" onclick="copyTranscriptPromptFromClipboard()" class="hidden inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 hover:border-emerald-300 text-xs font-semibold transition" title="è¤‡è£½å‰ªè²¼ç°¿ Prompt">
                        <span class="material-symbols-outlined text-sm">content_paste</span>
                        å‰ªè²¼ç°¿ Prompt
                    </button>
                    <button id="copy-prompt-btn" onclick="copyPrompt()" class="hidden inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 hover:border-indigo-300 text-xs font-semibold transition" title="è¤‡è£½ AI Prompt">
                        <span class="material-symbols-outlined text-sm">auto_awesome</span>
                        AI Prompt
                    </button>
                    <button id="copy-vocab-transcript-prompt-btn" onclick="copyVocabPrompt('transcript')" class="hidden inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:border-blue-300 text-xs font-semibold transition" title="è¤‡è£½é€å­—ç¨¿å–®å­— Prompt">
                        <span class="material-symbols-outlined text-sm">description</span>
                        é€å­—ç¨¿ Prompt
                    </button>
                    <button id="copy-vocab-summary-prompt-btn" onclick="copyVocabPrompt('summary')" class="hidden inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 hover:border-emerald-300 text-xs font-semibold transition" title="è¤‡è£½æ‘˜è¦å–®å­— Prompt">
                        <span class="material-symbols-outlined text-sm">summarize</span>
                        æ‘˜è¦ Prompt
                    </button>
                    <button onclick="closeModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 text-slate-400 transition">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                </div>
                <!-- Tabs for transcript/summary switching -->
                <div id="import-tabs" class="import-tabs hidden mt-4">
                    <div class="import-tab active" onclick="switchImportTab('transcript')">
                        <span class="material-symbols-outlined text-sm">description</span>
                        <span>é€å­—ç¨¿å…§å®¹</span>
                    </div>
                    <div class="import-tab" onclick="switchImportTab('summary')">
                        <span class="material-symbols-outlined text-sm">summarize</span>
                        <span>æ‘˜è¦å…§å®¹</span>
                    </div>
                </div>
            </div>
            
            <div class="p-4 flex-1 flex flex-col gap-3">
                <!-- Transcript input -->
                <div id="transcript-tab-content" class="import-tab-content active flex-1 flex flex-col gap-3">
                    <div class="flex items-center justify-between mb-1">
                        <div class="flex items-center gap-2">
                            <span class="material-symbols-outlined text-lg text-blue-600">description</span>
                            <h4 class="font-bold text-sm text-slate-800">é€å­—ç¨¿å…§å®¹</h4>
                        </div>
                        <span class="text-xs text-slate-500 font-medium">å®Œæ•´è©³ç´°ç‰ˆæœ¬</span>
                    </div>
                    <div id="modal-hint" class="bg-blue-50 text-blue-800 p-3 rounded text-xs"></div>
                    <textarea id="import-input" class="flex-1 border-2 border-blue-200 rounded-lg p-4 font-mono text-xs resize-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100 transition-all"></textarea>
                </div>
                <!-- Summary input -->
                <div id="summary-tab-content" class="import-tab-content flex-1 flex flex-col gap-3">
                    <div class="flex items-center justify-between mb-1">
                        <div class="flex items-center gap-2">
                            <span class="material-symbols-outlined text-lg text-emerald-600">summarize</span>
                            <h4 class="font-bold text-sm text-slate-800">æ‘˜è¦å…§å®¹</h4>
                        </div>
                        <span class="text-xs text-slate-500 font-medium">ç²¾ç°¡é‡é»ç‰ˆæœ¬</span>
                    </div>
                    <div class="bg-emerald-50 text-emerald-800 p-3 rounded-lg text-xs border border-emerald-200">æ ¼å¼ï¼š[{ "en": "...", "cn": "...", "t": 0 }, ...]</div>
                    <textarea id="summary-input" class="flex-1 border-2 border-emerald-200 rounded-lg p-4 font-mono text-xs resize-none focus:border-emerald-400 focus:ring-2 focus:ring-emerald-100 transition-all" placeholder="[{&quot;en&quot;:&quot;Summary paragraph&quot;,&quot;cn&quot;:&quot;æ‘˜è¦æ®µè½&quot;,&quot;t&quot;:0}]"></textarea>
                </div>
            </div>
            
            <div class="p-6 border-t border-slate-50 flex justify-between gap-3 bg-slate-50/50 rounded-b-3xl">
                <div class="flex gap-2">
                    <button id="clear-data-btn" class="px-4 py-2 rounded border border-red-300 bg-red-50 text-red-700 hover:bg-red-100 font-medium text-sm hidden">
                        <span class="material-symbols-outlined text-base align-middle">delete_outline</span> æ¸…é™¤æ‰€æœ‰ç´€éŒ„
                    </button>
                    <button id="clear-all-records-btn" class="px-4 py-2 rounded border border-red-300 bg-red-50 text-red-700 hover:bg-red-100 font-medium text-sm hidden">
                        <span class="material-symbols-outlined text-base align-middle">delete_forever</span> æ¸…é™¤å…¨éƒ¨è³‡æ–™
                    </button>
                </div>
                <div class="flex gap-3">
                    <button onclick="closeModal()" class="px-6 py-2.5 rounded-xl text-slate-500 font-bold hover:bg-slate-100 transition">Cancel</button>
                    <button id="import-action-btn" class="px-8 py-2.5 rounded-xl bg-indigo-600 text-white font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition">Load</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global State - Load from localStorage
        let transcriptData = [{"en":"So in 2015, a bride-to-be uploaded a picture of a dress to the internet -- (Laughter) And we all lost our minds. If you see this as blue and black, say \"Team blue.\" Audience: Team blue! If you see this as white and gold, how? How do you see that as white and gold? (Laughter) Why does this break our brains so much? It's because it puts us into confrontation with the fact that two minds can perceive the same reality entirely differently.","cn":"2015 å¹´ï¼Œä¸€ä½æº–æ–°å¨˜å°‡ä¸€å¼µæ´‹è£çš„ç…§ç‰‡ä¸Šå‚³åˆ°ç¶²è·¯ä¸Šâ€”â€”ï¼ˆç¬‘è²ï¼‰çµæœæˆ‘å€‘å…¨éƒ½ç‚ºä¹‹ç˜‹ç‹‚ã€‚å¦‚æœä½ çœ‹åˆ°çš„æ˜¯è—è‰²å’Œé»‘è‰²ï¼Œè«‹èªªã€Œè—éšŠã€ã€‚è§€çœ¾ï¼šè—éšŠï¼å¦‚æœä½ çœ‹åˆ°çš„æ˜¯ç™½è‰²å’Œé‡‘è‰²ï¼Œæ€éº¼æœƒï¼Ÿä½ æ€éº¼æœƒçœ‹æˆç™½è‰²å’Œé‡‘è‰²ï¼Ÿï¼ˆç¬‘è²ï¼‰ç‚ºä»€éº¼é€™æœƒè®“æˆ‘å€‘é€™éº¼å´©æ½°ï¼Ÿå› ç‚ºé€™è¿«ä½¿æˆ‘å€‘é¢å°ä¸€å€‹äº‹å¯¦ï¼šå…©å€‹å¤§è…¦å¯èƒ½å°åŒä¸€å€‹ç¾å¯¦æœ‰å®Œå…¨ä¸åŒçš„æ„ŸçŸ¥ã€‚","t":4},{"en":"I'd like to talk to you about two things. One, our minds are much more different than we think. And two, you should seek out minds that are different than your own, because that's where the magic happens.","cn":"æˆ‘æƒ³è·Ÿå„ä½è«‡å…©ä»¶äº‹ã€‚ç¬¬ä¸€ï¼Œæˆ‘å€‘çš„å¿ƒæ™ºå·®ç•°é æ¯”æˆ‘å€‘æƒ³åƒçš„é‚„è¦å¤§ã€‚ç¬¬äºŒï¼Œä½ æ‡‰è©²å»å°‹æ‰¾èˆ‡ä½ æ€ç¶­ä¸åŒçš„äººï¼Œå› ç‚ºé‚£æ‰æ˜¯å¥‡è¹Ÿç™¼ç”Ÿçš„åœ°æ–¹ã€‚","t":34},{"en":"I get to work with a lot of diverse minds by virtue of what I do. I write and produce scripts for animation on a wide variety of topics, and I create puzzles and games.","cn":"ç”±æ–¼å·¥ä½œçš„é—œä¿‚ï¼Œæˆ‘æœ‰æ©Ÿæœƒèˆ‡è¨±å¤šä¸åŒæ€ç¶­çš„äººå…±äº‹ã€‚æˆ‘æ’°å¯«ä¸¦è£½ä½œå„ç¨®ä¸»é¡Œçš„å‹•ç•«è…³æœ¬ï¼Œæˆ‘ä¹Ÿè¨­è¨ˆè¬é¡Œå’ŒéŠæˆ²ã€‚","t":45},{"en":"And a few years ago, I had my own dress moment where I realized that my brain works differently than almost everyone I know. And I'd like to show you how.","cn":"å¹¾å¹´å‰ï¼Œæˆ‘ä¹Ÿç¶“æ­·äº†è‡ªå·±çš„ã€Œæ´‹è£æ™‚åˆ»ã€ï¼Œæˆ‘æ„è­˜åˆ°æˆ‘çš„å¤§è…¦é‹ä½œæ–¹å¼èˆ‡æˆ‘èªè­˜çš„å¹¾ä¹æ‰€æœ‰äººéƒ½ä¸åŒã€‚æˆ‘æƒ³å‘å„ä½å±•ç¤ºæ˜¯æ€éº¼å›äº‹ã€‚","t":57},{"en":"So if you'll indulge me for a second, please visualize the following. You can do it with your eyes open or closed, whichever gives you the most vivid mental imagery. A rocket ship crash lands on an alien planet. A creature comes up to the hatch and knocks. And someone opens it from within.","cn":"æ‰€ä»¥ï¼Œè«‹å®¹è¨±æˆ‘èŠ±ä¸€é»æ™‚é–“ï¼Œè«‹å„ä½æƒ³åƒä»¥ä¸‹çš„ç•«é¢ã€‚ä½ å¯ä»¥çœé–‹çœ¼ç›æˆ–é–‰ä¸Šçœ¼ç›ï¼Œåªè¦èƒ½ç”¢ç”Ÿæœ€ç”Ÿå‹•çš„å¿ƒç†åœ–åƒå³å¯ã€‚ä¸€è‰˜ç«ç®­é£›èˆ¹å¢œè½åœ¨ä¸€å€‹å¤–æ˜Ÿçƒä¸Šã€‚ä¸€å€‹ç”Ÿç‰©èµ°è¿‘è‰™é–€ä¸¦æ•²é–€ã€‚ç„¶å¾Œæœ‰äººå¾è£¡é¢æ‰“é–‹äº†é–€ã€‚","t":66},{"en":"So now I'm going to ask you some questions about what you just saw. What color was the planet? What kind of creature was it? And who opened the hatch? I'll show you what I see. Nothing. That's because I have a condition called aphantasia, which is where I don't have access to my mind's eye.","cn":"ç¾åœ¨æˆ‘è¦å•ä½ å€‘ä¸€äº›é—œæ–¼å‰›å‰›çœ‹åˆ°çš„å•é¡Œã€‚é‚£å€‹æ˜Ÿçƒæ˜¯ä»€éº¼é¡è‰²çš„ï¼Ÿé‚£æ˜¯ä»€éº¼æ¨£çš„ç”Ÿç‰©ï¼Ÿæ˜¯èª°é–‹çš„è‰™é–€ï¼Ÿæˆ‘çµ¦å„ä½çœ‹çœ‹æˆ‘çœ‹åˆ°äº†ä»€éº¼ã€‚ä»€éº¼éƒ½æ²’æœ‰ã€‚é‚£æ˜¯å› ç‚ºæˆ‘æœ‰ä¸€ç¨®å«åšã€Œå¿ƒç›²ç—‡ã€ï¼ˆaphantasiaï¼‰çš„ç‹€æ³ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘ç„¡æ³•ä½¿ç”¨æˆ‘çš„ã€Œå¿ƒéˆä¹‹çœ¼ã€ã€‚","t":86},{"en":"It turns out that the mind's eye is a spectrum. On one end are about two to four percent of us with aphantasia. And at the other extreme is hyperphantasia. That's where you can visualize in exquisite detail, sometimes even able to superimpose what you're imagining on reality. That's about three to six percent of people. Everyone else is somewhere in between.","cn":"åŸä¾†ï¼Œå¿ƒéˆä¹‹çœ¼æ˜¯ä¸€å€‹å…‰è­œã€‚åœ¨ä¸€ç«¯æ˜¯å¤§ç´„ 2% åˆ° 4% æœ‰å¿ƒç›²ç—‡çš„äººã€‚è€Œåœ¨å¦ä¸€å€‹æ¥µç«¯å‰‡æ˜¯ã€Œè¶…å¹»åƒã€ï¼ˆhyperphantasiaï¼‰ã€‚é€™æ„å‘³è‘—ä½ å¯ä»¥æƒ³åƒå‡ºæ¥µå…¶ç²¾ç·»çš„ç´°ç¯€ï¼Œæœ‰æ™‚ç”šè‡³èƒ½å°‡æƒ³åƒç–ŠåŠ åœ¨ç¾å¯¦ä¹‹ä¸Šã€‚å¤§ç´„æœ‰ 3% åˆ° 6% çš„äººå±¬æ–¼é€™ä¸€é¡ã€‚å…¶ä»–äººå‰‡ä»‹æ–¼å…©è€…ä¹‹é–“ã€‚","t":108},{"en":"But there's a huge range of experience here. Everyone I do this with not only describes something different but describes the experience of experiencing it differently. So I went through most of my life assuming that most people were or everyone was like me, that a visualization exercise like this is a figure of speech that no one could actually do.","cn":"ä½†é€™è£¡å­˜åœ¨è‘—å·¨å¤§çš„é«”é©—å·®ç•°ã€‚æ¯å€‹å’Œæˆ‘ä¸€èµ·åšé€™å€‹ç·´ç¿’çš„äººï¼Œä¸åƒ…æè¿°çš„æ±è¥¿ä¸åŒï¼Œé€£ã€Œé«”é©—ã€é€™ä»¶äº‹æœ¬èº«çš„æ„Ÿå—ä¹Ÿä¸åŒã€‚æ‰€ä»¥æˆ‘é€™è¼©å­å¤§éƒ¨åˆ†æ™‚é–“éƒ½ä»¥ç‚ºå¤§å¤šæ•¸äººï¼Œæˆ–è€…æ¯å€‹äººéƒ½è·Ÿæˆ‘ä¸€æ¨£ï¼Œä»¥ç‚ºåƒé€™æ¨£çš„è¦–è¦ºåŒ–ç·´ç¿’åªæ˜¯ä¸€ç¨®ä¿®è¾­æ¯”å–»ï¼Œæ²’æœ‰äººçœŸçš„èƒ½åšåˆ°ã€‚","t":128},{"en":"So imagine my surprise and fascination and apprehension when I learned about aphantasia, the last, because it raised some scary questions like, have I been working in entirely the wrong careers my entire life? (Laughter)","cn":"æ‰€ä»¥æƒ³åƒä¸€ä¸‹ï¼Œç•¶æˆ‘å¾—çŸ¥å¿ƒç›²ç—‡æ™‚ï¼Œæˆ‘æ˜¯å¤šéº¼é©šè¨ã€è‘—è¿·åˆææ…Œï¼Œå°¤å…¶æ˜¯æœ€å¾Œä¸€é»ï¼Œå› ç‚ºå®ƒå¼•ç™¼äº†ä¸€äº›å¯æ€•çš„å•é¡Œï¼Œæ¯”å¦‚ï¼šæˆ‘é€™è¼©å­æ˜¯ä¸æ˜¯å®Œå…¨é¸éŒ¯äº†è·æ¥­ï¼Ÿï¼ˆç¬‘è²ï¼‰","t":150},{"en":"So aphantasia changes the way that those of us who have it perceive information and consume and process information. So, for example, most people I speak to who have a mind's eye describe the experience of reading a novel as seeing scenes play out in their mind and casting characters. I can't do either of those things. It's a much more conceptual experience for me.","cn":"å¿ƒç›²ç—‡æ”¹è®Šäº†æˆ‘å€‘æ„ŸçŸ¥ã€å¸æ”¶å’Œè™•ç†è³‡è¨Šçš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå¤§å¤šæ•¸æœ‰å¿ƒéˆä¹‹çœ¼çš„äººå‘Šè¨´æˆ‘ï¼Œè®€å°èªªæ™‚ï¼Œè…¦æµ·ä¸­æœƒä¸Šæ¼”å ´æ™¯ï¼Œç”šè‡³æœƒç‚ºè§’è‰²é¸è§’ã€‚é€™å…©ä»¶äº‹æˆ‘éƒ½åšä¸åˆ°ã€‚å°æˆ‘ä¾†èªªï¼Œé‚£æ›´åƒæ˜¯ä¸€ç¨®æ¦‚å¿µæ€§çš„é«”é©—ã€‚","t":163},{"en":"And when something is out of sight, it's very much out of mind. I have a five-year-old daughter. I can't in this moment imagine her face. That has a big effect on my memory. And it's also not just my mind's eye, it's also my mind's ear, though I think I have a little bit of a mind's ear, but I don't have a mind's nose or a mind's mouth. I can't, for example, imagine the taste of peanut butter.","cn":"ç•¶æ±è¥¿ä¸åœ¨è¦–ç·šç¯„åœå…§ï¼Œæˆ‘å°±çœŸçš„æƒ³ä¸èµ·ä¾†ã€‚æˆ‘æœ‰å€‹äº”æ­²çš„å¥³å…’ã€‚æ­¤æ™‚æ­¤åˆ»æˆ‘ç„¡æ³•æƒ³åƒå¥¹çš„è‡‰ã€‚é€™å°æˆ‘çš„è¨˜æ†¶åŠ›æœ‰å¾ˆå¤§çš„å½±éŸ¿ã€‚è€Œä¸”ä¸åªæ˜¯å¿ƒéˆä¹‹çœ¼ï¼Œé‚„æœ‰å¿ƒéˆä¹‹è€³ï¼Œé›–ç„¶æˆ‘è¦ºå¾—æˆ‘æœ‰ä¸€é»é»å¿ƒéˆä¹‹è€³ï¼Œä½†æˆ‘æ²’æœ‰å¿ƒéˆä¹‹é¼»æˆ–å¿ƒéˆä¹‹å£ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘ç„¡æ³•æƒ³åƒèŠ±ç”Ÿé†¬çš„å‘³é“ã€‚","t":187},{"en":"And what's it like to think in the absence of a mind's eye? It's a really tough question that's not that far off from asking what's it like to be a dolphin or a spider? And in the absence of being able to inhabit each other's consciousnesses, we can communicate about them.","cn":"é‚£éº¼ï¼Œåœ¨æ²’æœ‰å¿ƒéˆä¹‹çœ¼çš„æƒ…æ³ä¸‹æ€è€ƒæ˜¯ä»€éº¼æ„Ÿè¦ºï¼Ÿé€™æ˜¯ä¸€å€‹éå¸¸é›£å›ç­”çš„å•é¡Œï¼Œå°±è·Ÿå•ç•¶ä¸€éš»æµ·è±šæˆ–èœ˜è››æ˜¯ä»€éº¼æ„Ÿè¦ºå·®ä¸å¤šã€‚æ—¢ç„¶æˆ‘å€‘ç„¡æ³•æ£²å±…åœ¨å½¼æ­¤çš„æ„è­˜ä¸­ï¼Œæˆ‘å€‘å¯ä»¥è©¦è‘—æºé€šã€‚","t":212},{"en":"So for me, I'm generally much more aware of something's skeleton than its skin. I'm very attuned to structure. When I'm creating a game or a puzzle, I'm first dreaming up the mechanics and figuring out how they relate to each other, how they map to a story structure. And the details come later, often in collaboration with other artists.","cn":"å°æˆ‘ä¾†èªªï¼Œæˆ‘é€šå¸¸æ›´æ³¨æ„åˆ°äº‹ç‰©çš„éª¨æ¶è€Œéçš®è†šã€‚æˆ‘å°çµæ§‹éå¸¸æ•æ„Ÿã€‚ç•¶æˆ‘åœ¨è¨­è¨ˆéŠæˆ²æˆ–è¬é¡Œæ™‚ï¼Œæˆ‘é¦–å…ˆæ§‹æ€çš„æ˜¯æ©Ÿåˆ¶ï¼Œå¼„æ¸…æ¥šå®ƒå€‘å½¼æ­¤ä¹‹é–“çš„é—œä¿‚ï¼Œä»¥åŠå¦‚ä½•å°æ‡‰åˆ°æ•…äº‹çµæ§‹ã€‚ç´°ç¯€æ˜¯å¾Œä¾†æ‰åŠ ä¸Šå»çš„ï¼Œé€šå¸¸æ˜¯èˆ‡å…¶ä»–è—è¡“å®¶åˆä½œå®Œæˆã€‚","t":228},{"en":"I realize there's a leap of faith here in this idea that our minds can be so alien to each other, and I struggle with that, too. I can't understand what it's like to visualize any more than I can see the dress as white and gold.","cn":"æˆ‘æ„è­˜åˆ°è¦ç›¸ä¿¡æˆ‘å€‘çš„å¿ƒæ™ºå½¼æ­¤ä¹‹é–“å¦‚æ­¤é™Œç”Ÿï¼Œéœ€è¦ä¸€é»ä¿¡å¿µçš„é£›èºï¼Œæˆ‘ä¹Ÿå¾ˆé›£æ¥å—é€™é»ã€‚æˆ‘ç„¡æ³•ç†è§£è¦–è¦ºåŒ–æ˜¯ä»€éº¼æ„Ÿè¦ºï¼Œå°±åƒæˆ‘ç„¡æ³•æŠŠé‚£ä»¶æ´‹è£çœ‹æˆç™½è‰²å’Œé‡‘è‰²ä¸€æ¨£ã€‚","t":247},{"en":"But what's become increasingly apparent is that the mind's eye is just one of many constellations we're starting to draw in a night sky full of neurological diversity. That includes having or not having an interior monologue. It includes the autism spectrum, ADHD, dyslexia and a lot more. Probably a lot of things we have yet to even give a name to because we're just figuring all of this out.","cn":"ä½†è¶Šä¾†è¶Šæ˜é¡¯çš„æ˜¯ï¼Œå¿ƒéˆä¹‹çœ¼åªæ˜¯æˆ‘å€‘é–‹å§‹åœ¨å……æ»¿ç¥ç¶“å¤šæ¨£æ€§çš„å¤œç©ºä¸­æç¹ªå‡ºçš„çœ¾å¤šæ˜Ÿåº§ä¹‹ä¸€ã€‚é€™åŒ…æ‹¬æœ‰æ²’æœ‰å…§å¿ƒç¨ç™½ã€‚é€™åŒ…æ‹¬è‡ªé–‰ç—‡å…‰è­œã€éå‹•ç—‡ï¼ˆADHDï¼‰ã€é–±è®€éšœç¤™ç­‰ç­‰ã€‚å¯èƒ½é‚„æœ‰å¾ˆå¤šæˆ‘å€‘å°šæœªå‘½åçš„ç‰¹è³ªï¼Œå› ç‚ºæˆ‘å€‘æ‰å‰›å‰›é–‹å§‹äº†è§£é€™ä¸€åˆ‡ã€‚","t":261},{"en":"The norm is to pathologize these experiences into a list of conditions that depart from a so-called \"normal\" functioning of the mind. I think we're thinking about this completely wrong. There is no true normal out there, and difference is not deviance. Rather, these are all clues towards a vast and profound star field we're each individually blinded to because we only have our one cozy, inescapable mind as a single reference point.","cn":"é€šå¸¸çš„åšæ³•æ˜¯å°‡é€™äº›ç¶“é©—ç—…ç†åŒ–ï¼Œåˆ—ç‚ºåé›¢æ‰€è¬‚ã€Œæ­£å¸¸ã€å¿ƒæ™ºé‹ä½œçš„ç—‡ç‹€ã€‚æˆ‘èªç‚ºæˆ‘å€‘å®Œå…¨æƒ³éŒ¯äº†ã€‚ä¸–ä¸Šæ²’æœ‰çœŸæ­£çš„æ­£å¸¸ï¼Œå·®ç•°ä¸¦ä¸æ˜¯ç•°å¸¸ã€‚ç›¸ååœ°ï¼Œé€™äº›éƒ½æ˜¯é€šå¾€å»£é—Šæ·±é‚ƒæ˜ŸåŸŸçš„ç·šç´¢ï¼Œåªæ˜¯æˆ‘å€‘æ¯å€‹äººéƒ½çœ‹ä¸è¦‹ï¼Œå› ç‚ºæˆ‘å€‘åªæœ‰è‡ªå·±é€™ä¸€å€‹èˆ’é©ã€ç„¡æ³•é€ƒè„«çš„å¿ƒæ™ºä½œç‚ºå”¯ä¸€çš„åƒè€ƒé»ã€‚","t":285},{"en":"It's no secret that different people think differently. Many people on the autism spectrum excel at pattern recognition and logical deduction. Multiple studies have shown students with ADHD outperforming, on average, their peers, at creative problem solving and divergent thinking tasks, and there are very similar findings for dyslexia, especially when it comes to advanced spatial reasoning.","cn":"ä¸åŒçš„äººæœ‰ä¸åŒçš„æ€è€ƒæ–¹å¼ï¼Œé€™å·²ä¸æ˜¯ç§˜å¯†ã€‚è¨±å¤šè‡ªé–‰ç—‡å…‰è­œä¸Šçš„äººæ“…é•·æ¨¡å¼è­˜åˆ¥å’Œé‚è¼¯æ¨æ¼”ã€‚å¤šé …ç ”ç©¶é¡¯ç¤ºï¼Œæ‚£æœ‰ ADHD çš„å­¸ç”Ÿåœ¨å‰µé€ æ€§è§£æ±ºå•é¡Œå’Œç™¼æ•£æ€§æ€ç¶­ä»»å‹™ä¸Šçš„è¡¨ç¾ï¼Œå¹³å‡å„ªæ–¼åŒé½¡äººï¼›å°æ–¼é–±è®€éšœç¤™ä¹Ÿæœ‰é¡ä¼¼çš„ç™¼ç¾ï¼Œç‰¹åˆ¥æ˜¯åœ¨é«˜éšç©ºé–“æ¨ç†æ–¹é¢ã€‚","t":311},{"en":"So if difference is in fact the norm, what do we do with that? I say seek out minds that are different than your own and make something incredible together. There's a wealth of research that shows that teams of people from diverse backgrounds produce superior outcomes. I'd like to propose a corollary to this: diverse minds working together can produce wonders.","cn":"é‚£éº¼ï¼Œå¦‚æœå·®ç•°å…¶å¯¦æ‰æ˜¯å¸¸æ…‹ï¼Œæˆ‘å€‘è©²æ€éº¼è¾¦ï¼Ÿæˆ‘èªªï¼Œå»å°‹æ‰¾é‚£äº›èˆ‡ä½ æ€ç¶­ä¸åŒçš„äººï¼Œä¸€èµ·å‰µé€ å‡ºä¸å¯æ€è­°çš„äº‹ç‰©ã€‚å·²æœ‰å¤§é‡ç ”ç©¶é¡¯ç¤ºï¼Œä¾†è‡ªä¸åŒèƒŒæ™¯çš„åœ˜éšŠèƒ½ç”¢å‡ºæ›´å„ªç•°çš„æˆæœã€‚æˆ‘æƒ³å°æ­¤æå‡ºä¸€å€‹æ¨è«–ï¼šä¸åŒçš„å¿ƒæ™ºå…±åŒåˆä½œï¼Œå¯ä»¥å‰µé€ å¥‡è¹Ÿã€‚","t":333},{"en":"This comes with challenges and opportunities. So in the last decade or so, companies such as SAP, Hewlett Packard and JPMorgan have started programs designed to recruit neurodivergent talent. And in the time since, they've reported corresponding gains in productivity, morale, innovation and quality.","cn":"é€™ä¼´éš¨è‘—æŒ‘æˆ°èˆ‡æ©Ÿé‡ã€‚åœ¨éå»åå¹´å·¦å³ï¼Œåƒ SAPã€æƒ æ™®ï¼ˆHewlett Packardï¼‰å’Œæ‘©æ ¹å¤§é€šï¼ˆJPMorganï¼‰é€™æ¨£çš„å…¬å¸å·²ç¶“å•Ÿå‹•äº†æ‹›å‹Ÿç¥ç¶“å¤šæ¨£æ€§äººæ‰çš„è¨ˆç•«ã€‚å¾é‚£æ™‚èµ·ï¼Œä»–å€‘å ±å‘Šäº†åœ¨ç”Ÿç”¢åŠ›ã€å£«æ°£ã€å‰µæ–°å’Œå“è³ªæ–¹é¢çš„ç›¸æ‡‰å¢é•·ã€‚","t":356},{"en":"I see this in my own work as well. Again, by the serendipity of working in visual fields without being able to visualize, I wind up working with a lot of minds who are very different than mine. And that results in some weird and wonderful work, such as a film noir animation about fractals that I coauthored that was brought to life by a brilliant hyperphantasic animator named Jeremiah Dickey.","cn":"æˆ‘åœ¨è‡ªå·±çš„å·¥ä½œä¸­ä¹Ÿçœ‹åˆ°äº†é€™ä¸€é»ã€‚åŒæ¨£åœ°ï¼Œæ©Ÿç·£å·§åˆä¸‹ï¼Œæˆ‘åœ¨ç„¡æ³•è¦–è¦ºåŒ–çš„æƒ…æ³ä¸‹å¾äº‹è¦–è¦ºé ˜åŸŸçš„å·¥ä½œï¼Œçµæœæˆ‘å¸¸èˆ‡æ€ç¶­æ–¹å¼èˆ‡æˆ‘æˆªç„¶ä¸åŒçš„äººå…±äº‹ã€‚é€™ç”¢ç”Ÿäº†ä¸€äº›æ€ªç•°è€Œç¾å¦™çš„ä½œå“ï¼Œä¾‹å¦‚æˆ‘åˆå¯«çš„ä¸€éƒ¨é—œæ–¼ç¢å½¢çš„é»‘è‰²é›»å½±é¢¨æ ¼å‹•ç•«ï¼Œç”±ä¸€ä½æ‰è¯æ´‹æº¢ã€æ“æœ‰è¶…å¹»åƒèƒ½åŠ›çš„å‹•ç•«å¸« Jeremiah Dickey è³¦äºˆäº†ç”Ÿå‘½ã€‚","t":376},{"en":"Or this is one of my pride and joys. It's a game that's a hybrid jigsaw puzzle and escape room in a box. And the way it works -- yeah. (Laughter) The way it works is you first assemble a jigsaw, but you're missing big sections, so you have to unlock them by solving puzzles that are embedded in the illustration and artifacts that you unlock along the way.","cn":"æˆ–è€…é€™ä¹Ÿæ˜¯æˆ‘å¼•ä»¥ç‚ºå‚²çš„ä½œå“ä¹‹ä¸€ã€‚é€™æ˜¯ä¸€å€‹çµåˆäº†æ‹¼åœ–å’Œç›’è£å¯†å®¤é€ƒè„«çš„éŠæˆ²ã€‚å®ƒçš„ç©æ³•æ˜¯â€”â€”å°ã€‚ï¼ˆç¬‘è²ï¼‰å®ƒçš„ç©æ³•æ˜¯ä½ é¦–å…ˆè¦æ‹¼æ‹¼åœ–ï¼Œä½†ä½ æœƒç¼ºå°‘ä¸€å¤§å¡Šå€åŸŸï¼Œæ‰€ä»¥ä½ å¿…é ˆé€éè§£æ±ºåµŒå…¥åœ¨æ’åœ–ä¸­çš„è¬é¡Œï¼Œä»¥åŠæ²¿é€”è§£é–çš„ç‰©å“ä¾†è§£é–é€™äº›å€åŸŸã€‚","t":401},{"en":"This was made in collaboration with two incredible artists, Rita Orlov and Senne Trip, and our minds can be found in very different corners of the galaxy of neurological diversity.","cn":"é€™æ˜¯èˆ‡å…©ä½ä¸å¯æ€è­°çš„è—è¡“å®¶ Rita Orlov å’Œ Senne Trip åˆä½œå®Œæˆçš„ï¼Œæˆ‘å€‘çš„å¿ƒæ™ºä½æ–¼ç¥ç¶“å¤šæ¨£æ€§éŠ€æ²³ä¸­æˆªç„¶ä¸åŒçš„è§’è½ã€‚","t":425},{"en":"So am I working in the wrong fields? No, I don't think so. I think I'm exactly where I should be. In fact, some of the greatest joy and fulfillment in my life has been from coming to terms with the initially jarring realization that my mind works differently than the people around me, and recognizing that for what it is -- dazzling. Thank you.","cn":"æ‰€ä»¥æˆ‘é¸éŒ¯è¡Œäº†å—ï¼Ÿä¸ï¼Œæˆ‘ä¸é€™éº¼èªç‚ºã€‚æˆ‘è¦ºå¾—æˆ‘æ­£è™•æ–¼æˆ‘è©²åœ¨çš„åœ°æ–¹ã€‚äº‹å¯¦ä¸Šï¼Œæˆ‘ç”Ÿå‘½ä¸­æœ€å¤§çš„å¿«æ¨‚å’Œæ»¿è¶³æ„Ÿï¼Œéƒ¨åˆ†ä¾†è‡ªæ–¼æ¥å—äº†ã€Œæˆ‘çš„å¤§è…¦é‹ä½œæ–¹å¼èˆ‡å‘¨é­äººä¸åŒã€é€™å€‹æœ€åˆä»¤äººéœ‡é©šçš„é«”æ‚Ÿï¼Œä¸¦èªæ¸…å®ƒçš„æœ¬è³ªâ€”â€”é‚£æ˜¯ä»¤äººçœ©ç›®çš„ã€‚è¬è¬ã€‚","t":435}];
        let summaryData = [{"en":"In 2015, a photo of a dress became very famous on the internet. Some people saw the dress as blue and black. Others saw it as white and gold. This simple picture shocked everyone. Why? Because it showed us a big truth: two people can look at the same reality but perceive it completely differently.","cn":"2015å¹´ï¼Œä¸€å¼µæ´‹è£çš„ç…§ç‰‡åœ¨ç¶²è·¯ä¸Šè®Šå¾—éå¸¸æœ‰åã€‚æœ‰äº›äººçœ‹åˆ°çš„æ˜¯è—é»‘è‰²ï¼Œå…¶ä»–äººçœ‹åˆ°çš„å‰‡æ˜¯ç™½é‡‘è‰²ã€‚é€™å¼µç°¡å–®çš„ç…§ç‰‡éœ‡é©šäº†æ‰€æœ‰äººã€‚ç‚ºä»€éº¼ï¼Ÿå› ç‚ºå®ƒå‘æˆ‘å€‘å±•ç¤ºäº†ä¸€å€‹é‡è¦çš„çœŸç›¸ï¼šå…©å€‹äººçœ‹è‘—åŒæ¨£çš„ç¾å¯¦ï¼Œå»å¯èƒ½æœ‰å®Œå…¨ä¸åŒçš„æ„ŸçŸ¥ã€‚","t":0},{"en":"I want to talk about two main ideas today. First, our minds are more different than we think. Second, you should work with people who think differently than you because that is how we create magic.","cn":"ä»Šå¤©æˆ‘æƒ³è«‡è«‡å…©å€‹ä¸»è¦è§€é»ã€‚é¦–å…ˆï¼Œæˆ‘å€‘çš„å¿ƒæ™ºå·®ç•°æ¯”æˆ‘å€‘æƒ³åƒçš„é‚„è¦å¤§ã€‚å…¶æ¬¡ï¼Œä½ æ‡‰è©²èˆ‡æ€è€ƒæ–¹å¼ä¸åŒçš„äººåˆä½œï¼Œå› ç‚ºé€™æ­£æ˜¯æˆ‘å€‘å‰µé€ å¥‡è¹Ÿçš„æ–¹å¼ã€‚","t":10},{"en":"I work as a writer and a game designer. A few years ago, I realized that my brain works differently from most people. Letâ€™s try a small experiment. Please close your eyes and visualize this: A rocket ship lands on an alien planet. A creature knocks on the door, and someone opens it.","cn":"æˆ‘çš„è·æ¥­æ˜¯ä½œå®¶å’ŒéŠæˆ²è¨­è¨ˆå¸«ã€‚å¹¾å¹´å‰ï¼Œæˆ‘æ„è­˜åˆ°æˆ‘çš„å¤§è…¦é‹ä½œæ–¹å¼èˆ‡å¤§å¤šæ•¸äººä¸åŒã€‚è®“æˆ‘å€‘ä¾†åšå€‹å°å¯¦é©—ã€‚è«‹é–‰ä¸Šçœ¼ç›ä¸¦æƒ³åƒé€™å€‹ç•«é¢ï¼šä¸€è‰˜ç«ç®­é™è½åœ¨å¤–æ˜Ÿçƒä¸Šã€‚ä¸€å€‹ç”Ÿç‰©æ•²äº†æ•²é–€ï¼Œç„¶å¾Œæœ‰äººæ‰“é–‹äº†é–€ã€‚","t":20},{"en":"Now, answer these questions: What color was the planet? What did the creature look like? Here is what I see when I do this exercise: Nothing.","cn":"ç¾åœ¨ï¼Œå›ç­”é€™äº›å•é¡Œï¼šé‚£å€‹æ˜Ÿçƒæ˜¯ä»€éº¼é¡è‰²çš„ï¼Ÿé‚£å€‹ç”Ÿç‰©é•·ä»€éº¼æ¨£å­ï¼Ÿç•¶æˆ‘åšé€™å€‹ç·´ç¿’æ™‚ï¼Œæˆ‘çœ‹åˆ°çš„æ˜¯ï¼šä¸€ç‰‡ç©ºç™½ï¼ˆä»€éº¼éƒ½æ²’æœ‰ï¼‰ã€‚","t":30},{"en":"I have a condition called \"aphantasia.\" This means I do not have a \"mindâ€™s eye.\" I cannot see pictures in my head. Human imagination is like a spectrum (a range). On one side, some people have \"hyperphantasia\" and can see perfect images in their minds. On the other side, about 2% to 4% of people are like me. We see nothing.","cn":"æˆ‘æœ‰ä¸€ç¨®ç¨±ç‚ºã€Œç„¡æƒ³åƒåŠ›ç—‡ã€ï¼ˆaphantasiaï¼Œæˆ–ç¨±å¿ƒç›²ç—‡ï¼‰çš„ç‹€æ³ã€‚é€™æ„å‘³è‘—æˆ‘æ²’æœ‰ã€Œå¿ƒéˆä¹‹çœ¼ã€ï¼Œæˆ‘ç„¡æ³•åœ¨è…¦æµ·ä¸­çœ‹åˆ°ç•«é¢ã€‚äººé¡çš„æƒ³åƒåŠ›å°±åƒä¸€å€‹å…‰è­œï¼ˆç¯„åœï¼‰ã€‚åœ¨ä¸€ç«¯ï¼Œæœ‰äº›äººæ“æœ‰ã€Œè¶…å¼·æƒ³åƒåŠ›ã€ï¼Œå¯ä»¥åœ¨è…¦æµ·ä¸­çœ‹åˆ°å®Œç¾çš„åœ–åƒã€‚åœ¨å¦ä¸€ç«¯ï¼Œå¤§ç´„ 2% åˆ° 4% çš„äººåƒæˆ‘ä¸€æ¨£ï¼Œæˆ‘å€‘ä»€éº¼ä¹Ÿçœ‹ä¸åˆ°ã€‚","t":40},{"en":"For a long time, I thought everyone was like me. When people said, \"I can see it in my mind,\" I thought it was just a figure of speech. When I learned about aphantasia, I was scared. I thought, \"Am I in the wrong job?\"","cn":"å¾ˆé•·ä¸€æ®µæ™‚é–“ï¼Œæˆ‘ä»¥ç‚ºæ¯å€‹äººéƒ½è·Ÿæˆ‘ä¸€æ¨£ã€‚ç•¶äººå€‘èªªã€Œæˆ‘å¯ä»¥åœ¨è…¦æµ·ä¸­çœ‹åˆ°å®ƒã€æ™‚ï¼Œæˆ‘ä»¥ç‚ºé‚£åªæ˜¯å€‹æ¯”å–»ã€‚ç•¶æˆ‘å¾—çŸ¥ç„¡æƒ³åƒåŠ›ç—‡æ™‚ï¼Œæˆ‘æ„Ÿåˆ°å¾ˆå®³æ€•ã€‚æˆ‘æƒ³ï¼šã€Œæˆ‘æ˜¯ä¸æ˜¯å…¥éŒ¯è¡Œäº†ï¼Ÿã€","t":50},{"en":"This condition changes how I process information. For example, when most people read a book, they see a movie in their heads. I cannot do that. For me, reading is a conceptual experience. I understand the ideas, but I donâ€™t see the scenes. This also affects my memory. I have a five-year-old daughter, but when I am not looking at her, I cannot see her face in my mind.","cn":"é€™å€‹ç‹€æ³æ”¹è®Šäº†æˆ‘è™•ç†è³‡è¨Šçš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œç•¶å¤§å¤šæ•¸äººé–±è®€å°èªªæ™‚ï¼Œä»–å€‘è…¦ä¸­æœƒåƒåœ¨çœ‹é›»å½±ã€‚æˆ‘ç„¡æ³•é‚£æ¨£åšã€‚å°æˆ‘ä¾†èªªï¼Œé–±è®€æ˜¯ä¸€ç¨®æ¦‚å¿µæ€§çš„é«”é©—ã€‚æˆ‘ç†è§£é€™äº›æƒ³æ³•ï¼Œä½†çœ‹ä¸åˆ°å ´æ™¯ã€‚é€™ä¹Ÿå½±éŸ¿äº†æˆ‘çš„è¨˜æ†¶ã€‚æˆ‘æœ‰å€‹äº”æ­²çš„å¥³å…’ï¼Œä½†ç•¶æˆ‘æ²’çœ‹è‘—å¥¹æ™‚ï¼Œæˆ‘ç„¡æ³•åœ¨è…¦æµ·ä¸­æµ®ç¾å¥¹çš„è‡‰é¾ã€‚","t":60},{"en":"So, how do I design games if I cannot imagine pictures? I focus on the structureâ€”the \"skeleton\"â€”rather than the \"skin.\" I think about the rules and the story first. Then, I work with amazing artists who can visualize the details.","cn":"é‚£éº¼ï¼Œå¦‚æœæˆ‘ç„¡æ³•æƒ³åƒç•«é¢ï¼Œæˆ‘è¦å¦‚ä½•è¨­è¨ˆéŠæˆ²å‘¢ï¼Ÿæˆ‘å°ˆæ³¨æ–¼çµæ§‹â€”â€”ä¹Ÿå°±æ˜¯ã€Œéª¨æ¶ã€â€”â€”è€Œä¸æ˜¯ã€Œçš®è†šã€ã€‚æˆ‘å…ˆæ§‹æ€è¦å‰‡å’Œæ•…äº‹ã€‚ç„¶å¾Œï¼Œæˆ‘èˆ‡é‚£äº›èƒ½å¤ å°‡ç´°ç¯€å…·è±¡åŒ–çš„å„ªç§€è—è¡“å®¶åˆä½œã€‚","t":70},{"en":"This experience taught me something important. Aphantasia is just one example of neurological diversity. There are many other types, like autism, ADHD, and dyslexia. Society often treats these as illnesses or problems. I think that is wrong. There is no \"normal\" brain. Being different is not bad.","cn":"é€™æ¬¡ç¶“æ­·æ•™æœƒäº†æˆ‘ä¸€ä»¶é‡è¦çš„äº‹ã€‚ç„¡æƒ³åƒåŠ›ç—‡åªæ˜¯ç¥ç¶“å¤šæ¨£æ€§çš„ä¸€å€‹ä¾‹å­ã€‚é‚„æœ‰è¨±å¤šå…¶ä»–é¡å‹ï¼Œå¦‚è‡ªé–‰ç—‡ã€ADHDï¼ˆæ³¨æ„åŠ›ä¸è¶³éå‹•ç—‡ï¼‰å’Œé–±è®€éšœç¤™ã€‚ç¤¾æœƒé€šå¸¸å°‡é€™äº›è¦–ç‚ºç–¾ç—…æˆ–å•é¡Œã€‚æˆ‘èªç‚ºé€™æ˜¯éŒ¯çš„ã€‚ä¸¦æ²’æœ‰æ‰€è¬‚ã€Œæ­£å¸¸ã€çš„å¤§è…¦ã€‚èˆ‡çœ¾ä¸åŒä¸¦ä¸æ˜¯å£äº‹ã€‚","t":80},{"en":"In fact, research shows that teams with different types of people produce better results. Companies are starting to hire people who think differently, and they are seeing great success. In my career, I work with artists who have powerful visual imaginations. Because our minds are different, we make wonderful things together.","cn":"äº‹å¯¦ä¸Šï¼Œç ”ç©¶é¡¯ç¤ºç”±ä¸åŒé¡å‹çš„äººçµ„æˆçš„åœ˜éšŠèƒ½ç”¢ç”Ÿæ›´å¥½çš„çµæœã€‚ä¼æ¥­é–‹å§‹åƒ±ç”¨æ€è€ƒæ–¹å¼ä¸åŒçš„äººï¼Œä¸¦ä¸”çœ‹è¦‹äº†å·¨å¤§çš„æˆåŠŸã€‚åœ¨æˆ‘çš„è·æ¥­ç”Ÿæ¶¯ä¸­ï¼Œæˆ‘èˆ‡æ“æœ‰å¼·å¤§è¦–è¦ºæƒ³åƒåŠ›çš„è—è¡“å®¶åˆä½œã€‚æ­£å› ç‚ºæˆ‘å€‘çš„å¿ƒæ™ºä¸åŒï¼Œæˆ‘å€‘ä¸€èµ·å‰µé€ äº†ç¾å¦™çš„äº‹ç‰©ã€‚","t":90},{"en":"So, am I in the wrong field? No. I realized that my different mind is not a weakness. It is a gift. We should all look for minds that are different from ours. When we combine our different ways of thinking, we can do incredible things.","cn":"æ‰€ä»¥ï¼Œæˆ‘å…¥éŒ¯è¡Œäº†å—ï¼Ÿä¸ã€‚æˆ‘æ„è­˜åˆ°æˆ‘ç¨ç‰¹çš„å¿ƒæ™ºä¸æ˜¯å¼±é»ï¼Œè€Œæ˜¯ç¦®ç‰©ã€‚æˆ‘å€‘éƒ½æ‡‰è©²å°‹æ‰¾èˆ‡æˆ‘å€‘ä¸åŒçš„å¿ƒæ™ºã€‚ç•¶æˆ‘å€‘çµåˆå½¼æ­¤ä¸åŒçš„æ€è€ƒæ–¹å¼æ™‚ï¼Œæˆ‘å€‘å°±èƒ½æˆå°±ä¸å¯æ€è­°çš„äº‹ã€‚","t":100}];
        let vocabData = [{"id":"indulge","word":"Indulge","ipa":"/ÉªnËˆdÊŒldÊ’/","pos":"verb","def":"To allow oneself or someone else to enjoy a particular pleasure or privilege, often used in requests.","cn":"é·å°±ï¼›ç¸±å®¹ (æ­¤è™•æŒ‡è¬›è€…è«‹æ±‚è½çœ¾æš«æ™‚é…åˆåšæƒ³åƒç·´ç¿’)"},{"id":"aphantasia","word":"Aphantasia","ipa":"/ËŒeÉª.fÃ¦nËˆteÉª.Ê’É™/","pos":"noun","def":"A neurological condition characterized by the inability to voluntarily create mental images in one's mind.","cn":"å¿ƒç›²ç—‡ (ç„¡æ³•åœ¨è…¦æµ·ä¸­é€²è¡Œè¦–è¦ºæƒ³åƒçš„ç‹€æ³)"},{"id":"hyperphantasia","word":"Hyperphantasia","ipa":"/ËŒhaÉª.pÉ™r.fÃ¦nËˆteÉª.Ê’É™/","pos":"noun","def":" The condition of having extremely vivid mental imagery, often indistinguishable from reality.","cn":"è¶…å¹»åƒ (æ“æœ‰æ¥µåº¦æ¸…æ™°ã€ç”Ÿå‹•çš„å¿ƒç†è¦–è¦ºæˆåƒèƒ½åŠ›)"},{"id":"superimpose","word":"Superimpose","ipa":"/ËŒsuË.pÉš.ÉªmËˆpoÊŠz/","pos":"verb","def":"To place or lay one thing over another, typically so that both are still evident.","cn":"ç–ŠåŠ  (å°‡å½±åƒç–Šåœ¨ç¾å¯¦å ´æ™¯ä¹‹ä¸Š)"},{"id":"apprehension","word":"Apprehension","ipa":"/ËŒÃ¦p.rÉ™Ëˆhen.ÊƒÉ™n/","pos":"noun","def":"Anxiety or fear that something bad or unpleasant will happen.","cn":"æ†‚æ…®ï¼›ææ‡¼ (æ“”å¿ƒè‡ªå·±è·æ¥­ç”Ÿæ¶¯å—å½±éŸ¿)"},{"id":"attuned","word":"Attuned","ipa":"/É™ËˆtuËnd/","pos":"adjective","def":"Receptive or aware; accustomed to or harmonious with something.","cn":"æ•éŠ³çš„ï¼›èƒ½ç†è§£çš„ (æ­¤è™•æŒ‡å°çµæ§‹ç‰¹åˆ¥æ•æ„Ÿ)"},{"id":"pathologize","word":"Pathologize","ipa":"/pÉ™ËˆÎ¸É‘Ë.lÉ™.dÊ’aÉªz/","pos":"verb","def":"To regard or treat a condition or behavior as medically or psychologically abnormal.","cn":"ç—…ç†åŒ– (å°‡æŸç¨®ç‰¹è³ªè¦–ç‚ºç–¾ç—…æˆ–ç•°å¸¸ç‹€æ³)"},{"id":"deviance","word":"Deviance","ipa":"/ËˆdiË.vi.É™ns/","pos":"noun","def":"The fact or state of departing from usual or accepted standards, especially in social or sexual behavior.","cn":"ç•°å¸¸ï¼›è¶Šè»Œ (å¼·èª¿èˆ‡å¸¸æ…‹ä¸åŒä¸¦éå£äº‹)"},{"id":"divergent","word":"Divergent","ipa":"/dÉªËˆvÉË.dÊ’É™nt/","pos":"adjective","def":"Tending to be different or develop in different directions; used in 'divergent thinking' for creative idea generation.","cn":"ç™¼æ•£çš„ï¼›åˆ†æ­§çš„ (æŒ‡ç™¼æ•£æ€§æ€è€ƒï¼Œå³èƒ½æå‡ºå¤šç¨®è§£æ±ºæ–¹æ¡ˆçš„èƒ½åŠ›)"},{"id":"corollary","word":"Corollary","ipa":"/ËˆkÉ”Ër.É™.ler.i/","pos":"noun","def":"A proposition that follows from (and is often appended to) one already proved.","cn":"æ¨è«–ï¼›å¿…ç„¶çš„çµæœ"},{"id":"serendipity","word":"Serendipity","ipa":"/ËŒser.É™nËˆdÉªp.É™.tÌ¬i/","pos":"noun","def":"The occurrence and development of events by chance in a happy or beneficial way.","cn":"æ©Ÿç·£å·§åˆï¼›æ„å¤–ç™¼ç¾çå¯¶çš„é‹æ°£"},{"id":"jarring","word":"Jarring","ipa":"/ËˆdÊ’É‘Ër.ÉªÅ‹/","pos":"adjective","def":"Causing a physical shock, jolt, or vibration; incongruous in a striking or shocking way.","cn":"ä»¤äººéœ‡é©šçš„ï¼›åˆºè€³çš„ï¼›ä¸å’Œè«§çš„"}];
        let summaryVocabData = [{"id":"perceive","word":"Perceive","ipa":"/pÉ™rËˆsiËv/","pos":"verb","def":"To interpret or become aware of something through the senses or the mind.","cn":"æ„ŸçŸ¥ï¼›å¯Ÿè¦ºï¼›ç†è§£"},{"id":"visualize","word":"Visualize","ipa":"/ËˆvÉªÊ’.u.É™.laÉªz/","pos":"verb","def":"To form a mental image of something; to imagine.","cn":"æƒ³åƒï¼›åœ¨è…¦æµ·ä¸­é¡¯ç¾åœ–åƒ"},{"id":"aphantasia","word":"Aphantasia","ipa":"/ËŒeÉª.fÃ¦nËˆteÉª.Ê’É™/","pos":"noun","def":"A condition where a person cannot voluntarily create mental images in their mind.","cn":"ç„¡æƒ³åƒåŠ›ç—‡ (åˆç¨±å¿ƒç›²ç—‡)"},{"id":"spectrum","word":"Spectrum","ipa":"/Ëˆspek.trÉ™m/","pos":"noun","def":"A range of different positions, opinions, or values between two extreme points.","cn":"å…‰è­œï¼›ç¯„åœï¼›å¹…åº¦"},{"id":"hyperphantasia","word":"Hyperphantasia","ipa":"/ËŒhaÉª.pÉ™r.fÃ¦nËˆteÉª.Ê’É™/","pos":"noun","def":"The condition of having extremely vivid mental imagery.","cn":"è¶…å¼·æƒ³åƒåŠ› (å¿ƒåƒæ¥µåº¦æ¸…æ™°)"},{"id":"conceptual","word":"Conceptual","ipa":"/kÉ™nËˆsep.tÊƒu.É™l/","pos":"adjective","def":"Based on ideas or principles rather than concrete examples or physical reality.","cn":"æ¦‚å¿µä¸Šçš„ï¼›è§€å¿µçš„"},{"id":"neurological","word":"Neurological","ipa":"/ËŒnÊŠr.É™ËˆlÉ‘Ë.dÊ’Éª.kÉ™l/","pos":"adjective","def":"Relating to the anatomy, functions, and organic disorders of nerves and the nervous system.","cn":"ç¥ç¶“å­¸çš„ï¼›ç¥ç¶“ç³»çµ±çš„"},{"id":"dyslexia","word":"Dyslexia","ipa":"/dÉªsËˆlek.si.É™/","pos":"noun","def":"A learning disorder that affects a person's ability to read, write, and spell.","cn":"é–±è®€éšœç¤™"}];
        let quizData = {"english":[{"q":"According to the text, what is \"aphantasia\"?","options":["The ability to see perfect images in the mind.","The inability to voluntarily visualize mental images.","A condition where one cannot recognize faces.","A type of color blindness affecting how one sees clothing."],"correct":1},{"q":"How does the author approach game design without a \"mind's eye\"?","options":["By focusing on the visual details first.","By hiring someone else to do all the work.","By focusing on the structure, rules, and story.","By only writing books instead of games."],"correct":2},{"q":"Why did the author initially feel scared upon learning about their condition?","options":["They thought they were losing their memory.","They feared they were in the wrong career field.","They were afraid of doctors.","They thought they would eventually go blind."],"correct":1},{"q":"What does the author imply by comparing human imagination to a \"spectrum\"?","options":["Everyone visualizes exactly the same way.","Most people fall into the category of hyperphantasia.","There is a wide range of visualization abilities among people.","Imagination is strictly related to seeing colors like a rainbow."],"correct":2},{"q":"What is the main purpose of mentioning the \"dress\" photo in the introduction?","options":["To teach the audience about fashion trends.","To prove that some people have better eyesight than others.","To show that people can perceive the same reality differently.","To explain why the photo went viral on the internet."],"correct":2},{"q":"What is the author's core message regarding neurological diversity (like autism, ADHD, etc.)?","options":["These are illnesses that need to be fixed immediately.","Companies should avoid hiring people who think differently.","There is only one \"normal\" way for a brain to function.","Different ways of thinking are gifts that create better outcomes."],"correct":3}],"chinese":[{"q":"æ ¹æ“šæ–‡ç« ï¼Œã€Œç„¡æƒ³åƒåŠ›ç—‡ã€(aphantasia) æ˜¯ä»€éº¼ï¼Ÿ","options":["èƒ½åœ¨è…¦æµ·ä¸­çœ‹è¦‹å®Œç¾å½±åƒçš„èƒ½åŠ›ã€‚","ç„¡æ³•åœ¨è…¦æµ·ä¸­è‡ªä¸»ç”¢ç”Ÿè¦–è¦ºå½±åƒã€‚","ä¸€ç¨®ç„¡æ³•è¾¨è­˜äººè‡‰çš„ç‹€æ³ã€‚","ä¸€ç¨®å½±éŸ¿äººå€‘è§€çœ‹è¡£ç‰©çš„è‰²ç›²ã€‚",""],"correct":1},{"q":"ä½œè€…å¦‚ä½•åœ¨æ²’æœ‰ã€Œå¿ƒéˆä¹‹çœ¼ã€çš„æƒ…æ³ä¸‹é€²è¡ŒéŠæˆ²è¨­è¨ˆï¼Ÿ","options":["å„ªå…ˆå°ˆæ³¨æ–¼è¦–è¦ºç´°ç¯€ã€‚","è˜è«‹å…¶ä»–äººä¾†åšæ‰€æœ‰çš„å·¥ä½œã€‚","å°ˆæ³¨æ–¼çµæ§‹ã€è¦å‰‡å’Œæ•…äº‹ã€‚","åªå¯«æ›¸è€Œä¸è¨­è¨ˆéŠæˆ²ã€‚"],"correct":2},{"q":"ç‚ºä»€éº¼ä½œè€…åœ¨å¾—çŸ¥è‡ªå·±çš„ç‹€æ³æ™‚æœ€åˆæ„Ÿåˆ°å®³æ€•ï¼Ÿ","options":["ä»–å€‘ä»¥ç‚ºè‡ªå·±æ­£åœ¨å¤±å»è¨˜æ†¶ã€‚","ä»–å€‘æ“”å¿ƒè‡ªå·±é¸éŒ¯äº†è·æ¥­é ˜åŸŸã€‚","ä»–å€‘å®³æ€•çœ‹é†«ç”Ÿã€‚","ä»–å€‘ä»¥ç‚ºè‡ªå·±æœ€çµ‚æœƒå¤±æ˜ã€‚"],"correct":1},{"q":"ä½œè€…å°‡äººé¡çš„æƒ³åƒåŠ›æ¯”å–»ç‚ºã€Œå…‰è­œã€ï¼Œæš—ç¤ºäº†ä»€éº¼ï¼Ÿ","options":["æ¯å€‹äººçš„æƒ³åƒæ–¹å¼éƒ½å®Œå…¨ç›¸åŒã€‚","å¤§å¤šæ•¸äººéƒ½å±¬æ–¼æ“æœ‰è¶…å¼·æƒ³åƒåŠ›çš„é¡åˆ¥ã€‚","äººå€‘çš„è¦–è¦ºåŒ–èƒ½åŠ›å­˜åœ¨å¾ˆå¤§å·®ç•°ã€‚","æƒ³åƒåŠ›åš´æ ¼ä¾†èªªèˆ‡çœ‹è¦‹åƒå½©è™¹ä¸€æ¨£çš„é¡è‰²æœ‰é—œã€‚"],"correct":2},{"q":"å¼•è¨€ä¸­æåˆ°ã€Œæ´‹è£ã€ç…§ç‰‡çš„ä¸»è¦ç›®çš„æ˜¯ä»€éº¼ï¼Ÿ","options":["ä»¥æ­¤æ•™å°è§€çœ¾æœ‰é—œæ™‚å°šè¶¨å‹¢ã€‚","è­‰æ˜æœ‰äº›äººçš„è¦–åŠ›æ¯”åˆ¥äººå¥½ã€‚","é¡¯ç¤ºäººå€‘å°åŒä¸€ç¾å¯¦å¯èƒ½æœ‰ä¸åŒçš„æ„ŸçŸ¥ã€‚","è§£é‡‹ç‚ºä»€éº¼é€™å¼µç…§ç‰‡åœ¨ç¶²è·¯ä¸Šçˆ†ç´…ã€‚"],"correct":2},{"q":"é—œæ–¼ç¥ç¶“å¤šæ¨£æ€§ï¼ˆå¦‚è‡ªé–‰ç—‡ã€ADHDç­‰ï¼‰ï¼Œä½œè€…çš„æ ¸å¿ƒè¨Šæ¯æ˜¯ä»€éº¼ï¼Ÿ","options":["é€™äº›æ˜¯éœ€è¦ç«‹å³æ²»ç™‚çš„ç–¾ç—…ã€‚","å…¬å¸æ‡‰é¿å…åƒ±ç”¨æ€è€ƒæ–¹å¼ä¸åŒçš„äººã€‚","å¤§è…¦åªæœ‰ä¸€ç¨®ã€Œæ­£å¸¸ã€çš„é‹ä½œæ–¹å¼ã€‚","ä¸åŒçš„æ€è€ƒæ–¹å¼æ˜¯å¤©è³¦ï¼Œèƒ½å‰µé€ æ›´å¥½çš„æˆæœã€‚"],"correct":3}]};
        let quizLanguage = 'english'; // 'english' or 'chinese'
        let videoId = localStorage.getItem('videoId') || '';
        let selectedWords = [];
        let cefrLevel = localStorage.getItem('cefrLevel') || ''; // Store selected CEFR level
        let currentViewMode = 'transcript'; // 'transcript' or 'summary'
        let currentImportTab = 'transcript'; // Track which tab is active in import modal
        let currentVocabTab = 'transcript'; // Track which vocab tab is active in vocab modal
        let translationsVisible = false;
        let player;
        let playerReady = false;
        let headerLinks = JSON.parse(localStorage.getItem('headerLinks') || '[]');
        
        // TTS (Text-to-Speech) State
        let currentSpeakingSegment = null;
        let isSpeechPaused = false;

        // Sticky video functionality
        const videoContainer = document.getElementById('video-container');
        const videoSection = document.getElementById('video-section');
        const videoPlaceholder = document.getElementById('video-placeholder');
        const closeBtn = document.getElementById('close-sticky-video');
        const floatingCloseBtn = document.getElementById('floating-close-btn');
        let isSticky = false;
        let manuallyHidden = false;
        let initialTop = 0;
        let isTransitioning = false; // æ¨™è¨˜è½‰æ›ç‹€æ…‹

        // Calculate initial position once
        if (videoSection) {
            setTimeout(() => {
                initialTop = videoSection.getBoundingClientRect().top + window.scrollY;
            }, 100);
        }

        function updateStickyVideo() {
            if (!videoSection || manuallyHidden || isTransitioning) return;
            
            const shouldBeSticky = window.scrollY > initialTop + 100;
            
            if (shouldBeSticky && !isSticky) {
                videoContainer.classList.add('sticky-video');
                videoPlaceholder.classList.remove('hidden');
                closeBtn.classList.remove('hidden');
                floatingCloseBtn.classList.remove('hidden');
                isSticky = true;
            } else if (!shouldBeSticky && isSticky) {
                videoContainer.classList.remove('sticky-video');
                videoPlaceholder.classList.add('hidden');
                closeBtn.classList.add('hidden');
                floatingCloseBtn.classList.add('hidden');
                isSticky = false;
            }
        }

        function closeStickyVideo() {
            videoContainer.classList.remove('sticky-video');
            videoPlaceholder.classList.add('hidden');
            closeBtn.classList.add('hidden');
            floatingCloseBtn.classList.add('hidden');
            isSticky = false;
            manuallyHidden = true;
        }

        function manualToggleSticky() {
            if (isSticky) {
                // å¦‚æœå·²ç¶“æ˜¯æµ®å‹•ç‹€æ…‹ï¼Œé—œé–‰å®ƒ
                closeStickyVideo();
            } else {
                // é–‹å•Ÿæµ®å‹•æ¨¡å¼
                isTransitioning = true;
                videoContainer.classList.add('sticky-video');
                videoPlaceholder.classList.remove('hidden');
                closeBtn.classList.remove('hidden');
                floatingCloseBtn.classList.remove('hidden');
                isSticky = true;
                manuallyHidden = false;
                
                // çŸ­æš«ç¦ç”¨æ»¾å‹•äº‹ä»¶ç›£è½å™¨ï¼Œé¿å…ä½ç½®æ”¹è®Šè§¸ç™¼å¤šæ¬¡æ›´æ–°
                setTimeout(() => {
                    isTransitioning = false;
                }, 300);
            }
        }

        closeBtn.addEventListener('click', closeStickyVideo);
        floatingCloseBtn.addEventListener('click', closeStickyVideo);

        window.addEventListener('scroll', updateStickyVideo);
        window.addEventListener('resize', () => {
            if (videoSection && !manuallyHidden) {
                initialTop = videoSection.getBoundingClientRect().top + window.scrollY;
                updateStickyVideo();
            }
        });

        let youtubeAPIReady = false;
        let currentFontSize = 18; // base font size in px
        let currentPlaybackSpeed = 1.0;

        // Formspree configuration - è«‹å°‡æ­¤ç¶²å€æ›¿æ›ç‚ºæ‚¨çš„ Formspree endpoint
        // ä¾‹å¦‚: 'https://formspree.io/f/YOUR_FORM_ID'
        const FORMSPREE_ENDPOINT = 'https://formspree.io/f/mwvqzeej';

        const modal = document.getElementById('import-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalHint = document.getElementById('modal-hint');
        const inputArea = document.getElementById('import-input');
        const actionBtn = document.getElementById('import-action-btn');
        const floatingCard = document.getElementById('floating-card');
        const transcriptPromptBtn = document.getElementById('copy-transcript-prompt-btn');
        const headerLinksTrigger = document.getElementById('header-links-trigger');
        const headerLinksMenu = document.getElementById('header-links-menu');
        const headerLinksList = document.getElementById('header-links-list');
        const headerLinkNameInput = document.getElementById('header-link-name');
        const headerLinkUrlInput = document.getElementById('header-link-url');
        const headerLinkAddBtn = document.getElementById('header-link-add-btn');

        function saveHeaderLinks() {
            localStorage.setItem('headerLinks', JSON.stringify(headerLinks));
        }

        function renderHeaderLinks() {
            if (!headerLinksList) return;
            headerLinksList.innerHTML = '';
            if (headerLinks.length === 0) {
                headerLinksList.innerHTML = '<div class="text-xs text-slate-400">å°šæœªæ–°å¢é€£çµ</div>';
                return;
            }
            headerLinks.forEach((link, index) => {
                const item = document.createElement('div');
                item.className = 'header-link-item';
                item.innerHTML = `
                    <a href="${link.url}" target="_blank" rel="noopener" class="text-xs text-blue-600 hover:text-blue-700 truncate">${link.name}</a>
                    <button class="text-xs text-slate-400 hover:text-red-500" title="ç§»é™¤" data-index="${index}">âœ•</button>
                `;
                const removeBtn = item.querySelector('button');
                removeBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (confirm(`ç¢ºå®šè¦ç§»é™¤ã€Œ${link.name}ã€å—ï¼Ÿ`)) {
                        removeHeaderLink(index);
                    }
                });
                headerLinksList.appendChild(item);
            });
        }

        function addHeaderLink() {
            const name = headerLinkNameInput.value.trim();
            const url = headerLinkUrlInput.value.trim();
            if (!name || !url) return;
            headerLinks.push({ name, url });
            saveHeaderLinks();
            renderHeaderLinks();
            headerLinkNameInput.value = '';
            headerLinkUrlInput.value = '';
        }

        function removeHeaderLink(index) {
            headerLinks.splice(index, 1);
            saveHeaderLinks();
            renderHeaderLinks();
        }

        function toggleHeaderLinksMenu() {
            if (!headerLinksMenu) return;
            headerLinksMenu.classList.toggle('hidden');
            if (!headerLinksMenu.classList.contains('hidden')) {
                renderHeaderLinks();
                headerLinkNameInput.focus();
            }
        }

        function closeHeaderLinksMenu() {
            if (!headerLinksMenu) return;
            headerLinksMenu.classList.add('hidden');
        }

        // Modal Functions
        function openModal(mode) {
            modal.classList.remove('hidden');
            inputArea.value = '';
            inputArea.focus();
            const clearBtn = document.getElementById('clear-data-btn');
            const clearAllBtn = document.getElementById('clear-all-records-btn');
            const copyBtn = document.getElementById('copy-prompt-btn');
            const cefrBtn = document.getElementById('copy-cefr-prompt-btn');
            const vocabTranscriptPromptBtn = document.getElementById('copy-vocab-transcript-prompt-btn');
            const vocabSummaryPromptBtn = document.getElementById('copy-vocab-summary-prompt-btn');
            window.currentModalMode = mode;
            
            if (mode === 'video') {
                modalTitle.innerText = "è¨­å®š YouTube å½±ç‰‡";
                modalHint.innerText = 'è²¼ä¸Š YouTube ç¶²å€æˆ–å½±ç‰‡ ID';
                inputArea.placeholder = 'https://www.youtube.com/watch?v=...';
                actionBtn.onclick = parseVideoUrl;
                clearBtn.classList.add('hidden');
                clearAllBtn.classList.remove('hidden');
                copyBtn.classList.add('hidden');
                transcriptPromptBtn.classList.add('hidden');
                cefrBtn.classList.add('hidden');
                vocabTranscriptPromptBtn.classList.add('hidden');
                vocabSummaryPromptBtn.classList.add('hidden');
                
                // Hide transcript/summary tabs for video mode
                const importTabs = document.getElementById('import-tabs');
                importTabs.classList.add('hidden');
                
                // Show only the transcript tab content (which has the main input), hide summary
                const transcriptContent = document.getElementById('transcript-tab-content');
                const summaryContent = document.getElementById('summary-tab-content');
                transcriptContent.classList.remove('hidden');
                transcriptContent.classList.add('active');
                summaryContent.classList.add('hidden');
                summaryContent.classList.remove('active');
                
                clearAllBtn.onclick = () => {
                    if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„å—ï¼Ÿ\n\næ­¤æ“ä½œæœƒæ¸…é™¤ï¼šå½±ç‰‡é€£çµã€é€å­—ç¨¿ã€å–®å­—ã€æ¸¬é©—ã€æ‘˜è¦æ¨¡å¼èˆ‡é¸å­—ã€‚')) {
                        clearAllRecords();
                    }
                };
            } else if (mode === 'transcript') {
                modalTitle.innerText = "åŒ¯å…¥é€å­—ç¨¿";
                modalHint.innerText = 'æ ¼å¼ï¼š[{ "en": "...", "cn": "...", "t": 0 }, ...]';
                inputArea.placeholder = '[{"en":"Hello","cn":"ä½ å¥½","t":0}]';
                actionBtn.onclick = parseTranscriptOrSummary;
                clearBtn.classList.remove('hidden');
                clearAllBtn.classList.add('hidden');
                copyBtn.classList.remove('hidden');
                transcriptPromptBtn.classList.remove('hidden');
                cefrBtn.classList.remove('hidden');
                vocabTranscriptPromptBtn.classList.add('hidden');
                vocabSummaryPromptBtn.classList.add('hidden');
                
                // Show tabs for transcript/summary switching
                const importTabs = document.getElementById('import-tabs');
                importTabs.classList.remove('hidden');
                const tabs = importTabs.querySelectorAll('.import-tab');
                if (tabs[0]) tabs[0].innerHTML = '<span class="material-symbols-outlined text-sm align-middle">description</span> é€å­—ç¨¿';
                if (tabs[1]) tabs[1].innerHTML = '<span class="material-symbols-outlined text-sm align-middle">summarize</span> æ‘˜è¦';
                if (tabs[0]) tabs[0].setAttribute('onclick', "switchImportTab('transcript')");
                if (tabs[1]) tabs[1].setAttribute('onclick', "switchImportTab('summary')");
                
                // Show the input areas for transcript/summary
                const transcriptContent = document.getElementById('transcript-tab-content');
                const summaryContent = document.getElementById('summary-tab-content');
                if (transcriptContent) transcriptContent.classList.remove('hidden');
                if (summaryContent) summaryContent.classList.remove('hidden');
                
                // Load existing data into inputs
                if (transcriptData.length > 0) {
                    inputArea.value = JSON.stringify(transcriptData, null, 2);
                }
                const summaryInput = document.getElementById('summary-input');
                if (summaryData.length > 0) {
                    summaryInput.value = JSON.stringify(summaryData, null, 2);
                }
                
                clearBtn.onclick = () => {
                    if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰é€å­—ç¨¿èˆ‡æ‘˜è¦ç´€éŒ„å—ï¼Ÿ')) {
                        clearTranscriptData();
                    }
                };
            } else if (mode === 'vocab') {
                modalTitle.innerText = "åŒ¯å…¥å–®å­—";
                modalHint.innerText = 'æ ¼å¼ï¼š[{ "word": "...", "def": "...", "pos": "n." }, ...]';
                inputArea.placeholder = '[{"word":"Example","def":"ç¯„ä¾‹"}]';
                actionBtn.onclick = parseVocab;
                clearBtn.classList.remove('hidden');
                clearAllBtn.classList.add('hidden');
                copyBtn.classList.add('hidden');
                transcriptPromptBtn.classList.add('hidden');
                cefrBtn.classList.add('hidden');
                vocabTranscriptPromptBtn.classList.remove('hidden');
                vocabSummaryPromptBtn.classList.remove('hidden');
                
                // Show tabs for vocab mode
                const importTabs = document.getElementById('import-tabs');
                importTabs.classList.remove('hidden');
                
                // Update tab labels to "é€å­—ç¨¿å–®å­—" and "æ‘˜è¦å–®å­—"
                const tabs = importTabs.querySelectorAll('.import-tab');
                if (tabs[0]) tabs[0].innerHTML = '<span class="material-symbols-outlined text-sm align-middle">description</span> é€å­—ç¨¿å–®å­—';
                if (tabs[1]) tabs[1].innerHTML = '<span class="material-symbols-outlined text-sm align-middle">summarize</span> æ‘˜è¦å–®å­—';
                
                // Load existing vocab data into inputs
                if (vocabData.length > 0) {
                    inputArea.value = JSON.stringify(vocabData, null, 2);
                }
                const summaryInput = document.getElementById('summary-input');
                if (summaryVocabData.length > 0) {
                    summaryInput.value = JSON.stringify(summaryVocabData, null, 2);
                }
                
                // Update hint text for each tab
                const transcriptContent = document.getElementById('transcript-tab-content');
                const summaryContent = document.getElementById('summary-tab-content');
                if (transcriptContent) {
                    const transcriptHint = transcriptContent.querySelector('.bg-blue-50');
                    if (transcriptHint) transcriptHint.textContent = 'æ ¼å¼ï¼š[{ "word": "...", "def": "...", "pos": "n." }, ...]';
                }
                if (summaryContent) {
                    const summaryHint = summaryContent.querySelector('.bg-emerald-50');
                    if (summaryHint) summaryHint.textContent = 'æ ¼å¼ï¼š[{ "word": "...", "def": "...", "pos": "n." }, ...]';
                }
                
                // Switch tabs to use vocab-specific function
                const tabButtons = importTabs.querySelectorAll('.import-tab');
                if (tabButtons[0]) tabButtons[0].setAttribute('onclick', "switchVocabTab('transcript')");
                if (tabButtons[1]) tabButtons[1].setAttribute('onclick', "switchVocabTab('summary')");
                
                clearBtn.onclick = () => {
                    if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å–®å­—ç´€éŒ„å—ï¼Ÿ')) {
                        clearVocabData();
                    }
                };
            } else {
                modalTitle.innerText = "åŒ¯å…¥ Quizï¼ˆé›™èªæ ¼å¼ï¼‰";
                modalHint.innerText = 'æ ¼å¼ï¼š{ "english": [{"q":"...", "options":[...], "correct":0}], "chinese": [{"q":"...", "options":[...], "correct":0}] }';
                inputArea.placeholder = '{"english":[{"q":"Question?","options":["A","B","C","D"],"correct":0}],"chinese":[{"q":"é¡Œç›®?","options":["A","B","C","D"],"correct":0}]}';
                actionBtn.onclick = parseQuiz;
                clearBtn.classList.remove('hidden');
                clearAllBtn.classList.add('hidden');
                copyBtn.classList.remove('hidden');
                transcriptPromptBtn.classList.add('hidden');
                cefrBtn.classList.add('hidden');
                vocabTranscriptPromptBtn.classList.add('hidden');
                vocabSummaryPromptBtn.classList.add('hidden');
                
                // Hide tabs for quiz mode
                const importTabs = document.getElementById('import-tabs');
                importTabs.classList.add('hidden');
                
                // Show only the transcript tab content (which has the main input), hide summary
                const transcriptContent = document.getElementById('transcript-tab-content');
                const summaryContent = document.getElementById('summary-tab-content');
                transcriptContent.classList.remove('hidden');
                transcriptContent.classList.add('active');
                summaryContent.classList.add('hidden');
                summaryContent.classList.remove('active');
                
                clearBtn.onclick = () => {
                    if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ Quiz é¡Œåº«å—ï¼Ÿ')) {
                        clearQuizData();
                    }
                };
            }
        }
        
        function switchImportTab(tab) {
            currentImportTab = tab;
            const transcriptTab = document.querySelector('.import-tab:first-child');
            const summaryTab = document.querySelector('.import-tab:last-child');
            const transcriptContent = document.getElementById('transcript-tab-content');
            const summaryContent = document.getElementById('summary-tab-content');
            
            if (tab === 'transcript') {
                transcriptTab.classList.add('active');
                summaryTab.classList.remove('active');
                transcriptContent.classList.add('active');
                summaryContent.classList.remove('active');
            } else {
                transcriptTab.classList.remove('active');
                summaryTab.classList.add('active');
                transcriptContent.classList.remove('active');
                summaryContent.classList.add('active');
            }
        }
        
        function switchVocabTab(tab) {
            currentVocabTab = tab;
            const transcriptTab = document.querySelector('.import-tab:first-child');
            const summaryTab = document.querySelector('.import-tab:last-child');
            const transcriptContent = document.getElementById('transcript-tab-content');
            const summaryContent = document.getElementById('summary-tab-content');
            
            if (tab === 'transcript') {
                transcriptTab.classList.add('active');
                summaryTab.classList.remove('active');
                transcriptContent.classList.add('active');
                summaryContent.classList.remove('active');
            } else {
                transcriptTab.classList.remove('active');
                summaryTab.classList.add('active');
                transcriptContent.classList.remove('active');
                summaryContent.classList.add('active');
            }
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        if (headerLinksTrigger) {
            headerLinksTrigger.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleHeaderLinksMenu();
            });
        }

        if (headerLinkAddBtn) {
            headerLinkAddBtn.addEventListener('click', (e) => {
                e.preventDefault();
                addHeaderLink();
            });
        }

        document.addEventListener('click', (e) => {
            if (!headerLinksMenu || headerLinksMenu.classList.contains('hidden')) return;
            const withinMenu = headerLinksMenu.contains(e.target);
            const withinTrigger = headerLinksTrigger && headerLinksTrigger.contains(e.target);
            if (!withinMenu && !withinTrigger) {
                closeHeaderLinksMenu();
            }
        });

        function selectQuizLanguage(lang) {
            quizLanguage = lang;
            updateQuizLanguageSelector();
            renderQuizContent(); // é‡æ–°æ¸²æŸ“é¡Œç›®
        }

        function updateQuizLanguageSelector() {
            const btnEn = document.getElementById('quiz-select-en');
            const btnZh = document.getElementById('quiz-select-zh');
            
            if (!btnEn || !btnZh) return;
            
            if (quizLanguage === 'english') {
                btnEn.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                btnEn.classList.remove('bg-white', 'text-slate-700', 'border-slate-300');
                btnZh.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                btnZh.classList.add('bg-white', 'text-slate-700', 'border-slate-300');
            } else {
                btnZh.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                btnZh.classList.remove('bg-white', 'text-slate-700', 'border-slate-300');
                btnEn.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                btnEn.classList.add('bg-white', 'text-slate-700', 'border-slate-300');
            }
        }


        function generateTranscriptPrompt() {
            let prompt = '';
            
            // Add video URL if available
            if (videoId && videoId.length === 11) {
                prompt += `https://www.youtube.com/watch?v=${videoId}\n\n`;
            } else {
                prompt += 'ğŸ”»\n\n';
            }
            
            prompt += `å°‡ä»¥ä¸Šå½±ç‰‡çš„æ¼”è¬›å…§å®¹ï¼Œæ•´ç†æˆè‹±æ–‡å’Œä¸­æ–‡éš¨æ®µè½å°ç…§çš„é€å­—ç¨¿ï¼Œä¸¦ä»¥ä»¥ä¸‹æ ¼å¼åš´æ ¼ä¾ç…§ JSON Array æ ¼å¼è¼¸å‡ºçµæœï¼šï¼š
{
    en: "When I found out my grandmother, my last living grandparent, was dying, my first thought was, \"I need to draw her hands.\" I'm a visual artist, a cartoonist for The New Yorker, and comics writer, so drawing is how I understand much of the world.",
    cn: "ç•¶æˆ‘å¾—çŸ¥æˆ‘çš„ç¥–æ¯â€”â€”æˆ‘æœ€å¾Œä¸€ä½åœ¨ä¸–çš„ç¥–çˆ¶æ¯â€”â€”å³å°‡é›¢ä¸–æ™‚ï¼Œæˆ‘çš„ç¬¬ä¸€å€‹å¿µé ­æ˜¯ï¼šã€Œæˆ‘éœ€è¦ç•«ä¸‹å¥¹çš„æ‰‹ã€‚ã€æˆ‘æ˜¯ä¸€ä½è¦–è¦ºè—è¡“å®¶ï¼Œä¹Ÿæ˜¯ã€Šç´ç´„å®¢ã€‹çš„æ¼«ç•«å®¶å’Œæ¼«ç•«ä½œè€…ï¼Œæ‰€ä»¥ç¹ªç•«æ˜¯æˆ‘ç†è§£é€™å€‹ä¸–ç•Œçš„ä¸»è¦æ–¹å¼ã€‚"
},
{
    en: "For a long time, my cartoons had been impersonal. Commentary on the world around me, sure, but not really about me. The closest my personal life got to influencing my cartoons were cartoons I lifted from things my friends and family had said around me. It was only after my daughter Ellika was born that my personal life began to creep into my cartoons more.",
    cn: "å¾ˆé•·ä¸€æ®µæ™‚é–“ä»¥ä¾†ï¼Œæˆ‘çš„æ¼«ç•«éƒ½æ˜¯éå€‹äººåŒ–çš„ã€‚å®ƒå€‘æ˜¯å°å‘¨é­ä¸–ç•Œçš„è©•è«–ï¼Œæ²’éŒ¯ï¼Œä½†ä¸¦ä¸çœŸæ­£é—œæ–¼æˆ‘è‡ªå·±ã€‚æˆ‘çš„å€‹äººç”Ÿæ´»å°æ¼«ç•«æœ€æ¥è¿‘çš„å½±éŸ¿ï¼Œé ‚å¤šå°±æ˜¯å¾æœ‹å‹å’Œå®¶äººçš„è«‡è©±ä¸­å–æã€‚ç›´åˆ°æˆ‘å¥³å…’åŸƒè‰å¡ (Ellika) å‡ºç”Ÿå¾Œï¼Œæˆ‘çš„å€‹äººç”Ÿæ´»æ‰é–‹å§‹æ›´å¤šåœ°æ»²é€é€²æˆ‘çš„æ¼«ç•«ä¸­ã€‚"
}`;
            
            return prompt;
        }

        function generateQuizPrompt() {
            let prompt = '# Role: ä½ æ˜¯ä¸€ä½è³‡æ·±çš„è‹±èªæ•™å­¸è©•é‡å°ˆå®¶ï¼Œå°ˆç²¾æ–¼ CEFR ç­‰ç´šåˆ†æèˆ‡é–±è®€ç†è§£è¨ºæ–·ã€‚\n\n';
            prompt += '# Task: è«‹é‡å°æˆ‘æä¾›çš„è‹±æ–‡æ–‡ç« ï¼Œè¨­è¨ˆä¸€ä»½ç”¨æ–¼ã€Œè©•ä¼°å­¸ç”Ÿé–±è®€ç¨‹åº¦ã€çš„é¡Œçµ„ã€‚\n\n';
            prompt += '# Requirements:\n\n';
            prompt += '1. **æ–‡ç« ç¨‹åº¦è¨ºæ–·**ï¼šå…ˆç°¡è¿°é€™ç¯‡æ–‡ç« åœ¨ CEFR æ¨™æº–ä¸‹å±¬æ–¼å“ªå€‹ç­‰ç´šï¼Œä¸¦åˆ—å‡º 5-10 å€‹å½±éŸ¿é›£åº¦çš„é—œéµè©å½™ã€‚\n\n';
            prompt += '2. **é¡Œçµ„è¨­è¨ˆ**ï¼šè«‹æ ¹æ“šã€Œé–±è®€ç†è§£ä¸‰å±¤æ¬¡ã€è¨­è¨ˆ 6 é“é¸æ“‡é¡Œï¼š\n';
            prompt += '   - Level 1: å­—é¢ç†è§£é¡Œ (Literal) x 2 (ç­”æ¡ˆç›´æ¥åœ¨æ–‡ä¸­)\n';
            prompt += '   - Level 2: æ¨è«–ç†è§£é¡Œ (Inferential) x 2 (éœ€è¦æ•´åˆä¸Šä¸‹æ–‡æˆ–çŒœæ¸¬èªæ°£)\n';
            prompt += '   - Level 3: æ‰¹åˆ¤/æ•´åˆé¡Œ (Evaluative) x 2 (éœ€è¦ç†è§£ä½œè€…æ ¸å¿ƒæ„åœ–æˆ–å»¶ä¼¸æ€è€ƒ)\n\n';
            prompt += '3. **è®€è€…ç¨‹åº¦è¨ºæ–·æŒ‡å—**ï¼šé€™éƒ¨åˆ†æœ€é‡è¦ã€‚è«‹æä¾›ä¸€å€‹å°ç…§è¡¨ï¼Œèªªæ˜å­¸ç”Ÿç­”å°é¡Œæ•¸æ‰€ä»£è¡¨çš„ CEFR é–±è®€èƒ½åŠ›è½é»ï¼Œä»¥åŠå¾ŒçºŒçš„å­¸ç¿’å»ºè­°ã€‚\n\n';
            prompt += '# Output Format:\n\n';
            prompt += '---\n\n';
            prompt += '## ä¸€ã€ æ–‡ç« é›£åº¦åˆ†æ (CEFR Level)\n\n';
            prompt += '## äºŒã€ é–±è®€è©•ä¼°é¡Œçµ„ (é™„é¸é …èˆ‡æ­£ç¢ºç­”æ¡ˆ)\n\n';
            prompt += '## ä¸‰ã€ å­¸ç”Ÿç¨‹åº¦è¨ºæ–·æŒ‡å— (Diagnostic Guide)\n\n';
            prompt += '- ç­”å° 0-2 é¡Œï¼šç¨‹åº¦è½é»èˆ‡å»ºè­°\n';
            prompt += '- ç­”å° 3-4 é¡Œï¼šç¨‹åº¦è½é»èˆ‡å»ºè­°\n';
            prompt += '- ç­”å° 5-6 é¡Œï¼šç¨‹åº¦è½é»èˆ‡å»ºè­°\n\n';
            prompt += '---\n\n';
            prompt += 'Please output a JSON object with TWO keys: "english" and "chinese", each containing a JSON Array of questions.\n';
            prompt += 'Format specifications:\n\n';
            prompt += '{\n';
            prompt += '  "english": [\n';
            prompt += '    { "q": "Question in English", "options": ["Option A", "Option B", "Option C", "Option D"], "correct": 0 },\n';
            prompt += '    ...\n';
            prompt += '  ],\n';
            prompt += '  "chinese": [\n';
            prompt += '    { "q": "é¡Œç›®ä¸­æ–‡ç¿»è­¯", "options": ["é¸é …A", "é¸é …B", "é¸é …C", "é¸é …D"], "correct": 0 },\n';
            prompt += '    ...\n';
            prompt += '  ]\n';
            prompt += '}\n\n';
            prompt += 'Requirements:\n';
            prompt += '- Both English and Chinese versions must have the SAME questions with the SAME correct answers (index).\n';
            prompt += '- English: questions and options in English\n';
            prompt += '- Chinese: complete translation of questions and options to Traditional Chinese\n';
            prompt += '- Output ONLY the JSON object, no explanations or extra text.\n';
            prompt += '- Questions should cover content comprehension, key details, main idea, and inference.\n';
            prompt += '- Avoid duplicate questions or overly similar options.\n';
            prompt += '- Content must be faithful to the transcript; do not add information not present in it.\n\n';
            prompt += 'English transcript:';
            
            if (transcriptData.length > 0) {
                const englishText = transcriptData.map(seg => seg.en).join(' ');
                prompt += englishText;
            } else {
                prompt += 'ğŸ”»';
            }
            
            return prompt;
        }

        function generateVocabPromptForSource(sourceTab) {
            let prompt = 'ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„è‹±èªæ•™å­¸å°ˆå®¶èˆ‡ç¨‹å¼é–‹ç™¼è¼”åŠ©è€…ã€‚è«‹åˆ†ææˆ‘æä¾›çš„æ–‡ç« ï¼Œä¸¦å¾ä¸­æŒ‘é¸å‡ºå°è®€è€…å¯èƒ½è¼ƒé›£ã€å†·åƒ»æˆ–å…·å‚™å­¸ç¿’åƒ¹å€¼çš„ç”Ÿå­—ï¼ˆå»ºè­°é›£åº¦ B2-C2 æˆ–ç‰¹å®šé ˜åŸŸè¡“èªï¼‰ã€‚\n\n';
            prompt += 'è«‹åš´æ ¼ä¾ç…§ä»¥ä¸‹ JSON Array æ ¼å¼è¼¸å‡ºçµæœï¼š\n\n';
            prompt += '1.  **id**: å–®å­—çš„å…¨å°å¯«å½¢å¼ã€‚\n';
            prompt += '2.  **word**: å–®å­—çš„é¦–å­—æ¯å¤§å¯«ã€‚\n';
            prompt += '3.  **ipa**: è©²å–®å­—çš„ IPA éŸ³æ¨™ã€‚\n';
            prompt += '4.  **pos**: è©æ€§ (å¦‚ noun, verb, adjective)ã€‚\n';
            prompt += '5.  **def**: ç°¡æ½”çš„è‹±æ–‡å®šç¾©ã€‚\n';
            prompt += '6.  **cn**: ç¹é«”ä¸­æ–‡è§£é‡‹ (è‹¥æœ‰ç‰¹å®šèªå¢ƒè«‹ä¸€ä½µæ¨™è¨»)ã€‚\n';
            prompt += 'ç¯„ä¾‹æ ¼å¼ï¼š\n';
            prompt += '[\n    {\n        "id": "pareidolia",\n        "word": "Pareidolia",\n        "ipa": "/ËŒpÃ¦r.ÉªËˆdoÊŠ.li.É™/",\n        "pos": "noun",\n        "def": "The psychological phenomenon of seeing recognizable shapes, especially faces, in random or vague stimuli.",\n        "cn": "å¹»æƒ³æ€§éŒ¯è¦º (å°¤æŒ‡å°‡æ¨¡ç³Šåœ–åƒçœ‹ä½œäººè‡‰)",\n     }\n]\n\n';
            prompt += 'æ–‡ç« å…§å®¹å¦‚ä¸‹ï¼š\n';
            
            // Add text based on source tab
            if (sourceTab === 'transcript' && transcriptData.length > 0) {
                const englishText = transcriptData.map(seg => seg.en).join(' ');
                prompt += englishText + '\n\n';
            } else if (sourceTab === 'summary' && summaryData.length > 0) {
                const englishText = summaryData.map(seg => seg.en).join(' ');
                prompt += englishText + '\n\n';
            } else {
                prompt += 'ğŸ”»\n\n';
            }
            
            return prompt;
        }

        function generateVocabPrompt() {
            const isVocabMode = window.currentModalMode === 'vocab';
            const sourceTab = isVocabMode ? currentVocabTab : 'transcript';
            return generateVocabPromptForSource(sourceTab);
        }

        function copyVocabPrompt(sourceTab) {
            const promptText = generateVocabPromptForSource(sourceTab);
            if (!promptText) {
                alert('ç„¡æ³•ç”Ÿæˆprompt');
                return;
            }
            
            navigator.clipboard.writeText(promptText).then(() => {
                const buttonId = sourceTab === 'summary' ? 'copy-vocab-summary-prompt-btn' : 'copy-vocab-transcript-prompt-btn';
                const btn = document.getElementById(buttonId);
                if (!btn) return;
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<span class="material-symbols-outlined">done</span> å·²è¤‡è£½';
                btn.classList.add('opacity-80');
                
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.classList.remove('opacity-80');
                }, 2000);
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹é‡è©¦');
            });
        }

        function generateCEFRAdaptationPrompt(targetLevel, options = {}) {
            let prompt = '# Role: ä½ æ˜¯ä¸€ä½è³‡æ·±çš„è‹±èªæ•™æç·¨å¯«å°ˆå®¶ï¼Œæ“…é•·æ ¹æ“š CEFR æ¨™æº–èª¿æ•´æ–‡æœ¬é›£åº¦ã€‚\n\n';
            prompt += '# Task: è«‹å°‡æˆ‘æä¾›çš„åŸå§‹é€å­—ç¨¿ï¼Œæ”¹å¯«ç‚ºç¬¦åˆ [' + targetLevel + '] ç¨‹åº¦çš„è‹±æ–‡æ–‡ç« ã€‚\n\n';
            prompt += '# Requirements by CEFR Level:\n';
            prompt += '- è‹¥ç›®æ¨™ç‚º **A2/B1**ï¼šä½¿ç”¨å¸¸ç”¨å–®å­—ï¼ˆæ ¸å¿ƒ 2000-3000 å­—ï¼‰ï¼Œå¥å­çµæ§‹ä»¥å–®å¥ç‚ºä¸»ï¼Œé¿å…è¤‡é›œçš„å­å¥ã€‚\n';
            prompt += '- è‹¥ç›®æ¨™ç‚º **B2**ï¼šå¯ä»¥ä½¿ç”¨è¼ƒå…·é«”çš„æè¿°æ€§å‹•è©ï¼Œå…è¨±å‡ºç¾è¤‡åˆå¥ï¼Œä½†æ‡‰ä¿æŒé‚è¼¯çµæ§‹æ¸…æ™°ã€‚\n';
            prompt += '- è‹¥ç›®æ¨™ç‚º **C1**ï¼šä¿æŒåŸå§‹æ–‡ç« çš„ç²¾ç¢ºæ€§èˆ‡ä¿®é£¾èªï¼Œå¼·åŒ–å­¸è¡“æˆ–æ–‡å­¸æ€§çš„è½‰æŠ˜è©ã€‚\n\n';
            prompt += '# Guidelines:\n';
            prompt += '1. **çµæ§‹å„ªåŒ–**ï¼šå°‡åŸæœ¬é›œäº‚çš„å£èªé€å­—ç¨¿æ•´ç†æˆé‚è¼¯é€šé †çš„æ®µè½ã€‚\n';
            prompt += '2. **èªæ°£ä¿ç•™**ï¼šä¿ç•™åŸä½œè€…çš„æ ¸å¿ƒè§€é»ã€æ•…äº‹èˆ‡æƒ…æ„Ÿè‰²å½©ï¼Œä¸è¦åˆªé™¤é‡è¦çš„ä¾‹å­ã€‚\n';
            prompt += '3. **è©å½™èª¿æ•´**ï¼š[é‡å°ç›®æ¨™ç¨‹åº¦ï¼Œæ›¿æ›æ‰éæ–¼è‰±æ¾€æˆ–éæ–¼ç°¡å–®çš„è©å½™]ã€‚\n';
            
            // Add optional guidelines
            if (options.keepNarrative) {
                prompt += '4. **ä¿æŒæ•˜äº‹çµæ§‹**ï¼šè«‹ä¿æŒæ•˜äº‹çµæ§‹ï¼Œåƒ…ç°¡åŒ–å–®å­—èˆ‡æ–‡æ³•ã€‚\n';
            }
            if (options.keepCulturalRef) {
                prompt += '5. **ä¿ç•™æ–‡åŒ–å…¸æ•…**ï¼šè«‹ä¿ç•™æ–‡ç« ä¸­çš„æ–‡åŒ–å…¸æ•…ï¼Œä½†è«‹ç”¨ç°¡å–®çš„è‹±æ–‡å¥å­è£œå……è§£é‡‹è©²å…¸æ•…çš„æ„æ€ã€‚\n';
            }
            
            prompt += '6. **è¼¸å‡ºæ ¼å¼**ï¼š\n';
            prompt += '   - æ¨™é¡Œï¼š[ç‚ºæ”¹å¯«å¾Œçš„æ–‡ç« èµ·ä¸€å€‹æ¨™é¡Œ]\n';
            prompt += '   - æœ¬æ–‡ï¼š[æ”¹å¯«å¾Œçš„æ–‡ç« å…§å®¹]\n';
            prompt += '   - é—œéµå–®å­—è¡¨ï¼š[åˆ—å‡º 5 å€‹ç¬¦åˆè©²ç¨‹åº¦ã€ä¸”å°ç†è§£æœ¬æ–‡è‡³é—œé‡è¦çš„å–®å­—èˆ‡ä¸­è§£]\n\n';
            prompt += '# Target Level: ' + targetLevel + '\n\n';
            prompt += '# Original Transcript (åŸå§‹é€å­—ç¨¿):\n';
            
            if (transcriptData.length > 0) {
                const englishText = transcriptData.map(seg => seg.en).join(' ');
                prompt += englishText;
            } else {
                prompt += 'ğŸ”»';
            }
            
            return prompt;
        }

        async function openCEFRLevelSelector() {
            // Create a modal for selecting CEFR level with checkboxes
            const levelHTML = `
                <div id="cefr-level-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 9999;">
                    <div style="background: white; border-radius: 16px; padding: 32px; text-align: left; box-shadow: 0 20px 25px rgba(0,0,0,0.15); max-width: 450px;">
                        <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 24px; color: #1f2937; text-align: center;">é¸æ“‡ç›®æ¨™é›£åº¦ç­‰ç´š</h3>
                        
                        <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px;">
                            <button onclick="copyCEFRPrompt('A2')" style="padding: 12px 24px; border: 2px solid #60a5fa; background: #dbeafe; color: #2563eb; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.2s;">
                                A2 (Elementary)
                            </button>
                            <button onclick="copyCEFRPrompt('B1')" style="padding: 12px 24px; border: 2px solid #60a5fa; background: #dbeafe; color: #2563eb; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.2s;">
                                B1 (Intermediate)
                            </button>
                            <button onclick="copyCEFRPrompt('B2')" style="padding: 12px 24px; border: 2px solid #60a5fa; background: #dbeafe; color: #2563eb; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.2s;">
                                B2 (Upper-Intermediate)
                            </button>
                            <button onclick="copyCEFRPrompt('C1')" style="padding: 12px 24px; border: 2px solid #60a5fa; background: #dbeafe; color: #2563eb; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.2s;">
                                C1 (Advanced)
                            </button>
                        </div>
                        
                        <div style="border-top: 2px solid #e5e7eb; padding-top: 24px; margin-bottom: 24px;">
                            <p style="font-size: 14px; font-weight: bold; color: #4b5563; margin-bottom: 12px;">é¡å¤–é¸é … (å¯è¤‡é¸)ï¼š</p>
                            <label style="display: flex; align-items: center; margin-bottom: 12px; cursor: pointer;">
                                <input type="checkbox" id="cefr-narrative-checkbox" style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
                                <span style="color: #374151; font-size: 14px;">ä¿æŒæ•˜äº‹çµæ§‹</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="cefr-cultural-checkbox" style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
                                <span style="color: #374151; font-size: 14px;">ä¿ç•™æ–‡åŒ–å…¸æ•…</span>
                            </label>
                        </div>
                        
                        <div style="display: flex; gap: 12px;">
                            <button onclick="closeCEFRModal()" style="flex: 1; padding: 12px 24px; border: 2px solid #d1d5db; background: #f3f4f6; color: #6b7280; border-radius: 8px; font-weight: bold; cursor: pointer;">
                                å–æ¶ˆ
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', levelHTML);
        }

        function closeCEFRModal() {
            const modal = document.getElementById('cefr-level-modal');
            if (modal) modal.remove();
        }

        async function copyCEFRPrompt(level) {
            // Get checkbox states before closing modal
            const narrativeCheckbox = document.getElementById('cefr-narrative-checkbox');
            const culturalCheckbox = document.getElementById('cefr-cultural-checkbox');
            
            const options = {
                keepNarrative: narrativeCheckbox ? narrativeCheckbox.checked : false,
                keepCulturalRef: culturalCheckbox ? culturalCheckbox.checked : false
            };
            
            closeCEFRModal();
            
            try {
                // Try to read from clipboard first
                let clipboardText = '';
                try {
                    clipboardText = await navigator.clipboard.readText();
                } catch (e) {
                    console.warn('ç„¡æ³•è®€å–å‰ªè²¼ç°¿ï¼Œå°‡ä½¿ç”¨æ‡‰ç”¨ä¸­çš„é€å­—ç¨¿');
                }
                
                // Build the CEFR prompt with clipboard content or app data
                let prompt = '# Role: ä½ æ˜¯ä¸€ä½è³‡æ·±çš„è‹±èªæ•™æç·¨å¯«å°ˆå®¶ï¼Œæ“…é•·æ ¹æ“š CEFR æ¨™æº–èª¿æ•´æ–‡æœ¬é›£åº¦ã€‚\n\n';
                prompt += '# Task: è«‹å°‡æˆ‘æä¾›çš„åŸå§‹é€å­—ç¨¿ï¼Œæ”¹å¯«ç‚ºç¬¦åˆ [' + level + '] ç¨‹åº¦çš„è‹±æ–‡æ–‡ç« ã€‚\n\n';
                prompt += '# Requirements by CEFR Level:\n';
                prompt += '- è‹¥ç›®æ¨™ç‚º **A2/B1**ï¼šä½¿ç”¨å¸¸ç”¨å–®å­—ï¼ˆæ ¸å¿ƒ 2000-3000 å­—ï¼‰ï¼Œå¥å­çµæ§‹ä»¥å–®å¥ç‚ºä¸»ï¼Œé¿å…è¤‡é›œçš„å­å¥ã€‚\n';
                prompt += '- è‹¥ç›®æ¨™ç‚º **B2**ï¼šå¯ä»¥ä½¿ç”¨è¼ƒå…·é«”çš„æè¿°æ€§å‹•è©ï¼Œå…è¨±å‡ºç¾è¤‡åˆå¥ï¼Œä½†æ‡‰ä¿æŒé‚è¼¯çµæ§‹æ¸…æ™°ã€‚\n';
                prompt += '- è‹¥ç›®æ¨™ç‚º **C1**ï¼šä¿æŒåŸå§‹æ–‡ç« çš„ç²¾ç¢ºæ€§èˆ‡ä¿®é£¾èªï¼Œå¼·åŒ–å­¸è¡“æˆ–æ–‡å­¸æ€§çš„è½‰æŠ˜è©ã€‚\n\n';
                prompt += '# Guidelines:\n';
                prompt += '1. **çµæ§‹å„ªåŒ–**ï¼šå°‡åŸæœ¬é›œäº‚çš„å£èªé€å­—ç¨¿æ•´ç†æˆé‚è¼¯é€šé †çš„æ®µè½ã€‚\n';
                prompt += '2. **èªæ°£ä¿ç•™**ï¼šä¿ç•™åŸä½œè€…çš„æ ¸å¿ƒè§€é»ã€æ•…äº‹èˆ‡æƒ…æ„Ÿè‰²å½©ï¼Œä¸è¦åˆªé™¤é‡è¦çš„ä¾‹å­ã€‚\n';
                prompt += '3. **è©å½™èª¿æ•´**ï¼š[é‡å°ç›®æ¨™ç¨‹åº¦ï¼Œæ›¿æ›æ‰éæ–¼è‰±æ¾€æˆ–éæ–¼ç°¡å–®çš„è©å½™]ã€‚\n';
                
                if (options.keepNarrative) {
                    prompt += '4. **ä¿æŒæ•˜äº‹çµæ§‹**ï¼šè«‹ä¿æŒæ•˜äº‹çµæ§‹ï¼Œåƒ…ç°¡åŒ–å–®å­—èˆ‡æ–‡æ³•ã€‚\n';
                }
                if (options.keepCulturalRef) {
                    prompt += '5. **ä¿ç•™æ–‡åŒ–å…¸æ•…**ï¼šè«‹ä¿ç•™æ–‡ç« ä¸­çš„æ–‡åŒ–å…¸æ•…ï¼Œä½†è«‹ç”¨ç°¡å–®çš„è‹±æ–‡å¥å­è£œå……è§£é‡‹è©²å…¸æ•…çš„æ„æ€ã€‚\n';
                }
                
                prompt += '6. **è¼¸å‡ºæ ¼å¼**ï¼š\n';
                prompt += '   - æ¨™é¡Œï¼š[ç‚ºæ”¹å¯«å¾Œçš„æ–‡ç« èµ·ä¸€å€‹æ¨™é¡Œ]\n';
                prompt += '   - æœ¬æ–‡ï¼š[æ”¹å¯«å¾Œçš„æ–‡ç« å…§å®¹]\n';
                prompt += '   - é—œéµå–®å­—è¡¨ï¼š[åˆ—å‡º 5 å€‹ç¬¦åˆè©²ç¨‹åº¦ã€ä¸”å°ç†è§£æœ¬æ–‡è‡³é—œé‡è¦çš„å–®å­—èˆ‡ä¸­è§£]\n\n';
                prompt += '# Target Level: ' + level + '\n\n';
                prompt += '# Original Transcript (åŸå§‹é€å­—ç¨¿):\n';
                
                // Use clipboard content if available, otherwise use app data
                if (clipboardText.trim().length > 0) {
                    prompt += clipboardText;
                } else if (transcriptData.length > 0) {
                    const englishText = transcriptData.map(seg => seg.en).join(' ');
                    prompt += englishText;
                } else {
                    prompt += 'ğŸ”»';
                }
                
                await navigator.clipboard.writeText(prompt);
                
                // Save CEFR level to localStorage
                localStorage.setItem('cefrLevel', level);
                cefrLevel = level;
                
                // Enable summary mode - hide segment controls
                document.body.classList.add('summary-mode');
                
                // Update transcript title
                const transcriptTitle = document.getElementById('transcript-title');
                if (transcriptTitle) {
                    transcriptTitle.textContent = `æ‘˜è¦ï¼ˆ${level}ï¼‰`;
                }
                
                alert(`âœ… CEFR ${level} é›£åº¦èª¿æ•´ Prompt å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿\næ‘˜è¦æ¨™é¡Œå·²æ›´æ–°ç‚ºï¼šæ‘˜è¦ï¼ˆ${level}ï¼‰\nåˆ†æ®µæŒ‰éˆ•å·²éš±è—`);
                console.log(`âœ… CEFR ${level} Promptå·²è¤‡è£½ï¼Œæ¨™é¡Œå·²æ›´æ–°ç‚ºï¼šæ‘˜è¦ï¼ˆ${level}ï¼‰ï¼Œé€²å…¥æ‘˜è¦æ¨¡å¼`);
            } catch (err) {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹é‡è©¦');
            }
        }

        function copyPrompt() {
            let promptText = '';
            
            if (window.currentModalMode === 'transcript') {
                promptText = generateTranscriptPrompt();
            } else if (window.currentModalMode === 'vocab') {
                promptText = generateVocabPrompt();
            } else if (window.currentModalMode === 'quiz') {
                promptText = generateQuizPrompt();
            }
            
            if (!promptText) {
                alert('ç„¡æ³•ç”Ÿæˆprompt');
                return;
            }
            
            navigator.clipboard.writeText(promptText).then(() => {
                const copyBtn = document.getElementById('copy-prompt-btn');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span class="material-symbols-outlined">done</span>';
                copyBtn.style.color = '#10b981';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.style.color = '';
                }, 2000);
                
                console.log('âœ… Promptå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹é‡è©¦');
            });
        }

        async function copyTranscriptPromptFromClipboard() {
            try {
                const clipboardText = await navigator.clipboard.readText();
                const sourceText = clipboardText.trim() ? clipboardText.trim() : 'ğŸ”»';
                const promptText = `${sourceText}

å°‡ä»¥ä¸Šæœªç¶“æ•´ç†çš„æ–‡ç¨¿å…§å®¹ï¼Œæ•´ç†æˆè‹±æ–‡å’Œä¸­æ–‡éš¨æ®µè½å°ç…§çš„é€å­—ç¨¿ï¼Œä¸¦ä»¥ä»¥ä¸‹æ ¼å¼åš´æ ¼ä¾ç…§ JSON Array æ ¼å¼è¼¸å‡ºçµæœï¼šï¼š
{
    en: "When I found out my grandmother, my last living grandparent, was dying, my first thought was, \"I need to draw her hands.\" I'm a visual artist, a cartoonist for The New Yorker, and comics writer, so drawing is how I understand much of the world.",
    cn: "ç•¶æˆ‘å¾—çŸ¥æˆ‘çš„ç¥–æ¯â€”â€”æˆ‘æœ€å¾Œä¸€ä½åœ¨ä¸–çš„ç¥–çˆ¶æ¯â€”â€”å³å°‡é›¢ä¸–æ™‚ï¼Œæˆ‘çš„ç¬¬ä¸€å€‹å¿µé ­æ˜¯ï¼šã€Œæˆ‘éœ€è¦ç•«ä¸‹å¥¹çš„æ‰‹ã€‚ã€æˆ‘æ˜¯ä¸€ä½è¦–è¦ºè—è¡“å®¶ï¼Œä¹Ÿæ˜¯ã€Šç´ç´„å®¢ã€‹çš„æ¼«ç•«å®¶å’Œæ¼«ç•«ä½œè€…ï¼Œæ‰€ä»¥ç¹ªç•«æ˜¯æˆ‘ç†è§£é€™å€‹ä¸–ç•Œçš„ä¸»è¦æ–¹å¼ã€‚"
},
{
    en: "For a long time, my cartoons had been impersonal. Commentary on the world around me, sure, but not really about me. The closest my personal life got to influencing my cartoons were cartoons I lifted from things my friends and family had said around me. It was only after my daughter Ellika was born that my personal life began to creep into my cartoons more.",
    cn: "å¾ˆé•·ä¸€æ®µæ™‚é–“ä»¥ä¾†ï¼Œæˆ‘çš„æ¼«ç•«éƒ½æ˜¯éå€‹äººåŒ–çš„ã€‚å®ƒå€‘æ˜¯å°å‘¨é­ä¸–ç•Œçš„è©•è«–ï¼Œæ²’éŒ¯ï¼Œä½†ä¸¦ä¸çœŸæ­£é—œæ–¼æˆ‘è‡ªå·±ã€‚æˆ‘çš„å€‹äººç”Ÿæ´»å°æ¼«ç•«æœ€æ¥è¿‘çš„å½±éŸ¿ï¼Œé ‚å¤šå°±æ˜¯å¾æœ‹å‹å’Œå®¶äººçš„è«‡è©±ä¸­å–æã€‚ç›´åˆ°æˆ‘å¥³å…’åŸƒè‰å¡ (Ellika) å‡ºç”Ÿå¾Œï¼Œæˆ‘çš„å€‹äººç”Ÿæ´»æ‰é–‹å§‹æ›´å¤šåœ°æ»²é€é€²æˆ‘çš„æ¼«ç•«ä¸­ã€‚"
}`;

                await navigator.clipboard.writeText(promptText);
                const originalHTML = transcriptPromptBtn.innerHTML;
                transcriptPromptBtn.innerHTML = '<span class="material-symbols-outlined text-base align-middle">done</span> å·²è¤‡è£½';
                transcriptPromptBtn.classList.remove('bg-blue-50', 'text-blue-700');
                transcriptPromptBtn.classList.add('bg-emerald-50', 'text-emerald-700');

                setTimeout(() => {
                    transcriptPromptBtn.innerHTML = originalHTML;
                    transcriptPromptBtn.classList.remove('bg-emerald-50', 'text-emerald-700');
                    transcriptPromptBtn.classList.add('bg-blue-50', 'text-blue-700');
                }, 2000);
            } catch (err) {
                console.error('è®€å–æˆ–è¤‡è£½å‰ªè²¼ç°¿å¤±æ•—:', err);
                alert('ç„¡æ³•è®€å–å‰ªè²¼ç°¿å…§å®¹ï¼Œè«‹å…è¨±ç€è¦½å™¨å­˜å–å‰ªè²¼ç°¿å¾Œé‡è©¦ã€‚');
            }
        }

        function parseJSON(str) {
            str = str.trim();
            // å¦‚æœä¸æ˜¯ [ æˆ– { é–‹é ­ï¼Œå‡è¨­ç‚ºé™£åˆ—ä¸¦åŠ ä¸Š []
            if (!str.startsWith('[') && !str.startsWith('{')) {
                str = '[' + str + ']';
            }
            return JSON.parse(str);
        }

        function parseVideoUrl() {
            try {
                const input = inputArea.value.trim();
                let id = input;
                
                let m = input.match(/[?&]v=([^&]+)/);
                if (m) id = m[1];
                
                m = input.match(/youtu\.be\/([^?]+)/);
                if (m) id = m[1];
                
                id = id.split('&')[0].split('?')[0];
                
                if (id.length !== 11) throw new Error("ç„¡æ•ˆçš„å½±ç‰‡ ID");
                
                // Save to localStorage
                localStorage.setItem('videoId', id);
                
                // Clear selected words when setting new video
                selectedWords = [];
                localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
                
                console.log(`âœ… å½±ç‰‡è¨­å®šç‚º: ${id}`);
                console.log(`âœ… å·²æ¸…ç©ºé¸å–çš„ç”Ÿå­—ï¼Œå³å°‡é‡æ–°æ•´ç†é é¢...`);
                
                // Reload page to reset everything
                setTimeout(() => {
                    location.reload();
                }, 500);
            } catch (e) {
                console.error("éŒ¯èª¤: " + e.message);
            }
        }

        function parseTranscriptOrSummary() {
            try {
                const transcriptInput = inputArea;
                const summaryInput = document.getElementById('summary-input');
                
                let transcriptSaved = false;
                let summarySaved = false;
                
                // Parse and save transcript if provided
                if (transcriptInput.value.trim()) {
                    const transcriptJson = parseJSON(transcriptInput.value);
                    if (!Array.isArray(transcriptJson)) throw new Error("é€å­—ç¨¿å¿…é ˆæ˜¯é™£åˆ—");
                    
                    // Auto-add "t" field if missing
                    transcriptJson.forEach((item, index) => {
                        if (!item.hasOwnProperty('t')) {
                            item.t = index * 10;
                        }
                    });
                    
                    transcriptData = transcriptJson;
                    localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
                    transcriptSaved = true;
                    
                    // Clear CEFR level when importing new transcript
                    localStorage.removeItem('cefrLevel');
                    cefrLevel = '';
                    document.body.classList.remove('summary-mode');
                }
                
                // Parse and save summary if provided
                if (summaryInput.value.trim()) {
                    const summaryJson = parseJSON(summaryInput.value);
                    if (!Array.isArray(summaryJson)) throw new Error("æ‘˜è¦å¿…é ˆæ˜¯é™£åˆ—");
                    
                    // Auto-add "t" field if missing
                    summaryJson.forEach((item, index) => {
                        if (!item.hasOwnProperty('t')) {
                            item.t = index * 10;
                        }
                    });
                    
                    summaryData = summaryJson;
                    localStorage.setItem('summaryData', JSON.stringify(summaryData));
                    summarySaved = true;
                }
                
                if (!transcriptSaved && !summarySaved) {
                    alert('è«‹è‡³å°‘è¼¸å…¥é€å­—ç¨¿æˆ–æ‘˜è¦å…¶ä¸­ä¸€é …');
                    return;
                }
                
                renderTranscript();
                closeModal();
                
                if (transcriptSaved && summarySaved) {
                    alert('âœ… å·²æˆåŠŸåŒ¯å…¥é€å­—ç¨¿å’Œæ‘˜è¦');
                } else if (transcriptSaved) {
                    alert('âœ… å·²æˆåŠŸåŒ¯å…¥é€å­—ç¨¿');
                } else {
                    alert('âœ… å·²æˆåŠŸåŒ¯å…¥æ‘˜è¦');
                }
            } catch (e) {
                console.error("æ ¼å¼éŒ¯èª¤: " + e.message);
                alert("åŒ¯å…¥å¤±æ•—ï¼š" + e.message + "\n\nè«‹ç¢ºèª JSON æ ¼å¼æ­£ç¢º");
            }
        }

        function parseVocab() {
            try {
                const transcriptInput = inputArea;
                const summaryInput = document.getElementById('summary-input');
                
                let transcriptSaved = false;
                let summarySaved = false;
                
                // Parse and save transcript vocab if provided
                if (transcriptInput.value.trim()) {
                    const transcriptJson = parseJSON(transcriptInput.value);
                    if (!Array.isArray(transcriptJson)) throw new Error("é€å­—ç¨¿å–®å­—å¿…é ˆæ˜¯é™£åˆ—");
                    vocabData = transcriptJson;
                    localStorage.setItem('vocabData', JSON.stringify(vocabData));
                    transcriptSaved = true;
                }
                
                // Parse and save summary vocab if provided
                if (summaryInput.value.trim()) {
                    const summaryJson = parseJSON(summaryInput.value);
                    if (!Array.isArray(summaryJson)) throw new Error("æ‘˜è¦å–®å­—å¿…é ˆæ˜¯é™£åˆ—");
                    summaryVocabData = summaryJson;
                    localStorage.setItem('summaryVocabData', JSON.stringify(summaryVocabData));
                    summarySaved = true;
                }
                
                if (!transcriptSaved && !summarySaved) {
                    alert('è«‹è‡³å°‘è¼¸å…¥é€å­—ç¨¿å–®å­—æˆ–æ‘˜è¦å–®å­—å…¶ä¸­ä¸€é …');
                    return;
                }
                
                renderTranscript();
                renderVocab();
                closeModal();
                
                if (transcriptSaved && summarySaved) {
                    alert('âœ… å·²æˆåŠŸåŒ¯å…¥é€å­—ç¨¿å–®å­—å’Œæ‘˜è¦å–®å­—');
                } else if (transcriptSaved) {
                    alert('âœ… å·²æˆåŠŸåŒ¯å…¥é€å­—ç¨¿å–®å­—');
                } else {
                    alert('âœ… å·²æˆåŠŸåŒ¯å…¥æ‘˜è¦å–®å­—');
                }
            } catch (e) {
                console.error("æ ¼å¼éŒ¯èª¤: " + e.message);
                alert("åŒ¯å…¥å¤±æ•—ï¼š" + e.message + "\n\nè«‹ç¢ºèª JSON æ ¼å¼æ­£ç¢º");
            }
        }

        function parseQuiz() {
            try {
                const inputValue = inputArea.value.trim();
                if (!inputValue) {
                    alert('è«‹è¼¸å…¥ Quiz è³‡æ–™');
                    return;
                }
                
                const data = parseJSON(inputValue);
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºé›™èªæ ¼å¼ { english: [...], chinese: [...] }
                if (typeof data === 'object' && data !== null && !Array.isArray(data) && 'english' in data && 'chinese' in data) {
                    // é›™èªæ ¼å¼
                    if (!Array.isArray(data.english) || !Array.isArray(data.chinese)) {
                        alert("éŒ¯èª¤ï¼šenglish å’Œ chinese éƒ½å¿…é ˆæ˜¯é™£åˆ—");
                        return;
                    }
                    if (data.english.length === 0 && data.chinese.length === 0) {
                        alert("éŒ¯èª¤ï¼šé¡Œåº«ä¸èƒ½ç‚ºç©º");
                        return;
                    }
                    quizData = data; // ä¿å­˜æ•´å€‹é›™èªç‰©ä»¶
                    localStorage.setItem('quizData', JSON.stringify(quizData));
                    closeModal();
                    alert(`âœ… é›™èª Quiz é¡Œåº«å·²åŒ¯å…¥\n\nè‹±æ–‡ï¼š${data.english.length} é¡Œ\nä¸­æ–‡ï¼š${data.chinese.length} é¡Œ`);
                    console.log(`âœ… é›™èª Quiz é¡Œåº«å·²åŒ¯å…¥: è‹±æ–‡ ${data.english.length} é¡Œã€ä¸­æ–‡ ${data.chinese.length} é¡Œ`);
                } else if (Array.isArray(data)) {
                    // å‚³çµ±æ ¼å¼ - å–®ä¸€é™£åˆ—
                    if (data.length === 0) {
                        alert("éŒ¯èª¤ï¼šé¡Œåº«ä¸èƒ½ç‚ºç©º");
                        return;
                    }
                    quizData = data;
                    localStorage.setItem('quizData', JSON.stringify(quizData));
                    closeModal();
                    alert(`âœ… Quiz é¡Œåº«å·²åŒ¯å…¥ï¼š${quizData.length} é¡Œ`);
                    console.log(`âœ… Quiz é¡Œåº«å·²åŒ¯å…¥: ${quizData.length} é¡Œ`);
                } else {
                    alert("æ ¼å¼éŒ¯èª¤ï¼šå¿…é ˆæ˜¯é™£åˆ—æˆ–é›™èªç‰©ä»¶\n\næ­£ç¢ºæ ¼å¼ï¼š\n{ \"english\": [...], \"chinese\": [...] }\næˆ–\n[{\"q\":\"...\", \"options\":[...], \"correct\":0}]");
                }
            } catch (e) {
                alert("æ ¼å¼éŒ¯èª¤ï¼š" + e.message + "\n\nè«‹ç¢ºèª JSON æ ¼å¼æ˜¯å¦æ­£ç¢º");
                console.error("æ ¼å¼éŒ¯èª¤: ", e);
            }
        }

        function clearTranscriptData() {
            transcriptData = [];
            summaryData = [];
            selectedWords = [];
            localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
            localStorage.setItem('summaryData', JSON.stringify(summaryData));
            localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
            
            // Clear CEFR level and exit summary mode
            localStorage.removeItem('cefrLevel');
            cefrLevel = '';
            currentViewMode = 'transcript';
            document.body.classList.remove('summary-mode');
            
            console.log('âœ… é€å­—ç¨¿èˆ‡æ‘˜è¦ç´€éŒ„å·²æ¸…é™¤');
            setTimeout(() => location.reload(), 500);
        }

        function clearAllRecords() {
            transcriptData = [];
            vocabData = [];
            summaryVocabData = [];
            quizData = [];
            selectedWords = [];
            videoId = '';
            cefrLevel = '';

            localStorage.removeItem('transcriptData');
            localStorage.removeItem('vocabData');
            localStorage.removeItem('summaryVocabData');
            localStorage.removeItem('quizData');
            localStorage.removeItem('selectedWords');
            localStorage.removeItem('videoId');
            localStorage.removeItem('cefrLevel');

            document.body.classList.remove('summary-mode');

            console.log('âœ… æ‰€æœ‰ç´€éŒ„å·²æ¸…é™¤');
            setTimeout(() => location.reload(), 500);
        }

        function clearVocabData() {
            vocabData = [];
            summaryVocabData = [];
            localStorage.setItem('vocabData', JSON.stringify(vocabData));
            localStorage.setItem('summaryVocabData', JSON.stringify(summaryVocabData));
            console.log('âœ… å–®å­—ç´€éŒ„å·²æ¸…é™¤');
            setTimeout(() => location.reload(), 500);
        }

        function clearQuizData() {
            quizData = [];
            localStorage.setItem('quizData', JSON.stringify(quizData));
            console.log('âœ… Quiz é¡Œåº«å·²æ¸…é™¤');
            setTimeout(() => location.reload(), 500);
        }

        // Render Functions
        function renderTranscript() {
            const container = document.getElementById('transcript-content');
            const viewToggleBtn = document.getElementById('view-toggle-btn');
            const transcriptTitle = document.getElementById('transcript-title');
            const viewModeText = document.getElementById('view-mode-text');
            
            // Auto-switch to appropriate view based on available data
            if (transcriptData.length === 0 && summaryData.length > 0) {
                // Only summary exists, switch to summary view
                currentViewMode = 'summary';
            } else if (transcriptData.length > 0 && summaryData.length === 0) {
                // Only transcript exists, switch to transcript view
                currentViewMode = 'transcript';
            }
            // If both exist, keep current view mode
            
            // Show toggle button if both transcript and summary exist
            if (transcriptData.length > 0 && summaryData.length > 0) {
                viewToggleBtn.classList.remove('hidden');
            } else {
                viewToggleBtn.classList.add('hidden');
            }
            
            // Determine which data to render
            const dataToRender = currentViewMode === 'summary' ? summaryData : transcriptData;
            const isInSummaryView = currentViewMode === 'summary';
            
            // Add or remove summary-mode class on body
            if (isInSummaryView) {
                document.body.classList.add('summary-mode');
            } else {
                document.body.classList.remove('summary-mode');
            }
            
            // Update UI labels
            if (transcriptTitle) {
                transcriptTitle.textContent = isInSummaryView ? 'æ‘˜è¦' : 'é€å­—ç¨¿';
            }
            if (viewModeText) {
                viewModeText.textContent = isInSummaryView ? 'åˆ‡æ›åˆ°é€å­—ç¨¿' : 'åˆ‡æ›åˆ°æ‘˜è¦';
            }
            
            if (dataToRender.length === 0) {
                container.innerHTML = '<p class="text-center text-slate-400 py-12">åŒ¯å…¥é€å­—ç¨¿å¾Œé¡¯ç¤ºæ–¼æ­¤...</p>';
                return;
            }
            
            container.innerHTML = "";
            // Use vocab data based on current view mode
            const currentVocabData = isInSummaryView ? summaryVocabData : vocabData;
            const sortedVocab = [...currentVocabData].sort((a,b) => b.word.length - a.word.length);

            dataToRender.forEach((seg, idx) => {
                let text = seg.en;  // ä¿æŒç´”æ–‡æœ¬é€²è¡Œæ›¿æ›
                
                // å…ˆé€²è¡Œæ‰€æœ‰æ›¿æ›ï¼Œå»ºç«‹æ¨™è¨˜åˆ—è¡¨
                const replacements = [];
                
                // Collect all vocab replacements
                sortedVocab.forEach(v => {
                    const roots = v.roots || [v.word];
                    const pattern = roots.map(r => r.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|');
                    const regex = new RegExp(`\\b(${pattern})\\b`, 'gi');
                    let match;
                    while ((match = regex.exec(text)) !== null) {
                        replacements.push({
                            start: match.index,
                            end: match.index + match[0].length,
                            word: match[0],
                            vocab: v,
                            type: 'vocab'
                        });
                    }
                });
                
                // Collect all selected word replacements
                selectedWords.forEach(word => {
                    const escaped = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    const regex = new RegExp(`\\b(${escaped})\\b`, 'gi');
                    let match;
                    while ((match = regex.exec(text)) !== null) {
                        replacements.push({
                            start: match.index,
                            end: match.index + match[0].length,
                            word: match[0],
                            selectedWord: word,
                            type: 'selected'
                        });
                    }
                });
                
                // Sort by start position (descending) to replace from end to start
                replacements.sort((a, b) => b.start - a.start);
                
                // Remove overlapping replacements (keep the first one found)
                const finalReplacements = [];
                replacements.forEach(rep => {
                    const overlaps = finalReplacements.some(r => 
                        (rep.start >= r.start && rep.start < r.end) ||
                        (rep.end > r.start && rep.end <= r.end)
                    );
                    if (!overlaps) {
                        finalReplacements.push(rep);
                    }
                });
                
                // Apply replacements from end to start
                let html = text;
                finalReplacements.forEach(rep => {
                    const before = html.substring(0, rep.start);
                    const after = html.substring(rep.end);
                    let replacement = '';
                    
                    if (rep.type === 'vocab') {
                        const isCustom = rep.vocab.custom ? 'vocab-word-custom' : 'vocab-word';
                        replacement = `<span class="${isCustom}" data-id="${rep.vocab.id || rep.vocab.word}" 
                                           onmouseenter="showCard(event, '${rep.vocab.id || rep.vocab.word}')" 
                                           onmouseleave="hideCard()" 
                                           onclick="toggleCard(event, '${rep.vocab.id || rep.vocab.word}')">${rep.word}</span>`;
                    } else if (rep.type === 'selected') {
                        replacement = `<span class="selected-word" onclick="removeSelectedWord('${rep.selectedWord}')" style="cursor: pointer; text-decoration: underline;" title="é»æ“Šå–æ¶ˆé¸å–">${rep.word}</span>`;
                    }
                    
                    html = before + replacement + after;
                });

                const hasTime = typeof seg.t === 'number';
                const timeLabel = hasTime ? formatTime(seg.t) : 'Set';
                const timeClass = hasTime ? 'bg-green-50 text-green-700' : 'bg-slate-100 text-slate-600';
                const minutes = hasTime ? Math.floor(seg.t / 60) : '';
                const seconds = hasTime ? seg.t % 60 : '';

                // Show different buttons based on view mode
                const showReadButtons = isInSummaryView || cefrLevel;
                const showEditButtons = !isInSummaryView;

                container.innerHTML += `
                    <div class="mb-6" id="seg-${idx}">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            ${showReadButtons ? `<div class="flex gap-1 items-center">
                                <button class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors" 
                                        onclick="speakSegment(${idx})" title="æ’­æ”¾æ­¤æ®µè½">
                                    ğŸ”Š Read
                                </button>
                                <button id="pause-btn-${idx}" class="px-3 py-1.5 rounded-lg border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-semibold hover:bg-indigo-100 transition-colors opacity-50" 
                                        onclick="togglePauseSegment(${idx})" title="æš«åœ/ç¹¼çºŒæ’­æ”¾" style="cursor: not-allowed;">
                                    â¸ Pause
                                </button>
                            </div>` : ''}
                            <button class="segment-time-btn px-3 py-1.5 rounded-lg border-2 ${timeClass} text-xs font-semibold transition-colors" 
                                    onclick="jumpToTime(${hasTime ? seg.t : 'null'})">
                                âµ ${timeLabel}
                            </button>
                            ${showEditButtons ? `<div class="segment-time-inputs flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-${idx}" min="0" max="999" step="1" 
                                           class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400"
                                           placeholder="0" value="${minutes}"
                                           onchange="setTimeByInput(${idx})"
                                           onkeypress="if(event.key==='Enter') setTimeByInput(${idx})">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-${idx}" min="0" max="59" step="1" 
                                           class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400"
                                           placeholder="00" value="${seconds ? String(seconds).padStart(2, '0') : ''}"
                                           onchange="setTimeByInput(${idx})"
                                           onkeypress="if(event.key==='Enter') setTimeByInput(${idx})">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="segment-edit-btn px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" 
                                    onclick="editSegment(${idx})">
                                âœï¸ Edit
                            </button>
                            ` : ''}
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-${idx}">${html}</p>
                        ${seg.cn ? `<p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-${idx}">${seg.cn}</p>` : ''}
                    </div>`;
            });
            
            applyTranslationState();
        }

        function showAddVocabModal() {
            document.getElementById('add-vocab-modal').classList.remove('hidden');
            document.getElementById('add-vocab-input').focus();
        }

        function closeAddVocabModal() {
            document.getElementById('add-vocab-modal').classList.add('hidden');
            // æ¸…ç©ºè¡¨å–®
            document.getElementById('add-vocab-input').value = '';
        }

        function addNewVocabFromJSON() {
            try {
                const input = document.getElementById('add-vocab-input').value.trim();
                if (!input) {
                    alert('è«‹è¼¸å…¥å–®å­—è³‡æ–™');
                    return;
                }
                
                const data = parseJSON(input);
                if (!Array.isArray(data)) {
                    alert('æ ¼å¼éŒ¯èª¤ï¼šå¿…é ˆæ˜¯é™£åˆ—');
                    return;
                }
                
                if (data.length === 0) {
                    alert('è«‹è‡³å°‘æ–°å¢ä¸€å€‹å–®å­—');
                    return;
                }
                
                let addedCount = 0;
                data.forEach(item => {
                    if (!item.word) return; // è·³éæ²’æœ‰ word çš„é …ç›®
                    
                    // æª¢æŸ¥æ˜¯å¦é‡è¤‡
                    if (vocabData.some(v => v.word.toLowerCase() === item.word.toLowerCase())) {
                        console.warn(`âš ï¸ å–®å­—å·²å­˜åœ¨ï¼Œå·²è·³é: ${item.word}`);
                        return;
                    }
                    
                    // æ·»åŠ æ–°å–®å­—ï¼ˆæ¨™è¨˜ç‚ºè‡ªè¨‚ï¼šcustom: trueï¼‰
                    const newVocab = {
                        id: item.word.toLowerCase(),
                        word: item.word.charAt(0).toUpperCase() + item.word.slice(1).toLowerCase(),
                        def: item.def || '',
                        cn: item.cn || '',
                        pos: item.pos || '',
                        custom: true  // æ¨™è¨˜ç‚ºè‡ªè¨‚å–®å­—
                    };
                    
                    vocabData.push(newVocab);
                    addedCount++;
                });
                
                if (addedCount === 0) {
                    alert('æ‰€æœ‰å–®å­—éƒ½å·²å­˜åœ¨æˆ–æ ¼å¼ä¸æ­£ç¢º');
                    return;
                }
                
                localStorage.setItem('vocabData', JSON.stringify(vocabData));
                renderVocab();
                renderTranscript();
                closeAddVocabModal();
                
                alert(`âœ… å·²æ–°å¢ ${addedCount} å€‹ç”Ÿå­—`);
                console.log(`âœ… å·²æ–°å¢ ${addedCount} å€‹ç”Ÿå­—`);
            } catch (e) {
                alert('æ ¼å¼éŒ¯èª¤ï¼š' + e.message + '\n\nè«‹ç¢ºèª JSON æ ¼å¼æ˜¯å¦æ­£ç¢º');
                console.error('æ ¼å¼éŒ¯èª¤: ', e);
            }
        }

        function toggleViewMode() {
            if (currentViewMode === 'transcript') {
                currentViewMode = 'summary';
            } else {
                currentViewMode = 'transcript';
            }
            renderTranscript();
            renderVocab(); // Update vocab list to match current view mode
        }

        function renderVocab() {
            const list = document.getElementById('vocab-list');
            const count = document.getElementById('vocab-count');
            
            // Use vocab data based on current view mode
            const currentVocabData = currentViewMode === 'summary' ? summaryVocabData : vocabData;
            
            if (currentVocabData.length === 0) {
                count.textContent = '0';
                list.innerHTML = '<div class="p-4 text-center text-slate-400 text-sm">å°šæœªåŒ¯å…¥å–®å­—</div>';
                return;
            }
            
            count.textContent = currentVocabData.length;
            list.innerHTML = "";
            
            const sortedVocab = [...currentVocabData].sort((a,b) => a.word.localeCompare(b.word));
            sortedVocab.forEach((v, index) => {
                list.innerHTML += `
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" 
                        onclick="scrollToVocab('${v.id || v.word}')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">${index + 1}.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">${v.word}</div>
                                    <button onclick="event.stopPropagation(); speakWord('${v.word}')" class="text-slate-400 hover:text-blue-600 transition" title="æ’­æ”¾ç™¼éŸ³">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                ${v.ipa ? `<div class="text-xs text-blue-600 font-semibold mt-1">${v.ipa}</div>` : ''}
                                ${v.pos ? `<div class="text-xs text-slate-500 mt-0.5">${v.pos}</div>` : ''}
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">${v.def || ''}</div>
                        ${v.cn ? `<div class="text-xs text-blue-700 font-semibold ml-6">${v.cn}</div>` : ''}
                    </li>`;
            });
        }
        
        function speakWord(word) {
            // ä½¿ç”¨ Web Speech API æ’­æ”¾ç™¼éŸ³
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 1;
                utterance.pitch = 1;
                speechSynthesis.speak(utterance);
            } else {
                console.warn('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åˆæˆåŠŸèƒ½');
            }
        }

        function speakSegment(segmentIndex) {
            // æ’­æ”¾ç‰¹å®šæ®µè½çš„è‹±æ–‡æ–‡æœ¬ï¼Œä½¿ç”¨ç•¶å‰è¦–åœ–æ¨¡å¼çš„æ•¸æ“š
            const dataToUse = currentViewMode === 'summary' ? summaryData : transcriptData;
            if (segmentIndex < 0 || segmentIndex >= dataToUse.length) return;
            
            const segment = dataToUse[segmentIndex];
            if (!segment.en) return;
            
            if ('speechSynthesis' in window) {
                // å¦‚æœç•¶å‰æ­£åœ¨æ’­æ”¾åŒä¸€æ®µè½
                if (currentSpeakingSegment === segmentIndex) {
                    if (isSpeechPaused) {
                        // æ¢å¾©æ’­æ”¾
                        speechSynthesis.resume();
                        isSpeechPaused = false;
                        updatePauseButton(segmentIndex, false);
                    } else {
                        // æš«åœæ’­æ”¾
                        speechSynthesis.pause();
                        isSpeechPaused = true;
                        updatePauseButton(segmentIndex, true);
                    }
                } else {
                    // æ’­æ”¾æ–°æ®µè½
                    speechSynthesis.cancel();
                    currentSpeakingSegment = segmentIndex;
                    isSpeechPaused = false;
                    
                    const utterance = new SpeechSynthesisUtterance(segment.en);
                    utterance.lang = 'en-US';
                    utterance.rate = 1;
                    utterance.pitch = 1;
                    
                    // æ’­æ”¾çµæŸæ™‚é‡ç½®ç‹€æ…‹
                    utterance.onend = () => {
                        currentSpeakingSegment = null;
                        isSpeechPaused = false;
                        updatePauseButton(segmentIndex, false);
                    };
                    
                    speechSynthesis.speak(utterance);
                    updatePauseButton(segmentIndex, false);
                }
            } else {
                console.warn('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åˆæˆåŠŸèƒ½');
            }
        }
        
        function updatePauseButton(segmentIndex, isPaused) {
            // æ›´æ–°æš«åœ/ç¹¼çºŒæŒ‰éˆ•çš„ç‹€æ…‹
            const pauseBtn = document.getElementById(`pause-btn-${segmentIndex}`);
            if (pauseBtn) {
                pauseBtn.textContent = isPaused ? 'â–¶ Resume' : 'â¸ Pause';
                pauseBtn.style.opacity = currentSpeakingSegment === segmentIndex ? '1' : '0.5';
            }
        }
        
        function togglePauseSegment(segmentIndex) {
            // æš«åœ/ç¹¼çºŒæŒ‰éˆ•çš„é»æ“Šè™•ç†
            if (currentSpeakingSegment === segmentIndex) {
                speakSegment(segmentIndex);
            }
        }

        // YouTube Player
        function onYouTubeIframeAPIReady() {
            youtubeAPIReady = true;
            console.log('YouTube API Ready');
            // Only initialize player if a valid video ID is set
            if (videoId && videoId.length === 11) {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: { rel: 0, modestbranding: 1 },
                    events: {
                        onReady: () => {
                            playerReady = true;
                            player.setPlaybackRate(currentPlaybackSpeed);
                            console.log('YouTube Player Ready');
                        },
                        onStateChange: (event) => {
                            updatePlayPauseButton();
                        }
                    }
                });
            }
        }
        
        function initializePlayer(id) {
            // Initialize player with a specific video ID
            if (!id || id.length !== 11) return;
            videoId = id;
            localStorage.setItem('videoId', id);
            
            // Wait for YouTube API to be ready
            if (!youtubeAPIReady || typeof YT === 'undefined' || typeof YT.Player === 'undefined') {
                console.log('ç­‰å¾… YouTube API è¼‰å…¥...');
                setTimeout(() => initializePlayer(id), 200);
                return;
            }
            
            if (!player) {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: { rel: 0, modestbranding: 1 },
                    events: {
                        onReady: () => {
                            playerReady = true;
                            player.setPlaybackRate(currentPlaybackSpeed);
                            console.log('YouTube Player Ready');
                        },
                        onStateChange: (event) => {
                            updatePlayPauseButton();
                        }
                    }
                });
            } else if (playerReady) {
                player.loadVideoById(videoId);
            }
        }

        function jumpToTime(seconds) {
            if (!player || !playerReady || typeof seconds !== 'number') return;
            player.seekTo(seconds, true);
            player.playVideo();
        }

        

        

        // Insert Transcript Modal Functions
        let currentInsertIndex = null;

        function openInsertModal(idx) {
            currentInsertIndex = idx;
            document.getElementById('insert-segment-index').textContent = idx + 1;
            document.getElementById('insert-input').value = '';
            document.getElementById('insert-modal').classList.remove('hidden');
            document.getElementById('insert-input').focus();
        }

        function closeInsertModal() {
            document.getElementById('insert-modal').classList.add('hidden');
            currentInsertIndex = null;
        }

        function copyInsertPrompt() {
            let promptText = '';
            
            // Add video URL if available
            if (videoId && videoId.length === 11) {
                promptText += `https://www.youtube.com/watch?v=${videoId}\n\n`;
            } else {
                promptText += 'ğŸ”»\n\n';
            }
            
            promptText += `å°‡ä»¥ä¸Šå½±ç‰‡å¾ ${formatTime(transcriptData[currentInsertIndex]?.t || 0)} é–‹å§‹çš„æ¼”è¬›å…§å®¹ï¼Œæ•´ç†æˆè‹±æ–‡å’Œä¸­æ–‡éš¨æ®µè½å°ç…§çš„é€å­—ç¨¿ï¼Œä¸¦ä»¥ä»¥ä¸‹æ ¼å¼åš´æ ¼ä¾ç…§ JSON Array æ ¼å¼è¼¸å‡ºçµæœï¼š
{
    en: "When I found out my grandmother, my last living grandparent, was dying, my first thought was, \"I need to draw her hands.\" I'm a visual artist, a cartoonist for The New Yorker, and comics writer, so drawing is how I understand much of the world.",
    cn: "ç•¶æˆ‘å¾—çŸ¥æˆ‘çš„ç¥–æ¯â€”â€”æˆ‘æœ€å¾Œä¸€ä½åœ¨ä¸–çš„ç¥–çˆ¶æ¯â€”â€”å³å°‡é›¢ä¸–æ™‚ï¼Œæˆ‘çš„ç¬¬ä¸€å€‹å¿µé ­æ˜¯ï¼šã€Œæˆ‘éœ€è¦ç•«ä¸‹å¥¹çš„æ‰‹ã€‚ã€æˆ‘æ˜¯ä¸€ä½è¦–è¦ºè—è¡“å®¶ï¼Œä¹Ÿæ˜¯ã€Šç´ç´„å®¢ã€‹çš„æ¼«ç•«å®¶å’Œæ¼«ç•«ä½œè€…ï¼Œæ‰€ä»¥ç¹ªç•«æ˜¯æˆ‘ç†è§£é€™å€‹ä¸–ç•Œçš„ä¸»è¦æ–¹å¼ã€‚"
},
{
    en: "For a long time, my cartoons had been impersonal. Commentary on the world around me, sure, but not really about me. The closest my personal life got to influencing my cartoons were cartoons I lifted from things my friends and family had said around me. It was only after my daughter Ellika was born that my personal life began to creep into my cartoons more.",
    cn: "å¾ˆé•·ä¸€æ®µæ™‚é–“ä»¥ä¾†ï¼Œæˆ‘çš„æ¼«ç•«éƒ½æ˜¯éå€‹äººåŒ–çš„ã€‚å®ƒå€‘æ˜¯å°å‘¨é­ä¸–ç•Œçš„è©•è«–ï¼Œæ²’éŒ¯ï¼Œä½†ä¸¦ä¸çœŸæ­£é—œæ–¼æˆ‘è‡ªå·±ã€‚æˆ‘çš„å€‹äººç”Ÿæ´»å°æ¼«ç•«æœ€æ¥è¿‘çš„å½±éŸ¿ï¼Œé ‚å¤šå°±æ˜¯å¾æœ‹å‹å’Œå®¶äººçš„è«‡è©±ä¸­å–æã€‚ç›´åˆ°æˆ‘å¥³å…’åŸƒè‰å¡ (Ellika) å‡ºç”Ÿå¾Œï¼Œæˆ‘çš„å€‹äººç”Ÿæ´»æ‰é–‹å§‹æ›´å¤šåœ°æ»²é€é€²æˆ‘çš„æ¼«ç•«ä¸­ã€‚"
}`;
            
            navigator.clipboard.writeText(promptText).then(() => {
                const copyBtn = document.getElementById('copy-insert-prompt-btn');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span class="material-symbols-outlined">done</span>';
                copyBtn.classList.remove('bg-indigo-50', 'text-indigo-700');
                copyBtn.classList.add('bg-green-50', 'text-green-700');
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.classList.remove('bg-green-50', 'text-green-700');
                    copyBtn.classList.add('bg-indigo-50', 'text-indigo-700');
                }, 2000);
                
                console.log('âœ… Insert Promptå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹é‡è©¦');
            });
        }

        function insertTranscriptFromIndex() {
            if (currentInsertIndex === null || currentInsertIndex === undefined) return;
            
            try {
                const input = document.getElementById('insert-input').value.trim();
                if (!input) {
                    alert('è«‹è¼¸å…¥é€å­—ç¨¿è³‡æ–™');
                    return;
                }
                
                const newData = parseJSON(input);
                if (!Array.isArray(newData)) {
                    alert('æ ¼å¼éŒ¯èª¤ï¼šå¿…é ˆæ˜¯é™£åˆ—');
                    return;
                }
                
                if (newData.length === 0) {
                    alert('è«‹è‡³å°‘è¼¸å…¥ä¸€æ®µé€å­—ç¨¿');
                    return;
                }
                
                // Preserve segments before currentInsertIndex, replace everything from currentInsertIndex onwards
                const preservedSegments = transcriptData.slice(0, currentInsertIndex);
                transcriptData = [...preservedSegments, ...newData];
                
                localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
                renderTranscript();
                closeInsertModal();
                
                alert(`âœ… å·²å¾æ®µè½ ${currentInsertIndex + 1} æ’å…¥ ${newData.length} æ®µé€å­—ç¨¿\nä¿ç•™å‰ ${currentInsertIndex} æ®µï¼Œç¸½å…± ${transcriptData.length} æ®µ`);
                console.log(`âœ… æ’å…¥é€å­—ç¨¿: ä¿ç•™ ${currentInsertIndex} æ®µï¼Œæ–°å¢ ${newData.length} æ®µï¼Œç¸½è¨ˆ ${transcriptData.length} æ®µ`);
            } catch (e) {
                alert('æ ¼å¼éŒ¯èª¤ï¼š' + e.message + '\n\nè«‹ç¢ºèª JSON æ ¼å¼æ˜¯å¦æ­£ç¢º');
                console.error('æ ¼å¼éŒ¯èª¤: ', e);
            }
        }

        function editSegment(idx) {
            const seg = transcriptData[idx];
            if (!seg) return;
            
            // Store current editing index
            window.currentEditIndex = idx;
            
            // Fill in the modal
            document.getElementById('edit-en-input').value = seg.en || '';
            document.getElementById('edit-cn-input').value = seg.cn || '';
            document.getElementById('edit-time-input').value = typeof seg.t === 'number' ? seg.t : '';
            
            // Show modal
            document.getElementById('edit-modal').classList.remove('hidden');
            
            // Focus on English input
            setTimeout(() => {
                document.getElementById('edit-en-input').focus();
            }, 100);
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            window.currentEditIndex = null;
        }

        function saveEdit() {
            const idx = window.currentEditIndex;
            if (idx === null || idx === undefined || !transcriptData[idx]) return;
            
            const enText = document.getElementById('edit-en-input').value.trim();
            const cnText = document.getElementById('edit-cn-input').value.trim();
            const timeInput = document.getElementById('edit-time-input').value.trim();
            
            if (enText) {
                transcriptData[idx].en = enText;
            }
            
            transcriptData[idx].cn = cnText;
            
            // Save time if provided
            if (timeInput !== '') {
                const timeSeconds = parseInt(timeInput, 10);
                if (!isNaN(timeSeconds) && timeSeconds >= 0) {
                    transcriptData[idx].t = timeSeconds;
                }
            }
            
            localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
            renderTranscript();
            closeEditModal();
        }
        
        function previewEditTime() {
            const timeInput = document.getElementById('edit-time-input').value.trim();
            if (timeInput === '') {
                alert('è«‹è¼¸å…¥æ™‚é–“ï¼ˆç§’ï¼‰');
                return;
            }
            
            const timeSeconds = parseInt(timeInput, 10);
            if (isNaN(timeSeconds) || timeSeconds < 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ™‚é–“ï¼ˆ0 ç§’ä»¥ä¸Šï¼‰');
                return;
            }
            
            if (player && playerReady) {
                player.seekTo(timeSeconds, true);
                player.playVideo();
                console.log(`âµ è·³è½‰åˆ° ${formatTime(timeSeconds)}`);
            } else {
                alert('å½±ç‰‡é‚„æœªè¼‰å…¥ï¼Œè«‹å…ˆè¨­å®šå½±ç‰‡');
            }
        }

        function formatTime(sec) {
            if (typeof sec !== 'number' || sec < 0) return '00:00';
            const m = Math.floor(sec / 60);
            const s = Math.floor(sec % 60);
            return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        // Interaction
        function showCard(e, id) {
            const currentVocabData = currentViewMode === 'summary' ? summaryVocabData : vocabData;
            const vocab = currentVocabData.find(v => (v.id === id) || (v.word === id));
            if (!vocab) return;
            
            floatingCard.dataset.currentId = id;
            floatingCard.innerHTML = `
                <div class="p-4">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="text-xl font-bold flex-1">${vocab.word}</h3>
                        <button onclick="event.stopPropagation(); speakWord('${vocab.word}')" class="ml-2 p-2 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 transition" title="æ’­æ”¾ç™¼éŸ³">
                            <span class="material-symbols-outlined text-lg">volume_up</span>
                        </button>
                    </div>
                    <div class="text-xs text-slate-500 mb-1">${vocab.pos || ''}</div>
                    ${vocab.ipa ? `<div class="text-xs text-blue-600 font-semibold mb-3">${vocab.ipa}</div>` : ''}
                    <p class="text-sm mb-3">${vocab.def}</p>
                    ${vocab.cn ? `<p class="text-xs text-blue-700 font-bold">${vocab.cn}</p>` : ''}
                </div>`;
            
            const rect = e.target.getBoundingClientRect();
            const cardWidth = 320;
            const cardHeight = 200; // é ä¼°é«˜åº¦
            const padding = 10;
            
            // è¨ˆç®—æœ€ä½³ä½ç½®ï¼ˆé¿å…è¶…å‡ºè¢å¹•ï¼‰
            let left = rect.left;
            let top = rect.bottom + padding;
            
            // æ°´å¹³æ–¹å‘èª¿æ•´
            if (left + cardWidth > window.innerWidth) {
                left = window.innerWidth - cardWidth - padding;
            }
            if (left < padding) {
                left = padding;
            }
            
            // å‚ç›´æ–¹å‘èª¿æ•´ï¼ˆå¦‚æœä¸‹æ–¹ç©ºé–“ä¸è¶³ï¼Œé¡¯ç¤ºåœ¨ä¸Šæ–¹ï¼‰
            if (top + cardHeight > window.innerHeight) {
                top = rect.top - cardHeight - padding;
                if (top < padding) {
                    top = padding;
                }
            }
            
            floatingCard.style.left = left + 'px';
            floatingCard.style.top = top + 'px';
            floatingCard.classList.remove('hidden');
        }
        
        function toggleCard(e, id) {
            e.stopPropagation();
            e.preventDefault();
            
            // å¦‚æœå·²ç¶“é¡¯ç¤ºåŒä¸€å€‹å­—å¡ï¼Œå‰‡é—œé–‰
            if (!floatingCard.classList.contains('hidden') && floatingCard.dataset.currentId === id) {
                hideCard();
            } else {
                showCard(e, id);
            }
        }

        function hideCard() {
            floatingCard.classList.add('hidden');
            floatingCard.dataset.currentId = '';
        }
        
        // é»æ“Šå¤–éƒ¨é—œé–‰å­—å¡
        document.addEventListener('click', function(e) {
            // å»¶é²åŸ·è¡Œï¼Œè®“ toggleCard å…ˆå®Œæˆ
            setTimeout(() => {
                if (!floatingCard.classList.contains('hidden') && 
                    !floatingCard.contains(e.target) && 
                    !e.target.closest('.vocab-word') && 
                    !e.target.closest('.vocab-word-custom')) {
                    hideCard();
                }
            }, 100);
        });

        function toggleTranslations() {
            translationsVisible = !translationsVisible;
            const toggleBtnText = document.getElementById('toggle-btn-text');
            const cnToggleText = document.getElementById('cn-toggle-text');
            
            if (toggleBtnText) {
                toggleBtnText.innerText = translationsVisible ? "Hide CN" : "Show CN";
            }
            if (cnToggleText) {
                cnToggleText.innerText = translationsVisible ? "éš±è—" : "ä¸­æ–‡";
            }
            
            applyTranslationState();
        }

        // Quiz Logic
        function openQuiz() {
            const modal = document.getElementById('quiz-modal');
            modal.classList.remove('hidden');
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºé›™èªæ ¼å¼
            const isBilingual = typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData;
            
            // é¡¯ç¤ºæˆ–éš±è—èªè¨€é¸æ“‡å™¨
            const languageSelector = document.getElementById('quiz-language-selector');
            if (isBilingual) {
                languageSelector.classList.remove('hidden');
                updateQuizLanguageSelector();
            } else {
                languageSelector.classList.add('hidden');
            }
            
            renderQuizContent();
        }

        function renderQuizContent() {
            const content = document.getElementById('quiz-content');
            const footer = document.getElementById('quiz-footer');

            // æª¢æŸ¥æ˜¯å¦ç‚ºé›™èªæ ¼å¼æˆ–å‚³çµ±æ ¼å¼
            let questionsToDisplay = [];
            let isBilingual = false;
            
            if (typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData) {
                // é›™èªæ ¼å¼
                isBilingual = true;
                questionsToDisplay = quizLanguage === 'english' ? quizData.english : quizData.chinese;
            } else if (Array.isArray(quizData)) {
                // å‚³çµ±æ ¼å¼
                questionsToDisplay = quizData;
            }

            if (!Array.isArray(questionsToDisplay) || questionsToDisplay.length === 0) {
                content.innerHTML = `
                    <div class="p-6 rounded-xl border border-slate-200 bg-slate-50 text-slate-700">
                        å°šæœªåŒ¯å…¥ Quiz é¡Œåº«ï¼Œè«‹å…ˆç”¨ä¸Šæ–¹çš„ Quiz Data æŒ‰éˆ•è²¼ä¸Šé¡Œåº«ã€‚
                    </div>
                `;
                footer.innerHTML = `<button onclick="closeQuiz()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-900 transition">Close</button>`;
                return;
            }

            footer.innerHTML = `<button onclick="submitQuiz()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 shadow-md transition">Submit Answers</button>`;

            content.innerHTML = questionsToDisplay.map((q, i) => `
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors" id="q-block-${i}">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">${i + 1}</span>
                        ${q.q}
                    </p>
                    <div class="space-y-3 pl-9">
                        ${(q.options || []).map((opt, optIdx) => `
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q${i}" value="${optIdx}" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">${opt}</span>
                            </label>
                        `).join('')}
                    </div>
                    <div class="feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2"></div>
                </div>
            `).join('');
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').classList.add('hidden');
        }

        function submitQuiz() {
            let score = 0;
            let allAnswered = true;

            // æ±ºå®šä½¿ç”¨å“ªä»½é¡Œåº«
            let questionsToScore = [];
            if (typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData) {
                // é›™èªæ ¼å¼ - æ ¹æ“šé¸æ“‡çš„èªè¨€å–ç”¨å°æ‡‰ç‰ˆæœ¬
                questionsToScore = quizLanguage === 'english' ? quizData.english : quizData.chinese;
            } else if (Array.isArray(quizData)) {
                // å‚³çµ±æ ¼å¼
                questionsToScore = quizData;
            }

            questionsToScore.forEach((q, i) => {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                const block = document.getElementById(`q-block-${i}`);
                const feedback = block ? block.querySelector('.feedback') : null;

                if (!block || !feedback) return;

                block.classList.remove('bg-green-50', 'border-green-200', 'bg-red-50', 'border-red-200');
                feedback.className = 'feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2';

                if (selected) {
                    feedback.classList.remove('hidden');
                    if (parseInt(selected.value, 10) === q.correct) {
                        score++;
                        feedback.innerHTML = `<span class="material-symbols-outlined">check_circle</span> Correct!`;
                        feedback.classList.add('bg-green-100', 'text-green-700');
                        block.classList.add('bg-green-50/50', 'border-green-200');
                    } else {
                        feedback.innerHTML = `<span class="material-symbols-outlined">cancel</span> Incorrect. The correct answer is: <span class="italic">${q.options[q.correct]}</span>`;
                        feedback.classList.add('bg-red-100', 'text-red-700');
                        block.classList.add('bg-red-50/50', 'border-red-200');
                    }
                } else {
                    allAnswered = false;
                }
            });

            const footer = document.getElementById('quiz-footer');
            if (allAnswered || confirm("You haven't answered all questions. Submit anyway?")) {
                let message = '';
                let colorClass = '';

                if (score === questionsToScore.length) {
                    message = 'Perfect Score! ğŸ‰';
                    colorClass = 'text-green-600';
                } else if (score > questionsToScore.length / 2) {
                    message = 'Great Job! ğŸ‘';
                    colorClass = 'text-blue-600';
                } else {
                    message = 'Keep Practicing! ğŸ’ª';
                    colorClass = 'text-orange-500';
                }

                footer.innerHTML = `
                    <div class="flex items-center gap-4 w-full justify-between">
                        <div>
                            <p class="text-sm text-gray-500 uppercase tracking-wider font-bold">Your Score</p>
                            <p class="text-2xl font-bold ${colorClass}">${score} / ${questionsToScore.length} - ${message}</p>
                        </div>
                        <button onclick="closeQuiz()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-900 transition">Close</button>
                    </div>`;

                // ç™¼é€æ¸¬é©—çµæœåˆ° Formspree (å¦‚æœå·²é…ç½®)
                sendQuizResultsToFormspree(score, questionsToScore, quizLanguage);
            }
        }

        async function sendQuizResultsToFormspree(score, questions, language) {
            // æª¢æŸ¥æ˜¯å¦å·²é…ç½® Formspree endpoint
            if (!FORMSPREE_ENDPOINT || FORMSPREE_ENDPOINT.includes('YOUR_FORM_ID')) {
                console.log('Formspree endpoint not configured. Skipping submission.');
                return;
            }

            try {
                // æ”¶é›†ç”¨æˆ¶ä½œç­”è©³æƒ… - ç°¡åŒ–æ ¼å¼ï¼šé¡Œè™Ÿã€ç­”æ¡ˆç·¨è™Ÿã€æ­£ç¢ºèˆ‡å¦
                const answers = questions.map((q, i) => {
                    const selected = document.querySelector(`input[name="q${i}"]:checked`);
                    const selectedValue = selected ? parseInt(selected.value) : null;
                    const isCorrect = selected ? selectedValue === q.correct : false;
                    
                    return {
                        questionNumber: i + 1,
                        userAnswer: selectedValue !== null ? selectedValue + 1 : 'N/A', // è½‰æ›ç‚º 1234 è€Œé 0123
                        result: isCorrect ? 'O' : 'X'
                    };
                });

                // æº–å‚™æäº¤æ•¸æ“š
                const submissionData = {
                    timestamp: new Date().toISOString(),
                    videoId: videoId || 'N/A',
                    cefrLevel: cefrLevel || 'N/A',
                    quizLanguage: language || 'N/A',
                    score: score,
                    totalQuestions: questions.length,
                    percentage: ((score / questions.length) * 100).toFixed(2) + '%',
                    answers: answers.map(a => `Q${a.questionNumber}: ${a.userAnswer} (${a.result})`).join(', '),
                    answersDetailed: JSON.stringify(answers, null, 2),
                    userAgent: navigator.userAgent
                };

                // ç™¼é€åˆ° Formspree
                const response = await fetch(FORMSPREE_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(submissionData)
                });

                if (response.ok) {
                    console.log('Quiz results successfully sent to Formspree');
                } else {
                    console.error('Failed to send quiz results:', response.statusText);
                }
            } catch (error) {
                console.error('Error sending quiz results to Formspree:', error);
            }
        }

        function applyTranslationState() {
            document.querySelectorAll('.cn-text').forEach(el => {
                if (translationsVisible) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            });
        }

        function scrollToVocab(id) {
            const span = document.querySelector(`.vocab-word[data-id="${id}"]`);
            if (span) {
                span.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function increaseFontSize() {
            if (currentFontSize < 32) {
                currentFontSize += 2;
                applyFontSize();
            }
        }

        function decreaseFontSize() {
            if (currentFontSize > 12) {
                currentFontSize -= 2;
                applyFontSize();
            }
        }

        function applyFontSize() {
            const transcriptContent = document.getElementById('transcript-content');
            if (transcriptContent) {
                transcriptContent.style.fontSize = currentFontSize + 'px';
            }
        }

        function increasePlaybackSpeed() {
            if (!player || !playerReady) return;
            const speeds = [0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];
            const currentIndex = speeds.indexOf(currentPlaybackSpeed);
            if (currentIndex < speeds.length - 1) {
                currentPlaybackSpeed = speeds[currentIndex + 1];
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
        }

        function decreasePlaybackSpeed() {
            if (!player || !playerReady) return;
            const speeds = [0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];
            const currentIndex = speeds.indexOf(currentPlaybackSpeed);
            if (currentIndex > 0) {
                currentPlaybackSpeed = speeds[currentIndex - 1];
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
        }

        function updateSpeedDisplay() {
            const display = document.getElementById('speed-display');
            if (display) {
                display.textContent = currentPlaybackSpeed.toFixed(2) + 'x';
            }
        }

        function togglePlayPause() {
            if (!player || !playerReady) return;
            
            const state = player.getPlayerState();
            const playIcon = document.getElementById('play-icon');
            const playText = document.getElementById('play-text');
            
            // YT.PlayerState: UNSTARTED (-1), ENDED (0), PLAYING (1), PAUSED (2), BUFFERING (3), CUED (5)
            if (state === 1) { // Playing
                player.pauseVideo();
                playIcon.textContent = 'play_arrow';
                playText.textContent = 'æ’­æ”¾';
            } else { // Paused or other states
                player.playVideo();
                playIcon.textContent = 'pause';
                playText.textContent = 'æš«åœ';
            }
        }

        function updatePlayPauseButton() {
            if (!player || !playerReady) return;
            const state = player.getPlayerState();
            const playIcon = document.getElementById('play-icon');
            const playText = document.getElementById('play-text');
            
            if (state === 1) { // Playing
                playIcon.textContent = 'pause';
                playText.textContent = 'æš«åœ';
            } else {
                playIcon.textContent = 'play_arrow';
                playText.textContent = 'æ’­æ”¾';
            }
        }

        function resetSettings() {
            currentFontSize = 18;
            applyFontSize();
            
            if (player && playerReady) {
                currentPlaybackSpeed = 1.0;
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
            
            translationsVisible = false;
            const toggleBtnText = document.getElementById('toggle-btn-text');
            const cnToggleText = document.getElementById('cn-toggle-text');
            if (toggleBtnText) toggleBtnText.innerText = 'Show CN';
            if (cnToggleText) cnToggleText.innerText = 'ä¸­æ–‡';
            applyTranslationState();
        }

        function changeVideoUrl() {
            const newUrl = prompt('è²¼ä¸Š YouTube ç¶²å€æˆ–å½±ç‰‡ ID:', videoId);
            if (!newUrl || newUrl.trim() === '') return;
            
            try {
                let id = newUrl.trim();
                
                // æå–å½±ç‰‡ ID
                let m = id.match(/[?&]v=([^&]+)/);
                if (m) id = m[1];
                
                m = id.match(/youtu\.be\/([^?]+)/);
                if (m) id = m[1];
                
                id = id.split('&')[0].split('?')[0];
                
                if (id.length !== 11) throw new Error("ç„¡æ•ˆçš„å½±ç‰‡ ID");
                
                videoId = id;
                if (player && playerReady) {
                    player.loadVideoById(videoId);
                    console.log(`âœ… å½±ç‰‡å·²æ›´æ›: ${videoId}`);
                }
            } catch (e) {
                console.error("éŒ¯èª¤: " + e.message);
            }
        }

        // Export Function
        function downloadHTML() {
            const clone = document.documentElement.cloneNode(true);
            
            // Replace entire navigation bar with simplified Export-only version
            const nav = clone.querySelector('nav');
            if (nav) {
                const linksListHtml = headerLinks.map(link => 
                    `<a href="${link.url}" target="_blank" rel="noopener" class="block px-3 py-2 text-xs text-blue-600 hover:bg-blue-50 rounded">${link.name}</a>`
                ).join('');
                
                nav.innerHTML = `
                    <div class="max-w-7xl mx-auto px-4 sm:px-6">
                        <div class="flex justify-between h-16 items-center">
                            <div class="flex items-center gap-3">
                                <div class="relative">
                                    <button id="header-links-trigger-export" class="flex items-center gap-3 text-left rounded-lg px-2 py-1 -ml-2 hover:bg-slate-50 transition">
                                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                            <span class="material-symbols-outlined text-white text-xl">school</span>
                                        </div>
                                        <div class="flex flex-col">
                                            <div class="font-bold text-lg text-slate-900">StudyEngine</div>
                                            <div class="text-xs text-slate-500 hidden sm:block">è‹±èªå­¸ç¿’å¹³å°</div>
                                        </div>
                                    </button>
                                    <div id="header-links-menu-export" class="hidden absolute left-0 mt-2 w-64 bg-white border border-slate-200 rounded-xl shadow-lg z-50 p-2">
                                        <div class="text-xs font-semibold text-slate-600 px-2 py-1 mb-1">å›ºå®šé€£çµ</div>
                                        ${linksListHtml || '<div class="px-2 py-1 text-xs text-slate-400">ç„¡é€£çµ</div>'}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <button onclick="toggleExportMenu()" class="px-3 py-2 rounded-lg border border-purple-200 bg-purple-50 hover:bg-purple-100 text-purple-700 transition text-sm font-medium flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-lg">bookmark</span>
                                    <span class="hidden sm:inline">Export Words (</span><span class="sm:hidden">(</span><span id="selected-count">${selectedWords.length}</span><span>)</span>
                                </button>
                                <div id="export-menu" class="hidden absolute top-full right-0 mt-2 bg-white border border-slate-200 rounded-xl shadow-lg z-50 min-w-max overflow-hidden">
                                    <button onclick="copyExportPrompt()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 border-b border-slate-100 flex items-center gap-2 text-sm" title="è¤‡è£½ç”ŸæˆAIæŒ‡ä»¤çš„Prompt">
                                        <span class="material-symbols-outlined text-sm text-blue-600">content_copy</span> <span>è¤‡è£½ Prompt</span>
                                    </button>
                                    <button onclick="exportSelectedWords()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 flex items-center gap-2 text-sm" title="ä¸‹è¼‰é¸ä¸­çš„ç”Ÿå­—">
                                        <span class="material-symbols-outlined text-sm text-blue-600">download</span> <span>ä¸‹è¼‰æ–‡å­—æª”</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Remove all Five Server and third-party injected code
            const scriptsToRemove = clone.querySelectorAll('script[data-id="five-server"], script[id="www-widgetapi-script"]');
            scriptsToRemove.forEach(s => s.remove());
            
            // Remove all injected styles (Five Server, Tailwind compiled, third-party)
            const stylesToRemove = clone.querySelectorAll('style[id*="five"], style[class*="five"], style:not([type])');
            stylesToRemove.forEach(s => {
                const content = s.textContent || '';
                if (content.includes('five-server') || 
                    content.includes('fiveserver') || 
                    content.includes('keyword-info') ||
                    content.includes('tippy-') ||
                    content.includes('ubersuggest') ||
                    content.includes('bl-info') ||
                    content.includes('kw-info') ||
                    content.includes('statistics-graph') ||
                    content.includes('ue-sidebar') ||
                    content.includes('tw-border-spacing') ||
                    content.includes('tailwindcss v3.4')) {
                    s.remove();
                }
            });
            
            // Remove Ubersuggest/extension divs
            const extensionDivs = clone.querySelectorAll('.ue-sidebar-container, [class*="ubersuggest"]');
            extensionDivs.forEach(div => div.remove());

            let html = clone.outerHTML;

            // Fix toggleExportMenu function for exported file (use 'export-menu' instead of type parameter)
            html = html.replace(
                /function toggleExportMenu\(type = 'desktop'\) \{\s*const menuId = type === 'mobile' \? 'export-menu-mobile' : 'export-menu-desktop';/,
                `function toggleExportMenu(type = 'desktop') {
            const menuId = 'export-menu';`
            );
            
            // Add toggleMobileMenu function if not present
            if (!html.includes('function toggleMobileMenu()')) {
                const insertPoint = html.indexOf('function toggleExportMenu');
                if (insertPoint !== -1) {
                    html = html.slice(0, insertPoint) + 
                           `function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('hamburger-btn');
            if (!menu || !btn) return;
            menu.classList.toggle('hidden');
            btn.classList.toggle('active');
        }

        ` + 
                           html.slice(insertPoint);
                }
            }

            // Remove Insert button from exported file
            html = html.replace(
                /<button[^>]*onclick="openInsertModal\([^)]*\)"[^>]*>[\s\S]*?<\/button>\s*/g,
                ''
            );

            // Inject data (keep videoId empty for exported files)
            html = html.replace(
                /let transcriptData = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('transcriptData'\) \|\| '\[\]'\));/s,
                `let transcriptData = ${JSON.stringify(transcriptData)};`
            );
            html = html.replace(
                /let summaryData = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('summaryData'\) \|\| '\[\]'\));/s,
                `let summaryData = ${JSON.stringify(summaryData)};`
            );
            html = html.replace(
                /let vocabData = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('vocabData'\) \|\| '\[\]'\));/s,
                `let vocabData = ${JSON.stringify(vocabData)};`
            );
            html = html.replace(
                /let summaryVocabData = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('summaryVocabData'\) \|\| '\[\]'\));/s,
                `let summaryVocabData = ${JSON.stringify(summaryVocabData)};`
            );
            html = html.replace(
                /let quizData = (?:\[.*?\]|\{.*?\}|JSON\.parse\(localStorage\.getItem\('quizData'\) \|\| '\[\]'\));/s,
                `let quizData = ${JSON.stringify(quizData)};`
            );
            html = html.replace(
                /let selectedWords = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('selectedWords'\) \|\| '\[\]'\));/s,
                `let selectedWords = ${JSON.stringify(selectedWords)};`
            );
            html = html.replace(
                /let videoId = (?:localStorage\.getItem\('videoId'\) \|\| ''|'[^']*');/,
                `let videoId = localStorage.getItem('videoId') || '';`
            );

            // ç¢ºä¿ player æ˜¯ç©ºçš„ divï¼Œä¸è¦åŒ…å« iframe
            html = html.replace(
                /<iframe[^>]*id="player"[^>]*>[\s\S]*?<\/iframe>/,
                '<div id="player" class="absolute inset-0"></div>'
            );
            html = html.replace(
                /<div id="player"[^>]*>[\s\S]*?<\/div>/,
                '<div id="player" class="absolute inset-0"></div>'
            );

            // Remove Capture buttons from exported file
            html = html.replace(
                /<button[^>]*onclick="captureTime\([^)]+\)"[^>]*>[\s\S]*?Capture[\s\S]*?<\/button>/g,
                ''
            );
            
            // Remove captureTime function from exported file
            html = html.replace(
                /function captureTime\([^)]*\) \{[\s\S]*?\n        \}/,
                ''
            );
            
            // Remove setTimeByInput function from exported file
            html = html.replace(
                /function setTimeByInput\([^)]*\) \{[\s\S]*?\n        \}/,
                ''
            );
            
            // Add CSS to hide time input fields in exported file
            html = html.replace(
                /(<\/style>)/,
                `        
        /* Hide time input fields */
        .flex.items-center.gap-0.bg-blue-50 {
            display: none !important;
        }
$1`
            );
            
            // Update video section hint text
            html = html.replace(
                /é»æ“Šæ™‚é–“æ¨™ç±¤è·³è½‰åˆ°æŒ‡å®šæ™‚é–“/,
                'é»æ“Šæ™‚é–“æ¨™ç±¤è·³è½‰åˆ°æŒ‡å®šæ™‚é–“'
            );

            // Inject header links toggle script for exported file
            const headerLinksScript = `
        const headerLinksTriggerExport = document.getElementById('header-links-trigger-export');
        const headerLinksMenuExport = document.getElementById('header-links-menu-export');
        
        if (headerLinksTriggerExport && headerLinksMenuExport) {
            headerLinksTriggerExport.addEventListener('click', (e) => {
                e.stopPropagation();
                headerLinksMenuExport.classList.toggle('hidden');
            });
            
            document.addEventListener('click', (e) => {
                if (!headerLinksMenuExport.classList.contains('hidden')) {
                    const withinMenu = headerLinksMenuExport.contains(e.target);
                    const withinTrigger = headerLinksTriggerExport.contains(e.target);
                    if (!withinMenu && !withinTrigger) {
                        headerLinksMenuExport.classList.add('hidden');
                    }
                }
            });
        }
            `;
            
            html = html.replace(
                /(<\/body>)/,
                `<script>${headerLinksScript}<\/script>$1`
            );

            // Download
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'study_guide.html';
            a.click();
            URL.revokeObjectURL(url);

            console.log(`âœ… åŒ¯å‡ºæˆåŠŸï¼\né€å­—ç¨¿: ${transcriptData.length} æ®µ\nå–®å­—: ${vocabData.length} å€‹\nå½±ç‰‡: éœ€é€éã€Œæ›´æ›å½±ç‰‡ã€æŒ‰éˆ•è¨­å®š`);
        }

        // Load YouTube API
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        document.head.appendChild(tag);

        // Global YouTube Ready handler
        window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

        // Initialize if data exists
        if (transcriptData.length > 0 || vocabData.length > 0) {
            renderTranscript();
            renderVocab();
        }
        
        // Update transcript title if CEFR level is set
        if (cefrLevel) {
            const transcriptTitle = document.getElementById('transcript-title');
            if (transcriptTitle) {
                transcriptTitle.textContent = `æ‘˜è¦ï¼ˆ${cefrLevel}ï¼‰`;
            }
            // Activate summary mode if CEFR level is persisted
            document.body.classList.add('summary-mode');
        }
        
        // Update selected word count
        updateSelectedCount();
        
        // Text Selection Handler
        document.addEventListener('mouseup', handleTextSelection);
        
        function handleTextSelection(e) {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();
            
            if (!selectedText || selectedText.length === 0) {
                hideSelectionPopup();
                return;
            }
            
            // Check if selection is within transcript
            const container = document.getElementById('transcript-content');
            if (!container || !container.contains(selection.anchorNode)) {
                hideSelectionPopup();
                return;
            }
            
            // Show popup near cursor
            const popup = document.getElementById('selection-popup');
            const range = selection.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            
            popup.style.left = (rect.left + rect.width / 2 - 60) + 'px';
            popup.style.top = (rect.top - 45) + 'px';
            popup.classList.remove('hidden');
            
            popup.onclick = () => addSelectedWord(selectedText);
        }
        
        function hideSelectionPopup() {
            const popup = document.getElementById('selection-popup');
            if (popup) popup.classList.add('hidden');
        }
        
        function addSelectedWord(word) {
            word = word.trim();
            if (!word || selectedWords.includes(word)) {
                hideSelectionPopup();
                window.getSelection().removeAllRanges();
                return;
            }
            
            selectedWords.push(word);
            localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
            updateSelectedCount();
            highlightSelectedWords();
            hideSelectionPopup();
            window.getSelection().removeAllRanges();
            
            console.log(`âœ… å·²åŠ å…¥ç”Ÿå­—: ${word}`);
        }
        
        function removeSelectedWord(word) {
            word = word.trim();
            const index = selectedWords.indexOf(word);
            if (index > -1) {
                selectedWords.splice(index, 1);
                localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
                updateSelectedCount();
                highlightSelectedWords();
                console.log(`âŒ å·²å–æ¶ˆé¸å–: ${word}`);
            }
        }
        
        function updateSelectedCount() {
            const countEl = document.getElementById('selected-count');
            const countElMobile = document.getElementById('selected-count-mobile');
            if (countEl) countEl.textContent = selectedWords.length;
            if (countElMobile) countElMobile.textContent = selectedWords.length;
        }
        
        function highlightSelectedWords() {
            const container = document.getElementById('transcript-content');
            if (!container) return;
            
            // Remove existing highlights
            container.querySelectorAll('.selected-word').forEach(el => {
                el.outerHTML = el.textContent;
            });
            
            // Re-render to apply new highlights
            renderTranscript();
        }
        
        function toggleExportMenu(type = 'desktop') {
            const menuId = 'export-menu';
            const menu = document.getElementById(menuId);
            if (!menu) return;
            
            menu.classList.toggle('hidden');
            
            // é»æ“Šå¤–éƒ¨æ™‚é—œé–‰é¸å–®
            if (!menu.classList.contains('hidden')) {
                document.addEventListener('click', (e) => {
                    if (!e.target.closest(`#${menuId}`) && !e.target.closest('button[onclick*="toggleExportMenu"]')) {
                        menu.classList.add('hidden');
                    }
                }, { once: true });
            }
        }
        
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('hamburger-btn');
            
            menu.classList.toggle('hidden');
            btn.classList.toggle('active');
            
            // é»æ“Šå¤–éƒ¨æ™‚é—œé–‰é¸å–®
            if (!menu.classList.contains('hidden')) {
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#mobile-menu') && !e.target.closest('#hamburger-btn')) {
                        menu.classList.add('hidden');
                        btn.classList.remove('active');
                    }
                }, { once: true });
            }
        }

        function generateExportPrompt() {
            if (selectedWords.length === 0) {
                return '';
            }
            
            let prompt = selectedWords.join('\n');
            prompt += '\n\nå°‡ä»¥ä¸Šè‹±æ–‡å–®å­—åš´æ ¼ä¾ç…§ä»¥ä¸‹ JSON Array æ ¼å¼è¼¸å‡ºçµæœï¼š\n\n';
            prompt += '1.  **id**: å–®å­—çš„å…¨å°å¯«å½¢å¼ã€‚\n';
            prompt += '2.  **word**: å–®å­—çš„é¦–å­—æ¯å¤§å¯«ã€‚\n';
            prompt += '3.  **ipa**: è©²å–®å­—çš„ IPA éŸ³æ¨™ã€‚\n';
            prompt += '4.  **pos**: è©æ€§ (å¦‚ noun, verb, adjective)ã€‚\n';
            prompt += '5.  **def**: ç°¡æ½”çš„è‹±æ–‡å®šç¾©ã€‚\n';
            prompt += '6.  **cn**: ç¹é«”ä¸­æ–‡è§£é‡‹ (è‹¥æœ‰ç‰¹å®šèªå¢ƒè«‹ä¸€ä½µæ¨™è¨»)ã€‚\n';
            prompt += '7.  **image**: è«‹è¼¸å‡ºæ ¼å¼ç‚º `https://source.unsplash.com/featured/?{å–®å­—}` çš„é€£çµï¼Œå°‡ `{å–®å­—}` æ›¿æ›ç‚ºè©²å–®å­—çš„è‹±æ–‡å…§å®¹ï¼Œä»¥ä¾¿è‡ªå‹•æŠ“å–ç›¸é—œåœ–ç‰‡ã€‚\n\n';
            prompt += 'ç¯„ä¾‹æ ¼å¼ï¼š\n\n';
            prompt += '[\n';
            prompt += '    {\n';
            prompt += '        "id": "pareidolia",\n';
            prompt += '        "word": "Pareidolia",\n';
            prompt += '        "ipa": "/ËŒpÃ¦r.ÉªËˆdoÊŠ.li.É™/",\n';
            prompt += '        "pos": "noun",\n';
            prompt += '        "def": "The psychological phenomenon of seeing recognizable shapes, especially faces, in random or vague stimuli.",\n';
            prompt += '        "cn": "å¹»æƒ³æ€§éŒ¯è¦º (å°¤æŒ‡å°‡æ¨¡ç³Šåœ–åƒçœ‹ä½œäººè‡‰)",\n';
            prompt += '        "image": "https://source.unsplash.com/featured/?pareidolia"\n';
            prompt += '    }\n';
            prompt += ']\n';
            
            return prompt;
        }

        function copyExportPrompt() {
            if (selectedWords.length === 0) {
                alert('å°šæœªé¸å–ä»»ä½•ç”Ÿå­—');
                return;
            }
            
            const prompt = generateExportPrompt();
            navigator.clipboard.writeText(prompt).then(() => {
                document.getElementById('export-menu').classList.add('hidden');
                console.log(`âœ… Export Prompt å·²è¤‡è£½ (${selectedWords.length} å€‹ç”Ÿå­—)`);
            }).catch(() => {
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹é‡è©¦');
            });
        }

        function exportSelectedWords() {
            if (selectedWords.length === 0) {
                alert('å°šæœªé¸å–ä»»ä½•ç”Ÿå­—');
                return;
            }
            
            const text = selectedWords.map((word, i) => `${i + 1}. ${word}`).join('\n');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'selected_words.txt';
            a.click();
            URL.revokeObjectURL(url);
            
            console.log(`âœ… å·²åŒ¯å‡º ${selectedWords.length} å€‹ç”Ÿå­—`);
        }
        
        // Initialize on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                renderTranscript();
                renderVocab();
                renderHeaderLinks();
            });
        } else {
            // DOM is already ready
            renderTranscript();
            renderVocab();
            renderHeaderLinks();
        }
    </script>


<script>
        const headerLinksTriggerExport = document.getElementById('header-links-trigger-export');
        const headerLinksMenuExport = document.getElementById('header-links-menu-export');
        
        if (headerLinksTriggerExport && headerLinksMenuExport) {
            headerLinksTriggerExport.addEventListener('click', (e) => {
                e.stopPropagation();
                headerLinksMenuExport.classList.toggle('hidden');
            });
            
            document.addEventListener('click', (e) => {
                if (!headerLinksMenuExport.classList.contains('hidden')) {
                    const withinMenu = headerLinksMenuExport.contains(e.target);
                    const withinTrigger = headerLinksTriggerExport.contains(e.target);
                    if (!withinMenu && !withinTrigger) {
                        headerLinksMenuExport.classList.add('hidden');
                    }
                }
            });
        }
            </script></body></html>