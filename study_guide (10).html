<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>完整學習網頁生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&amp;family=Inter:wght@400;500;600;700&amp;family=Material+Symbols+Outlined" rel="stylesheet">
    <style>
        * { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        
        body {
            background: linear-gradient(135deg, #f8fafb 0%, #f0f4f8 100%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        .vocab-word { 
            border-bottom: 2px solid #60a5fa; 
            cursor: pointer; 
            color: #2563eb; 
            font-weight: 600; 
            transition: all 0.2s ease; 
            padding: 2px 4px;
            border-radius: 2px;
        }
        .vocab-word:hover { 
            background-color: #dbeafe;
            border-bottom-color: #2563eb;
        }
        .vocab-word-custom { 
            border-bottom: 2px solid #f87171; 
            cursor: pointer; 
            color: #dc2626; 
            font-weight: 600; 
            transition: all 0.2s ease; 
            padding: 2px 4px;
            border-radius: 2px;
        }
        .vocab-word-custom:hover { 
            background-color: #fee2e2;
            border-bottom-color: #991b1b;
        }
        #floating-card { 
            transition: opacity 0.2s, transform 0.2s ease; 
            pointer-events: none; 
            z-index: 9999;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal { transition: all 0.3s ease-in-out; }
        .modal.hidden { opacity: 0; pointer-events: none; }
        #quiz-modal { transition: all 0.3s ease-in-out; }
        #quiz-modal.hidden { opacity: 0; pointer-events: none; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .selected-word { 
            background-color: #fef3c7; 
            border-bottom: 2px solid #eab308; 
            font-weight: 600;
            padding: 2px 4px;
            border-radius: 2px;
        }
        #selection-popup { 
            transition: all 0.2s ease; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .learning-card {
            transition: all 0.3s ease;
        }
        .learning-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.08);
        }
        
        /* 漢堡選單樣式 */
        #mobile-menu {
            transition: all 0.3s ease;
        }
        #mobile-menu.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .hamburger-line {
            transition: all 0.3s ease;
        }
        #hamburger-btn.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        #hamburger-btn.active .hamburger-line:nth-child(2) {
            opacity: 0;
        }
        #hamburger-btn.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
    </style>
<script src="https://www.youtube.com/iframe_api"></script><style id="_goober"> @keyframes go2264125279{from{transform:scale(0) rotate(45deg);opacity:0;}to{transform:scale(1) rotate(45deg);opacity:1;}}@keyframes go3020080000{from{transform:scale(0);opacity:0;}to{transform:scale(1);opacity:1;}}@keyframes go463499852{from{transform:scale(0) rotate(90deg);opacity:0;}to{transform:scale(1) rotate(90deg);opacity:1;}}@keyframes go1268368563{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}@keyframes go1310225428{from{transform:scale(0) rotate(45deg);opacity:0;}to{transform:scale(1) rotate(45deg);opacity:1;}}@keyframes go651618207{0%{height:0;width:0;opacity:0;}40%{height:0;width:6px;opacity:1;}100%{opacity:1;height:10px;}}@keyframes go901347462{from{transform:scale(0.6);opacity:0.4;}to{transform:scale(1);opacity:1;}}.go4109123758{z-index:9999;}.go4109123758 > *{pointer-events:auto;}</style><style>.rr--group{display:flex;width:100%;position:relative}.rr--box{display:flex;width:100%;flex-grow:1;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rr--svg{display:flex;aspect-ratio:1;width:100%;flex-grow:1;overflow:clip;pointer-events:none}@supports not (overflow: clip){.rr--svg{overflow:auto}}.rr--box:focus,.rr--box:focus-visible,.rr-reset:focus-visible,.rr-reset:focus{outline:none;box-shadow:none}.rr--focus-reset{outline:6px double #0079ff}.rr--box:focus-visible .rr--svg{outline:6px double #0079ff;isolation:isolate}.rr--reset{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0;right:0;bottom:50%}[dir=rtl] .rr--reset{left:0;right:auto}.rr--dir-y .rr--reset{bottom:0;right:50%}.rr--disabled{opacity:.5;cursor:not-allowed}.rr--disabled .rr--svg{pointer-events:none}.rr--pointer .rr--box{cursor:pointer}.rr--dir-x{flex-direction:row}.rr--dir-y{flex-direction:column}.rr--space-sm .rr--svg{padding:8%}.rr--space-md .rr--svg{padding:12.5%}.rr--space-lg .rr--svg{padding:17.5%}.rr--dir-x.rr--gap-sm .rr--svg{margin:0 6.25%}.rr--dir-x.rr--gap-sm .rr--box:focus-visible:after{width:87.5%;left:6.25%}.rr--dir-x.rr--gap-md .rr--svg{margin:0 12.5%}.rr--dir-x.rr--gap-md .rr--box:focus-visible:after{width:75%;left:12.5%}.rr--dir-x.rr--gap-lg .rr--svg{margin:0 25%}.rr--dir-x.rr--gap-lg .rr--box:focus-visible:after{width:50%;left:25%}.rr--dir-y.rr--gap-sm .rr--svg{margin:6.25% 0}.rr--dir-y.rr--gap-md .rr--svg{margin:12.5% 0}.rr--dir-y.rr--gap-lg .rr--svg{margin:25% 0}.rr--rx-sm .rr--svg{border-radius:5%}.rr--rx-md .rr--svg{border-radius:15%}.rr--rx-lg .rr--svg{border-radius:20%}.rr--rx-full .rr--svg{border-radius:100%}.rr--has-stroke .rr--svg{stroke-linecap:round;stroke-linejoin:round}.rr--has-border .rr--svg{border-width:var(--rr--border-width);border-style:solid}.rr--on .rr--svg{fill:var(--rr--fill-on-color, none)}.rr--off .rr--svg{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--on .rr--svg{stroke:var(--rr--stroke-on-color, currentColor)}.rr--has-stroke .rr--off .rr--svg{stroke:var(--rr--stroke-off-color, currentColor)}.rr--on .rr--svg{background-color:var(--rr--box-on-color, none)}.rr--off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--has-border .rr--off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}.rr--has-border .rr--on .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--fx-colors{--rr--easing: .2s cubic-bezier(.61, 1, .88, 1)}.rr--fx-colors .rr--svg{transition-duration:.2s;transition-timing-function:var(--rr--easing);transition-property:background-color,border-color,fill,stroke}.rr--fx-opacity .rr--off{opacity:.35;transition:opacity var(--rr--easing)}.rr--fx-opacity .rr--on{opacity:1}@media(hover: hover){.rr--fx-opacity .rr--box:hover{opacity:1}}@media(hover: hover){.rr--fx-zoom .rr--box{transition:transform var(--rr--easing);transform:scale(1)}.rr--fx-zoom .rr--box:hover{transform:scale(1.2)}}@media(hover: hover)and (prefers-reduced-motion){.rr--fx-zoom .rr--box:hover{transform:scale(1)}}@media(hover: hover){.rr--fx-position .rr--box{transition:transform var(--rr--easing);transform:translateY(0)}.rr--fx-position .rr--box:hover{transform:translateY(-15%)}}@media(hover: hover)and (prefers-reduced-motion){.rr--fx-position .rr--box:hover{transform:translateY(0)}}.rr--svg-stop-1{stop-color:var(--rr--fill-on-color, rgba(0, 0, 0, 0))}[dir=rtl] .rr--svg-stop-1,.rr--svg-stop-2{stop-color:var(--rr--fill-off-color, rgba(0, 0, 0, 0))}[dir=rtl] .rr--svg-stop-2{stop-color:var(--rr--fill-on-color, rgba(0, 0, 0, 0))}.rr--hf-svg-on{fill:var(--rr--fill-on-color, none)}.rr--hf-svg-off{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--hf-svg-on{stroke:var(--rr--stroke-on-color, currentColor)}.rr--has-stroke .rr--hf-svg-off{stroke:var(--rr--stroke-off-color, currentColor)}.rr--hf-svg-on .rr--svg,.rr--hf-svg-off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--has-border .rr--hf-svg-on .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--has-border .rr--hf-svg-off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}.rr--dir-x .rr--hf-box-int .rr--svg{background:linear-gradient(to right, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}[dir=rtl] .rr--dir-x .rr--hf-box-int .rr--svg{background:linear-gradient(to left, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}.rr--dir-y .rr--hf-box-int .rr--svg{background:linear-gradient(to bottom, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}.rr--hf-box-on .rr--svg{background-color:var(--rr--box-on-color, none)}.rr--hf-box-off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--hf-box-on .rr--svg,.rr--hf-box-off .rr--svg,.rr--hf-box-int .rr--svg{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--hf-box-on .rr--svg,.rr--has-stroke .rr--hf-box-off .rr--svg,.rr--has-stroke .rr--hf-box-int .rr--svg{stroke:var(--rr--stroke-off-color, currentColor)}.rr--has-border .rr--hf-box-on .rr--svg,.rr--has-border .rr--hf-box-int .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--has-border .rr--hf-box-off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}</style><style>.kw-overview-container{box-sizing:border-box;width:673px;padding:0;margin:0;margin-top:14px;font-size:12px;font-family:Figtree;-webkit-font-smoothing:antialiased}.kw-overview-container.youtube{box-sizing:border-box;width:645px;padding:0;margin:0;font-size:12px}</style></head>
<body class="text-slate-700">

    <nav class="bg-white border-b border-slate-100 sticky top-0 z-40 shadow-sm">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6">
                        <div class="flex justify-between h-16 items-center">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                    <span class="material-symbols-outlined text-white text-xl">school</span>
                                </div>
                                <div class="flex flex-col">
                                    <div class="font-bold text-lg text-slate-900">StudyEngine</div>
                                    <div class="text-xs text-slate-500 hidden sm:block">英語學習平台</div>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <button onclick="toggleExportMenu()" class="px-3 py-2 rounded-lg border border-purple-200 bg-purple-50 hover:bg-purple-100 text-purple-700 transition text-sm font-medium flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-lg">bookmark</span>
                                    <span class="hidden sm:inline">Export Words (</span><span class="sm:hidden">(</span><span id="selected-count">2</span><span>)</span>
                                </button>
                                <div id="export-menu" class="hidden absolute top-full right-0 mt-2 bg-white border border-slate-200 rounded-xl shadow-lg z-50 min-w-max overflow-hidden">
                                    <button onclick="copyExportPrompt()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 border-b border-slate-100 flex items-center gap-2 text-sm" title="複製生成AI指令的Prompt">
                                        <span class="material-symbols-outlined text-sm text-blue-600">content_copy</span> <span>複製 Prompt</span>
                                    </button>
                                    <button onclick="exportSelectedWords()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 flex items-center gap-2 text-sm" title="下載選中的生字">
                                        <span class="material-symbols-outlined text-sm text-blue-600">download</span> <span>下載文字檔</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>

    <div class="max-w-7xl mx-auto px-6 py-8 pb-32 space-y-8">
        
        <!-- Video Section (Will be included in export) -->
        <section id="video-section" class="bg-white rounded-2xl p-8 shadow-sm border border-slate-100 learning-card">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold flex items-center gap-3 text-slate-900">
                    <div class="p-2 bg-red-100 rounded-lg">
                        <span class="material-symbols-outlined text-red-600 text-2xl">play_circle</span>
                    </div>
                    視頻播放
                </h3>
                <button onclick="openModal('video')" class="px-4 py-2 rounded-lg border border-slate-200 bg-slate-50 hover:bg-slate-100 text-slate-700 text-sm font-medium transition flex items-center gap-2">
                    <span class="material-symbols-outlined text-base">edit</span> 更換影片
                </button>
            </div>
            <div class="relative w-full bg-black rounded-xl overflow-hidden" style="padding-top: 56.25%;">
                <div id="player" class="absolute inset-0"></div>
            </div>
            <p class="text-sm text-slate-600 mt-3">
                點擊時間標籤跳轉到指定時間
            </p>
        </section>

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Transcript -->
            <main class="lg:w-2/3 bg-white p-8 rounded-2xl shadow-lg">
                <div class="flex justify-between items-center mb-6 border-b pb-4">
                    <h2 class="text-2xl font-bold text-slate-900">逐字稿</h2>
                    <button onclick="toggleTranslations()" class="px-3 py-2 rounded-lg border border-slate-200 bg-slate-50 hover:bg-slate-100 text-slate-600 text-sm font-medium transition flex items-center gap-2">
                        <span class="material-symbols-outlined text-base">translate</span> <span id="toggle-btn-text">顯示中文</span>
                    </button>
                </div>
                
                <div id="transcript-content" class="space-y-8 text-lg leading-relaxed text-slate-700">
                    <div class="mb-6" id="seg-0">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(4)">
                                ⏵ 00:04
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-0" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="0" onchange="setTimeByInput(0)" onkeypress="if(event.key==='Enter') setTimeByInput(0)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-0" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="04" onchange="setTimeByInput(0)" onkeypress="if(event.key==='Enter') setTimeByInput(0)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(0)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-0">Do you ever close your laptop at the end of a long day and feel like you have just enough energy to crawl over to the couch to scroll on your phone or watch a show or maybe both at the same time? Yeah, during the <span class="vocab-word-custom" data-id="pandemic" onmouseenter="showCard(event, 'pandemic')" onmouseleave="hideCard()" onclick="toggleCard(event, 'pandemic')">pandemic</span> that was all I wanted to do. And I couldn't understand why. I was safe, I was healthy. Why didn't I want to close my laptop and go dance around the living room? Where did all my energy go?</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-0">你是否曾在結束漫長的一天後闔上筆記型電腦，覺得自己僅剩的力氣只夠爬到沙發上滑手機或看劇，甚至兩者同時進行？是的，疫情期間這就是我想做的所有事。我不明白為什麼，我很安全，我很健康，為什麼我不想闔上筆記型電腦然後在客廳裡跳舞？我的精力都去哪了？</p>
                    </div>
                    <div class="mb-6" id="seg-1">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(35)">
                                ⏵ 00:35
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-1" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="0" onchange="setTimeByInput(1)" onkeypress="if(event.key==='Enter') setTimeByInput(1)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-1" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="35" onchange="setTimeByInput(1)" onkeypress="if(event.key==='Enter') setTimeByInput(1)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(1)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-1">I'm a journalist. My specialty for the last 10 years has been trying to understand how our tech habits change us as people. And so I decided I was going to find out why sitting in front of a screen makes us feel so exhausted. Because we have all heard about the mental effects, right? But what about our physical health? Well, as I quickly learned, looking at screens has not only reshaped our days, it is reshaping our bodies.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-1">我是一名記者，過去十年的專長是試圖理解我們的科技習慣如何改變我們。所以我決定找出為什麼坐在螢幕前會讓我們感到如此疲憊。因為我們都聽說過心理方面的影響，對吧？但我們的身體健康呢？正如我很快了解到的，注視螢幕不僅重塑了我們的日子，也在重塑我們的身體。</p>
                    </div>
                    <div class="mb-6" id="seg-2">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(66)">
                                ⏵ 01:06
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-2" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="1" onchange="setTimeByInput(2)" onkeypress="if(event.key==='Enter') setTimeByInput(2)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-2" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="06" onchange="setTimeByInput(2)" onkeypress="if(event.key==='Enter') setTimeByInput(2)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(2)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-2">According to researchers at Johns Hopkins, every day the average 19-year-old moves about as much as the average 60-year-old. Over the last 20 years, rates of type 2 diabetes in young people have doubled. Three in four American adults has a chronic illness. Many of those are preventable. At least one chronic illness. And the WHO says that this is a global problem. They predict that by the end of the decade, which is not that far away, this lifestyle will likely lead to 500 million new cases of preventable conditions like heart disease, obesity and diabetes, costing governments 27 billion a year.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-2">根據約翰霍普金斯大學研究人員的說法，現在平均 19 歲的年輕人每天的活動量大約與平均 60 歲的人相當。過去 20 年來，年輕人罹患第 2 型糖尿病的比率翻了一倍。四分之三的美國成年人患有慢性病，其中許多是可以預防的，至少患有一種慢性病。世界衛生組織表示這是一個全球性問題。他們預測到本世紀末——其實並不遙遠——這種生活方式可能會導致 5 億個新的可預防疾病病例，如心臟病、肥胖和糖尿病，每年將耗費政府 270 億美元。</p>
                    </div>
                    <div class="mb-6" id="seg-3">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(107)">
                                ⏵ 01:47
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-3" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="1" onchange="setTimeByInput(3)" onkeypress="if(event.key==='Enter') setTimeByInput(3)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-3" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="47" onchange="setTimeByInput(3)" onkeypress="if(event.key==='Enter') setTimeByInput(3)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(3)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-3">Typing, swiping, scrolling, sitting. This is the rhythm of our modern life. But I don't know about you, I can't throw away my phone, right? Like I can't go off the grid. So how can we stay connected without slowly destroying our health? That was the question running through my mind when I came across this guy. Keith Diaz is a <span class="vocab-word" data-id="physiologist" onmouseenter="showCard(event, 'physiologist')" onmouseleave="hideCard()" onclick="toggleCard(event, 'physiologist')">physiologist</span> at Columbia University Medical Center, and he has spent his entire career trying to figure out how little can we get away with moving so that sitting doesn't kill us basically.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-3">打字、滑動、捲動、坐著，這是我們現代生活的節奏。但我不知道你怎麼樣，我不能扔掉我的手機，對吧？就像我不能與世隔絕一樣。那麼，我們要如何在保持聯繫的同時，不讓健康慢慢被摧毀呢？這是我遇到這個人時腦海中盤旋的問題。基思·迪亞茲 (Keith Diaz) 是哥倫比亞大學醫學中心的生理學家，他整個職業生涯都在試圖找出：我們最少需要動多少，才不會讓久坐殺死我們。</p>
                    </div>
                    <div class="mb-6" id="seg-4">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(143)">
                                ⏵ 02:23
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-4" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="2" onchange="setTimeByInput(4)" onkeypress="if(event.key==='Enter') setTimeByInput(4)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-4" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="23" onchange="setTimeByInput(4)" onkeypress="if(event.key==='Enter') setTimeByInput(4)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(4)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-4">And in 2022, he published a small study that gives us a great idea. He found that just five minutes of gentle movement every 30 minutes had dramatic effects. It slashed blood sugar and blood pressure. In another study, he found that inactive people who traded 30 minutes of sitting for 30 minutes of movement every day could lower their risk of a <span class="vocab-word-custom" data-id="premature" onmouseenter="showCard(event, 'premature')" onmouseleave="hideCard()" onclick="toggleCard(event, 'premature')">premature</span> death by 18%.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-4">2022 年，他發表了一項小型研究，給了我們一個很好的概念。他發現，每 30 分鐘只需進行 5 分鐘的輕微活動，就能產生顯著的效果。它大幅降低了血糖和血壓。在另一項研究中，他發現不常活動的人如果每天將 30 分鐘的久坐時間換成 30 分鐘的活動，可以將早逝風險降低 18%。</p>
                    </div>
                    <div class="mb-6" id="seg-5">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(168)">
                                ⏵ 02:48
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-5" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="2" onchange="setTimeByInput(5)" onkeypress="if(event.key==='Enter') setTimeByInput(5)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-5" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="48" onchange="setTimeByInput(5)" onkeypress="if(event.key==='Enter') setTimeByInput(5)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(5)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-5">And so maybe you're like, 'Yeah, I worked out this morning, so I'm good.' Or maybe you're like, 'Phew, I'm so glad I got that standing desk.' I am so sorry. But no, if you sit or stand for the majority of your waking hours, your health is in <span class="vocab-word" data-id="jeopardy" onmouseenter="showCard(event, 'jeopardy')" onmouseleave="hideCard()" onclick="toggleCard(event, 'jeopardy')">jeopardy</span> too. Don't stop working out, Keith told me. But he said, 'What you have to do is break up these long stretches of <span class="vocab-word" data-id="sedentary" onmouseenter="showCard(event, 'sedentary')" onmouseleave="hideCard()" onclick="toggleCard(event, 'sedentary')">sedentary</span> screen time.'</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-5">也許你會想：「耶，我今天早上運動過了，所以我沒問題。」或者你會想：「呼，好險我買了那個升降桌。」我真是太對不起了。但不，如果你在清醒的大部分時間裡都是坐著或站著，你的健康同樣岌岌可危。基思告訴我，別停止運動，但他接著說：「你必須做的是打斷這些長時間久坐不動的螢幕時間。」</p>
                    </div>
                    <div class="mb-6" id="seg-6">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(199)">
                                ⏵ 03:19
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-6" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="3" onchange="setTimeByInput(6)" onkeypress="if(event.key==='Enter') setTimeByInput(6)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-6" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="19" onchange="setTimeByInput(6)" onkeypress="if(event.key==='Enter') setTimeByInput(6)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(6)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-6">When he told me this, I was like, 'Really? Like how big a difference can these movement breaks make for someone who is, you know, relatively healthy?' I decided I would join the study. So one day I went to his lab and I sat and worked on my laptop for eight hours straight. The next day, I took those movement breaks every half hour or so. They checked all my vital signs and the results were actually quite extraordinary. My <span class="vocab-word" data-id="glucose" onmouseenter="showCard(event, 'glucose')" onmouseleave="hideCard()" onclick="toggleCard(event, 'glucose')">glucose</span> was cut nearly in half, my blood pressure was down by five points, and my mood was so much better.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-6">當他告訴我這些時，我想：「真的嗎？對於一個相對健康的人來說，這些活動休息能有多大的差別？」我決定加入這項研究。所以有一天，我去了他的實驗室，連續坐著用筆記型電腦工作了八個小時。第二天，我每半小時左右就進行一次活動休息。他們檢查了我所有的生命體徵，結果實際上相當驚人。我的血糖幾乎減半，血壓下降了五個點，而且我的心情好多了。</p>
                    </div>
                    <div class="mb-6" id="seg-7">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(235)">
                                ⏵ 03:55
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-7" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="3" onchange="setTimeByInput(7)" onkeypress="if(event.key==='Enter') setTimeByInput(7)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-7" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="55" onchange="setTimeByInput(7)" onkeypress="if(event.key==='Enter') setTimeByInput(7)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(7)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-7">The science was clear. But like, what did it matter if no one could actually do these movement breaks? Like it was easy in the lab, somebody tapped me on the shoulder and led me over to the treadmill. So we decided to ask people out in the world, out in real life, to see if they could do it. Our teams at NPR and Columbia combined forces to create a podcast and a global clinical trial called the Body Electric Study. And over 20,000 people signed up. We had to cap it at 20,000 people.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-7">科學證據很明確。但如果沒人真的能執行這些活動休息，那又有什麼用呢？在實驗室裡很簡單，有人拍拍我的肩膀，帶我走向跑步機。所以我們決定詢問現實世界中的人們，看看他們是否能做到。我們 NPR 的團隊與哥倫比亞大學合作，製作了一個播客並發起了一項名為「人體電能研究」(Body Electric Study) 的全球臨床試驗。有超過 20,000 人報名，我們不得不將人數限制在 20,000 人。</p>
                    </div>
                    <div class="mb-6" id="seg-8">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(267)">
                                ⏵ 04:27
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-8" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="4" onchange="setTimeByInput(8)" onkeypress="if(event.key==='Enter') setTimeByInput(8)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-8" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="27" onchange="setTimeByInput(8)" onkeypress="if(event.key==='Enter') setTimeByInput(8)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(8)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-8">And they could choose a movement dose. So they could move 5 minutes every half hour, 5 minutes every hour or every 2 hours. They could dance around the house, they could pace on calls, they could walk the dog, they could take out the trash. It didn't matter. They just had to break it up. Break up those long periods of sitting. And you guys, I was so excited. I was like, we are going to launch a movement for movement. Yeah, I've got a way with words.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-8">他們可以選擇一種「活動劑量」：每半小時活動 5 分鐘、每小時活動 5 分鐘，或每兩小時活動一次。他們可以在家裡跳舞，可以在講電話時踱步，可以遛狗，可以倒垃圾。這都不重要，他們只需要打斷久坐，打斷那些長時間的坐姿。各位，我太興奮了，我想：我們要發起一場「為了活動的運動」(movement for movement)。是的，我很會玩文字遊戲。</p>
                    </div>
                    <div class="mb-6" id="seg-9">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(297)">
                                ⏵ 04:57
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-9" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="4" onchange="setTimeByInput(9)" onkeypress="if(event.key==='Enter') setTimeByInput(9)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-9" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="57" onchange="setTimeByInput(9)" onkeypress="if(event.key==='Enter') setTimeByInput(9)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(9)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-9">Um, but I am not going to lie, those first few days were so tough. It takes a lot of intention and a little rebellion to upend a world that is quite literally built around screens and chairs. But when people figured it out, when they started getting those breaks into their lives, they started having breakthroughs. They told us that they felt less pain. They told us that they had more energy. They said that they felt more positive about life in general.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-9">嗯，但我不會說謊，最初幾天非常艱難。要顛覆一個實際上是圍繞著螢幕和椅子建立起來的世界，需要很大的決心和一點反叛精神。但當人們掌握了訣竅，當他們開始將這些休息時間融入生活時，他們開始有了突破。他們告訴我們疼痛感減輕了，精力更充沛了，他們說對生活的整體看法也變得更積極了。</p>
                    </div>
                    <div class="mb-6" id="seg-10">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(329)">
                                ⏵ 05:29
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-10" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="5" onchange="setTimeByInput(10)" onkeypress="if(event.key==='Enter') setTimeByInput(10)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-10" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="29" onchange="setTimeByInput(10)" onkeypress="if(event.key==='Enter') setTimeByInput(10)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(10)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-10">In the end, of the people who started taking movement breaks, 80% managed to stick with them for two solid weeks. And yes, this was a self-reported study with a lot of very motivated participants—hello public radio—but still, the data showed that the more often they took breaks, the better they felt. People who went outside got an extra boost. Some people lost a few of those stubborn pounds. And most people actually liked taking the breaks.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-10">最終，在開始進行活動休息的人中，有 80% 的人成功堅持了整整兩週。是的，這是一項自我報告的研究，參與者都有很高的積極性（哈囉，公共廣播聽眾），但數據仍然顯示，他們休息的頻率越高，感覺就越好。走到戶外的人獲得了額外的提振，有些人減掉了一些頑固的體重，而且大多數人實際上喜歡這些休息時間。</p>
                    </div>
                    <div class="mb-6" id="seg-11">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(359)">
                                ⏵ 05:59
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-11" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="5" onchange="setTimeByInput(11)" onkeypress="if(event.key==='Enter') setTimeByInput(11)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-11" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="59" onchange="setTimeByInput(11)" onkeypress="if(event.key==='Enter') setTimeByInput(11)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(11)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-11">But the biggest surprise to me was that the breaks did not hurt their productivity. People said they got back to their desks and they were able to focus, and they felt that the work they did was actually of better quality. So this research is going through the scientific process right now, but Keith explained to me some of the reasons why these gentle breaks can have such an <span class="vocab-word" data-id="outsized" onmouseenter="showCard(event, 'outsized')" onmouseleave="hideCard()" onclick="toggleCard(event, 'outsized')">outsized</span> impact.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-11">但對我來說最大的驚喜是，這些休息並沒有損害他們的生產力。人們說當他們回到辦公桌前時，能夠更加專注，並且覺得他們所做的工作品質實際上更好了。這項研究目前正在進行科學審查程序，但基思向我解釋了為什麼這些輕微的休息能產生如此巨大影響的一些原因。</p>
                    </div>
                    <div class="mb-6" id="seg-12">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(383)">
                                ⏵ 06:23
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-12" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="6" onchange="setTimeByInput(12)" onkeypress="if(event.key==='Enter') setTimeByInput(12)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-12" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="23" onchange="setTimeByInput(12)" onkeypress="if(event.key==='Enter') setTimeByInput(12)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(12)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-12">So when we sit, our arteries get bent at our hips and our knees, kind of like a kinked vacuum hose. Blood starts pooling in our legs and our muscles stop contracting. But leg muscles need to move, be stimulated in order to clear out fat and sugar and reduce blood pressure. If they don't, over months and over years, that's when those chronic conditions can start to creep in.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-12">當我們坐著時，我們的動脈在臀部和膝蓋處彎曲，有點像打結的吸塵器軟管。血液開始淤積在腿部，肌肉停止收縮。但腿部肌肉需要運動、需要被刺激，才能清除脂肪和糖分並降低血壓。如果沒有這樣做，長年累月下來，這就是那些慢性病開始悄悄找上門的時候。</p>
                    </div>
                    <div class="mb-6" id="seg-13">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(407)">
                                ⏵ 06:47
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-13" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="6" onchange="setTimeByInput(13)" onkeypress="if(event.key==='Enter') setTimeByInput(13)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-13" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="47" onchange="setTimeByInput(13)" onkeypress="if(event.key==='Enter') setTimeByInput(13)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(13)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-13">And then there is our posture. Sitting compresses the <span class="vocab-word" data-id="diaphragm" onmouseenter="showCard(event, 'diaphragm')" onmouseleave="hideCard()" onclick="toggleCard(event, 'diaphragm')">diaphragm</span>. We start taking shallow breaths. Shallow breaths lead to less oxygen going into our blood and up to our brain. Less oxygen in our brain means we get tired and lose focus. Feel free to take a deep breath right now if you want to. And that is where screens come into the picture. So screens can mess with something called <span class="vocab-word" data-id="interoception" onmouseenter="showCard(event, 'interoception')" onmouseleave="hideCard()" onclick="toggleCard(event, 'interoception')">interoception</span>. <span class="vocab-word" data-id="interoception" onmouseenter="showCard(event, 'interoception')" onmouseleave="hideCard()" onclick="toggleCard(event, 'interoception')">Interoception</span> is the body's way of telling you what it needs. It needs a snack, it needs to go to the bathroom, it needs to move.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-13">還有我們的姿勢。坐姿會壓迫橫膈膜，我們開始進行淺呼吸。淺呼吸導致進入血液和輸送到大腦的氧氣減少。大腦缺氧意味著我們會感到疲倦並失去注意力。（如果你想的話，現在可以深吸一口氣。）這就是螢幕介入的地方。螢幕會干擾一種叫做「內感受」(interoception) 的東西。內感受是身體告訴你它需要什麼的方式：它需要吃點心、需要上廁所、需要活動。</p>
                    </div>
                    <div class="mb-6" id="seg-14">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(443)">
                                ⏵ 07:23
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-14" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="7" onchange="setTimeByInput(14)" onkeypress="if(event.key==='Enter') setTimeByInput(14)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-14" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="23" onchange="setTimeByInput(14)" onkeypress="if(event.key==='Enter') setTimeByInput(14)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(14)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-14">The more we focus on screens, the less we listen to the signals that our body is sending us. Your body could be begging for a break, but what do you do? You keep scrolling past the anxiety, scrolling past the exhaustion that eventually can lead to burnout. Yes, and again, those chronic conditions. So how can you start making a change and feeling better?</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-14">我們越專注於螢幕，就越少傾聽身體發出的訊號。你的身體可能在乞求休息，但你做了什麼？你繼續滑手機，忽略焦慮，忽略疲憊。這最終可能導致倦怠，是的，還有那些慢性病。那麼，你要如何開始改變並感覺更好呢？</p>
                    </div>
                    <div class="mb-6" id="seg-15">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(469)">
                                ⏵ 07:49
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-15" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="7" onchange="setTimeByInput(15)" onkeypress="if(event.key==='Enter') setTimeByInput(15)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-15" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="49" onchange="setTimeByInput(15)" onkeypress="if(event.key==='Enter') setTimeByInput(15)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(15)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-15">Well, first think about your most <span class="vocab-word" data-id="sedentary" onmouseenter="showCard(event, 'sedentary')" onmouseleave="hideCard()" onclick="toggleCard(event, 'sedentary')">sedentary</span> stretches of time and then make yourself a <span class="vocab-word" data-id="mantra" onmouseenter="showCard(event, 'mantra')" onmouseleave="hideCard()" onclick="toggleCard(event, 'mantra')">mantra</span>. So like if you are a student you could say, 'I'll take an extra lap around the <span class="vocab-word" data-id="quad" onmouseenter="showCard(event, 'quad')" onmouseleave="hideCard()" onclick="toggleCard(event, 'quad')">quad</span> before class instead of checking TikTok so I get to class with more oxygen in my brain and I can actually focus.' Or if you work from home you could decide that on long Zoom calls I will march in place in order to manage my <span class="vocab-word" data-id="glucose" onmouseenter="showCard(event, 'glucose')" onmouseleave="hideCard()" onclick="toggleCard(event, 'glucose')">glucose</span> and avoid the post-meeting crash.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-15">首先，思考你最長時間久坐不動的時段，然後給自己一個口號。例如，如果你是學生，你可以說：「上課前我會在校園多走一圈，而不是滑 TikTok，這樣我到教室時大腦會有更多氧氣，我也能真正專心。」或者如果你在家工作，你可以決定在長時間的 Zoom 會議中原地踏步，以控制血糖並避免會後的疲勞崩潰。</p>
                    </div>
                    <div class="mb-6" id="seg-16">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(497)">
                                ⏵ 08:17
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-16" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="8" onchange="setTimeByInput(16)" onkeypress="if(event.key==='Enter') setTimeByInput(16)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-16" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="17" onchange="setTimeByInput(16)" onkeypress="if(event.key==='Enter') setTimeByInput(16)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(16)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-16">If you're a parent you could say, 'I will take a lap around the soccer field once so that I have enough energy to get through the dinnertime chaos.' You can have a dance party while you microwave your leftovers. You can walk the <span class="vocab-word" data-id="concourse" onmouseenter="showCard(event, 'concourse')" onmouseleave="hideCard()" onclick="toggleCard(event, 'concourse')">concourse</span> instead of sitting and waiting for your flight. A mix of all these habits will keep your muscles firing and your mood steadier.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-16">如果你是家長，你可以說：「我要繞著足球場走一圈，這樣我才有足夠的精力應付晚餐時間的混亂。」你可以在微波剩菜時開個小型舞會，你可以在等飛機時在航廈走動而不是坐著。混合所有這些習慣將保持你的肌肉運作，讓情緒更穩定。</p>
                    </div>
                    <div class="mb-6" id="seg-17">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(519)">
                                ⏵ 08:39
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-17" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="8" onchange="setTimeByInput(17)" onkeypress="if(event.key==='Enter') setTimeByInput(17)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-17" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="39" onchange="setTimeByInput(17)" onkeypress="if(event.key==='Enter') setTimeByInput(17)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(17)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-17">My favorite story came from a 43-year-old woman named Dana who works in HR. So Dana was a type 2 diabetic with all kinds of health issues. Her doctor told her she needed to take a long brisk walk every morning and she was doing this but her numbers just were not changing. So with her doctor's permission she decided to join the study. She started fitting in movement breaks between all of her meetings. And within a couple of weeks she told me her blood pressure dropped by 40 points, her cholesterol went down, and her doctor told her she could start tapering her insulin. She's actually off all of her meds today. I know, yay Dana. We love you Dana.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-17">我最喜歡的故事來自一位 43 歲、在人資部門工作的女性，名叫黛娜 (Dana)。黛娜患有第 2 型糖尿病，並伴隨各種健康問題。醫生告訴她每天早上需要進行長時間的快走，她照做了，但數值卻沒有變化。所以在醫生的允許下，她決定加入這項研究。她開始在所有會議之間穿插活動休息。幾週內，她告訴我她的血壓下降了 40 個點，膽固醇下降了，醫生告訴她可以開始減少胰島素用量。她現在實際上已經停掉了所有藥物。我知道，太棒了黛娜，我們愛你黛娜。</p>
                    </div>
                    <div class="mb-6" id="seg-18">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(561)">
                                ⏵ 09:21
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-18" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="9" onchange="setTimeByInput(18)" onkeypress="if(event.key==='Enter') setTimeByInput(18)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-18" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="21" onchange="setTimeByInput(18)" onkeypress="if(event.key==='Enter') setTimeByInput(18)">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(18)">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-18">So we know that too much time online is not great for our mental health, but it's not just in our heads, it's in our bodies. We need movement to be as much a part of our lives as screens are. We need our schools, our neighborhoods, our workplaces to give us time and space just to move. You can help push this reset forward. Take movement breaks. And when people look at you like you're weird, just tell them why you're doing it. Because you just want to feel a little better. Get them to put down their phone and join you. Start soon, start small. Should we start now? Yeah let's. Can we have some music? You could do the march, you could do the shuffle, little hands in the air. If you can't get up, feel it. You're alive, you're alive. Love you guys.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-18">所以我們知道，上網時間過長對我們的心理健康不利，但這不僅僅是在我們的腦海裡，也在我們的身體裡。我們需要讓活動像螢幕一樣成為我們生活的一部分。我們需要學校、社區和工作場所給我們時間和空間去活動。你可以幫助推動這個重置：進行活動休息。當人們覺得你很奇怪時，就告訴他們你為什麼這樣做——因為你只想感覺好一點。讓他們放下手機加入你。儘快開始，從小處做起。我們現在開始好嗎？好，來吧！可以來點音樂嗎？你可以踏步，可以曳步跳舞，如果不能站起來就把手舉起來。感受它！你還活著！你還活著！愛你們大家。</p>
                    </div></div>
            </main>

            <!-- Vocab + Quiz Sidebar -->
            <aside class="lg:w-1/3">
                <div class="sticky top-24 space-y-6">
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 learning-card p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="font-bold text-xl flex items-center gap-3 text-slate-900">
                                <div class="p-2 bg-amber-100 rounded-lg">
                                    <span class="material-symbols-outlined text-amber-600 text-2xl">verified</span>
                                </div>
                                詞彙表
                                <span class="text-sm bg-slate-200 px-2.5 py-1 rounded-full font-semibold" id="vocab-count">14</span>
                            </h3>
                            <button onclick="showAddVocabModal()" class="text-blue-600 hover:bg-blue-50 rounded-full p-2 transition hover:scale-110" title="新增生字">
                                <span class="material-symbols-outlined text-2xl">add_circle</span>
                            </button>
                        </div>
                        <ul id="vocab-list" class="divide-y max-h-[60vh] overflow-y-auto">
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('artery')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">1.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Artery</div>
                                    <button onclick="event.stopPropagation(); speakWord('Artery')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈɑːr.t̬ɚ.i/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A blood vessel that carries oxygenated blood from the heart to other parts of the body.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">動脈</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('concourse')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">2.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Concourse</div>
                                    <button onclick="event.stopPropagation(); speakWord('Concourse')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈkɑːn.kɔːrs/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A large open area inside or in front of a public building, as in an airport or train station.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">(機場或車站的) 中央大廳；大堂</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('diaphragm')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">3.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Diaphragm</div>
                                    <button onclick="event.stopPropagation(); speakWord('Diaphragm')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈdaɪ.ə.fræm/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A large, dome-shaped muscle located at the base of the lungs that helps with breathing.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">橫膈膜</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('glucose')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">4.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Glucose</div>
                                    <button onclick="event.stopPropagation(); speakWord('Glucose')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈɡluː.koʊs/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A simple sugar that is an important energy source in living organisms and is a component of many carbohydrates.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">葡萄糖 (血糖)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('interoception')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">5.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Interoception</div>
                                    <button onclick="event.stopPropagation(); speakWord('Interoception')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˌɪn.tər.oʊˈsep.ʃən/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">The sense of the internal state of the body, such as hunger, thirst, or heartbeat.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">內感受 (感知身體內部生理狀態的能力)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('jeopardy')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">6.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Jeopardy</div>
                                    <button onclick="event.stopPropagation(); speakWord('Jeopardy')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈdʒep.ɚ.di/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Danger of loss, harm, or failure.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">危險；危難 (常用於片語 in jeopardy)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('mantra')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">7.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Mantra</div>
                                    <button onclick="event.stopPropagation(); speakWord('Mantra')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈmæn.trə/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A word or phrase that is repeated often or that expresses someone's basic beliefs.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">口號；箴言；座右銘 (源自宗教的持咒)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('outsized')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">8.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Outsized</div>
                                    <button onclick="event.stopPropagation(); speakWord('Outsized')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈaʊt.saɪzd/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Exceptionally large; having an influence or effect that is disproportionately large.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">特大的；極大的 (在此指非比尋常的巨大影響)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('pandemic')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">9.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Pandemic</div>
                                    <button onclick="event.stopPropagation(); speakWord('Pandemic')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">An outbreak of a disease that occurs over a wide geographic area and affects an exceptionally high proportion of the population.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">大流行病 (指疾病在廣大區域或全球範圍內傳播)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('physiologist')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">10.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Physiologist</div>
                                    <button onclick="event.stopPropagation(); speakWord('Physiologist')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˌfɪz.iˈɑː.lə.dʒɪst/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">An expert in the branch of biology that deals with the normal functions of living organisms and their parts.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">生理學家</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('premature')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">11.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Premature</div>
                                    <button onclick="event.stopPropagation(); speakWord('Premature')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Happening or done too soon, especially before the natural or suitable time.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">過早的；提早的 (尤指在時機成熟前發生)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('quad')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">12.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Quad</div>
                                    <button onclick="event.stopPropagation(); speakWord('Quad')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/kwɑːd/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A rectangular courtyard enclosed by buildings, typically on a university campus.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">(尤指大學校園內的) 方形庭院；四方院</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('sedentary')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">13.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Sedentary</div>
                                    <button onclick="event.stopPropagation(); speakWord('Sedentary')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈsed.ən.ter.i/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Involving little exercise or physical activity; tending to spend much time seated.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">久坐不動的；缺乏運動的</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('taper')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">14.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Taper</div>
                                    <button onclick="event.stopPropagation(); speakWord('Taper')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈteɪ.pɚ/</div>
                                <div class="text-xs text-slate-500 mt-0.5">verb</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">To diminish or reduce gradually.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">逐漸減少 (在此指逐漸減少藥物劑量)</div>
                    </li></ul>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-600 rounded-2xl p-8 shadow-lg text-white learning-card">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="p-2 bg-white/20 rounded-lg">
                                <span class="material-symbols-outlined text-2xl">quiz</span>
                            </div>
                            <h3 class="font-bold text-xl">知識檢測</h3>
                        </div>
                        <p class="text-blue-100 text-sm mb-6 leading-relaxed">通過測驗鞏固所學，評估學習進度。</p>
                        <button onclick="openQuiz()" class="w-full bg-white text-blue-600 py-3 px-4 rounded-xl font-bold shadow-md hover:shadow-lg hover:bg-blue-50 transition transform hover:scale-[1.02] flex justify-center items-center gap-2">
                            <span class="material-symbols-outlined">play_circle</span>
                            <span>開始測驗</span>
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Mobile Floating Action Button for Quiz -->
    <button onclick="openQuiz()" class="lg:hidden fixed bottom-20 right-6 bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-4 rounded-full shadow-xl hover:shadow-2xl hover:scale-110 z-50 flex items-center justify-center transition">
        <span class="material-symbols-outlined text-2xl">quiz</span>
    </button>

    <!-- Bottom Control Bar (Will be kept in export) -->
    <div id="bottom-controls" class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 shadow-lg z-40 px-3 py-2">
        <div class="flex flex-nowrap justify-center gap-2">
            <button id="play-pause-btn" onclick="togglePlayPause()" class="flex items-center gap-1.5 px-3 py-2 rounded-lg bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold shadow-md hover:shadow-lg active:scale-95 transition-all">
                <span class="material-symbols-outlined text-lg" id="play-icon">play_arrow</span>
                <span id="play-text" class="hidden sm:inline text-sm">播放</span>
            </button>
            
            <div class="flex items-center rounded-xl border border-slate-300 bg-slate-100 overflow-hidden">
                <button onclick="decreaseFontSize()" class="px-2 py-2 text-sm text-slate-700 hover:bg-slate-200 active:bg-slate-300 transition">
                    <span class="material-symbols-outlined text-base">text_decrease</span>
                </button>
                <div class="w-px h-6 bg-slate-300"></div>
                <button onclick="increaseFontSize()" class="px-2 py-2 text-sm text-slate-700 hover:bg-slate-200 active:bg-slate-300 transition">
                    <span class="material-symbols-outlined text-base">text_increase</span>
                </button>
            </div>
            
            <div class="flex items-center rounded-xl border border-slate-300 bg-white overflow-hidden">
                <button onclick="decreasePlaybackSpeed()" class="px-2 py-2 text-sm text-slate-700 hover:bg-slate-100 active:bg-slate-200 transition">
                    <span class="material-symbols-outlined text-base">remove</span>
                </button>
                <div class="w-px h-6 bg-slate-300"></div>
                <div class="flex items-center px-2 py-2 text-sm font-bold min-w-[50px] justify-center text-slate-700">
                    <span id="speed-display">1.0x</span>
                </div>
                <div class="w-px h-6 bg-slate-300"></div>
                <button onclick="increasePlaybackSpeed()" class="px-2 py-2 text-sm text-slate-700 hover:bg-slate-100 active:bg-slate-200 transition">
                    <span class="material-symbols-outlined text-base">add</span>
                </button>
            </div>
            
            <button onclick="toggleTranslations()" class="hidden sm:flex items-center px-3 py-2 rounded-lg border border-blue-300 bg-blue-50 text-blue-700 text-sm font-medium active:bg-blue-100 hover:bg-blue-100 transition">
                <span class="material-symbols-outlined text-base">translate</span> <span id="cn-toggle-text">中文</span>
            </button>
            <button onclick="resetSettings()" class="hidden sm:block px-3 py-2 rounded-lg border border-slate-300 bg-slate-50 text-slate-600 text-sm font-medium hover:bg-slate-100 active:bg-slate-200 transition">
                <span class="material-symbols-outlined text-base">restart_alt</span>
            </button>
        </div>
    </div>

    <!-- Floating Card -->
    <div id="floating-card" class="fixed bg-white rounded-xl shadow-2xl w-80 border z-50 hidden" data-current-id="" style="left: 555.969px; top: 310.375px;">
                <div class="p-4">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="text-xl font-bold flex-1">Pandemic</h3>
                        <button onclick="event.stopPropagation(); speakWord('Pandemic')" class="ml-2 p-2 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 transition" title="播放發音">
                            <span class="material-symbols-outlined text-lg">volume_up</span>
                        </button>
                    </div>
                    <div class="text-xs text-slate-500 mb-1">noun</div>
                    
                    <p class="text-sm mb-3">An outbreak of a disease that occurs over a wide geographic area and affects an exceptionally high proportion of the population.</p>
                    <p class="text-xs text-blue-700 font-bold">大流行病 (指疾病在廣大區域或全球範圍內傳播)</p>
                </div></div>

    <!-- Selection Popup -->
    <div id="selection-popup" class="fixed hidden bg-purple-600 text-white px-4 py-2 rounded-lg shadow-xl z-50 text-sm font-semibold cursor-pointer hover:bg-purple-700 active:scale-95 transition-all">
        <span class="material-symbols-outlined text-base" style="vertical-align: middle;">add_circle</span> 加入生字
    </div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="hidden fixed inset-0 z-[60] bg-slate-900/80 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden">
            <div class="p-6 border-b border-gray-100 bg-gray-50">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-blue-600">psychology</span>
                        <h3 class="text-xl font-bold text-slate-800">Knowledge Check</h3>
                    </div>
                    <button onclick="closeQuiz()" class="text-gray-400 hover:text-gray-600 hover:bg-gray-200 rounded-full p-1 transition"><span class="material-symbols-outlined">close</span></button>
                </div>
                <div id="quiz-language-selector" class="hidden flex items-center gap-2 p-3 bg-white border-2 border-slate-200 rounded-lg">
                    <span class="text-sm font-semibold text-slate-700">Quiz Language:</span>
                    <button onclick="selectQuizLanguage('english')" class="px-4 py-2 rounded-lg text-sm font-semibold border-2 transition" id="quiz-select-en">
                        <span class="material-symbols-outlined text-sm align-middle">language</span> English
                    </button>
                    <button onclick="selectQuizLanguage('chinese')" class="px-4 py-2 rounded-lg text-sm font-semibold border-2 transition" id="quiz-select-zh">
                        <span class="material-symbols-outlined text-sm align-middle">translate</span> 中文
                    </button>
                </div>
            </div>
            <div id="quiz-content" class="p-8 overflow-y-auto space-y-8 bg-white"></div>
            <div id="quiz-footer" class="p-6 border-t border-gray-100 bg-gray-50 flex justify-end"></div>
        </div>
    </div>

    <!-- Add Vocab Modal -->
    <div id="add-vocab-modal" class="modal hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl w-full max-w-3xl flex flex-col h-[80vh]">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg">新增生字</h3>
                <button onclick="closeAddVocabModal()" class="text-gray-400 hover:text-gray-700 rounded p-1">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="p-4 flex-1 flex flex-col gap-3">
                <div id="add-vocab-hint" class="bg-blue-50 text-blue-800 p-3 rounded text-xs">
                    格式：[{ "word": "...", "def": "...", "pos": "n." }, ...]
                </div>
                <textarea id="add-vocab-input" class="flex-1 border rounded p-4 font-mono text-xs resize-none" placeholder="[{&quot;word&quot;:&quot;Example&quot;,&quot;def&quot;:&quot;範例&quot;,&quot;pos&quot;:&quot;n.&quot;}]"></textarea>
            </div>
            
            <div class="p-4 border-t flex justify-between gap-3">
                <div></div>
                <div class="flex gap-3">
                    <button onclick="closeAddVocabModal()" class="px-4 py-2 rounded border border-slate-300 hover:bg-slate-50 font-medium">Cancel</button>
                    <button onclick="addNewVocabFromJSON()" class="bg-indigo-600 text-white px-6 py-2 rounded font-bold hover:bg-indigo-700">Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->

    <div id="edit-modal" class="modal hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl w-full max-w-4xl flex flex-col h-[85vh]">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg">編輯逐字稿段落</h3>
                <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-700 rounded p-1">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="p-6 flex-1 flex flex-col gap-4 overflow-y-auto">
                <div class="flex-1 flex flex-col">
                    <label class="font-semibold mb-2 text-sm text-slate-700">英文內容</label>
                    <textarea id="edit-en-input" class="flex-1 border-2 border-slate-300 rounded-lg p-4 font-sans text-base resize-none focus:border-blue-500 focus:outline-none min-h-[200px]" placeholder="輸入英文內容..."></textarea>
                </div>
                
                <div class="flex-1 flex flex-col">
                    <label class="font-semibold mb-2 text-sm text-slate-700">中文翻譯</label>
                    <textarea id="edit-cn-input" class="flex-1 border-2 border-slate-300 rounded-lg p-4 font-sans text-base resize-none focus:border-blue-500 focus:outline-none min-h-[200px]" placeholder="輸入中文翻譯（可選）..."></textarea>
                </div>
            </div>
            
            <div class="p-4 border-t flex justify-end gap-3">
                <button onclick="closeEditModal()" class="px-6 py-2.5 rounded-lg border border-slate-300 hover:bg-slate-50 font-medium">取消</button>
                <button onclick="saveEdit()" class="bg-blue-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-blue-700">儲存</button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="import-modal" class="modal hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl w-full max-w-3xl flex flex-col h-[80vh]">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg" id="modal-title">Import</h3>
                <div class="flex items-center gap-2">
                    <button id="copy-prompt-btn" onclick="copyPrompt()" class="text-slate-500 hover:text-blue-600 rounded p-1 hidden" title="複製prompt">
                        <span class="material-symbols-outlined">content_copy</span>
                    </button>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-700 rounded p-1">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
            </div>
            
            <div class="p-4 flex-1 flex flex-col gap-3">
                <div id="modal-hint" class="bg-blue-50 text-blue-800 p-3 rounded text-xs"></div>
                <textarea id="import-input" class="flex-1 border rounded p-4 font-mono text-xs resize-none"></textarea>
            </div>
            
            <div class="p-4 border-t flex justify-between gap-3">
                <button id="clear-data-btn" class="px-4 py-2 rounded border border-red-300 bg-red-50 text-red-700 hover:bg-red-100 font-medium text-sm hidden">
                    <span class="material-symbols-outlined text-base align-middle">delete_outline</span> 清除所有紀錄
                </button>
                <div class="flex gap-3">
                    <button onclick="closeModal()" class="px-4 py-2 rounded hover:bg-gray-100">Cancel</button>
                    <button id="import-action-btn" class="bg-blue-600 text-white px-6 py-2 rounded font-bold">Load</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global State - Load from localStorage
        let transcriptData = [{"en":"Do you ever close your laptop at the end of a long day and feel like you have just enough energy to crawl over to the couch to scroll on your phone or watch a show or maybe both at the same time? Yeah, during the pandemic that was all I wanted to do. And I couldn't understand why. I was safe, I was healthy. Why didn't I want to close my laptop and go dance around the living room? Where did all my energy go?","cn":"你是否曾在結束漫長的一天後闔上筆記型電腦，覺得自己僅剩的力氣只夠爬到沙發上滑手機或看劇，甚至兩者同時進行？是的，疫情期間這就是我想做的所有事。我不明白為什麼，我很安全，我很健康，為什麼我不想闔上筆記型電腦然後在客廳裡跳舞？我的精力都去哪了？","t":4},{"en":"I'm a journalist. My specialty for the last 10 years has been trying to understand how our tech habits change us as people. And so I decided I was going to find out why sitting in front of a screen makes us feel so exhausted. Because we have all heard about the mental effects, right? But what about our physical health? Well, as I quickly learned, looking at screens has not only reshaped our days, it is reshaping our bodies.","cn":"我是一名記者，過去十年的專長是試圖理解我們的科技習慣如何改變我們。所以我決定找出為什麼坐在螢幕前會讓我們感到如此疲憊。因為我們都聽說過心理方面的影響，對吧？但我們的身體健康呢？正如我很快了解到的，注視螢幕不僅重塑了我們的日子，也在重塑我們的身體。","t":35},{"en":"According to researchers at Johns Hopkins, every day the average 19-year-old moves about as much as the average 60-year-old. Over the last 20 years, rates of type 2 diabetes in young people have doubled. Three in four American adults has a chronic illness. Many of those are preventable. At least one chronic illness. And the WHO says that this is a global problem. They predict that by the end of the decade, which is not that far away, this lifestyle will likely lead to 500 million new cases of preventable conditions like heart disease, obesity and diabetes, costing governments 27 billion a year.","cn":"根據約翰霍普金斯大學研究人員的說法，現在平均 19 歲的年輕人每天的活動量大約與平均 60 歲的人相當。過去 20 年來，年輕人罹患第 2 型糖尿病的比率翻了一倍。四分之三的美國成年人患有慢性病，其中許多是可以預防的，至少患有一種慢性病。世界衛生組織表示這是一個全球性問題。他們預測到本世紀末——其實並不遙遠——這種生活方式可能會導致 5 億個新的可預防疾病病例，如心臟病、肥胖和糖尿病，每年將耗費政府 270 億美元。","t":66},{"en":"Typing, swiping, scrolling, sitting. This is the rhythm of our modern life. But I don't know about you, I can't throw away my phone, right? Like I can't go off the grid. So how can we stay connected without slowly destroying our health? That was the question running through my mind when I came across this guy. Keith Diaz is a physiologist at Columbia University Medical Center, and he has spent his entire career trying to figure out how little can we get away with moving so that sitting doesn't kill us basically.","cn":"打字、滑動、捲動、坐著，這是我們現代生活的節奏。但我不知道你怎麼樣，我不能扔掉我的手機，對吧？就像我不能與世隔絕一樣。那麼，我們要如何在保持聯繫的同時，不讓健康慢慢被摧毀呢？這是我遇到這個人時腦海中盤旋的問題。基思·迪亞茲 (Keith Diaz) 是哥倫比亞大學醫學中心的生理學家，他整個職業生涯都在試圖找出：我們最少需要動多少，才不會讓久坐殺死我們。","t":107},{"en":"And in 2022, he published a small study that gives us a great idea. He found that just five minutes of gentle movement every 30 minutes had dramatic effects. It slashed blood sugar and blood pressure. In another study, he found that inactive people who traded 30 minutes of sitting for 30 minutes of movement every day could lower their risk of a premature death by 18%.","cn":"2022 年，他發表了一項小型研究，給了我們一個很好的概念。他發現，每 30 分鐘只需進行 5 分鐘的輕微活動，就能產生顯著的效果。它大幅降低了血糖和血壓。在另一項研究中，他發現不常活動的人如果每天將 30 分鐘的久坐時間換成 30 分鐘的活動，可以將早逝風險降低 18%。","t":143},{"en":"And so maybe you're like, 'Yeah, I worked out this morning, so I'm good.' Or maybe you're like, 'Phew, I'm so glad I got that standing desk.' I am so sorry. But no, if you sit or stand for the majority of your waking hours, your health is in jeopardy too. Don't stop working out, Keith told me. But he said, 'What you have to do is break up these long stretches of sedentary screen time.'","cn":"也許你會想：「耶，我今天早上運動過了，所以我沒問題。」或者你會想：「呼，好險我買了那個升降桌。」我真是太對不起了。但不，如果你在清醒的大部分時間裡都是坐著或站著，你的健康同樣岌岌可危。基思告訴我，別停止運動，但他接著說：「你必須做的是打斷這些長時間久坐不動的螢幕時間。」","t":168},{"en":"When he told me this, I was like, 'Really? Like how big a difference can these movement breaks make for someone who is, you know, relatively healthy?' I decided I would join the study. So one day I went to his lab and I sat and worked on my laptop for eight hours straight. The next day, I took those movement breaks every half hour or so. They checked all my vital signs and the results were actually quite extraordinary. My glucose was cut nearly in half, my blood pressure was down by five points, and my mood was so much better.","cn":"當他告訴我這些時，我想：「真的嗎？對於一個相對健康的人來說，這些活動休息能有多大的差別？」我決定加入這項研究。所以有一天，我去了他的實驗室，連續坐著用筆記型電腦工作了八個小時。第二天，我每半小時左右就進行一次活動休息。他們檢查了我所有的生命體徵，結果實際上相當驚人。我的血糖幾乎減半，血壓下降了五個點，而且我的心情好多了。","t":199},{"en":"The science was clear. But like, what did it matter if no one could actually do these movement breaks? Like it was easy in the lab, somebody tapped me on the shoulder and led me over to the treadmill. So we decided to ask people out in the world, out in real life, to see if they could do it. Our teams at NPR and Columbia combined forces to create a podcast and a global clinical trial called the Body Electric Study. And over 20,000 people signed up. We had to cap it at 20,000 people.","cn":"科學證據很明確。但如果沒人真的能執行這些活動休息，那又有什麼用呢？在實驗室裡很簡單，有人拍拍我的肩膀，帶我走向跑步機。所以我們決定詢問現實世界中的人們，看看他們是否能做到。我們 NPR 的團隊與哥倫比亞大學合作，製作了一個播客並發起了一項名為「人體電能研究」(Body Electric Study) 的全球臨床試驗。有超過 20,000 人報名，我們不得不將人數限制在 20,000 人。","t":235},{"en":"And they could choose a movement dose. So they could move 5 minutes every half hour, 5 minutes every hour or every 2 hours. They could dance around the house, they could pace on calls, they could walk the dog, they could take out the trash. It didn't matter. They just had to break it up. Break up those long periods of sitting. And you guys, I was so excited. I was like, we are going to launch a movement for movement. Yeah, I've got a way with words.","cn":"他們可以選擇一種「活動劑量」：每半小時活動 5 分鐘、每小時活動 5 分鐘，或每兩小時活動一次。他們可以在家裡跳舞，可以在講電話時踱步，可以遛狗，可以倒垃圾。這都不重要，他們只需要打斷久坐，打斷那些長時間的坐姿。各位，我太興奮了，我想：我們要發起一場「為了活動的運動」(movement for movement)。是的，我很會玩文字遊戲。","t":267},{"en":"Um, but I am not going to lie, those first few days were so tough. It takes a lot of intention and a little rebellion to upend a world that is quite literally built around screens and chairs. But when people figured it out, when they started getting those breaks into their lives, they started having breakthroughs. They told us that they felt less pain. They told us that they had more energy. They said that they felt more positive about life in general.","cn":"嗯，但我不會說謊，最初幾天非常艱難。要顛覆一個實際上是圍繞著螢幕和椅子建立起來的世界，需要很大的決心和一點反叛精神。但當人們掌握了訣竅，當他們開始將這些休息時間融入生活時，他們開始有了突破。他們告訴我們疼痛感減輕了，精力更充沛了，他們說對生活的整體看法也變得更積極了。","t":297},{"en":"In the end, of the people who started taking movement breaks, 80% managed to stick with them for two solid weeks. And yes, this was a self-reported study with a lot of very motivated participants—hello public radio—but still, the data showed that the more often they took breaks, the better they felt. People who went outside got an extra boost. Some people lost a few of those stubborn pounds. And most people actually liked taking the breaks.","cn":"最終，在開始進行活動休息的人中，有 80% 的人成功堅持了整整兩週。是的，這是一項自我報告的研究，參與者都有很高的積極性（哈囉，公共廣播聽眾），但數據仍然顯示，他們休息的頻率越高，感覺就越好。走到戶外的人獲得了額外的提振，有些人減掉了一些頑固的體重，而且大多數人實際上喜歡這些休息時間。","t":329},{"en":"But the biggest surprise to me was that the breaks did not hurt their productivity. People said they got back to their desks and they were able to focus, and they felt that the work they did was actually of better quality. So this research is going through the scientific process right now, but Keith explained to me some of the reasons why these gentle breaks can have such an outsized impact.","cn":"但對我來說最大的驚喜是，這些休息並沒有損害他們的生產力。人們說當他們回到辦公桌前時，能夠更加專注，並且覺得他們所做的工作品質實際上更好了。這項研究目前正在進行科學審查程序，但基思向我解釋了為什麼這些輕微的休息能產生如此巨大影響的一些原因。","t":359},{"en":"So when we sit, our arteries get bent at our hips and our knees, kind of like a kinked vacuum hose. Blood starts pooling in our legs and our muscles stop contracting. But leg muscles need to move, be stimulated in order to clear out fat and sugar and reduce blood pressure. If they don't, over months and over years, that's when those chronic conditions can start to creep in.","cn":"當我們坐著時，我們的動脈在臀部和膝蓋處彎曲，有點像打結的吸塵器軟管。血液開始淤積在腿部，肌肉停止收縮。但腿部肌肉需要運動、需要被刺激，才能清除脂肪和糖分並降低血壓。如果沒有這樣做，長年累月下來，這就是那些慢性病開始悄悄找上門的時候。","t":383},{"en":"And then there is our posture. Sitting compresses the diaphragm. We start taking shallow breaths. Shallow breaths lead to less oxygen going into our blood and up to our brain. Less oxygen in our brain means we get tired and lose focus. Feel free to take a deep breath right now if you want to. And that is where screens come into the picture. So screens can mess with something called interoception. Interoception is the body's way of telling you what it needs. It needs a snack, it needs to go to the bathroom, it needs to move.","cn":"還有我們的姿勢。坐姿會壓迫橫膈膜，我們開始進行淺呼吸。淺呼吸導致進入血液和輸送到大腦的氧氣減少。大腦缺氧意味著我們會感到疲倦並失去注意力。（如果你想的話，現在可以深吸一口氣。）這就是螢幕介入的地方。螢幕會干擾一種叫做「內感受」(interoception) 的東西。內感受是身體告訴你它需要什麼的方式：它需要吃點心、需要上廁所、需要活動。","t":407},{"en":"The more we focus on screens, the less we listen to the signals that our body is sending us. Your body could be begging for a break, but what do you do? You keep scrolling past the anxiety, scrolling past the exhaustion that eventually can lead to burnout. Yes, and again, those chronic conditions. So how can you start making a change and feeling better?","cn":"我們越專注於螢幕，就越少傾聽身體發出的訊號。你的身體可能在乞求休息，但你做了什麼？你繼續滑手機，忽略焦慮，忽略疲憊。這最終可能導致倦怠，是的，還有那些慢性病。那麼，你要如何開始改變並感覺更好呢？","t":443},{"en":"Well, first think about your most sedentary stretches of time and then make yourself a mantra. So like if you are a student you could say, 'I'll take an extra lap around the quad before class instead of checking TikTok so I get to class with more oxygen in my brain and I can actually focus.' Or if you work from home you could decide that on long Zoom calls I will march in place in order to manage my glucose and avoid the post-meeting crash.","cn":"首先，思考你最長時間久坐不動的時段，然後給自己一個口號。例如，如果你是學生，你可以說：「上課前我會在校園多走一圈，而不是滑 TikTok，這樣我到教室時大腦會有更多氧氣，我也能真正專心。」或者如果你在家工作，你可以決定在長時間的 Zoom 會議中原地踏步，以控制血糖並避免會後的疲勞崩潰。","t":469},{"en":"If you're a parent you could say, 'I will take a lap around the soccer field once so that I have enough energy to get through the dinnertime chaos.' You can have a dance party while you microwave your leftovers. You can walk the concourse instead of sitting and waiting for your flight. A mix of all these habits will keep your muscles firing and your mood steadier.","cn":"如果你是家長，你可以說：「我要繞著足球場走一圈，這樣我才有足夠的精力應付晚餐時間的混亂。」你可以在微波剩菜時開個小型舞會，你可以在等飛機時在航廈走動而不是坐著。混合所有這些習慣將保持你的肌肉運作，讓情緒更穩定。","t":497},{"en":"My favorite story came from a 43-year-old woman named Dana who works in HR. So Dana was a type 2 diabetic with all kinds of health issues. Her doctor told her she needed to take a long brisk walk every morning and she was doing this but her numbers just were not changing. So with her doctor's permission she decided to join the study. She started fitting in movement breaks between all of her meetings. And within a couple of weeks she told me her blood pressure dropped by 40 points, her cholesterol went down, and her doctor told her she could start tapering her insulin. She's actually off all of her meds today. I know, yay Dana. We love you Dana.","cn":"我最喜歡的故事來自一位 43 歲、在人資部門工作的女性，名叫黛娜 (Dana)。黛娜患有第 2 型糖尿病，並伴隨各種健康問題。醫生告訴她每天早上需要進行長時間的快走，她照做了，但數值卻沒有變化。所以在醫生的允許下，她決定加入這項研究。她開始在所有會議之間穿插活動休息。幾週內，她告訴我她的血壓下降了 40 個點，膽固醇下降了，醫生告訴她可以開始減少胰島素用量。她現在實際上已經停掉了所有藥物。我知道，太棒了黛娜，我們愛你黛娜。","t":519},{"en":"So we know that too much time online is not great for our mental health, but it's not just in our heads, it's in our bodies. We need movement to be as much a part of our lives as screens are. We need our schools, our neighborhoods, our workplaces to give us time and space just to move. You can help push this reset forward. Take movement breaks. And when people look at you like you're weird, just tell them why you're doing it. Because you just want to feel a little better. Get them to put down their phone and join you. Start soon, start small. Should we start now? Yeah let's. Can we have some music? You could do the march, you could do the shuffle, little hands in the air. If you can't get up, feel it. You're alive, you're alive. Love you guys.","cn":"所以我們知道，上網時間過長對我們的心理健康不利，但這不僅僅是在我們的腦海裡，也在我們的身體裡。我們需要讓活動像螢幕一樣成為我們生活的一部分。我們需要學校、社區和工作場所給我們時間和空間去活動。你可以幫助推動這個重置：進行活動休息。當人們覺得你很奇怪時，就告訴他們你為什麼這樣做——因為你只想感覺好一點。讓他們放下手機加入你。儘快開始，從小處做起。我們現在開始好嗎？好，來吧！可以來點音樂嗎？你可以踏步，可以曳步跳舞，如果不能站起來就把手舉起來。感受它！你還活著！你還活著！愛你們大家。","t":561}];
        let vocabData = [{"id":"sedentary","word":"Sedentary","ipa":"/ˈsed.ən.ter.i/","pos":"adjective","def":"Involving little exercise or physical activity; tending to spend much time seated.","cn":"久坐不動的；缺乏運動的","image":"https://source.unsplash.com/featured/?sedentary"},{"id":"physiologist","word":"Physiologist","ipa":"/ˌfɪz.iˈɑː.lə.dʒɪst/","pos":"noun","def":"An expert in the branch of biology that deals with the normal functions of living organisms and their parts.","cn":"生理學家","image":"https://source.unsplash.com/featured/?physiologist"},{"id":"jeopardy","word":"Jeopardy","ipa":"/ˈdʒep.ɚ.di/","pos":"noun","def":"Danger of loss, harm, or failure.","cn":"危險；危難 (常用於片語 in jeopardy)","image":"https://source.unsplash.com/featured/?jeopardy"},{"id":"glucose","word":"Glucose","ipa":"/ˈɡluː.koʊs/","pos":"noun","def":"A simple sugar that is an important energy source in living organisms and is a component of many carbohydrates.","cn":"葡萄糖 (血糖)","image":"https://source.unsplash.com/featured/?glucose"},{"id":"outsized","word":"Outsized","ipa":"/ˈaʊt.saɪzd/","pos":"adjective","def":"Exceptionally large; having an influence or effect that is disproportionately large.","cn":"特大的；極大的 (在此指非比尋常的巨大影響)","image":"https://source.unsplash.com/featured/?outsized"},{"id":"artery","word":"Artery","ipa":"/ˈɑːr.t̬ɚ.i/","pos":"noun","def":"A blood vessel that carries oxygenated blood from the heart to other parts of the body.","cn":"動脈","image":"https://source.unsplash.com/featured/?artery"},{"id":"diaphragm","word":"Diaphragm","ipa":"/ˈdaɪ.ə.fræm/","pos":"noun","def":"A large, dome-shaped muscle located at the base of the lungs that helps with breathing.","cn":"橫膈膜","image":"https://source.unsplash.com/featured/?diaphragm"},{"id":"interoception","word":"Interoception","ipa":"/ˌɪn.tər.oʊˈsep.ʃən/","pos":"noun","def":"The sense of the internal state of the body, such as hunger, thirst, or heartbeat.","cn":"內感受 (感知身體內部生理狀態的能力)","image":"https://source.unsplash.com/featured/?anatomy"},{"id":"mantra","word":"Mantra","ipa":"/ˈmæn.trə/","pos":"noun","def":"A word or phrase that is repeated often or that expresses someone's basic beliefs.","cn":"口號；箴言；座右銘 (源自宗教的持咒)","image":"https://source.unsplash.com/featured/?mantra"},{"id":"quad","word":"Quad","ipa":"/kwɑːd/","pos":"noun","def":"A rectangular courtyard enclosed by buildings, typically on a university campus.","cn":"(尤指大學校園內的) 方形庭院；四方院","image":"https://source.unsplash.com/featured/?campus+quad"},{"id":"concourse","word":"Concourse","ipa":"/ˈkɑːn.kɔːrs/","pos":"noun","def":"A large open area inside or in front of a public building, as in an airport or train station.","cn":"(機場或車站的) 中央大廳；大堂","image":"https://source.unsplash.com/featured/?airport+concourse"},{"id":"taper","word":"Taper","ipa":"/ˈteɪ.pɚ/","pos":"verb","def":"To diminish or reduce gradually.","cn":"逐漸減少 (在此指逐漸減少藥物劑量)","image":"https://source.unsplash.com/featured/?decrease"},{"id":"pandemic","word":"Pandemic","def":"An outbreak of a disease that occurs over a wide geographic area and affects an exceptionally high proportion of the population.","cn":"大流行病 (指疾病在廣大區域或全球範圍內傳播)","pos":"noun","custom":true},{"id":"premature","word":"Premature","def":"Happening or done too soon, especially before the natural or suitable time.","cn":"過早的；提早的 (尤指在時機成熟前發生)","pos":"adjective","custom":true}];
        let quizData = {"english":[{"q":"According to the prediction by the WHO mentioned in the talk, what will be the cost of the modern sedentary lifestyle by the end of the decade?","options":["It will result in a global decrease in chronic illnesses.","It will lead to 500 million new cases of preventable conditions.","It will cost governments 500 billion dollars a year.","It will primarily affect the elderly population only."],"correct":1},{"q":"What did physiologist Keith Diaz discover about the effectiveness of working out once a day or using a standing desk?","options":["They are sufficient to completely offset the dangers of sitting.","Standing desks are significantly better than taking movement breaks.","Your health is still in jeopardy if you remain sedentary for the majority of the day.","Working out in the morning creates a permanent buffer against sitting."],"correct":2},{"q":"In the speaker's personal experiment, how did her vital signs change on the day she took movement breaks compared to the day she sat for eight hours?","options":["Her glucose levels increased, but her mood improved.","Her blood pressure dropped by five points and glucose was cut nearly in half.","Her vital signs remained exactly the same, but she felt less tired.","Her blood pressure increased due to the stress of moving."],"correct":1},{"q":"What was the surprising finding regarding productivity in the 'Body Electric Study'?","options":["The breaks did not hurt productivity and often improved focus and quality.","Participants struggled to focus after returning to their desks.","Most people had to work longer hours to finish their tasks.","Productivity dropped by 18% due to constant interruptions."],"correct":0},{"q":"How does the speaker describe the physiological effect of sitting on the arteries in our hips and knees?","options":["They expand to allow better blood flow.","They become stiff like a frozen pipe.","They get bent like a kinked vacuum hose, causing blood to pool.","They disconnect from the nervous system temporarily."],"correct":2},{"q":"According to the speaker, what is 'interoception' and how do screens impact it?","options":["It is a vision problem caused by blue light.","It is the body's ability to focus, which screens enhance.","It is the body's way of signaling needs, which screens cause us to ignore.","It is a mental state of anxiety caused by social media."],"correct":2},{"q":"What was the outcome for Dana, the 43-year-old woman who joined the study?","options":["She saw no change in her health despite walking every morning.","She lowered her blood pressure and was able to stop taking her medications.","She decided to quit her job to focus on her health.","She increased her insulin dosage to manage the stress."],"correct":1}],"chinese":[{"q":"根據演講中提到的世界衛生組織（WHO）預測，到了這十年末，現代久坐的生活方式將帶來什麼代價？","options":["這將導致全球慢性疾病減少。","這將導致 5 億個可預防疾病的新病例。","這將使政府每年花費 5000 億美元。","這將主要只影響老年人口。"],"correct":1},{"q":"生理學家 Keith Diaz 對於每天運動一次或使用站立式辦公桌的成效有何發現？","options":["它們足以完全抵消久坐的危險。","站立式辦公桌比進行運動休息明顯更好。","如果你一天中大部分時間仍保持久坐，你的健康依然岌岌可危。","早上運動可以建立對抗久坐的永久緩衝。"],"correct":2},{"q":"在講者的個人實驗中，與連續坐著八小時的那天相比，她在進行運動休息的那天生命徵象有何變化？","options":["她的血糖升高，但心情變好了。","她的血壓下降了五點，且血糖幾乎減半。","她的生命徵象完全保持不變，但她感覺比較不累。","因為移動的壓力，她的血壓升高了。"],"correct":1},{"q":"在「人體電流研究」（Body Electric Study）中，關於生產力有什麼令人驚訝的發現？","options":["休息並沒有損害生產力，反而通常能改善專注力和品質。","參與者回到座位後難以集中注意力。","大多數人必須工作更長的時間來完成任務。","由於不斷的干擾，生產力下降了 18%。"],"correct":0},{"q":"講者如何描述久坐對我們臀部和膝蓋動脈的生理影響？","options":["它們會擴張以允許更好的血液流動。","它們會像冷凍的水管一樣變硬。","它們會像扭結的真空吸塵器軟管一樣彎曲，導致血液淤積。","它們會暫時與神經系統斷開連接。"],"correct":2},{"q":"根據講者的說法，什麼是「內感受」（interoception），螢幕又是如何影響它的？","options":["這是一種由藍光引起的視力問題。","這是身體集中注意力的能力，螢幕會增強這種能力。","這是身體發出需求訊號的方式，而螢幕會導致我們忽略它。","這是一種由社群媒體引起的焦慮心理狀態。"],"correct":2},{"q":"對於參加這項研究的 43 歲女性 Dana 來說，結果如何？","options":["儘管她每天早上散步，健康狀況卻沒有變化。","她降低了血壓，並且能夠停止服用藥物。","她決定辭職以專注於自己的健康。","她增加了胰島素劑量來控制壓力。"],"correct":1}]};
        let quizLanguage = 'english'; // 'english' or 'chinese'
        let videoId = localStorage.getItem('videoId') || '';
        let selectedWords = ["pandemic","premature"];
        let translationsVisible = false;
        let player;
        let playerReady = false;
        let youtubeAPIReady = false;
        let currentFontSize = 18; // base font size in px
        let currentPlaybackSpeed = 1.0;

        const modal = document.getElementById('import-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalHint = document.getElementById('modal-hint');
        const inputArea = document.getElementById('import-input');
        const actionBtn = document.getElementById('import-action-btn');
        const floatingCard = document.getElementById('floating-card');

        // Modal Functions
        function openModal(mode) {
            modal.classList.remove('hidden');
            inputArea.value = '';
            inputArea.focus();
            const clearBtn = document.getElementById('clear-data-btn');
            const copyBtn = document.getElementById('copy-prompt-btn');
            window.currentModalMode = mode;
            
            if (mode === 'video') {
                modalTitle.innerText = "設定 YouTube 影片";
                modalHint.innerText = '貼上 YouTube 網址或影片 ID';
                inputArea.placeholder = 'https://www.youtube.com/watch?v=...';
                actionBtn.onclick = parseVideoUrl;
                clearBtn.classList.add('hidden');
                copyBtn.classList.add('hidden');
            } else if (mode === 'transcript') {
                modalTitle.innerText = "匯入逐字稿";
                modalHint.innerText = '格式：[{ "en": "...", "cn": "...", "t": 0 }, ...]';
                inputArea.placeholder = '[{"en":"Hello","cn":"你好","t":0}]';
                actionBtn.onclick = parseTranscript;
                clearBtn.classList.remove('hidden');
                copyBtn.classList.remove('hidden');
                clearBtn.onclick = () => {
                    if (confirm('確定要清除所有逐字稿紀錄嗎？')) {
                        clearTranscriptData();
                    }
                };
            } else if (mode === 'vocab') {
                modalTitle.innerText = "匯入單字";
                modalHint.innerText = '格式：[{ "word": "...", "def": "...", "pos": "n." }, ...]';
                inputArea.placeholder = '[{"word":"Example","def":"範例"}]';
                actionBtn.onclick = parseVocab;
                clearBtn.classList.remove('hidden');
                copyBtn.classList.remove('hidden');
                clearBtn.onclick = () => {
                    if (confirm('確定要清除所有單字紀錄嗎？')) {
                        clearVocabData();
                    }
                };
            } else {
                modalTitle.innerText = "匯入 Quiz（雙語格式）";
                modalHint.innerText = '格式：{ "english": [{"q":"...", "options":[...], "correct":0}], "chinese": [{"q":"...", "options":[...], "correct":0}] }';
                inputArea.placeholder = '{"english":[{"q":"Question?","options":["A","B","C","D"],"correct":0}],"chinese":[{"q":"題目?","options":["A","B","C","D"],"correct":0}]}';
                actionBtn.onclick = parseQuiz;
                clearBtn.classList.remove('hidden');
                copyBtn.classList.remove('hidden');
                clearBtn.onclick = () => {
                    if (confirm('確定要清除所有 Quiz 題庫嗎？')) {
                        clearQuizData();
                    }
                };
            }
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        function selectQuizLanguage(lang) {
            quizLanguage = lang;
            updateQuizLanguageSelector();
            renderQuizContent(); // 重新渲染題目
        }

        function updateQuizLanguageSelector() {
            const btnEn = document.getElementById('quiz-select-en');
            const btnZh = document.getElementById('quiz-select-zh');
            
            if (!btnEn || !btnZh) return;
            
            if (quizLanguage === 'english') {
                btnEn.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                btnEn.classList.remove('bg-white', 'text-slate-700', 'border-slate-300');
                btnZh.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                btnZh.classList.add('bg-white', 'text-slate-700', 'border-slate-300');
            } else {
                btnZh.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                btnZh.classList.remove('bg-white', 'text-slate-700', 'border-slate-300');
                btnEn.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                btnEn.classList.add('bg-white', 'text-slate-700', 'border-slate-300');
            }
        }


        function generateTranscriptPrompt() {
            let prompt = '';
            
            // Add video URL if available
            if (videoId && videoId.length === 11) {
                prompt += `https://www.youtube.com/watch?v=${videoId}\n\n`;
            } else {
                prompt += '🔻\n\n';
            }
            
            prompt += `將以上影片的演講內容，整理成英文和中文隨段落對照的逐字稿，並以以下格式呈現：
{
    en: "When I found out my grandmother, my last living grandparent, was dying, my first thought was, \"I need to draw her hands.\" I'm a visual artist, a cartoonist for The New Yorker, and comics writer, so drawing is how I understand much of the world.",
    cn: "當我得知我的祖母——我最後一位在世的祖父母——即將離世時，我的第一個念頭是：「我需要畫下她的手。」我是一位視覺藝術家，也是《紐約客》的漫畫家和漫畫作者，所以繪畫是我理解這個世界的主要方式。"
},
{
    en: "For a long time, my cartoons had been impersonal. Commentary on the world around me, sure, but not really about me. The closest my personal life got to influencing my cartoons were cartoons I lifted from things my friends and family had said around me. It was only after my daughter Ellika was born that my personal life began to creep into my cartoons more.",
    cn: "很長一段時間以來，我的漫畫都是非個人化的。它們是對周遭世界的評論，沒錯，但並不真正關於我自己。我的個人生活對漫畫最接近的影響，頂多就是從朋友和家人的談話中取材。直到我女兒埃莉卡 (Ellika) 出生後，我的個人生活才開始更多地滲透進我的漫畫中。"
}`;
            
            return prompt;
        }

        function generateQuizPrompt() {
            let prompt = 'You are an English teaching and quiz design expert. Based on the English transcript I provide, generate 5~10 comprehension quiz questions in BOTH English and Chinese.\n\n';
            prompt += 'Please output a JSON object with TWO keys: "english" and "chinese", each containing a JSON Array of questions.\n';
            prompt += 'Format specifications:\n\n';
            prompt += '{\n';
            prompt += '  "english": [\n';
            prompt += '    { "q": "Question in English", "options": ["Option A", "Option B", "Option C", "Option D"], "correct": 0 },\n';
            prompt += '    ...\n';
            prompt += '  ],\n';
            prompt += '  "chinese": [\n';
            prompt += '    { "q": "題目中文翻譯", "options": ["選項A", "選項B", "選項C", "選項D"], "correct": 0 },\n';
            prompt += '    ...\n';
            prompt += '  ]\n';
            prompt += '}\n\n';
            prompt += 'Requirements:\n';
            prompt += '- Both English and Chinese versions must have the SAME questions with the SAME correct answers (index).\n';
            prompt += '- English: questions and options in English\n';
            prompt += '- Chinese: complete translation of questions and options to Traditional Chinese\n';
            prompt += '- Output ONLY the JSON object, no explanations or extra text.\n';
            prompt += '- Questions should cover content comprehension, key details, main idea, and inference.\n';
            prompt += '- Avoid duplicate questions or overly similar options.\n';
            prompt += '- Content must be faithful to the transcript; do not add information not present in it.\n\n';
            prompt += 'English transcript:';
            
            if (transcriptData.length > 0) {
                const englishText = transcriptData.map(seg => seg.en).join(' ');
                prompt += englishText;
            } else {
                prompt += '🔻';
            }
            
            return prompt;
        }

        function generateVocabPrompt() {
            let prompt = '你是一位專業的英語教學專家與程式開發輔助者。請分析我提供的文章，並從中挑選出對讀者可能較難、冷僻或具備學習價值的生字（建議難度 B2-C2 或特定領域術語）。\n\n';
            prompt += '請嚴格依照以下 JSON Array 格式輸出結果：\n\n';
            prompt += '1.  **id**: 單字的全小寫形式。\n';
            prompt += '2.  **word**: 單字的首字母大寫。\n';
            prompt += '3.  **ipa**: 該單字的 IPA 音標。\n';
            prompt += '4.  **pos**: 詞性 (如 noun, verb, adjective)。\n';
            prompt += '5.  **def**: 簡潔的英文定義。\n';
            prompt += '6.  **cn**: 繁體中文解釋 (若有特定語境請一併標註)。\n';
            prompt += '7.  **image**: 請輸出格式為 `https://source.unsplash.com/featured/?{單字}` 的連結，將 `{單字}` 替換為該單字的英文內容，以便自動抓取相關圖片。\n\n';
            prompt += '範例格式：\n';
            prompt += '[\n    {\n        "id": "pareidolia",\n        "word": "Pareidolia",\n        "ipa": "/ˌpær.ɪˈdoʊ.li.ə/",\n        "pos": "noun",\n        "def": "The psychological phenomenon of seeing recognizable shapes, especially faces, in random or vague stimuli.",\n        "cn": "幻想性錯覺 (尤指將模糊圖像看作人臉)",\n        "image": "https://source.unsplash.com/featured/?pareidolia"\n    }\n]\n\n';
            prompt += '文章內容如下：\n';
            
            // Add English transcript if available
            if (transcriptData.length > 0) {
                const englishText = transcriptData.map(seg => seg.en).join(' ');
                prompt += englishText + '\n\n';
            } else {
                prompt += '🔻\n\n';
            }
            
            return prompt;
        }

        function copyPrompt() {
            let promptText = '';
            
            if (window.currentModalMode === 'transcript') {
                promptText = generateTranscriptPrompt();
            } else if (window.currentModalMode === 'vocab') {
                promptText = generateVocabPrompt();
            } else if (window.currentModalMode === 'quiz') {
                promptText = generateQuizPrompt();
            }
            
            if (!promptText) {
                alert('無法生成prompt');
                return;
            }
            
            navigator.clipboard.writeText(promptText).then(() => {
                const copyBtn = document.getElementById('copy-prompt-btn');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span class="material-symbols-outlined">done</span>';
                copyBtn.style.color = '#10b981';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.style.color = '';
                }, 2000);
                
                console.log('✅ Prompt已複製到剪貼簿');
            }).catch(err => {
                console.error('複製失敗:', err);
                alert('複製失敗，請重試');
            });
        }

        function parseJSON(str) {
            str = str.trim();
            // 如果不是 [ 或 { 開頭，假設為陣列並加上 []
            if (!str.startsWith('[') && !str.startsWith('{')) {
                str = '[' + str + ']';
            }
            return JSON.parse(str);
        }

        function parseVideoUrl() {
            try {
                const input = inputArea.value.trim();
                let id = input;
                
                let m = input.match(/[?&]v=([^&]+)/);
                if (m) id = m[1];
                
                m = input.match(/youtu\.be\/([^?]+)/);
                if (m) id = m[1];
                
                id = id.split('&')[0].split('?')[0];
                
                if (id.length !== 11) throw new Error("無效的影片 ID");
                
                // Save to localStorage
                localStorage.setItem('videoId', id);
                
                console.log(`✅ 影片設定為: ${id}`);
                closeModal();
                
                // Initialize player with the new video ID
                initializePlayer(id);
            } catch (e) {
                console.error("錯誤: " + e.message);
            }
        }

        function parseTranscript() {
            try {
                const data = parseJSON(inputArea.value);
                if (!Array.isArray(data)) throw new Error("必須是陣列");
                transcriptData = data;
                localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
                renderTranscript();
                closeModal();
            } catch (e) {
                console.error("格式錯誤: " + e.message);
            }
        }

        function parseVocab() {
            try {
                const data = parseJSON(inputArea.value);
                if (!Array.isArray(data)) throw new Error("必須是陣列");
                vocabData = data;
                localStorage.setItem('vocabData', JSON.stringify(vocabData));
                renderTranscript();
                renderVocab();
                closeModal();
            } catch (e) {
                console.error("格式錯誤: " + e.message);
            }
        }

        function parseQuiz() {
            try {
                const inputValue = inputArea.value.trim();
                if (!inputValue) {
                    alert('請輸入 Quiz 資料');
                    return;
                }
                
                const data = parseJSON(inputValue);
                
                // 檢查是否為雙語格式 { english: [...], chinese: [...] }
                if (typeof data === 'object' && data !== null && !Array.isArray(data) && 'english' in data && 'chinese' in data) {
                    // 雙語格式
                    if (!Array.isArray(data.english) || !Array.isArray(data.chinese)) {
                        alert("錯誤：english 和 chinese 都必須是陣列");
                        return;
                    }
                    if (data.english.length === 0 && data.chinese.length === 0) {
                        alert("錯誤：題庫不能為空");
                        return;
                    }
                    quizData = data; // 保存整個雙語物件
                    localStorage.setItem('quizData', JSON.stringify(quizData));
                    closeModal();
                    alert(`✅ 雙語 Quiz 題庫已匯入\n\n英文：${data.english.length} 題\n中文：${data.chinese.length} 題`);
                    console.log(`✅ 雙語 Quiz 題庫已匯入: 英文 ${data.english.length} 題、中文 ${data.chinese.length} 題`);
                } else if (Array.isArray(data)) {
                    // 傳統格式 - 單一陣列
                    if (data.length === 0) {
                        alert("錯誤：題庫不能為空");
                        return;
                    }
                    quizData = data;
                    localStorage.setItem('quizData', JSON.stringify(quizData));
                    closeModal();
                    alert(`✅ Quiz 題庫已匯入：${quizData.length} 題`);
                    console.log(`✅ Quiz 題庫已匯入: ${quizData.length} 題`);
                } else {
                    alert("格式錯誤：必須是陣列或雙語物件\n\n正確格式：\n{ \"english\": [...], \"chinese\": [...] }\n或\n[{\"q\":\"...\", \"options\":[...], \"correct\":0}]");
                }
            } catch (e) {
                alert("格式錯誤：" + e.message + "\n\n請確認 JSON 格式是否正確");
                console.error("格式錯誤: ", e);
            }
        }

        function clearTranscriptData() {
            transcriptData = [];
            selectedWords = [];
            localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
            localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
            console.log('✅ 逐字稿紀錄已清除');
            setTimeout(() => location.reload(), 500);
        }

        function clearVocabData() {
            vocabData = [];
            localStorage.setItem('vocabData', JSON.stringify(vocabData));
            console.log('✅ 單字紀錄已清除');
            setTimeout(() => location.reload(), 500);
        }

        function clearQuizData() {
            quizData = [];
            localStorage.setItem('quizData', JSON.stringify(quizData));
            console.log('✅ Quiz 題庫已清除');
            setTimeout(() => location.reload(), 500);
        }

        // Render Functions
        function renderTranscript() {
            const container = document.getElementById('transcript-content');
            if (transcriptData.length === 0) return;
            
            container.innerHTML = "";
            const sortedVocab = [...vocabData].sort((a,b) => b.word.length - a.word.length);

            transcriptData.forEach((seg, idx) => {
                let text = seg.en;  // 保持純文本進行替換
                
                // 先進行所有替換，建立標記列表
                const replacements = [];
                
                // Collect all vocab replacements
                sortedVocab.forEach(v => {
                    const roots = v.roots || [v.word];
                    const pattern = roots.map(r => r.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|');
                    const regex = new RegExp(`\\b(${pattern})\\b`, 'gi');
                    let match;
                    while ((match = regex.exec(text)) !== null) {
                        replacements.push({
                            start: match.index,
                            end: match.index + match[0].length,
                            word: match[0],
                            vocab: v,
                            type: 'vocab'
                        });
                    }
                });
                
                // Collect all selected word replacements
                selectedWords.forEach(word => {
                    const escaped = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    const regex = new RegExp(`\\b(${escaped})\\b`, 'gi');
                    let match;
                    while ((match = regex.exec(text)) !== null) {
                        replacements.push({
                            start: match.index,
                            end: match.index + match[0].length,
                            word: match[0],
                            selectedWord: word,
                            type: 'selected'
                        });
                    }
                });
                
                // Sort by start position (descending) to replace from end to start
                replacements.sort((a, b) => b.start - a.start);
                
                // Remove overlapping replacements (keep the first one found)
                const finalReplacements = [];
                replacements.forEach(rep => {
                    const overlaps = finalReplacements.some(r => 
                        (rep.start >= r.start && rep.start < r.end) ||
                        (rep.end > r.start && rep.end <= r.end)
                    );
                    if (!overlaps) {
                        finalReplacements.push(rep);
                    }
                });
                
                // Apply replacements from end to start
                let html = text;
                finalReplacements.forEach(rep => {
                    const before = html.substring(0, rep.start);
                    const after = html.substring(rep.end);
                    let replacement = '';
                    
                    if (rep.type === 'vocab') {
                        const isCustom = rep.vocab.custom ? 'vocab-word-custom' : 'vocab-word';
                        replacement = `<span class="${isCustom}" data-id="${rep.vocab.id || rep.vocab.word}" 
                                           onmouseenter="showCard(event, '${rep.vocab.id || rep.vocab.word}')" 
                                           onmouseleave="hideCard()" 
                                           onclick="toggleCard(event, '${rep.vocab.id || rep.vocab.word}')">${rep.word}</span>`;
                    } else if (rep.type === 'selected') {
                        replacement = `<span class="selected-word" onclick="removeSelectedWord('${rep.selectedWord}')" style="cursor: pointer; text-decoration: underline;" title="點擊取消選取">${rep.word}</span>`;
                    }
                    
                    html = before + replacement + after;
                });

                const hasTime = typeof seg.t === 'number';
                const timeLabel = hasTime ? formatTime(seg.t) : 'Set';
                const timeClass = hasTime ? 'bg-green-50 text-green-700' : 'bg-slate-100 text-slate-600';
                const minutes = hasTime ? Math.floor(seg.t / 60) : '';
                const seconds = hasTime ? seg.t % 60 : '';

                container.innerHTML += `
                    <div class="mb-6" id="seg-${idx}">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 ${timeClass} text-xs font-semibold transition-colors" 
                                    onclick="jumpToTime(${hasTime ? seg.t : 'null'})">
                                ⏵ ${timeLabel}
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">
                                
                                <div class="h-6 w-px bg-blue-200"></div>
                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-${idx}" min="0" max="999" step="1" 
                                           class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400"
                                           placeholder="0" value="${minutes}"
                                           onchange="setTimeByInput(${idx})"
                                           onkeypress="if(event.key==='Enter') setTimeByInput(${idx})">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-${idx}" min="0" max="59" step="1" 
                                           class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400"
                                           placeholder="00" value="${seconds ? String(seconds).padStart(2, '0') : ''}"
                                           onchange="setTimeByInput(${idx})"
                                           onkeypress="if(event.key==='Enter') setTimeByInput(${idx})">
                                </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" 
                                    onclick="editSegment(${idx})">
                                ✏️ Edit
                            </button>
                        </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-${idx}">${html}</p>
                        ${seg.cn ? `<p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-${idx}">${seg.cn}</p>` : ''}
                    </div>`;
            });
            
            applyTranslationState();
        }

        function showAddVocabModal() {
            document.getElementById('add-vocab-modal').classList.remove('hidden');
            document.getElementById('add-vocab-input').focus();
        }

        function closeAddVocabModal() {
            document.getElementById('add-vocab-modal').classList.add('hidden');
            // 清空表單
            document.getElementById('add-vocab-input').value = '';
        }

        function addNewVocabFromJSON() {
            try {
                const input = document.getElementById('add-vocab-input').value.trim();
                if (!input) {
                    alert('請輸入單字資料');
                    return;
                }
                
                const data = parseJSON(input);
                if (!Array.isArray(data)) {
                    alert('格式錯誤：必須是陣列');
                    return;
                }
                
                if (data.length === 0) {
                    alert('請至少新增一個單字');
                    return;
                }
                
                let addedCount = 0;
                data.forEach(item => {
                    if (!item.word) return; // 跳過沒有 word 的項目
                    
                    // 檢查是否重複
                    if (vocabData.some(v => v.word.toLowerCase() === item.word.toLowerCase())) {
                        console.warn(`⚠️ 單字已存在，已跳過: ${item.word}`);
                        return;
                    }
                    
                    // 添加新單字（標記為自訂：custom: true）
                    const newVocab = {
                        id: item.word.toLowerCase(),
                        word: item.word.charAt(0).toUpperCase() + item.word.slice(1).toLowerCase(),
                        def: item.def || '',
                        cn: item.cn || '',
                        pos: item.pos || '',
                        custom: true  // 標記為自訂單字
                    };
                    
                    vocabData.push(newVocab);
                    addedCount++;
                });
                
                if (addedCount === 0) {
                    alert('所有單字都已存在或格式不正確');
                    return;
                }
                
                localStorage.setItem('vocabData', JSON.stringify(vocabData));
                renderVocab();
                renderTranscript();
                closeAddVocabModal();
                
                alert(`✅ 已新增 ${addedCount} 個生字`);
                console.log(`✅ 已新增 ${addedCount} 個生字`);
            } catch (e) {
                alert('格式錯誤：' + e.message + '\n\n請確認 JSON 格式是否正確');
                console.error('格式錯誤: ', e);
            }
        }

        function renderVocab() {
            const list = document.getElementById('vocab-list');
            const count = document.getElementById('vocab-count');
            
            if (vocabData.length === 0) return;
            
            count.textContent = vocabData.length;
            list.innerHTML = "";
            
            const sortedVocab = [...vocabData].sort((a,b) => a.word.localeCompare(b.word));
            sortedVocab.forEach((v, index) => {
                list.innerHTML += `
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" 
                        onclick="scrollToVocab('${v.id || v.word}')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">${index + 1}.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">${v.word}</div>
                                    <button onclick="event.stopPropagation(); speakWord('${v.word}')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                ${v.ipa ? `<div class="text-xs text-blue-600 font-semibold mt-1">${v.ipa}</div>` : ''}
                                ${v.pos ? `<div class="text-xs text-slate-500 mt-0.5">${v.pos}</div>` : ''}
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">${v.def || ''}</div>
                        ${v.cn ? `<div class="text-xs text-blue-700 font-semibold ml-6">${v.cn}</div>` : ''}
                    </li>`;
            });
        }
        
        function speakWord(word) {
            // 使用 Web Speech API 播放發音
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 1;
                utterance.pitch = 1;
                speechSynthesis.speak(utterance);
            } else {
                console.warn('您的瀏覽器不支援語音合成功能');
            }
        }

        // YouTube Player
        function onYouTubeIframeAPIReady() {
            youtubeAPIReady = true;
            console.log('YouTube API Ready');
            // Only initialize player if a valid video ID is set
            if (videoId && videoId.length === 11) {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: { rel: 0, modestbranding: 1 },
                    events: {
                        onReady: () => {
                            playerReady = true;
                            player.setPlaybackRate(currentPlaybackSpeed);
                            console.log('YouTube Player Ready');
                        },
                        onStateChange: (event) => {
                            updatePlayPauseButton();
                        }
                    }
                });
            }
        }
        
        function initializePlayer(id) {
            // Initialize player with a specific video ID
            if (!id || id.length !== 11) return;
            videoId = id;
            localStorage.setItem('videoId', id);
            
            // Wait for YouTube API to be ready
            if (!youtubeAPIReady || typeof YT === 'undefined' || typeof YT.Player === 'undefined') {
                console.log('等待 YouTube API 載入...');
                setTimeout(() => initializePlayer(id), 200);
                return;
            }
            
            if (!player) {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: { rel: 0, modestbranding: 1 },
                    events: {
                        onReady: () => {
                            playerReady = true;
                            player.setPlaybackRate(currentPlaybackSpeed);
                            console.log('YouTube Player Ready');
                        },
                        onStateChange: (event) => {
                            updatePlayPauseButton();
                        }
                    }
                });
            } else if (playerReady) {
                player.loadVideoById(videoId);
            }
        }

        function jumpToTime(seconds) {
            if (!player || !playerReady || typeof seconds !== 'number') return;
            player.seekTo(seconds, true);
            player.playVideo();
        }

        

        function setTimeByInput(idx) {
            if (!transcriptData[idx]) return;
            
            const minInput = document.getElementById(`min-input-${idx}`);
            const secInput = document.getElementById(`sec-input-${idx}`);
            
            const minutes = parseInt(minInput.value, 10) || 0;
            const seconds = parseInt(secInput.value, 10) || 0;
            
            if (minutes < 0 || seconds < 0 || seconds > 59) {
                alert('請輸入有效的時間（秒數必須 0-59）');
                return;
            }
            
            const totalSeconds = minutes * 60 + seconds;
            transcriptData[idx].t = totalSeconds;
            localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
            renderTranscript();
            console.log(`✅ 時間戳記已設定: ${formatTime(totalSeconds)}`);
        }

        function editSegment(idx) {
            const seg = transcriptData[idx];
            if (!seg) return;
            
            // Store current editing index
            window.currentEditIndex = idx;
            
            // Fill in the modal
            document.getElementById('edit-en-input').value = seg.en || '';
            document.getElementById('edit-cn-input').value = seg.cn || '';
            
            // Show modal
            document.getElementById('edit-modal').classList.remove('hidden');
            
            // Focus on English input
            setTimeout(() => {
                document.getElementById('edit-en-input').focus();
            }, 100);
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            window.currentEditIndex = null;
        }

        function saveEdit() {
            const idx = window.currentEditIndex;
            if (idx === null || idx === undefined || !transcriptData[idx]) return;
            
            const enText = document.getElementById('edit-en-input').value.trim();
            const cnText = document.getElementById('edit-cn-input').value.trim();
            
            if (enText) {
                transcriptData[idx].en = enText;
            }
            
            transcriptData[idx].cn = cnText;
            
            localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
            renderTranscript();
            closeEditModal();
        }

        function formatTime(sec) {
            if (typeof sec !== 'number' || sec < 0) return '00:00';
            const m = Math.floor(sec / 60);
            const s = Math.floor(sec % 60);
            return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        // Interaction
        function showCard(e, id) {
            const vocab = vocabData.find(v => (v.id === id) || (v.word === id));
            if (!vocab) return;
            
            floatingCard.dataset.currentId = id;
            floatingCard.innerHTML = `
                <div class="p-4">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="text-xl font-bold flex-1">${vocab.word}</h3>
                        <button onclick="event.stopPropagation(); speakWord('${vocab.word}')" class="ml-2 p-2 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 transition" title="播放發音">
                            <span class="material-symbols-outlined text-lg">volume_up</span>
                        </button>
                    </div>
                    <div class="text-xs text-slate-500 mb-1">${vocab.pos || ''}</div>
                    ${vocab.ipa ? `<div class="text-xs text-blue-600 font-semibold mb-3">${vocab.ipa}</div>` : ''}
                    <p class="text-sm mb-3">${vocab.def}</p>
                    ${vocab.cn ? `<p class="text-xs text-blue-700 font-bold">${vocab.cn}</p>` : ''}
                </div>`;
            
            const rect = e.target.getBoundingClientRect();
            const cardWidth = 320;
            const cardHeight = 200; // 預估高度
            const padding = 10;
            
            // 計算最佳位置（避免超出螢幕）
            let left = rect.left;
            let top = rect.bottom + padding;
            
            // 水平方向調整
            if (left + cardWidth > window.innerWidth) {
                left = window.innerWidth - cardWidth - padding;
            }
            if (left < padding) {
                left = padding;
            }
            
            // 垂直方向調整（如果下方空間不足，顯示在上方）
            if (top + cardHeight > window.innerHeight) {
                top = rect.top - cardHeight - padding;
                if (top < padding) {
                    top = padding;
                }
            }
            
            floatingCard.style.left = left + 'px';
            floatingCard.style.top = top + 'px';
            floatingCard.classList.remove('hidden');
        }
        
        function toggleCard(e, id) {
            e.stopPropagation();
            e.preventDefault();
            
            // 如果已經顯示同一個字卡，則關閉
            if (!floatingCard.classList.contains('hidden') && floatingCard.dataset.currentId === id) {
                hideCard();
            } else {
                showCard(e, id);
            }
        }

        function hideCard() {
            floatingCard.classList.add('hidden');
            floatingCard.dataset.currentId = '';
        }
        
        // 點擊外部關閉字卡
        document.addEventListener('click', function(e) {
            // 延遲執行，讓 toggleCard 先完成
            setTimeout(() => {
                if (!floatingCard.classList.contains('hidden') && 
                    !floatingCard.contains(e.target) && 
                    !e.target.closest('.vocab-word') && 
                    !e.target.closest('.vocab-word-custom')) {
                    hideCard();
                }
            }, 100);
        });

        function toggleTranslations() {
            translationsVisible = !translationsVisible;
            const toggleBtnText = document.getElementById('toggle-btn-text');
            const cnToggleText = document.getElementById('cn-toggle-text');
            
            if (toggleBtnText) {
                toggleBtnText.innerText = translationsVisible ? "Hide CN" : "Show CN";
            }
            if (cnToggleText) {
                cnToggleText.innerText = translationsVisible ? "隱藏" : "中文";
            }
            
            applyTranslationState();
        }

        // Quiz Logic
        function openQuiz() {
            const modal = document.getElementById('quiz-modal');
            modal.classList.remove('hidden');
            
            // 檢查是否為雙語格式
            const isBilingual = typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData;
            
            // 顯示或隱藏語言選擇器
            const languageSelector = document.getElementById('quiz-language-selector');
            if (isBilingual) {
                languageSelector.classList.remove('hidden');
                updateQuizLanguageSelector();
            } else {
                languageSelector.classList.add('hidden');
            }
            
            renderQuizContent();
        }

        function renderQuizContent() {
            const content = document.getElementById('quiz-content');
            const footer = document.getElementById('quiz-footer');

            // 檢查是否為雙語格式或傳統格式
            let questionsToDisplay = [];
            let isBilingual = false;
            
            if (typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData) {
                // 雙語格式
                isBilingual = true;
                questionsToDisplay = quizLanguage === 'english' ? quizData.english : quizData.chinese;
            } else if (Array.isArray(quizData)) {
                // 傳統格式
                questionsToDisplay = quizData;
            }

            if (!Array.isArray(questionsToDisplay) || questionsToDisplay.length === 0) {
                content.innerHTML = `
                    <div class="p-6 rounded-xl border border-slate-200 bg-slate-50 text-slate-700">
                        尚未匯入 Quiz 題庫，請先用上方的 Quiz Data 按鈕貼上題庫。
                    </div>
                `;
                footer.innerHTML = `<button onclick="closeQuiz()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-900 transition">Close</button>`;
                return;
            }

            footer.innerHTML = `<button onclick="submitQuiz()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 shadow-md transition">Submit Answers</button>`;

            content.innerHTML = questionsToDisplay.map((q, i) => `
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors" id="q-block-${i}">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">${i + 1}</span>
                        ${q.q}
                    </p>
                    <div class="space-y-3 pl-9">
                        ${(q.options || []).map((opt, optIdx) => `
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q${i}" value="${optIdx}" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">${opt}</span>
                            </label>
                        `).join('')}
                    </div>
                    <div class="feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2"></div>
                </div>
            `).join('');
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').classList.add('hidden');
        }

        function submitQuiz() {
            let score = 0;
            let allAnswered = true;

            // 決定使用哪份題庫
            let questionsToScore = [];
            if (typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData) {
                // 雙語格式 - 根據選擇的語言取用對應版本
                questionsToScore = quizLanguage === 'english' ? quizData.english : quizData.chinese;
            } else if (Array.isArray(quizData)) {
                // 傳統格式
                questionsToScore = quizData;
            }

            questionsToScore.forEach((q, i) => {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                const block = document.getElementById(`q-block-${i}`);
                const feedback = block ? block.querySelector('.feedback') : null;

                if (!block || !feedback) return;

                block.classList.remove('bg-green-50', 'border-green-200', 'bg-red-50', 'border-red-200');
                feedback.className = 'feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2';

                if (selected) {
                    feedback.classList.remove('hidden');
                    if (parseInt(selected.value, 10) === q.correct) {
                        score++;
                        feedback.innerHTML = `<span class="material-symbols-outlined">check_circle</span> Correct!`;
                        feedback.classList.add('bg-green-100', 'text-green-700');
                        block.classList.add('bg-green-50/50', 'border-green-200');
                    } else {
                        feedback.innerHTML = `<span class="material-symbols-outlined">cancel</span> Incorrect. The correct answer is: <span class="italic">${q.options[q.correct]}</span>`;
                        feedback.classList.add('bg-red-100', 'text-red-700');
                        block.classList.add('bg-red-50/50', 'border-red-200');
                    }
                } else {
                    allAnswered = false;
                }
            });

            const footer = document.getElementById('quiz-footer');
            if (allAnswered || confirm("You haven't answered all questions. Submit anyway?")) {
                let message = '';
                let colorClass = '';

                if (score === questionsToScore.length) {
                    message = 'Perfect Score! 🎉';
                    colorClass = 'text-green-600';
                } else if (score > questionsToScore.length / 2) {
                    message = 'Great Job! 👍';
                    colorClass = 'text-blue-600';
                } else {
                    message = 'Keep Practicing! 💪';
                    colorClass = 'text-orange-500';
                }

                footer.innerHTML = `
                    <div class="flex items-center gap-4 w-full justify-between">
                        <div>
                            <p class="text-sm text-gray-500 uppercase tracking-wider font-bold">Your Score</p>
                            <p class="text-2xl font-bold ${colorClass}">${score} / ${questionsToScore.length} - ${message}</p>
                        </div>
                        <button onclick="closeQuiz()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-900 transition">Close</button>
                    </div>`;
            }
        }

        function applyTranslationState() {
            document.querySelectorAll('.cn-text').forEach(el => {
                if (translationsVisible) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            });
        }

        function scrollToVocab(id) {
            const span = document.querySelector(`.vocab-word[data-id="${id}"]`);
            if (span) {
                span.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function increaseFontSize() {
            if (currentFontSize < 32) {
                currentFontSize += 2;
                applyFontSize();
            }
        }

        function decreaseFontSize() {
            if (currentFontSize > 12) {
                currentFontSize -= 2;
                applyFontSize();
            }
        }

        function applyFontSize() {
            const transcriptContent = document.getElementById('transcript-content');
            if (transcriptContent) {
                transcriptContent.style.fontSize = currentFontSize + 'px';
            }
        }

        function increasePlaybackSpeed() {
            if (!player || !playerReady) return;
            const speeds = [0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];
            const currentIndex = speeds.indexOf(currentPlaybackSpeed);
            if (currentIndex < speeds.length - 1) {
                currentPlaybackSpeed = speeds[currentIndex + 1];
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
        }

        function decreasePlaybackSpeed() {
            if (!player || !playerReady) return;
            const speeds = [0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];
            const currentIndex = speeds.indexOf(currentPlaybackSpeed);
            if (currentIndex > 0) {
                currentPlaybackSpeed = speeds[currentIndex - 1];
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
        }

        function updateSpeedDisplay() {
            const display = document.getElementById('speed-display');
            if (display) {
                display.textContent = currentPlaybackSpeed.toFixed(2) + 'x';
            }
        }

        function togglePlayPause() {
            if (!player || !playerReady) return;
            
            const state = player.getPlayerState();
            const playIcon = document.getElementById('play-icon');
            const playText = document.getElementById('play-text');
            
            // YT.PlayerState: UNSTARTED (-1), ENDED (0), PLAYING (1), PAUSED (2), BUFFERING (3), CUED (5)
            if (state === 1) { // Playing
                player.pauseVideo();
                playIcon.textContent = 'play_arrow';
                playText.textContent = '播放';
            } else { // Paused or other states
                player.playVideo();
                playIcon.textContent = 'pause';
                playText.textContent = '暫停';
            }
        }

        function updatePlayPauseButton() {
            if (!player || !playerReady) return;
            const state = player.getPlayerState();
            const playIcon = document.getElementById('play-icon');
            const playText = document.getElementById('play-text');
            
            if (state === 1) { // Playing
                playIcon.textContent = 'pause';
                playText.textContent = '暫停';
            } else {
                playIcon.textContent = 'play_arrow';
                playText.textContent = '播放';
            }
        }

        function resetSettings() {
            currentFontSize = 18;
            applyFontSize();
            
            if (player && playerReady) {
                currentPlaybackSpeed = 1.0;
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
            
            translationsVisible = false;
            const toggleBtnText = document.getElementById('toggle-btn-text');
            const cnToggleText = document.getElementById('cn-toggle-text');
            if (toggleBtnText) toggleBtnText.innerText = 'Show CN';
            if (cnToggleText) cnToggleText.innerText = '中文';
            applyTranslationState();
        }

        function changeVideoUrl() {
            const newUrl = prompt('貼上 YouTube 網址或影片 ID:', videoId);
            if (!newUrl || newUrl.trim() === '') return;
            
            try {
                let id = newUrl.trim();
                
                // 提取影片 ID
                let m = id.match(/[?&]v=([^&]+)/);
                if (m) id = m[1];
                
                m = id.match(/youtu\.be\/([^?]+)/);
                if (m) id = m[1];
                
                id = id.split('&')[0].split('?')[0];
                
                if (id.length !== 11) throw new Error("無效的影片 ID");
                
                videoId = id;
                if (player && playerReady) {
                    player.loadVideoById(videoId);
                    console.log(`✅ 影片已更換: ${videoId}`);
                }
            } catch (e) {
                console.error("錯誤: " + e.message);
            }
        }

        // Export Function
        function downloadHTML() {
            const clone = document.documentElement.cloneNode(true);
            
            // Replace entire navigation bar with simplified Export-only version
            const nav = clone.querySelector('nav');
            if (nav) {
                nav.innerHTML = `
                    <div class="max-w-7xl mx-auto px-4 sm:px-6">
                        <div class="flex justify-between h-16 items-center">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                    <span class="material-symbols-outlined text-white text-xl">school</span>
                                </div>
                                <div class="flex flex-col">
                                    <div class="font-bold text-lg text-slate-900">StudyEngine</div>
                                    <div class="text-xs text-slate-500 hidden sm:block">英語學習平台</div>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <button onclick="toggleExportMenu()" class="px-3 py-2 rounded-lg border border-purple-200 bg-purple-50 hover:bg-purple-100 text-purple-700 transition text-sm font-medium flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-lg">bookmark</span>
                                    <span class="hidden sm:inline">Export Words (</span><span class="sm:hidden">(</span><span id="selected-count">${selectedWords.length}</span><span>)</span>
                                </button>
                                <div id="export-menu" class="hidden absolute top-full right-0 mt-2 bg-white border border-slate-200 rounded-xl shadow-lg z-50 min-w-max overflow-hidden">
                                    <button onclick="copyExportPrompt()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 border-b border-slate-100 flex items-center gap-2 text-sm" title="複製生成AI指令的Prompt">
                                        <span class="material-symbols-outlined text-sm text-blue-600">content_copy</span> <span>複製 Prompt</span>
                                    </button>
                                    <button onclick="exportSelectedWords()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 flex items-center gap-2 text-sm" title="下載選中的生字">
                                        <span class="material-symbols-outlined text-sm text-blue-600">download</span> <span>下載文字檔</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Remove all Five Server and third-party injected code
            const scriptsToRemove = clone.querySelectorAll('script[data-id="five-server"], script[id="www-widgetapi-script"]');
            scriptsToRemove.forEach(s => s.remove());
            
            // Remove all injected styles (Five Server, Tailwind compiled, third-party)
            const stylesToRemove = clone.querySelectorAll('style[id*="five"], style[class*="five"], style:not([type])');
            stylesToRemove.forEach(s => {
                const content = s.textContent || '';
                if (content.includes('five-server') || 
                    content.includes('fiveserver') || 
                    content.includes('keyword-info') ||
                    content.includes('tippy-') ||
                    content.includes('ubersuggest') ||
                    content.includes('bl-info') ||
                    content.includes('kw-info') ||
                    content.includes('statistics-graph') ||
                    content.includes('ue-sidebar') ||
                    content.includes('tw-border-spacing') ||
                    content.includes('tailwindcss v3.4')) {
                    s.remove();
                }
            });
            
            // Remove Ubersuggest/extension divs
            const extensionDivs = clone.querySelectorAll('.ue-sidebar-container, [class*="ubersuggest"]');
            extensionDivs.forEach(div => div.remove());

            let html = clone.outerHTML;

            // Inject data (keep videoId empty for exported files)
            html = html.replace(
                /let transcriptData = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('transcriptData'\) \|\| '\[\]'\));/s,
                `let transcriptData = ${JSON.stringify(transcriptData)};`
            );
            html = html.replace(
                /let vocabData = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('vocabData'\) \|\| '\[\]'\));/s,
                `let vocabData = ${JSON.stringify(vocabData)};`
            );
            html = html.replace(
                /let quizData = (?:\[.*?\]|\{.*?\}|JSON\.parse\(localStorage\.getItem\('quizData'\) \|\| '\[\]'\));/s,
                `let quizData = ${JSON.stringify(quizData)};`
            );
            html = html.replace(
                /let selectedWords = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('selectedWords'\) \|\| '\[\]'\));/s,
                `let selectedWords = ${JSON.stringify(selectedWords)};`
            );
            html = html.replace(
                /let videoId = (?:localStorage\.getItem\('videoId'\) \|\| ''|'[^']*');/,
                `let videoId = localStorage.getItem('videoId') || '';`
            );

            // 確保 player 是空的 div，不要包含 iframe
            html = html.replace(
                /<iframe[^>]*id="player"[^>]*>[\s\S]*?<\/iframe>/,
                '<div id="player" class="absolute inset-0"></div>'
            );
            html = html.replace(
                /<div id="player"[^>]*>[\s\S]*?<\/div>/,
                '<div id="player" class="absolute inset-0"></div>'
            );

            // Remove Capture buttons from exported file
            html = html.replace(
                /<button[^>]*onclick="captureTime\([^)]+\)"[^>]*>[\s\S]*?Capture[\s\S]*?<\/button>/g,
                ''
            );
            
            // Remove captureTime function from exported file
            html = html.replace(
                /function captureTime\([^)]*\) \{[\s\S]*?\n        \}/,
                ''
            );
            
            // Update video section hint text
            html = html.replace(
                /點擊時間標籤跳轉，按 Capture 設定當前播放時間/,
                '點擊時間標籤跳轉到指定時間'
            );

            // Download
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'study_guide.html';
            a.click();
            URL.revokeObjectURL(url);

            console.log(`✅ 匯出成功！\n逐字稿: ${transcriptData.length} 段\n單字: ${vocabData.length} 個\n影片: 需透過「更換影片」按鈕設定`);
        }

        // Load YouTube API
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        document.head.appendChild(tag);

        // Global YouTube Ready handler
        window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

        // Initialize if data exists
        if (transcriptData.length > 0 || vocabData.length > 0) {
            renderTranscript();
            renderVocab();
        }
        
        // Update selected word count
        updateSelectedCount();
        
        // Text Selection Handler
        document.addEventListener('mouseup', handleTextSelection);
        
        function handleTextSelection(e) {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();
            
            if (!selectedText || selectedText.length === 0) {
                hideSelectionPopup();
                return;
            }
            
            // Check if selection is within transcript
            const container = document.getElementById('transcript-content');
            if (!container || !container.contains(selection.anchorNode)) {
                hideSelectionPopup();
                return;
            }
            
            // Show popup near cursor
            const popup = document.getElementById('selection-popup');
            const range = selection.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            
            popup.style.left = (rect.left + rect.width / 2 - 60) + 'px';
            popup.style.top = (rect.top - 45) + 'px';
            popup.classList.remove('hidden');
            
            popup.onclick = () => addSelectedWord(selectedText);
        }
        
        function hideSelectionPopup() {
            const popup = document.getElementById('selection-popup');
            if (popup) popup.classList.add('hidden');
        }
        
        function addSelectedWord(word) {
            word = word.trim();
            if (!word || selectedWords.includes(word)) {
                hideSelectionPopup();
                window.getSelection().removeAllRanges();
                return;
            }
            
            selectedWords.push(word);
            localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
            updateSelectedCount();
            highlightSelectedWords();
            hideSelectionPopup();
            window.getSelection().removeAllRanges();
            
            console.log(`✅ 已加入生字: ${word}`);
        }
        
        function removeSelectedWord(word) {
            word = word.trim();
            const index = selectedWords.indexOf(word);
            if (index > -1) {
                selectedWords.splice(index, 1);
                localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
                updateSelectedCount();
                highlightSelectedWords();
                console.log(`❌ 已取消選取: ${word}`);
            }
        }
        
        function updateSelectedCount() {
            const countEl = document.getElementById('selected-count');
            const countElMobile = document.getElementById('selected-count-mobile');
            if (countEl) countEl.textContent = selectedWords.length;
            if (countElMobile) countElMobile.textContent = selectedWords.length;
        }
        
        function highlightSelectedWords() {
            const container = document.getElementById('transcript-content');
            if (!container) return;
            
            // Remove existing highlights
            container.querySelectorAll('.selected-word').forEach(el => {
                el.outerHTML = el.textContent;
            });
            
            // Re-render to apply new highlights
            renderTranscript();
        }
        
        function toggleExportMenu() {
            const menu = document.getElementById('export-menu');
            menu.classList.toggle('hidden');
            
            // 點擊外部時關閉選單
            if (!menu.classList.contains('hidden')) {
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#export-menu') && !e.target.closest('button[onclick="toggleExportMenu()"]')) {
                        menu.classList.add('hidden');
                    }
                }, { once: true });
            }
        }
        
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('hamburger-btn');
            
            menu.classList.toggle('hidden');
            btn.classList.toggle('active');
            
            // 點擊外部時關閉選單
            if (!menu.classList.contains('hidden')) {
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#mobile-menu') && !e.target.closest('#hamburger-btn')) {
                        menu.classList.add('hidden');
                        btn.classList.remove('active');
                    }
                }, { once: true });
            }
        }

        function generateExportPrompt() {
            if (selectedWords.length === 0) {
                return '';
            }
            
            let prompt = selectedWords.join('\n');
            prompt += '\n\n將以上英文單字嚴格依照以下 JSON Array 格式輸出結果：\n\n';
            prompt += '1.  **id**: 單字的全小寫形式。\n';
            prompt += '2.  **word**: 單字的首字母大寫。\n';
            prompt += '3.  **ipa**: 該單字的 IPA 音標。\n';
            prompt += '4.  **pos**: 詞性 (如 noun, verb, adjective)。\n';
            prompt += '5.  **def**: 簡潔的英文定義。\n';
            prompt += '6.  **cn**: 繁體中文解釋 (若有特定語境請一併標註)。\n';
            prompt += '7.  **image**: 請輸出格式為 `https://source.unsplash.com/featured/?{單字}` 的連結，將 `{單字}` 替換為該單字的英文內容，以便自動抓取相關圖片。\n\n';
            prompt += '範例格式：\n\n';
            prompt += '[\n';
            prompt += '    {\n';
            prompt += '        "id": "pareidolia",\n';
            prompt += '        "word": "Pareidolia",\n';
            prompt += '        "ipa": "/ˌpær.ɪˈdoʊ.li.ə/",\n';
            prompt += '        "pos": "noun",\n';
            prompt += '        "def": "The psychological phenomenon of seeing recognizable shapes, especially faces, in random or vague stimuli.",\n';
            prompt += '        "cn": "幻想性錯覺 (尤指將模糊圖像看作人臉)",\n';
            prompt += '        "image": "https://source.unsplash.com/featured/?pareidolia"\n';
            prompt += '    }\n';
            prompt += ']\n';
            
            return prompt;
        }

        function copyExportPrompt() {
            if (selectedWords.length === 0) {
                alert('尚未選取任何生字');
                return;
            }
            
            const prompt = generateExportPrompt();
            navigator.clipboard.writeText(prompt).then(() => {
                document.getElementById('export-menu').classList.add('hidden');
                console.log(`✅ Export Prompt 已複製 (${selectedWords.length} 個生字)`);
            }).catch(() => {
                alert('複製失敗，請重試');
            });
        }

        function exportSelectedWords() {
            if (selectedWords.length === 0) {
                alert('尚未選取任何生字');
                return;
            }
            
            const text = selectedWords.map((word, i) => `${i + 1}. ${word}`).join('\n');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'selected_words.txt';
            a.click();
            URL.revokeObjectURL(url);
            
            console.log(`✅ 已匯出 ${selectedWords.length} 個生字`);
        }
    </script>


</body></html>