<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>完整學習網頁生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&amp;family=Inter:wght@400;500;600;700&amp;family=Material+Symbols+Outlined" rel="stylesheet">
    <style>
        * { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        
        body {
            background: linear-gradient(135deg, #f8fafb 0%, #f0f4f8 100%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        .vocab-word { 
            border-bottom: 2px solid #60a5fa; 
            cursor: pointer; 
            color: #2563eb; 
            font-weight: 600; 
            transition: all 0.2s ease; 
            padding: 2px 4px;
            border-radius: 2px;
        }
        .vocab-word:hover { 
            background-color: #dbeafe;
            border-bottom-color: #2563eb;
        }
        .vocab-word-custom { 
            border-bottom: 2px solid #f87171; 
            cursor: pointer; 
            color: #dc2626; 
            font-weight: 600; 
            transition: all 0.2s ease; 
            padding: 2px 4px;
            border-radius: 2px;
        }
        .vocab-word-custom:hover { 
            background-color: #fee2e2;
            border-bottom-color: #991b1b;
        }
        #floating-card { 
            transition: opacity 0.2s, transform 0.2s ease; 
            pointer-events: none; 
            z-index: 9999;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal { transition: all 0.3s ease-in-out; }
        .modal.hidden { opacity: 0; pointer-events: none; }
        #quiz-modal { transition: all 0.3s ease-in-out; }
        #quiz-modal.hidden { opacity: 0; pointer-events: none; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .selected-word { 
            background-color: #fef3c7; 
            border-bottom: 2px solid #eab308; 
            font-weight: 600;
            padding: 2px 4px;
            border-radius: 2px;
        }
        #selection-popup { 
            transition: all 0.2s ease; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .learning-card {
            transition: all 0.3s ease;
        }
        .learning-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.08);
        }
        
        /* Sticky video styles */
        #video-container.sticky-video {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 480px;
            height: 270px;
            padding-top: 0 !important;
            max-width: 90vw;
            z-index: 1000;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.3), 0 8px 10px -6px rgb(0 0 0 / 0.3);
            border: 2px solid #fff;
        }
        
        #video-container.sticky-video #player {
            pointer-events: auto;
        }

        #floating-close-btn {
            position: fixed;
            top: 45px;
            right: 20px;
            z-index: 1001;
        }

        @media (max-width: 768px) {
            #video-container.sticky-video {
                width: 320px;
                height: 180px;
                right: 10px;
                top: 70px;
            }
            
            #floating-close-btn {
                top: 35px;
                right: 10px;
            }
        }
        
        /* 漢堡選單樣式 */
        #mobile-menu {
            transition: all 0.3s ease;
        }
        #mobile-menu.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .hamburger-line {
            transition: all 0.3s ease;
        }
        #hamburger-btn.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        #hamburger-btn.active .hamburger-line:nth-child(2) {
            opacity: 0;
        }
        #hamburger-btn.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
                        /* Hide time input fields */
        .flex.items-center.gap-0.bg-blue-50 {
            display: none !important;
        }


    </style>
<script src="https://www.youtube.com/iframe_api"></script><style id="_goober"> @keyframes go2264125279{from{transform:scale(0) rotate(45deg);opacity:0;}to{transform:scale(1) rotate(45deg);opacity:1;}}@keyframes go3020080000{from{transform:scale(0);opacity:0;}to{transform:scale(1);opacity:1;}}@keyframes go463499852{from{transform:scale(0) rotate(90deg);opacity:0;}to{transform:scale(1) rotate(90deg);opacity:1;}}@keyframes go1268368563{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}@keyframes go1310225428{from{transform:scale(0) rotate(45deg);opacity:0;}to{transform:scale(1) rotate(45deg);opacity:1;}}@keyframes go651618207{0%{height:0;width:0;opacity:0;}40%{height:0;width:6px;opacity:1;}100%{opacity:1;height:10px;}}@keyframes go901347462{from{transform:scale(0.6);opacity:0.4;}to{transform:scale(1);opacity:1;}}.go4109123758{z-index:9999;}.go4109123758 > *{pointer-events:auto;}</style><style>.rr--group{display:flex;width:100%;position:relative}.rr--box{display:flex;width:100%;flex-grow:1;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rr--svg{display:flex;aspect-ratio:1;width:100%;flex-grow:1;overflow:clip;pointer-events:none}@supports not (overflow: clip){.rr--svg{overflow:auto}}.rr--box:focus,.rr--box:focus-visible,.rr-reset:focus-visible,.rr-reset:focus{outline:none;box-shadow:none}.rr--focus-reset{outline:6px double #0079ff}.rr--box:focus-visible .rr--svg{outline:6px double #0079ff;isolation:isolate}.rr--reset{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0;right:0;bottom:50%}[dir=rtl] .rr--reset{left:0;right:auto}.rr--dir-y .rr--reset{bottom:0;right:50%}.rr--disabled{opacity:.5;cursor:not-allowed}.rr--disabled .rr--svg{pointer-events:none}.rr--pointer .rr--box{cursor:pointer}.rr--dir-x{flex-direction:row}.rr--dir-y{flex-direction:column}.rr--space-sm .rr--svg{padding:8%}.rr--space-md .rr--svg{padding:12.5%}.rr--space-lg .rr--svg{padding:17.5%}.rr--dir-x.rr--gap-sm .rr--svg{margin:0 6.25%}.rr--dir-x.rr--gap-sm .rr--box:focus-visible:after{width:87.5%;left:6.25%}.rr--dir-x.rr--gap-md .rr--svg{margin:0 12.5%}.rr--dir-x.rr--gap-md .rr--box:focus-visible:after{width:75%;left:12.5%}.rr--dir-x.rr--gap-lg .rr--svg{margin:0 25%}.rr--dir-x.rr--gap-lg .rr--box:focus-visible:after{width:50%;left:25%}.rr--dir-y.rr--gap-sm .rr--svg{margin:6.25% 0}.rr--dir-y.rr--gap-md .rr--svg{margin:12.5% 0}.rr--dir-y.rr--gap-lg .rr--svg{margin:25% 0}.rr--rx-sm .rr--svg{border-radius:5%}.rr--rx-md .rr--svg{border-radius:15%}.rr--rx-lg .rr--svg{border-radius:20%}.rr--rx-full .rr--svg{border-radius:100%}.rr--has-stroke .rr--svg{stroke-linecap:round;stroke-linejoin:round}.rr--has-border .rr--svg{border-width:var(--rr--border-width);border-style:solid}.rr--on .rr--svg{fill:var(--rr--fill-on-color, none)}.rr--off .rr--svg{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--on .rr--svg{stroke:var(--rr--stroke-on-color, currentColor)}.rr--has-stroke .rr--off .rr--svg{stroke:var(--rr--stroke-off-color, currentColor)}.rr--on .rr--svg{background-color:var(--rr--box-on-color, none)}.rr--off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--has-border .rr--off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}.rr--has-border .rr--on .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--fx-colors{--rr--easing: .2s cubic-bezier(.61, 1, .88, 1)}.rr--fx-colors .rr--svg{transition-duration:.2s;transition-timing-function:var(--rr--easing);transition-property:background-color,border-color,fill,stroke}.rr--fx-opacity .rr--off{opacity:.35;transition:opacity var(--rr--easing)}.rr--fx-opacity .rr--on{opacity:1}@media(hover: hover){.rr--fx-opacity .rr--box:hover{opacity:1}}@media(hover: hover){.rr--fx-zoom .rr--box{transition:transform var(--rr--easing);transform:scale(1)}.rr--fx-zoom .rr--box:hover{transform:scale(1.2)}}@media(hover: hover)and (prefers-reduced-motion){.rr--fx-zoom .rr--box:hover{transform:scale(1)}}@media(hover: hover){.rr--fx-position .rr--box{transition:transform var(--rr--easing);transform:translateY(0)}.rr--fx-position .rr--box:hover{transform:translateY(-15%)}}@media(hover: hover)and (prefers-reduced-motion){.rr--fx-position .rr--box:hover{transform:translateY(0)}}.rr--svg-stop-1{stop-color:var(--rr--fill-on-color, rgba(0, 0, 0, 0))}[dir=rtl] .rr--svg-stop-1,.rr--svg-stop-2{stop-color:var(--rr--fill-off-color, rgba(0, 0, 0, 0))}[dir=rtl] .rr--svg-stop-2{stop-color:var(--rr--fill-on-color, rgba(0, 0, 0, 0))}.rr--hf-svg-on{fill:var(--rr--fill-on-color, none)}.rr--hf-svg-off{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--hf-svg-on{stroke:var(--rr--stroke-on-color, currentColor)}.rr--has-stroke .rr--hf-svg-off{stroke:var(--rr--stroke-off-color, currentColor)}.rr--hf-svg-on .rr--svg,.rr--hf-svg-off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--has-border .rr--hf-svg-on .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--has-border .rr--hf-svg-off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}.rr--dir-x .rr--hf-box-int .rr--svg{background:linear-gradient(to right, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}[dir=rtl] .rr--dir-x .rr--hf-box-int .rr--svg{background:linear-gradient(to left, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}.rr--dir-y .rr--hf-box-int .rr--svg{background:linear-gradient(to bottom, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}.rr--hf-box-on .rr--svg{background-color:var(--rr--box-on-color, none)}.rr--hf-box-off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--hf-box-on .rr--svg,.rr--hf-box-off .rr--svg,.rr--hf-box-int .rr--svg{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--hf-box-on .rr--svg,.rr--has-stroke .rr--hf-box-off .rr--svg,.rr--has-stroke .rr--hf-box-int .rr--svg{stroke:var(--rr--stroke-off-color, currentColor)}.rr--has-border .rr--hf-box-on .rr--svg,.rr--has-border .rr--hf-box-int .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--has-border .rr--hf-box-off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}</style><style>.kw-overview-container{box-sizing:border-box;width:673px;padding:0;margin:0;margin-top:14px;font-size:12px;font-family:Figtree;-webkit-font-smoothing:antialiased}.kw-overview-container.youtube{box-sizing:border-box;width:645px;padding:0;margin:0;font-size:12px}</style></head>
<body class="text-slate-700">

    <nav class="bg-white border-b border-slate-100 sticky top-0 z-40 shadow-sm">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6">
                        <div class="flex justify-between h-16 items-center">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                    <span class="material-symbols-outlined text-white text-xl">school</span>
                                </div>
                                <div class="flex flex-col">
                                    <div class="font-bold text-lg text-slate-900">StudyEngine</div>
                                    <div class="text-xs text-slate-500 hidden sm:block">英語學習平台</div>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <button onclick="toggleExportMenu()" class="px-3 py-2 rounded-lg border border-purple-200 bg-purple-50 hover:bg-purple-100 text-purple-700 transition text-sm font-medium flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-lg">bookmark</span>
                                    <span class="hidden sm:inline">Export Words (</span><span class="sm:hidden">(</span><span id="selected-count">0</span><span>)</span>
                                </button>
                                <div id="export-menu" class="hidden absolute top-full right-0 mt-2 bg-white border border-slate-200 rounded-xl shadow-lg z-50 min-w-max overflow-hidden">
                                    <button onclick="copyExportPrompt()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 border-b border-slate-100 flex items-center gap-2 text-sm" title="複製生成AI指令的Prompt">
                                        <span class="material-symbols-outlined text-sm text-blue-600">content_copy</span> <span>複製 Prompt</span>
                                    </button>
                                    <button onclick="exportSelectedWords()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 flex items-center gap-2 text-sm" title="下載選中的生字">
                                        <span class="material-symbols-outlined text-sm text-blue-600">download</span> <span>下載文字檔</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>

    <div class="max-w-7xl mx-auto px-6 py-8 pb-32 space-y-8">
        
        <!-- Video Section (Will be included in export) -->
        <section id="video-section" class="bg-white rounded-2xl p-8 shadow-sm border border-slate-100 learning-card">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold flex items-center gap-3 text-slate-900">
                    <div class="p-2 bg-red-100 rounded-lg">
                        <span class="material-symbols-outlined text-red-600 text-2xl">play_circle</span>
                    </div>
                    影片播放
                </h3>
                <div class="flex items-center gap-2">
                    <button onclick="openModal('video')" class="px-4 py-2 rounded-lg border border-slate-200 bg-slate-50 hover:bg-slate-100 text-slate-700 text-sm font-medium transition flex items-center gap-2">
                        <span class="material-symbols-outlined text-base">edit</span> 更換影片
                    </button>
                    <button onclick="manualToggleSticky()" class="px-4 py-2 rounded-lg border border-blue-200 bg-blue-50 hover:bg-blue-100 text-blue-700 text-sm font-medium transition flex items-center gap-2" title="切換浮動模式">
                        <span class="material-symbols-outlined text-base">picture_in_picture_alt</span> 浮動
                    </button>
                </div>
            </div>
            <div id="video-container" class="relative w-full bg-black rounded-xl overflow-hidden" style="padding-top: 56.25%;">
                <div id="player" class="absolute inset-0"></div>
                <button id="close-sticky-video" class="absolute top-2 right-2 z-10 p-1.5 bg-black/70 hover:bg-black/90 rounded-lg text-white transition hidden">
                </button>
            </div>
            <div id="video-placeholder" class="w-full hidden" style="padding-top: 30%;"></div>
            <p class="text-sm text-slate-600 mt-3">
                點擊時間標籤跳轉到指定時間
            </p>
        </section>

        <!-- Floating close button -->
        <button id="floating-close-btn" class="p-2 bg-white/95 hover:bg-white rounded-full text-slate-700 hover:text-slate-900 shadow-lg hover:shadow-xl transition-all hover:scale-110 hidden">
            <span class="material-symbols-outlined text-xl">close</span>
        </button>

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Transcript -->
            <main class="lg:w-2/3 bg-white p-8 rounded-2xl shadow-lg">
                <div class="flex justify-between items-center mb-6 border-b pb-4">
                    <h2 id="transcript-title" class="text-2xl font-bold text-slate-900">逐字稿</h2>
                    <button onclick="toggleTranslations()" class="px-3 py-2 rounded-lg border border-slate-200 bg-slate-50 hover:bg-slate-100 text-slate-600 text-sm font-medium transition flex items-center gap-2">
                        <span class="material-symbols-outlined text-base">translate</span> <span id="toggle-btn-text">Show CN</span>
                    </button>
                </div>
                
                <div id="transcript-content" class="space-y-8 text-lg leading-relaxed text-slate-700">
                    <div class="mb-6" id="seg-0">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(4)">
                                ⏵ 00:04
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-0" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="0" onchange="setTimeByInput(0)" onkeypress="if(event.key==='Enter') setTimeByInput(0)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-0" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="04" onchange="setTimeByInput(0)" onkeypress="if(event.key==='Enter') setTimeByInput(0)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(0)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-0">So in 2015, a bride-to-be uploaded a picture of a dress to the internet -- (Laughter) And we all lost our minds. If you see this as blue and black, say "Team blue." Audience: Team blue! If you see this as white and gold, how? How do you see that as white and gold? (Laughter) Why does this break our brains so much? It's because it puts us into confrontation with the fact that two minds can perceive the same reality entirely differently.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-0">2015 年，一位準新娘將一張洋裝的照片上傳到網路上——（笑聲）結果我們全都為之瘋狂。如果你看到的是藍色和黑色，請說「藍隊」。觀眾：藍隊！如果你看到的是白色和金色，怎麼會？你怎麼會看成白色和金色？（笑聲）為什麼這會讓我們這麼崩潰？因為這迫使我們面對一個事實：兩個大腦可能對同一個現實有完全不同的感知。</p>
                    </div>
                    <div class="mb-6" id="seg-1">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(34)">
                                ⏵ 00:34
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-1" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="0" onchange="setTimeByInput(1)" onkeypress="if(event.key==='Enter') setTimeByInput(1)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-1" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="34" onchange="setTimeByInput(1)" onkeypress="if(event.key==='Enter') setTimeByInput(1)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(1)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-1">I'd like to talk to you about two things. One, our minds are much more different than we think. And two, you should seek out minds that are different than your own, because that's where the magic happens.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-1">我想跟各位談兩件事。第一，我們的心智差異遠比我們想像的還要大。第二，你應該去尋找與你思維不同的人，因為那才是奇蹟發生的地方。</p>
                    </div>
                    <div class="mb-6" id="seg-2">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(45)">
                                ⏵ 00:45
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-2" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="0" onchange="setTimeByInput(2)" onkeypress="if(event.key==='Enter') setTimeByInput(2)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-2" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="45" onchange="setTimeByInput(2)" onkeypress="if(event.key==='Enter') setTimeByInput(2)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(2)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-2">I get to work with a lot of diverse minds by virtue of what I do. I write and produce scripts for animation on a wide variety of topics, and I create puzzles and games.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-2">由於工作的關係，我有機會與許多不同思維的人共事。我撰寫並製作各種主題的動畫腳本，我也設計謎題和遊戲。</p>
                    </div>
                    <div class="mb-6" id="seg-3">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(57)">
                                ⏵ 00:57
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-3" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="0" onchange="setTimeByInput(3)" onkeypress="if(event.key==='Enter') setTimeByInput(3)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-3" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="57" onchange="setTimeByInput(3)" onkeypress="if(event.key==='Enter') setTimeByInput(3)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(3)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-3">And a few years ago, I had my own dress moment where I realized that my brain works differently than almost everyone I know. And I'd like to show you how.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-3">幾年前，我也經歷了自己的「洋裝時刻」，我意識到我的大腦運作方式與我認識的幾乎所有人都不同。我想向各位展示是怎麼回事。</p>
                    </div>
                    <div class="mb-6" id="seg-4">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(66)">
                                ⏵ 01:06
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-4" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="1" onchange="setTimeByInput(4)" onkeypress="if(event.key==='Enter') setTimeByInput(4)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-4" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="06" onchange="setTimeByInput(4)" onkeypress="if(event.key==='Enter') setTimeByInput(4)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(4)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-4">So if you'll <span class="vocab-word" data-id="indulge" onmouseenter="showCard(event, 'indulge')" onmouseleave="hideCard()" onclick="toggleCard(event, 'indulge')">indulge</span> me for a second, please visualize the following. You can do it with your eyes open or closed, whichever gives you the most vivid mental imagery. A rocket ship crash lands on an alien planet. A creature comes up to the hatch and knocks. And someone opens it from within.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-4">所以，請容許我花一點時間，請各位想像以下的畫面。你可以睜開眼睛或閉上眼睛，只要能產生最生動的心理圖像即可。一艘火箭飛船墜落在一個外星球上。一個生物走近艙門並敲門。然後有人從裡面打開了門。</p>
                    </div>
                    <div class="mb-6" id="seg-5">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(86)">
                                ⏵ 01:26
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-5" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="1" onchange="setTimeByInput(5)" onkeypress="if(event.key==='Enter') setTimeByInput(5)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-5" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="26" onchange="setTimeByInput(5)" onkeypress="if(event.key==='Enter') setTimeByInput(5)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(5)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-5">So now I'm going to ask you some questions about what you just saw. What color was the planet? What kind of creature was it? And who opened the hatch? I'll show you what I see. Nothing. That's because I have a condition called <span class="vocab-word" data-id="aphantasia" onmouseenter="showCard(event, 'aphantasia')" onmouseleave="hideCard()" onclick="toggleCard(event, 'aphantasia')">aphantasia</span>, which is where I don't have access to my mind's eye.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-5">現在我要問你們一些關於剛剛看到的問題。那個星球是什麼顏色的？那是什麼樣的生物？是誰開的艙門？我給各位看看我看到了什麼。什麼都沒有。那是因為我有一種叫做「心盲症」（aphantasia）的狀況，也就是說我無法使用我的「心靈之眼」。</p>
                    </div>
                    <div class="mb-6" id="seg-6">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(108)">
                                ⏵ 01:48
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-6" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="1" onchange="setTimeByInput(6)" onkeypress="if(event.key==='Enter') setTimeByInput(6)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-6" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="48" onchange="setTimeByInput(6)" onkeypress="if(event.key==='Enter') setTimeByInput(6)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(6)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-6">It turns out that the mind's eye is a spectrum. On one end are about two to four percent of us with <span class="vocab-word" data-id="aphantasia" onmouseenter="showCard(event, 'aphantasia')" onmouseleave="hideCard()" onclick="toggleCard(event, 'aphantasia')">aphantasia</span>. And at the other extreme is <span class="vocab-word" data-id="hyperphantasia" onmouseenter="showCard(event, 'hyperphantasia')" onmouseleave="hideCard()" onclick="toggleCard(event, 'hyperphantasia')">hyperphantasia</span>. That's where you can visualize in exquisite detail, sometimes even able to <span class="vocab-word" data-id="superimpose" onmouseenter="showCard(event, 'superimpose')" onmouseleave="hideCard()" onclick="toggleCard(event, 'superimpose')">superimpose</span> what you're imagining on reality. That's about three to six percent of people. Everyone else is somewhere in between.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-6">原來，心靈之眼是一個光譜。在一端是大約 2% 到 4% 有心盲症的人。而在另一個極端則是「超幻像」（hyperphantasia）。這意味著你可以想像出極其精緻的細節，有時甚至能將想像疊加在現實之上。大約有 3% 到 6% 的人屬於這一類。其他人則介於兩者之間。</p>
                    </div>
                    <div class="mb-6" id="seg-7">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(128)">
                                ⏵ 02:08
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-7" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="2" onchange="setTimeByInput(7)" onkeypress="if(event.key==='Enter') setTimeByInput(7)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-7" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="08" onchange="setTimeByInput(7)" onkeypress="if(event.key==='Enter') setTimeByInput(7)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(7)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-7">But there's a huge range of experience here. Everyone I do this with not only describes something different but describes the experience of experiencing it differently. So I went through most of my life assuming that most people were or everyone was like me, that a visualization exercise like this is a figure of speech that no one could actually do.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-7">但這裡存在著巨大的體驗差異。每個和我一起做這個練習的人，不僅描述的東西不同，連「體驗」這件事本身的感受也不同。所以我這輩子大部分時間都以為大多數人，或者每個人都跟我一樣，以為像這樣的視覺化練習只是一種修辭比喻，沒有人真的能做到。</p>
                    </div>
                    <div class="mb-6" id="seg-8">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(150)">
                                ⏵ 02:30
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-8" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="2" onchange="setTimeByInput(8)" onkeypress="if(event.key==='Enter') setTimeByInput(8)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-8" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="30" onchange="setTimeByInput(8)" onkeypress="if(event.key==='Enter') setTimeByInput(8)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(8)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-8">So imagine my surprise and fascination and <span class="vocab-word" data-id="apprehension" onmouseenter="showCard(event, 'apprehension')" onmouseleave="hideCard()" onclick="toggleCard(event, 'apprehension')">apprehension</span> when I learned about <span class="vocab-word" data-id="aphantasia" onmouseenter="showCard(event, 'aphantasia')" onmouseleave="hideCard()" onclick="toggleCard(event, 'aphantasia')">aphantasia</span>, the last, because it raised some scary questions like, have I been working in entirely the wrong careers my entire life? (Laughter)</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-8">所以想像一下，當我得知心盲症時，我是多麼驚訝、著迷又恐慌，尤其是最後一點，因為它引發了一些可怕的問題，比如：我這輩子是不是完全選錯了職業？（笑聲）</p>
                    </div>
                    <div class="mb-6" id="seg-9">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(163)">
                                ⏵ 02:43
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-9" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="2" onchange="setTimeByInput(9)" onkeypress="if(event.key==='Enter') setTimeByInput(9)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-9" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="43" onchange="setTimeByInput(9)" onkeypress="if(event.key==='Enter') setTimeByInput(9)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(9)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-9">So <span class="vocab-word" data-id="aphantasia" onmouseenter="showCard(event, 'aphantasia')" onmouseleave="hideCard()" onclick="toggleCard(event, 'aphantasia')">aphantasia</span> changes the way that those of us who have it perceive information and consume and process information. So, for example, most people I speak to who have a mind's eye describe the experience of reading a novel as seeing scenes play out in their mind and casting characters. I can't do either of those things. It's a much more conceptual experience for me.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-9">心盲症改變了我們感知、吸收和處理資訊的方式。例如，大多數有心靈之眼的人告訴我，讀小說時，腦海中會上演場景，甚至會為角色選角。這兩件事我都做不到。對我來說，那更像是一種概念性的體驗。</p>
                    </div>
                    <div class="mb-6" id="seg-10">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(187)">
                                ⏵ 03:07
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-10" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="3" onchange="setTimeByInput(10)" onkeypress="if(event.key==='Enter') setTimeByInput(10)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-10" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="07" onchange="setTimeByInput(10)" onkeypress="if(event.key==='Enter') setTimeByInput(10)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(10)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-10">And when something is out of sight, it's very much out of mind. I have a five-year-old daughter. I can't in this moment imagine her face. That has a big effect on my memory. And it's also not just my mind's eye, it's also my mind's ear, though I think I have a little bit of a mind's ear, but I don't have a mind's nose or a mind's mouth. I can't, for example, imagine the taste of peanut butter.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-10">當東西不在視線範圍內，我就真的想不起來。我有個五歲的女兒。此時此刻我無法想像她的臉。這對我的記憶力有很大的影響。而且不只是心靈之眼，還有心靈之耳，雖然我覺得我有一點點心靈之耳，但我沒有心靈之鼻或心靈之口。舉例來說，我無法想像花生醬的味道。</p>
                    </div>
                    <div class="mb-6" id="seg-11">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(212)">
                                ⏵ 03:32
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-11" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="3" onchange="setTimeByInput(11)" onkeypress="if(event.key==='Enter') setTimeByInput(11)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-11" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="32" onchange="setTimeByInput(11)" onkeypress="if(event.key==='Enter') setTimeByInput(11)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(11)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-11">And what's it like to think in the absence of a mind's eye? It's a really tough question that's not that far off from asking what's it like to be a dolphin or a spider? And in the absence of being able to inhabit each other's consciousnesses, we can communicate about them.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-11">那麼，在沒有心靈之眼的情況下思考是什麼感覺？這是一個非常難回答的問題，就跟問當一隻海豚或蜘蛛是什麼感覺差不多。既然我們無法棲居在彼此的意識中，我們可以試著溝通。</p>
                    </div>
                    <div class="mb-6" id="seg-12">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(228)">
                                ⏵ 03:48
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-12" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="3" onchange="setTimeByInput(12)" onkeypress="if(event.key==='Enter') setTimeByInput(12)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-12" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="48" onchange="setTimeByInput(12)" onkeypress="if(event.key==='Enter') setTimeByInput(12)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(12)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-12">So for me, I'm generally much more aware of something's skeleton than its skin. I'm very <span class="vocab-word" data-id="attuned" onmouseenter="showCard(event, 'attuned')" onmouseleave="hideCard()" onclick="toggleCard(event, 'attuned')">attuned</span> to structure. When I'm creating a game or a puzzle, I'm first dreaming up the mechanics and figuring out how they relate to each other, how they map to a story structure. And the details come later, often in collaboration with other artists.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-12">對我來說，我通常更注意到事物的骨架而非皮膚。我對結構非常敏感。當我在設計遊戲或謎題時，我首先構思的是機制，弄清楚它們彼此之間的關係，以及如何對應到故事結構。細節是後來才加上去的，通常是與其他藝術家合作完成。</p>
                    </div>
                    <div class="mb-6" id="seg-13">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(247)">
                                ⏵ 04:07
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-13" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="4" onchange="setTimeByInput(13)" onkeypress="if(event.key==='Enter') setTimeByInput(13)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-13" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="07" onchange="setTimeByInput(13)" onkeypress="if(event.key==='Enter') setTimeByInput(13)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(13)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-13">I realize there's a leap of faith here in this idea that our minds can be so alien to each other, and I struggle with that, too. I can't understand what it's like to visualize any more than I can see the dress as white and gold.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-13">我意識到要相信我們的心智彼此之間如此陌生，需要一點信念的飛躍，我也很難接受這點。我無法理解視覺化是什麼感覺，就像我無法把那件洋裝看成白色和金色一樣。</p>
                    </div>
                    <div class="mb-6" id="seg-14">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(261)">
                                ⏵ 04:21
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-14" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="4" onchange="setTimeByInput(14)" onkeypress="if(event.key==='Enter') setTimeByInput(14)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-14" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="21" onchange="setTimeByInput(14)" onkeypress="if(event.key==='Enter') setTimeByInput(14)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(14)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-14">But what's become increasingly apparent is that the mind's eye is just one of many constellations we're starting to draw in a night sky full of neurological diversity. That includes having or not having an interior monologue. It includes the autism spectrum, ADHD, dyslexia and a lot more. Probably a lot of things we have yet to even give a name to because we're just figuring all of this out.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-14">但越來越明顯的是，心靈之眼只是我們開始在充滿神經多樣性的夜空中描繪出的眾多星座之一。這包括有沒有內心獨白。這包括自閉症光譜、過動症（ADHD）、閱讀障礙等等。可能還有很多我們尚未命名的特質，因為我們才剛剛開始了解這一切。</p>
                    </div>
                    <div class="mb-6" id="seg-15">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(285)">
                                ⏵ 04:45
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-15" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="4" onchange="setTimeByInput(15)" onkeypress="if(event.key==='Enter') setTimeByInput(15)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-15" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="45" onchange="setTimeByInput(15)" onkeypress="if(event.key==='Enter') setTimeByInput(15)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(15)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-15">The norm is to <span class="vocab-word" data-id="pathologize" onmouseenter="showCard(event, 'pathologize')" onmouseleave="hideCard()" onclick="toggleCard(event, 'pathologize')">pathologize</span> these experiences into a list of conditions that depart from a so-called "normal" functioning of the mind. I think we're thinking about this completely wrong. There is no true normal out there, and difference is not <span class="vocab-word" data-id="deviance" onmouseenter="showCard(event, 'deviance')" onmouseleave="hideCard()" onclick="toggleCard(event, 'deviance')">deviance</span>. Rather, these are all clues towards a vast and profound star field we're each individually blinded to because we only have our one cozy, inescapable mind as a single reference point.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-15">通常的做法是將這些經驗病理化，列為偏離所謂「正常」心智運作的症狀。我認為我們完全想錯了。世上沒有真正的正常，差異並不是異常。相反地，這些都是通往廣闊深邃星域的線索，只是我們每個人都看不見，因為我們只有自己這一個舒適、無法逃脫的心智作為唯一的參考點。</p>
                    </div>
                    <div class="mb-6" id="seg-16">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(311)">
                                ⏵ 05:11
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-16" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="5" onchange="setTimeByInput(16)" onkeypress="if(event.key==='Enter') setTimeByInput(16)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-16" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="11" onchange="setTimeByInput(16)" onkeypress="if(event.key==='Enter') setTimeByInput(16)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(16)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-16">It's no secret that different people think differently. Many people on the autism spectrum excel at pattern recognition and logical deduction. Multiple studies have shown students with ADHD outperforming, on average, their peers, at creative problem solving and <span class="vocab-word" data-id="divergent" onmouseenter="showCard(event, 'divergent')" onmouseleave="hideCard()" onclick="toggleCard(event, 'divergent')">divergent</span> thinking tasks, and there are very similar findings for dyslexia, especially when it comes to advanced spatial reasoning.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-16">不同的人有不同的思考方式，這已不是秘密。許多自閉症光譜上的人擅長模式識別和邏輯推演。多項研究顯示，患有 ADHD 的學生在創造性解決問題和發散性思維任務上的表現，平均優於同齡人；對於閱讀障礙也有類似的發現，特別是在高階空間推理方面。</p>
                    </div>
                    <div class="mb-6" id="seg-17">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(333)">
                                ⏵ 05:33
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-17" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="5" onchange="setTimeByInput(17)" onkeypress="if(event.key==='Enter') setTimeByInput(17)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-17" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="33" onchange="setTimeByInput(17)" onkeypress="if(event.key==='Enter') setTimeByInput(17)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(17)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-17">So if difference is in fact the norm, what do we do with that? I say seek out minds that are different than your own and make something incredible together. There's a wealth of research that shows that teams of people from diverse backgrounds produce superior outcomes. I'd like to propose a <span class="vocab-word" data-id="corollary" onmouseenter="showCard(event, 'corollary')" onmouseleave="hideCard()" onclick="toggleCard(event, 'corollary')">corollary</span> to this: diverse minds working together can produce wonders.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-17">那麼，如果差異其實才是常態，我們該怎麼辦？我說，去尋找那些與你思維不同的人，一起創造出不可思議的事物。已有大量研究顯示，來自不同背景的團隊能產出更優異的成果。我想對此提出一個推論：不同的心智共同合作，可以創造奇蹟。</p>
                    </div>
                    <div class="mb-6" id="seg-18">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(356)">
                                ⏵ 05:56
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-18" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="5" onchange="setTimeByInput(18)" onkeypress="if(event.key==='Enter') setTimeByInput(18)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-18" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="56" onchange="setTimeByInput(18)" onkeypress="if(event.key==='Enter') setTimeByInput(18)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(18)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-18">This comes with challenges and opportunities. So in the last decade or so, companies such as SAP, Hewlett Packard and JPMorgan have started programs designed to recruit neurodivergent talent. And in the time since, they've reported corresponding gains in productivity, morale, innovation and quality.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-18">這伴隨著挑戰與機遇。在過去十年左右，像 SAP、惠普（Hewlett Packard）和摩根大通（JPMorgan）這樣的公司已經啟動了招募神經多樣性人才的計畫。從那時起，他們報告了在生產力、士氣、創新和品質方面的相應增長。</p>
                    </div>
                    <div class="mb-6" id="seg-19">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(376)">
                                ⏵ 06:16
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-19" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="6" onchange="setTimeByInput(19)" onkeypress="if(event.key==='Enter') setTimeByInput(19)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-19" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="16" onchange="setTimeByInput(19)" onkeypress="if(event.key==='Enter') setTimeByInput(19)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(19)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-19">I see this in my own work as well. Again, by the <span class="vocab-word" data-id="serendipity" onmouseenter="showCard(event, 'serendipity')" onmouseleave="hideCard()" onclick="toggleCard(event, 'serendipity')">serendipity</span> of working in visual fields without being able to visualize, I wind up working with a lot of minds who are very different than mine. And that results in some weird and wonderful work, such as a film noir animation about fractals that I coauthored that was brought to life by a brilliant hyperphantasic animator named Jeremiah Dickey.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-19">我在自己的工作中也看到了這一點。同樣地，機緣巧合下，我在無法視覺化的情況下從事視覺領域的工作，結果我常與思維方式與我截然不同的人共事。這產生了一些怪異而美妙的作品，例如我合寫的一部關於碎形的黑色電影風格動畫，由一位才華洋溢、擁有超幻像能力的動畫師 Jeremiah Dickey 賦予了生命。</p>
                    </div>
                    <div class="mb-6" id="seg-20">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(401)">
                                ⏵ 06:41
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-20" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="6" onchange="setTimeByInput(20)" onkeypress="if(event.key==='Enter') setTimeByInput(20)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-20" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="41" onchange="setTimeByInput(20)" onkeypress="if(event.key==='Enter') setTimeByInput(20)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(20)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-20">Or this is one of my pride and joys. It's a game that's a hybrid jigsaw puzzle and escape room in a box. And the way it works -- yeah. (Laughter) The way it works is you first assemble a jigsaw, but you're missing big sections, so you have to unlock them by solving puzzles that are embedded in the illustration and artifacts that you unlock along the way.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-20">或者這也是我引以為傲的作品之一。這是一個結合了拼圖和盒裝密室逃脫的遊戲。它的玩法是——對。（笑聲）它的玩法是你首先要拼拼圖，但你會缺少一大塊區域，所以你必須透過解決嵌入在插圖中的謎題，以及沿途解鎖的物品來解鎖這些區域。</p>
                    </div>
                    <div class="mb-6" id="seg-21">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(425)">
                                ⏵ 07:05
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-21" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="7" onchange="setTimeByInput(21)" onkeypress="if(event.key==='Enter') setTimeByInput(21)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-21" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="05" onchange="setTimeByInput(21)" onkeypress="if(event.key==='Enter') setTimeByInput(21)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(21)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-21">This was made in collaboration with two incredible artists, Rita Orlov and Senne Trip, and our minds can be found in very different corners of the galaxy of neurological diversity.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-21">這是與兩位不可思議的藝術家 Rita Orlov 和 Senne Trip 合作完成的，我們的心智位於神經多樣性銀河中截然不同的角落。</p>
                    </div>
                    <div class="mb-6" id="seg-22">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(435)">
                                ⏵ 07:15
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-22" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="7" onchange="setTimeByInput(22)" onkeypress="if(event.key==='Enter') setTimeByInput(22)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-22" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="15" onchange="setTimeByInput(22)" onkeypress="if(event.key==='Enter') setTimeByInput(22)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(22)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-22">So am I working in the wrong fields? No, I don't think so. I think I'm exactly where I should be. In fact, some of the greatest joy and fulfillment in my life has been from coming to terms with the initially <span class="vocab-word" data-id="jarring" onmouseenter="showCard(event, 'jarring')" onmouseleave="hideCard()" onclick="toggleCard(event, 'jarring')">jarring</span> realization that my mind works differently than the people around me, and recognizing that for what it is -- dazzling. Thank you.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-22">所以我選錯行了嗎？不，我不這麼認為。我覺得我正處於我該在的地方。事實上，我生命中最大的快樂和滿足感，部分來自於接受了「我的大腦運作方式與周遭人不同」這個最初令人震驚的體悟，並認清它的本質——那是令人眩目的。謝謝。</p>
                    </div></div>
            </main>

            <!-- Vocab + Quiz Sidebar -->
            <aside class="lg:w-1/3">
                <div class="sticky top-24 space-y-6">
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 learning-card p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="font-bold text-xl flex items-center gap-3 text-slate-900">
                                <div class="p-2 bg-amber-100 rounded-lg">
                                    <span class="material-symbols-outlined text-amber-600 text-2xl">verified</span>
                                </div>
                                詞彙表
                                <span class="text-sm bg-slate-200 px-2.5 py-1 rounded-full font-semibold" id="vocab-count">12</span>
                            </h3>
                            <button onclick="showAddVocabModal()" class="text-blue-600 hover:bg-blue-50 rounded-full p-2 transition hover:scale-110" title="新增生字">
                                <span class="material-symbols-outlined text-2xl">add_circle</span>
                            </button>
                        </div>
                        <ul id="vocab-list" class="divide-y max-h-[60vh] overflow-y-auto">
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('aphantasia')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">1.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Aphantasia</div>
                                    <button onclick="event.stopPropagation(); speakWord('Aphantasia')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˌeɪ.fænˈteɪ.ʒə/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A neurological condition characterized by the inability to voluntarily create mental images in one's mind.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">心盲症 (無法在腦海中進行視覺想像的狀況)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('apprehension')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">2.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Apprehension</div>
                                    <button onclick="event.stopPropagation(); speakWord('Apprehension')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˌæp.rəˈhen.ʃən/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Anxiety or fear that something bad or unpleasant will happen.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">憂慮；恐懼 (擔心自己職業生涯受影響)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('attuned')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">3.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Attuned</div>
                                    <button onclick="event.stopPropagation(); speakWord('Attuned')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/əˈtuːnd/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Receptive or aware; accustomed to or harmonious with something.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">敏銳的；能理解的 (此處指對結構特別敏感)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('corollary')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">4.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Corollary</div>
                                    <button onclick="event.stopPropagation(); speakWord('Corollary')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈkɔːr.ə.ler.i/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A proposition that follows from (and is often appended to) one already proved.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">推論；必然的結果</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('deviance')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">5.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Deviance</div>
                                    <button onclick="event.stopPropagation(); speakWord('Deviance')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈdiː.vi.əns/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">The fact or state of departing from usual or accepted standards, especially in social or sexual behavior.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">異常；越軌 (強調與常態不同並非壞事)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('divergent')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">6.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Divergent</div>
                                    <button onclick="event.stopPropagation(); speakWord('Divergent')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/dɪˈvɝː.dʒənt/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Tending to be different or develop in different directions; used in 'divergent thinking' for creative idea generation.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">發散的；分歧的 (指發散性思考，即能提出多種解決方案的能力)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('hyperphantasia')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">7.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Hyperphantasia</div>
                                    <button onclick="event.stopPropagation(); speakWord('Hyperphantasia')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˌhaɪ.pər.fænˈteɪ.ʒə/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6"> The condition of having extremely vivid mental imagery, often indistinguishable from reality.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">超幻像 (擁有極度清晰、生動的心理視覺成像能力)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('indulge')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">8.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Indulge</div>
                                    <button onclick="event.stopPropagation(); speakWord('Indulge')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ɪnˈdʌldʒ/</div>
                                <div class="text-xs text-slate-500 mt-0.5">verb</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">To allow oneself or someone else to enjoy a particular pleasure or privilege, often used in requests.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">遷就；縱容 (此處指講者請求聽眾暫時配合做想像練習)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('jarring')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">9.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Jarring</div>
                                    <button onclick="event.stopPropagation(); speakWord('Jarring')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈdʒɑːr.ɪŋ/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Causing a physical shock, jolt, or vibration; incongruous in a striking or shocking way.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">令人震驚的；刺耳的；不和諧的</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('pathologize')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">10.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Pathologize</div>
                                    <button onclick="event.stopPropagation(); speakWord('Pathologize')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/pəˈθɑː.lə.dʒaɪz/</div>
                                <div class="text-xs text-slate-500 mt-0.5">verb</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">To regard or treat a condition or behavior as medically or psychologically abnormal.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">病理化 (將某種特質視為疾病或異常狀況)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('serendipity')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">11.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Serendipity</div>
                                    <button onclick="event.stopPropagation(); speakWord('Serendipity')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˌser.ənˈdɪp.ə.t̬i/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">The occurrence and development of events by chance in a happy or beneficial way.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">機緣巧合；意外發現珍寶的運氣</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('superimpose')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">12.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Superimpose</div>
                                    <button onclick="event.stopPropagation(); speakWord('Superimpose')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˌsuː.pɚ.ɪmˈpoʊz/</div>
                                <div class="text-xs text-slate-500 mt-0.5">verb</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">To place or lay one thing over another, typically so that both are still evident.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">疊加 (將影像疊在現實場景之上)</div>
                    </li></ul>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-600 rounded-2xl p-8 shadow-lg text-white learning-card">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="p-2 bg-white/20 rounded-lg">
                                <span class="material-symbols-outlined text-2xl">quiz</span>
                            </div>
                            <h3 class="font-bold text-xl">知識檢測</h3>
                        </div>
                        <p class="text-blue-100 text-sm mb-6 leading-relaxed">通過測驗鞏固所學，評估學習進度。</p>
                        <button onclick="openQuiz()" class="w-full bg-white text-blue-600 py-3 px-4 rounded-xl font-bold shadow-md hover:shadow-lg hover:bg-blue-50 transition transform hover:scale-[1.02] flex justify-center items-center gap-2">
                            <span class="material-symbols-outlined">play_circle</span>
                            <span>開始測驗</span>
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Mobile Floating Action Button for Quiz -->
    <button onclick="openQuiz()" class="lg:hidden fixed bottom-20 right-6 bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-4 rounded-full shadow-xl hover:shadow-2xl hover:scale-110 z-50 flex items-center justify-center transition">
        <span class="material-symbols-outlined text-2xl">quiz</span>
    </button>

    <!-- Bottom Control Bar (Will be kept in export) -->
    <div id="bottom-controls" class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 shadow-lg z-40 px-3 py-3">
        <div class="flex flex-nowrap justify-center gap-2">
            <button id="play-pause-btn" onclick="togglePlayPause()" class="flex items-center gap-1.5 px-4 py-3 rounded-lg bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold shadow-md hover:shadow-lg active:scale-95 transition-all min-h-[44px]">
                <span class="material-symbols-outlined text-xl" id="play-icon">play_arrow</span>
                <span id="play-text" class="hidden sm:inline text-sm">播放</span>
            </button>
            
            <div class="flex items-center rounded-xl border border-slate-300 bg-slate-100 overflow-hidden min-h-[44px]">
                <button onclick="decreaseFontSize()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-200 active:bg-slate-300 transition">
                    <span class="material-symbols-outlined text-lg">text_decrease</span>
                </button>
                <div class="w-px h-8 bg-slate-300"></div>
                <button onclick="increaseFontSize()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-200 active:bg-slate-300 transition">
                    <span class="material-symbols-outlined text-lg">text_increase</span>
                </button>
            </div>
            
            <div class="flex items-center rounded-xl border border-slate-300 bg-white overflow-hidden min-h-[44px]">
                <button onclick="decreasePlaybackSpeed()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-100 active:bg-slate-200 transition">
                    <span class="material-symbols-outlined text-lg">remove</span>
                </button>
                <div class="w-px h-8 bg-slate-300"></div>
                <div class="flex items-center px-3 py-3 text-sm font-bold min-w-[50px] justify-center text-slate-700">
                    <span id="speed-display">1.0x</span>
                </div>
                <div class="w-px h-8 bg-slate-300"></div>
                <button onclick="increasePlaybackSpeed()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-100 active:bg-slate-200 transition">
                    <span class="material-symbols-outlined text-lg">add</span>
                </button>
            </div>
            
            <button onclick="toggleTranslations()" class="flex items-center px-4 py-3 rounded-lg border border-blue-300 bg-blue-50 text-blue-700 text-sm font-medium active:bg-blue-100 hover:bg-blue-100 transition min-h-[44px]">
                <span class="material-symbols-outlined text-lg">translate</span> <span id="cn-toggle-text">中文</span>
            </button>
            <button onclick="resetSettings()" class="hidden sm:block px-4 py-3 rounded-lg border border-slate-300 bg-slate-50 text-slate-600 text-sm font-medium hover:bg-slate-100 active:bg-slate-200 transition min-h-[44px]">
                <span class="material-symbols-outlined text-lg">restart_alt</span>
            </button>
        </div>
    </div>

    <!-- Floating Card -->
    <div id="floating-card" class="fixed bg-white rounded-xl shadow-2xl w-80 border z-50 hidden" data-current-id="" style="left: 556.023px; top: 195.375px;">
                <div class="p-4">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="text-xl font-bold flex-1">Serendipity</h3>
                        <button onclick="event.stopPropagation(); speakWord('Serendipity')" class="ml-2 p-2 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 transition" title="播放發音">
                            <span class="material-symbols-outlined text-lg">volume_up</span>
                        </button>
                    </div>
                    <div class="text-xs text-slate-500 mb-1">noun</div>
                    <div class="text-xs text-blue-600 font-semibold mb-3">/ˌser.ənˈdɪp.ə.t̬i/</div>
                    <p class="text-sm mb-3">The occurrence and development of events by chance in a happy or beneficial way.</p>
                    <p class="text-xs text-blue-700 font-bold">機緣巧合；意外發現珍寶的運氣</p>
                </div></div>

    <!-- Selection Popup -->
    <div id="selection-popup" class="fixed bg-purple-600 text-white px-4 py-2 rounded-lg shadow-xl z-50 text-sm font-semibold cursor-pointer hover:bg-purple-700 active:scale-95 transition-all hidden" style="left: -60px; top: -45px;">
        <span class="material-symbols-outlined text-base" style="vertical-align: middle;">add_circle</span> 加入生字
    </div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="fixed inset-0 z-[60] bg-slate-900/80 backdrop-blur-sm flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden">
            <div class="p-6 border-b border-gray-100 bg-gray-50">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-blue-600">psychology</span>
                        <h3 class="text-xl font-bold text-slate-800">Knowledge Check</h3>
                    </div>
                    <button onclick="closeQuiz()" class="text-gray-400 hover:text-gray-600 hover:bg-gray-200 rounded-full p-1 transition"><span class="material-symbols-outlined">close</span></button>
                </div>
                <div id="quiz-language-selector" class="flex items-center gap-2 p-3 bg-white border-2 border-slate-200 rounded-lg">
                    <span class="text-sm font-semibold text-slate-700">Quiz Language:</span>
                    <button onclick="selectQuizLanguage('english')" class="px-4 py-2 rounded-lg text-sm font-semibold border-2 transition bg-white text-slate-700 border-slate-300" id="quiz-select-en">
                        <span class="material-symbols-outlined text-sm align-middle">language</span> English
                    </button>
                    <button onclick="selectQuizLanguage('chinese')" class="px-4 py-2 rounded-lg text-sm font-semibold border-2 transition bg-blue-600 text-white border-blue-600" id="quiz-select-zh">
                        <span class="material-symbols-outlined text-sm align-middle">translate</span> 中文
                    </button>
                </div>
            </div>
            <div id="quiz-content" class="p-8 overflow-y-auto space-y-8 bg-white">
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors bg-red-50/50 border-red-200" id="q-block-0">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">1</span>
                        根據講者所述，當被要求想像火箭墜毀的畫面時，她在腦海中看到了什麼？
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q0" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">一個像電影般高度細節化的場景</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q0" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">一個模糊的船艦輪廓</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q0" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">完全沒有任何畫面</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q0" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">她女兒的臉龐</span>
                            </label>
                        
                    </div>
                    <div class="feedback mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2 bg-red-100 text-red-700"><span class="material-symbols-outlined">cancel</span> Incorrect. The correct answer is: <span class="italic">完全沒有任何畫面</span></div>
                </div>
            
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors bg-red-50/50 border-red-200" id="q-block-1">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">2</span>
                        由於她的狀況，講者如何描述她設計遊戲和謎題的方式？
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q1" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">她首先專注於機制和結構（骨架）</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q1" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">她從繪製詳細的角色（皮膚）開始</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q1" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">她完全依賴電腦軟體來產生點子</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q1" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">她避免設計視覺謎題，只寫純文字的謎語</span>
                            </label>
                        
                    </div>
                    <div class="feedback mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2 bg-red-100 text-red-700"><span class="material-symbols-outlined">cancel</span> Incorrect. The correct answer is: <span class="italic">她首先專注於機制和結構（骨架）</span></div>
                </div>
            
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors bg-green-50/50 border-green-200" id="q-block-2">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">3</span>
                        為什麼講者在演講開始時要使用著名的「藍黑洋裝」照片？
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q2" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">為了證明她的色彩視覺比觀眾優秀</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q2" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">為了說明兩個大腦可以對同一現實產生完全不同的感知</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q2" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">為了解釋光線和光譜的物理科學</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q2" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">為了展示她為遊戲設計的一個謎題範例</span>
                            </label>
                        
                    </div>
                    <div class="feedback mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2 bg-green-100 text-green-700"><span class="material-symbols-outlined">check_circle</span> Correct!</div>
                </div>
            
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors bg-red-50/50 border-red-200" id="q-block-3">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">4</span>
                        根據文章內容，關於 SAP 和 Hewlett Packard 等公司的企業計畫，暗示了什麼？
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q3" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">由於溝通問題，他們停止招募神經多樣性人才</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q3" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">他們只僱用患有失像症的人以節省視覺設計費用</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q3" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">他們發現招募神經多樣性人才帶來了生產力和創新的提升</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q3" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">他們的目標是治癒員工的 ADHD 和閱讀障礙等狀況</span>
                            </label>
                        
                    </div>
                    <div class="feedback mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2 bg-red-100 text-red-700"><span class="material-symbols-outlined">cancel</span> Incorrect. The correct answer is: <span class="italic">他們發現招募神經多樣性人才帶來了生產力和創新的提升</span></div>
                </div>
            
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors bg-red-50/50 border-red-200" id="q-block-4">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">5</span>
                        對於社會通常如何對待 ADHD、自閉症和閱讀障礙等狀況，講者提出了什麼批判性評估？
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q4" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">社會正確地將它們視為需要修復的疾病</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q4" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">社會錯誤地將它們視為偏離「正常」心智的病態，而不是將其視為多樣性</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q4" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">社會完全忽視它們，沒有為學生提供任何支持</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q4" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">社會高估了患有這些狀況的人的創造能力</span>
                            </label>
                        
                    </div>
                    <div class="feedback mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2 bg-red-100 text-red-700"><span class="material-symbols-outlined">cancel</span> Incorrect. The correct answer is: <span class="italic">社會錯誤地將它們視為偏離「正常」心智的病態，而不是將其視為多樣性</span></div>
                </div>
            
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors bg-red-50/50 border-red-200" id="q-block-5">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">6</span>
                        講者關於「專業合作」的核心論點是什麼？
                    </p>
                    <div class="space-y-3 pl-9">
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q5" value="0" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">人們應該只與思考方式完全相同的人一起工作，以避免衝突</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q5" value="1" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">視覺藝術家是任何創意團隊中最重要的成員</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q5" value="2" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">失像症是一種妨礙人們在創意領域工作的殘疾</span>
                            </label>
                        
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q5" value="3" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">結合不同的思維模式——那些運作方式不同的大腦——能產生更卓越且「神奇」的成果</span>
                            </label>
                        
                    </div>
                    <div class="feedback mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2 bg-red-100 text-red-700"><span class="material-symbols-outlined">cancel</span> Incorrect. The correct answer is: <span class="italic">結合不同的思維模式——那些運作方式不同的大腦——能產生更卓越且「神奇」的成果</span></div>
                </div>
            </div>
            <div id="quiz-footer" class="p-6 border-t border-gray-100 bg-gray-50 flex justify-end">
                    <div class="flex items-center gap-4 w-full justify-between">
                        <div>
                            <p class="text-sm text-gray-500 uppercase tracking-wider font-bold">Your Score</p>
                            <p class="text-2xl font-bold text-orange-500">1 / 6 - Keep Practicing! 💪</p>
                        </div>
                        <button onclick="closeQuiz()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-900 transition">Close</button>
                    </div></div>
        </div>
    </div>

    <!-- Add Vocab Modal -->
    <div id="add-vocab-modal" class="modal hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl w-full max-w-3xl flex flex-col h-[80vh]">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg">新增生字</h3>
                <button onclick="closeAddVocabModal()" class="text-gray-400 hover:text-gray-700 rounded p-1">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="p-4 flex-1 flex flex-col gap-3">
                <div id="add-vocab-hint" class="bg-blue-50 text-blue-800 p-3 rounded text-xs">
                    格式：[{ "word": "...", "def": "...", "pos": "n." }, ...]
                </div>
                <textarea id="add-vocab-input" class="flex-1 border rounded p-4 font-mono text-xs resize-none" placeholder="[{&quot;word&quot;:&quot;Example&quot;,&quot;def&quot;:&quot;範例&quot;,&quot;pos&quot;:&quot;n.&quot;}]"></textarea>
            </div>
            
            <div class="p-4 border-t flex justify-between gap-3">
                <div></div>
                <div class="flex gap-3">
                    <button onclick="closeAddVocabModal()" class="px-4 py-2 rounded border border-slate-300 hover:bg-slate-50 font-medium">Cancel</button>
                    <button onclick="addNewVocabFromJSON()" class="bg-indigo-600 text-white px-6 py-2 rounded font-bold hover:bg-indigo-700">Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->

    <div id="edit-modal" class="modal hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl w-full max-w-4xl flex flex-col h-[85vh]">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg">編輯逐字稿段落</h3>
                <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-700 rounded p-1">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="p-6 flex-1 flex flex-col gap-4 overflow-y-auto">
                <div class="flex-1 flex flex-col">
                    <label class="font-semibold mb-2 text-sm text-slate-700">英文內容</label>
                    <textarea id="edit-en-input" class="flex-1 border-2 border-slate-300 rounded-lg p-4 font-sans text-base resize-none focus:border-blue-500 focus:outline-none min-h-[200px]" placeholder="輸入英文內容..."></textarea>
                </div>
                
                <div class="flex-1 flex flex-col">
                    <label class="font-semibold mb-2 text-sm text-slate-700">中文翻譯</label>
                    <textarea id="edit-cn-input" class="flex-1 border-2 border-slate-300 rounded-lg p-4 font-sans text-base resize-none focus:border-blue-500 focus:outline-none min-h-[200px]" placeholder="輸入中文翻譯（可選）..."></textarea>
                </div>
            </div>
            
            <div class="p-4 border-t flex justify-end gap-3">
                <button onclick="closeEditModal()" class="px-6 py-2.5 rounded-lg border border-slate-300 hover:bg-slate-50 font-medium">取消</button>
                <button onclick="saveEdit()" class="bg-blue-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-blue-700">儲存</button>
            </div>
        </div>
    </div>

    <!-- Insert Transcript Modal -->
    <div id="insert-modal" class="modal hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl w-full max-w-3xl flex flex-col h-[80vh]">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg">從段落 <span id="insert-segment-index"></span> 插入逐字稿</h3>
                <div class="flex items-center gap-2">
                    <button id="copy-insert-prompt-btn" onclick="copyInsertPrompt()" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 hover:border-indigo-300 text-xs font-semibold transition" title="複製 AI Prompt">
                        <span class="material-symbols-outlined text-sm">auto_awesome</span>
                        AI Prompt
                    </button>
                    <button onclick="closeInsertModal()" class="text-gray-400 hover:text-gray-700 rounded p-1">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
            </div>
            
            <div class="p-4 flex-1 flex flex-col gap-3">
                <div class="bg-purple-50 text-purple-800 p-3 rounded text-xs">
                    格式：[{ "en": "...", "cn": "...", "t": 0 }, ...]<br>
                    <strong>注意：</strong>此功能會從選定的段落開始，用新資料<strong>取代</strong>之後所有段落，但保留之前的段落。
                </div>
                <textarea id="insert-input" class="flex-1 border rounded p-4 font-mono text-xs resize-none" placeholder="[{&quot;en&quot;:&quot;Hello&quot;,&quot;cn&quot;:&quot;你好&quot;,&quot;t&quot;:0}]"></textarea>
            </div>
            
            <div class="p-4 border-t flex justify-end gap-3">
                <button onclick="closeInsertModal()" class="px-4 py-2 rounded hover:bg-gray-100">Cancel</button>
                <button onclick="insertTranscriptFromIndex()" class="bg-purple-600 text-white px-6 py-2 rounded font-bold hover:bg-purple-700">插入逐字稿</button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="import-modal" class="modal fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-2xl w-full max-w-3xl flex flex-col h-[80vh]">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg" id="modal-title">匯入 Quiz（雙語格式）</h3>
                <div class="flex items-center gap-2">
                    <button id="copy-cefr-prompt-btn" onclick="openCEFRLevelSelector()" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-rose-200 bg-rose-50 text-rose-700 hover:bg-rose-100 hover:border-rose-300 text-xs font-semibold transition hidden" title="複製 CEFR 難度調整 Prompt">
                        <span class="material-symbols-outlined text-sm">tune</span>
                        難度調整
                    </button>
                    <button id="copy-transcript-prompt-btn" onclick="copyTranscriptPromptFromClipboard()" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-emerald-200 hover:bg-emerald-100 hover:border-emerald-300 text-xs font-semibold transition bg-blue-50 text-blue-700 hidden" title="複製剪貼簿 Prompt">
                        <span class="material-symbols-outlined text-sm">content_paste</span>
                        剪貼簿 Prompt
                    </button>
                    <button id="copy-prompt-btn" onclick="copyPrompt()" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 hover:border-indigo-300 text-xs font-semibold transition" title="複製 AI Prompt" style="">
                        <span class="material-symbols-outlined text-sm">auto_awesome</span>
                        AI Prompt
                    </button>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-700 rounded p-1">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
            </div>
            
            <div class="p-4 flex-1 flex flex-col gap-3">
                <div id="modal-hint" class="bg-blue-50 text-blue-800 p-3 rounded text-xs">格式：{ "english": [{"q":"...", "options":[...], "correct":0}], "chinese": [{"q":"...", "options":[...], "correct":0}] }</div>
                <textarea id="import-input" class="flex-1 border rounded p-4 font-mono text-xs resize-none" placeholder="{&quot;english&quot;:[{&quot;q&quot;:&quot;Question?&quot;,&quot;options&quot;:[&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;],&quot;correct&quot;:0}],&quot;chinese&quot;:[{&quot;q&quot;:&quot;題目?&quot;,&quot;options&quot;:[&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;],&quot;correct&quot;:0}]}"></textarea>
            </div>
            
            <div class="p-4 border-t flex justify-between gap-3">
                <div class="flex gap-2">
                    <button id="clear-data-btn" class="px-4 py-2 rounded border border-red-300 bg-red-50 text-red-700 hover:bg-red-100 font-medium text-sm">
                        <span class="material-symbols-outlined text-base align-middle">delete_outline</span> 清除所有紀錄
                    </button>
                </div>
                <div class="flex gap-3">
                    <button onclick="closeModal()" class="px-4 py-2 rounded hover:bg-gray-100">Cancel</button>
                    <button id="import-action-btn" class="bg-blue-600 text-white px-6 py-2 rounded font-bold">Load</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global State - Load from localStorage
        let transcriptData = [{"en":"So in 2015, a bride-to-be uploaded a picture of a dress to the internet -- (Laughter) And we all lost our minds. If you see this as blue and black, say \"Team blue.\" Audience: Team blue! If you see this as white and gold, how? How do you see that as white and gold? (Laughter) Why does this break our brains so much? It's because it puts us into confrontation with the fact that two minds can perceive the same reality entirely differently.","cn":"2015 年，一位準新娘將一張洋裝的照片上傳到網路上——（笑聲）結果我們全都為之瘋狂。如果你看到的是藍色和黑色，請說「藍隊」。觀眾：藍隊！如果你看到的是白色和金色，怎麼會？你怎麼會看成白色和金色？（笑聲）為什麼這會讓我們這麼崩潰？因為這迫使我們面對一個事實：兩個大腦可能對同一個現實有完全不同的感知。","t":4},{"en":"I'd like to talk to you about two things. One, our minds are much more different than we think. And two, you should seek out minds that are different than your own, because that's where the magic happens.","cn":"我想跟各位談兩件事。第一，我們的心智差異遠比我們想像的還要大。第二，你應該去尋找與你思維不同的人，因為那才是奇蹟發生的地方。","t":34},{"en":"I get to work with a lot of diverse minds by virtue of what I do. I write and produce scripts for animation on a wide variety of topics, and I create puzzles and games.","cn":"由於工作的關係，我有機會與許多不同思維的人共事。我撰寫並製作各種主題的動畫腳本，我也設計謎題和遊戲。","t":45},{"en":"And a few years ago, I had my own dress moment where I realized that my brain works differently than almost everyone I know. And I'd like to show you how.","cn":"幾年前，我也經歷了自己的「洋裝時刻」，我意識到我的大腦運作方式與我認識的幾乎所有人都不同。我想向各位展示是怎麼回事。","t":57},{"en":"So if you'll indulge me for a second, please visualize the following. You can do it with your eyes open or closed, whichever gives you the most vivid mental imagery. A rocket ship crash lands on an alien planet. A creature comes up to the hatch and knocks. And someone opens it from within.","cn":"所以，請容許我花一點時間，請各位想像以下的畫面。你可以睜開眼睛或閉上眼睛，只要能產生最生動的心理圖像即可。一艘火箭飛船墜落在一個外星球上。一個生物走近艙門並敲門。然後有人從裡面打開了門。","t":66},{"en":"So now I'm going to ask you some questions about what you just saw. What color was the planet? What kind of creature was it? And who opened the hatch? I'll show you what I see. Nothing. That's because I have a condition called aphantasia, which is where I don't have access to my mind's eye.","cn":"現在我要問你們一些關於剛剛看到的問題。那個星球是什麼顏色的？那是什麼樣的生物？是誰開的艙門？我給各位看看我看到了什麼。什麼都沒有。那是因為我有一種叫做「心盲症」（aphantasia）的狀況，也就是說我無法使用我的「心靈之眼」。","t":86},{"en":"It turns out that the mind's eye is a spectrum. On one end are about two to four percent of us with aphantasia. And at the other extreme is hyperphantasia. That's where you can visualize in exquisite detail, sometimes even able to superimpose what you're imagining on reality. That's about three to six percent of people. Everyone else is somewhere in between.","cn":"原來，心靈之眼是一個光譜。在一端是大約 2% 到 4% 有心盲症的人。而在另一個極端則是「超幻像」（hyperphantasia）。這意味著你可以想像出極其精緻的細節，有時甚至能將想像疊加在現實之上。大約有 3% 到 6% 的人屬於這一類。其他人則介於兩者之間。","t":108},{"en":"But there's a huge range of experience here. Everyone I do this with not only describes something different but describes the experience of experiencing it differently. So I went through most of my life assuming that most people were or everyone was like me, that a visualization exercise like this is a figure of speech that no one could actually do.","cn":"但這裡存在著巨大的體驗差異。每個和我一起做這個練習的人，不僅描述的東西不同，連「體驗」這件事本身的感受也不同。所以我這輩子大部分時間都以為大多數人，或者每個人都跟我一樣，以為像這樣的視覺化練習只是一種修辭比喻，沒有人真的能做到。","t":128},{"en":"So imagine my surprise and fascination and apprehension when I learned about aphantasia, the last, because it raised some scary questions like, have I been working in entirely the wrong careers my entire life? (Laughter)","cn":"所以想像一下，當我得知心盲症時，我是多麼驚訝、著迷又恐慌，尤其是最後一點，因為它引發了一些可怕的問題，比如：我這輩子是不是完全選錯了職業？（笑聲）","t":150},{"en":"So aphantasia changes the way that those of us who have it perceive information and consume and process information. So, for example, most people I speak to who have a mind's eye describe the experience of reading a novel as seeing scenes play out in their mind and casting characters. I can't do either of those things. It's a much more conceptual experience for me.","cn":"心盲症改變了我們感知、吸收和處理資訊的方式。例如，大多數有心靈之眼的人告訴我，讀小說時，腦海中會上演場景，甚至會為角色選角。這兩件事我都做不到。對我來說，那更像是一種概念性的體驗。","t":163},{"en":"And when something is out of sight, it's very much out of mind. I have a five-year-old daughter. I can't in this moment imagine her face. That has a big effect on my memory. And it's also not just my mind's eye, it's also my mind's ear, though I think I have a little bit of a mind's ear, but I don't have a mind's nose or a mind's mouth. I can't, for example, imagine the taste of peanut butter.","cn":"當東西不在視線範圍內，我就真的想不起來。我有個五歲的女兒。此時此刻我無法想像她的臉。這對我的記憶力有很大的影響。而且不只是心靈之眼，還有心靈之耳，雖然我覺得我有一點點心靈之耳，但我沒有心靈之鼻或心靈之口。舉例來說，我無法想像花生醬的味道。","t":187},{"en":"And what's it like to think in the absence of a mind's eye? It's a really tough question that's not that far off from asking what's it like to be a dolphin or a spider? And in the absence of being able to inhabit each other's consciousnesses, we can communicate about them.","cn":"那麼，在沒有心靈之眼的情況下思考是什麼感覺？這是一個非常難回答的問題，就跟問當一隻海豚或蜘蛛是什麼感覺差不多。既然我們無法棲居在彼此的意識中，我們可以試著溝通。","t":212},{"en":"So for me, I'm generally much more aware of something's skeleton than its skin. I'm very attuned to structure. When I'm creating a game or a puzzle, I'm first dreaming up the mechanics and figuring out how they relate to each other, how they map to a story structure. And the details come later, often in collaboration with other artists.","cn":"對我來說，我通常更注意到事物的骨架而非皮膚。我對結構非常敏感。當我在設計遊戲或謎題時，我首先構思的是機制，弄清楚它們彼此之間的關係，以及如何對應到故事結構。細節是後來才加上去的，通常是與其他藝術家合作完成。","t":228},{"en":"I realize there's a leap of faith here in this idea that our minds can be so alien to each other, and I struggle with that, too. I can't understand what it's like to visualize any more than I can see the dress as white and gold.","cn":"我意識到要相信我們的心智彼此之間如此陌生，需要一點信念的飛躍，我也很難接受這點。我無法理解視覺化是什麼感覺，就像我無法把那件洋裝看成白色和金色一樣。","t":247},{"en":"But what's become increasingly apparent is that the mind's eye is just one of many constellations we're starting to draw in a night sky full of neurological diversity. That includes having or not having an interior monologue. It includes the autism spectrum, ADHD, dyslexia and a lot more. Probably a lot of things we have yet to even give a name to because we're just figuring all of this out.","cn":"但越來越明顯的是，心靈之眼只是我們開始在充滿神經多樣性的夜空中描繪出的眾多星座之一。這包括有沒有內心獨白。這包括自閉症光譜、過動症（ADHD）、閱讀障礙等等。可能還有很多我們尚未命名的特質，因為我們才剛剛開始了解這一切。","t":261},{"en":"The norm is to pathologize these experiences into a list of conditions that depart from a so-called \"normal\" functioning of the mind. I think we're thinking about this completely wrong. There is no true normal out there, and difference is not deviance. Rather, these are all clues towards a vast and profound star field we're each individually blinded to because we only have our one cozy, inescapable mind as a single reference point.","cn":"通常的做法是將這些經驗病理化，列為偏離所謂「正常」心智運作的症狀。我認為我們完全想錯了。世上沒有真正的正常，差異並不是異常。相反地，這些都是通往廣闊深邃星域的線索，只是我們每個人都看不見，因為我們只有自己這一個舒適、無法逃脫的心智作為唯一的參考點。","t":285},{"en":"It's no secret that different people think differently. Many people on the autism spectrum excel at pattern recognition and logical deduction. Multiple studies have shown students with ADHD outperforming, on average, their peers, at creative problem solving and divergent thinking tasks, and there are very similar findings for dyslexia, especially when it comes to advanced spatial reasoning.","cn":"不同的人有不同的思考方式，這已不是秘密。許多自閉症光譜上的人擅長模式識別和邏輯推演。多項研究顯示，患有 ADHD 的學生在創造性解決問題和發散性思維任務上的表現，平均優於同齡人；對於閱讀障礙也有類似的發現，特別是在高階空間推理方面。","t":311},{"en":"So if difference is in fact the norm, what do we do with that? I say seek out minds that are different than your own and make something incredible together. There's a wealth of research that shows that teams of people from diverse backgrounds produce superior outcomes. I'd like to propose a corollary to this: diverse minds working together can produce wonders.","cn":"那麼，如果差異其實才是常態，我們該怎麼辦？我說，去尋找那些與你思維不同的人，一起創造出不可思議的事物。已有大量研究顯示，來自不同背景的團隊能產出更優異的成果。我想對此提出一個推論：不同的心智共同合作，可以創造奇蹟。","t":333},{"en":"This comes with challenges and opportunities. So in the last decade or so, companies such as SAP, Hewlett Packard and JPMorgan have started programs designed to recruit neurodivergent talent. And in the time since, they've reported corresponding gains in productivity, morale, innovation and quality.","cn":"這伴隨著挑戰與機遇。在過去十年左右，像 SAP、惠普（Hewlett Packard）和摩根大通（JPMorgan）這樣的公司已經啟動了招募神經多樣性人才的計畫。從那時起，他們報告了在生產力、士氣、創新和品質方面的相應增長。","t":356},{"en":"I see this in my own work as well. Again, by the serendipity of working in visual fields without being able to visualize, I wind up working with a lot of minds who are very different than mine. And that results in some weird and wonderful work, such as a film noir animation about fractals that I coauthored that was brought to life by a brilliant hyperphantasic animator named Jeremiah Dickey.","cn":"我在自己的工作中也看到了這一點。同樣地，機緣巧合下，我在無法視覺化的情況下從事視覺領域的工作，結果我常與思維方式與我截然不同的人共事。這產生了一些怪異而美妙的作品，例如我合寫的一部關於碎形的黑色電影風格動畫，由一位才華洋溢、擁有超幻像能力的動畫師 Jeremiah Dickey 賦予了生命。","t":376},{"en":"Or this is one of my pride and joys. It's a game that's a hybrid jigsaw puzzle and escape room in a box. And the way it works -- yeah. (Laughter) The way it works is you first assemble a jigsaw, but you're missing big sections, so you have to unlock them by solving puzzles that are embedded in the illustration and artifacts that you unlock along the way.","cn":"或者這也是我引以為傲的作品之一。這是一個結合了拼圖和盒裝密室逃脫的遊戲。它的玩法是——對。（笑聲）它的玩法是你首先要拼拼圖，但你會缺少一大塊區域，所以你必須透過解決嵌入在插圖中的謎題，以及沿途解鎖的物品來解鎖這些區域。","t":401},{"en":"This was made in collaboration with two incredible artists, Rita Orlov and Senne Trip, and our minds can be found in very different corners of the galaxy of neurological diversity.","cn":"這是與兩位不可思議的藝術家 Rita Orlov 和 Senne Trip 合作完成的，我們的心智位於神經多樣性銀河中截然不同的角落。","t":425},{"en":"So am I working in the wrong fields? No, I don't think so. I think I'm exactly where I should be. In fact, some of the greatest joy and fulfillment in my life has been from coming to terms with the initially jarring realization that my mind works differently than the people around me, and recognizing that for what it is -- dazzling. Thank you.","cn":"所以我選錯行了嗎？不，我不這麼認為。我覺得我正處於我該在的地方。事實上，我生命中最大的快樂和滿足感，部分來自於接受了「我的大腦運作方式與周遭人不同」這個最初令人震驚的體悟，並認清它的本質——那是令人眩目的。謝謝。","t":435}];
        let vocabData = [{"id":"indulge","word":"Indulge","ipa":"/ɪnˈdʌldʒ/","pos":"verb","def":"To allow oneself or someone else to enjoy a particular pleasure or privilege, often used in requests.","cn":"遷就；縱容 (此處指講者請求聽眾暫時配合做想像練習)"},{"id":"aphantasia","word":"Aphantasia","ipa":"/ˌeɪ.fænˈteɪ.ʒə/","pos":"noun","def":"A neurological condition characterized by the inability to voluntarily create mental images in one's mind.","cn":"心盲症 (無法在腦海中進行視覺想像的狀況)"},{"id":"hyperphantasia","word":"Hyperphantasia","ipa":"/ˌhaɪ.pər.fænˈteɪ.ʒə/","pos":"noun","def":" The condition of having extremely vivid mental imagery, often indistinguishable from reality.","cn":"超幻像 (擁有極度清晰、生動的心理視覺成像能力)"},{"id":"superimpose","word":"Superimpose","ipa":"/ˌsuː.pɚ.ɪmˈpoʊz/","pos":"verb","def":"To place or lay one thing over another, typically so that both are still evident.","cn":"疊加 (將影像疊在現實場景之上)"},{"id":"apprehension","word":"Apprehension","ipa":"/ˌæp.rəˈhen.ʃən/","pos":"noun","def":"Anxiety or fear that something bad or unpleasant will happen.","cn":"憂慮；恐懼 (擔心自己職業生涯受影響)"},{"id":"attuned","word":"Attuned","ipa":"/əˈtuːnd/","pos":"adjective","def":"Receptive or aware; accustomed to or harmonious with something.","cn":"敏銳的；能理解的 (此處指對結構特別敏感)"},{"id":"pathologize","word":"Pathologize","ipa":"/pəˈθɑː.lə.dʒaɪz/","pos":"verb","def":"To regard or treat a condition or behavior as medically or psychologically abnormal.","cn":"病理化 (將某種特質視為疾病或異常狀況)"},{"id":"deviance","word":"Deviance","ipa":"/ˈdiː.vi.əns/","pos":"noun","def":"The fact or state of departing from usual or accepted standards, especially in social or sexual behavior.","cn":"異常；越軌 (強調與常態不同並非壞事)"},{"id":"divergent","word":"Divergent","ipa":"/dɪˈvɝː.dʒənt/","pos":"adjective","def":"Tending to be different or develop in different directions; used in 'divergent thinking' for creative idea generation.","cn":"發散的；分歧的 (指發散性思考，即能提出多種解決方案的能力)"},{"id":"corollary","word":"Corollary","ipa":"/ˈkɔːr.ə.ler.i/","pos":"noun","def":"A proposition that follows from (and is often appended to) one already proved.","cn":"推論；必然的結果"},{"id":"serendipity","word":"Serendipity","ipa":"/ˌser.ənˈdɪp.ə.t̬i/","pos":"noun","def":"The occurrence and development of events by chance in a happy or beneficial way.","cn":"機緣巧合；意外發現珍寶的運氣"},{"id":"jarring","word":"Jarring","ipa":"/ˈdʒɑːr.ɪŋ/","pos":"adjective","def":"Causing a physical shock, jolt, or vibration; incongruous in a striking or shocking way.","cn":"令人震驚的；刺耳的；不和諧的"}];
        let quizData = {"english":[{"q":"According to the speaker, what does she see in her mind when asked to visualize a rocket ship crash landing?","options":["A highly detailed movie-like scene","A vague outline of a ship","Absolutely nothing","The face of her daughter"],"correct":2},{"q":"How does the speaker describe her approach to creating games and puzzles due to her condition?","options":["She focuses first on the mechanics and structure (the skeleton)","She starts by sketching detailed characters (the skin)","She relies entirely on computer software to generate ideas","She avoids visual puzzles and only writes text-based riddles"],"correct":0},{"q":"Why does the speaker use the famous 'blue and black dress' photo at the beginning of her talk?","options":["To prove that she has excellent color vision compared to the audience","To illustrate that two minds can perceive the same reality completely differently","To explain the scientific physics of light and color spectrums","To show an example of a puzzle she designed for a game"],"correct":1},{"q":"Based on the text, what is implied about the corporate programs at companies like SAP and Hewlett Packard?","options":["They stopped recruiting neurodivergent talent due to communication issues","They only hire people with aphantasia to save money on visual design","They discovered that recruiting neurodivergent talent led to gains in productivity and innovation","They aim to cure employees of conditions like ADHD and dyslexia"],"correct":2},{"q":"What is the speaker's critical evaluation regarding how society typically treats conditions like ADHD, autism, and dyslexia?","options":["Society correctly identifies them as diseases that need to be fixed","Society wrongly pathologizes them as deviations from a 'normal' mind, rather than seeing them as diversity","Society ignores them completely and provides no support for students","Society overestimates the creative abilities of people with these conditions"],"correct":1},{"q":"What is the central argument the speaker makes about professional collaboration?","options":["People should only work with others who think exactly like they do to avoid conflict","Visual artists are the most important members of any creative team","Aphantasia is a disability that prevents people from working in creative fields","Combining diverse minds—those that work differently—produces superior and 'magical' outcomes"],"correct":3}],"chinese":[{"q":"根據講者所述，當被要求想像火箭墜毀的畫面時，她在腦海中看到了什麼？","options":["一個像電影般高度細節化的場景","一個模糊的船艦輪廓","完全沒有任何畫面","她女兒的臉龐"],"correct":2},{"q":"由於她的狀況，講者如何描述她設計遊戲和謎題的方式？","options":["她首先專注於機制和結構（骨架）","她從繪製詳細的角色（皮膚）開始","她完全依賴電腦軟體來產生點子","她避免設計視覺謎題，只寫純文字的謎語"],"correct":0},{"q":"為什麼講者在演講開始時要使用著名的「藍黑洋裝」照片？","options":["為了證明她的色彩視覺比觀眾優秀","為了說明兩個大腦可以對同一現實產生完全不同的感知","為了解釋光線和光譜的物理科學","為了展示她為遊戲設計的一個謎題範例"],"correct":1},{"q":"根據文章內容，關於 SAP 和 Hewlett Packard 等公司的企業計畫，暗示了什麼？","options":["由於溝通問題，他們停止招募神經多樣性人才","他們只僱用患有失像症的人以節省視覺設計費用","他們發現招募神經多樣性人才帶來了生產力和創新的提升","他們的目標是治癒員工的 ADHD 和閱讀障礙等狀況"],"correct":2},{"q":"對於社會通常如何對待 ADHD、自閉症和閱讀障礙等狀況，講者提出了什麼批判性評估？","options":["社會正確地將它們視為需要修復的疾病","社會錯誤地將它們視為偏離「正常」心智的病態，而不是將其視為多樣性","社會完全忽視它們，沒有為學生提供任何支持","社會高估了患有這些狀況的人的創造能力"],"correct":1},{"q":"講者關於「專業合作」的核心論點是什麼？","options":["人們應該只與思考方式完全相同的人一起工作，以避免衝突","視覺藝術家是任何創意團隊中最重要的成員","失像症是一種妨礙人們在創意領域工作的殘疾","結合不同的思維模式——那些運作方式不同的大腦——能產生更卓越且「神奇」的成果"],"correct":3}]};
        let quizLanguage = 'english'; // 'english' or 'chinese'
        let videoId = localStorage.getItem('videoId') || '';
        let selectedWords = [];
        let cefrLevel = localStorage.getItem('cefrLevel') || ''; // Store selected CEFR level
        let translationsVisible = false;
        let player;
        let playerReady = false;

        // Sticky video functionality
        const videoContainer = document.getElementById('video-container');
        const videoSection = document.getElementById('video-section');
        const videoPlaceholder = document.getElementById('video-placeholder');
        const closeBtn = document.getElementById('close-sticky-video');
        const floatingCloseBtn = document.getElementById('floating-close-btn');
        let isSticky = false;
        let manuallyHidden = false;
        let initialTop = 0;

        // Calculate initial position once
        if (videoSection) {
            setTimeout(() => {
                initialTop = videoSection.getBoundingClientRect().top + window.scrollY;
            }, 100);
        }

        function updateStickyVideo() {
            if (!videoSection || manuallyHidden) return;
            
            const shouldBeSticky = window.scrollY > initialTop + 100;
            
            if (shouldBeSticky && !isSticky) {
                videoContainer.classList.add('sticky-video');
                videoPlaceholder.classList.remove('hidden');
                closeBtn.classList.remove('hidden');
                floatingCloseBtn.classList.remove('hidden');
                isSticky = true;
            } else if (!shouldBeSticky && isSticky) {
                videoContainer.classList.remove('sticky-video');
                videoPlaceholder.classList.add('hidden');
                closeBtn.classList.add('hidden');
                floatingCloseBtn.classList.add('hidden');
                isSticky = false;
            }
        }

        function closeStickyVideo() {
            videoContainer.classList.remove('sticky-video');
            videoPlaceholder.classList.add('hidden');
            closeBtn.classList.add('hidden');
            floatingCloseBtn.classList.add('hidden');
            isSticky = false;
            manuallyHidden = true;
        }

        function manualToggleSticky() {
            if (isSticky) {
                // 如果已經是浮動狀態，關閉它
                closeStickyVideo();
            } else {
                // 開啟浮動模式
                videoContainer.classList.add('sticky-video');
                videoPlaceholder.classList.remove('hidden');
                closeBtn.classList.remove('hidden');
                floatingCloseBtn.classList.remove('hidden');
                isSticky = true;
                manuallyHidden = false;
            }
        }

        closeBtn.addEventListener('click', closeStickyVideo);
        floatingCloseBtn.addEventListener('click', closeStickyVideo);

        window.addEventListener('scroll', updateStickyVideo);
        window.addEventListener('resize', () => {
            if (videoSection && !manuallyHidden) {
                initialTop = videoSection.getBoundingClientRect().top + window.scrollY;
                updateStickyVideo();
            }
        });

        let youtubeAPIReady = false;
        let currentFontSize = 18; // base font size in px
        let currentPlaybackSpeed = 1.0;

        const modal = document.getElementById('import-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalHint = document.getElementById('modal-hint');
        const inputArea = document.getElementById('import-input');
        const actionBtn = document.getElementById('import-action-btn');
        const floatingCard = document.getElementById('floating-card');
        const transcriptPromptBtn = document.getElementById('copy-transcript-prompt-btn');

        // Modal Functions
        function openModal(mode) {
            modal.classList.remove('hidden');
            inputArea.value = '';
            inputArea.focus();
            const clearBtn = document.getElementById('clear-data-btn');
            const copyBtn = document.getElementById('copy-prompt-btn');
            const cefrBtn = document.getElementById('copy-cefr-prompt-btn');
            window.currentModalMode = mode;
            
            if (mode === 'video') {
                modalTitle.innerText = "設定 YouTube 影片";
                modalHint.innerText = '貼上 YouTube 網址或影片 ID';
                inputArea.placeholder = 'https://www.youtube.com/watch?v=...';
                actionBtn.onclick = parseVideoUrl;
                clearBtn.classList.add('hidden');
                copyBtn.classList.add('hidden');
                transcriptPromptBtn.classList.add('hidden');
                cefrBtn.classList.add('hidden');
            } else if (mode === 'transcript') {
                modalTitle.innerText = "匯入逐字稿";
                modalHint.innerText = '格式：[{ "en": "...", "cn": "...", "t": 0 }, ...]';
                inputArea.placeholder = '[{"en":"Hello","cn":"你好","t":0}]';
                actionBtn.onclick = parseTranscript;
                clearBtn.classList.remove('hidden');
                copyBtn.classList.remove('hidden');
                transcriptPromptBtn.classList.remove('hidden');
                cefrBtn.classList.remove('hidden');
                clearBtn.onclick = () => {
                    if (confirm('確定要清除所有逐字稿紀錄嗎？')) {
                        clearTranscriptData();
                    }
                };
            } else if (mode === 'vocab') {
                modalTitle.innerText = "匯入單字";
                modalHint.innerText = '格式：[{ "word": "...", "def": "...", "pos": "n." }, ...]';
                inputArea.placeholder = '[{"word":"Example","def":"範例"}]';
                actionBtn.onclick = parseVocab;
                clearBtn.classList.remove('hidden');
                copyBtn.classList.remove('hidden');
                transcriptPromptBtn.classList.add('hidden');
                cefrBtn.classList.add('hidden');
                clearBtn.onclick = () => {
                    if (confirm('確定要清除所有單字紀錄嗎？')) {
                        clearVocabData();
                    }
                };
            } else {
                modalTitle.innerText = "匯入 Quiz（雙語格式）";
                modalHint.innerText = '格式：{ "english": [{"q":"...", "options":[...], "correct":0}], "chinese": [{"q":"...", "options":[...], "correct":0}] }';
                inputArea.placeholder = '{"english":[{"q":"Question?","options":["A","B","C","D"],"correct":0}],"chinese":[{"q":"題目?","options":["A","B","C","D"],"correct":0}]}';
                actionBtn.onclick = parseQuiz;
                clearBtn.classList.remove('hidden');
                copyBtn.classList.remove('hidden');
                transcriptPromptBtn.classList.add('hidden');
                cefrBtn.classList.add('hidden');
                clearBtn.onclick = () => {
                    if (confirm('確定要清除所有 Quiz 題庫嗎？')) {
                        clearQuizData();
                    }
                };
            }
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        function selectQuizLanguage(lang) {
            quizLanguage = lang;
            updateQuizLanguageSelector();
            renderQuizContent(); // 重新渲染題目
        }

        function updateQuizLanguageSelector() {
            const btnEn = document.getElementById('quiz-select-en');
            const btnZh = document.getElementById('quiz-select-zh');
            
            if (!btnEn || !btnZh) return;
            
            if (quizLanguage === 'english') {
                btnEn.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                btnEn.classList.remove('bg-white', 'text-slate-700', 'border-slate-300');
                btnZh.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                btnZh.classList.add('bg-white', 'text-slate-700', 'border-slate-300');
            } else {
                btnZh.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                btnZh.classList.remove('bg-white', 'text-slate-700', 'border-slate-300');
                btnEn.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                btnEn.classList.add('bg-white', 'text-slate-700', 'border-slate-300');
            }
        }


        function generateTranscriptPrompt() {
            let prompt = '';
            
            // Add video URL if available
            if (videoId && videoId.length === 11) {
                prompt += `https://www.youtube.com/watch?v=${videoId}\n\n`;
            } else {
                prompt += '🔻\n\n';
            }
            
            prompt += `將以上影片的演講內容，整理成英文和中文隨段落對照的逐字稿，並以以下格式嚴格依照 JSON Array 格式輸出結果：：
{
    en: "When I found out my grandmother, my last living grandparent, was dying, my first thought was, \"I need to draw her hands.\" I'm a visual artist, a cartoonist for The New Yorker, and comics writer, so drawing is how I understand much of the world.",
    cn: "當我得知我的祖母——我最後一位在世的祖父母——即將離世時，我的第一個念頭是：「我需要畫下她的手。」我是一位視覺藝術家，也是《紐約客》的漫畫家和漫畫作者，所以繪畫是我理解這個世界的主要方式。"
},
{
    en: "For a long time, my cartoons had been impersonal. Commentary on the world around me, sure, but not really about me. The closest my personal life got to influencing my cartoons were cartoons I lifted from things my friends and family had said around me. It was only after my daughter Ellika was born that my personal life began to creep into my cartoons more.",
    cn: "很長一段時間以來，我的漫畫都是非個人化的。它們是對周遭世界的評論，沒錯，但並不真正關於我自己。我的個人生活對漫畫最接近的影響，頂多就是從朋友和家人的談話中取材。直到我女兒埃莉卡 (Ellika) 出生後，我的個人生活才開始更多地滲透進我的漫畫中。"
}`;
            
            return prompt;
        }

        function generateQuizPrompt() {
            let prompt = '# Role: 你是一位資深的英語教學評量專家，專精於 CEFR 等級分析與閱讀理解診斷。\n\n';
            prompt += '# Task: 請針對我提供的英文文章，設計一份用於「評估學生閱讀程度」的題組。\n\n';
            prompt += '# Requirements:\n\n';
            prompt += '1. **文章程度診斷**：先簡述這篇文章在 CEFR 標準下屬於哪個等級，並列出 5-10 個影響難度的關鍵詞彙。\n\n';
            prompt += '2. **題組設計**：請根據「閱讀理解三層次」設計 6 道選擇題：\n';
            prompt += '   - Level 1: 字面理解題 (Literal) x 2 (答案直接在文中)\n';
            prompt += '   - Level 2: 推論理解題 (Inferential) x 2 (需要整合上下文或猜測語氣)\n';
            prompt += '   - Level 3: 批判/整合題 (Evaluative) x 2 (需要理解作者核心意圖或延伸思考)\n\n';
            prompt += '3. **讀者程度診斷指南**：這部分最重要。請提供一個對照表，說明學生答對題數所代表的 CEFR 閱讀能力落點，以及後續的學習建議。\n\n';
            prompt += '# Output Format:\n\n';
            prompt += '---\n\n';
            prompt += '## 一、 文章難度分析 (CEFR Level)\n\n';
            prompt += '## 二、 閱讀評估題組 (附選項與正確答案)\n\n';
            prompt += '## 三、 學生程度診斷指南 (Diagnostic Guide)\n\n';
            prompt += '- 答對 0-2 題：程度落點與建議\n';
            prompt += '- 答對 3-4 題：程度落點與建議\n';
            prompt += '- 答對 5-6 題：程度落點與建議\n\n';
            prompt += '---\n\n';
            prompt += 'Please output a JSON object with TWO keys: "english" and "chinese", each containing a JSON Array of questions.\n';
            prompt += 'Format specifications:\n\n';
            prompt += '{\n';
            prompt += '  "english": [\n';
            prompt += '    { "q": "Question in English", "options": ["Option A", "Option B", "Option C", "Option D"], "correct": 0 },\n';
            prompt += '    ...\n';
            prompt += '  ],\n';
            prompt += '  "chinese": [\n';
            prompt += '    { "q": "題目中文翻譯", "options": ["選項A", "選項B", "選項C", "選項D"], "correct": 0 },\n';
            prompt += '    ...\n';
            prompt += '  ]\n';
            prompt += '}\n\n';
            prompt += 'Requirements:\n';
            prompt += '- Both English and Chinese versions must have the SAME questions with the SAME correct answers (index).\n';
            prompt += '- English: questions and options in English\n';
            prompt += '- Chinese: complete translation of questions and options to Traditional Chinese\n';
            prompt += '- Output ONLY the JSON object, no explanations or extra text.\n';
            prompt += '- Questions should cover content comprehension, key details, main idea, and inference.\n';
            prompt += '- Avoid duplicate questions or overly similar options.\n';
            prompt += '- Content must be faithful to the transcript; do not add information not present in it.\n\n';
            prompt += 'English transcript:';
            
            if (transcriptData.length > 0) {
                const englishText = transcriptData.map(seg => seg.en).join(' ');
                prompt += englishText;
            } else {
                prompt += '🔻';
            }
            
            return prompt;
        }

        function generateVocabPrompt() {
            let prompt = '你是一位專業的英語教學專家與程式開發輔助者。請分析我提供的文章，並從中挑選出對讀者可能較難、冷僻或具備學習價值的生字（建議難度 B2-C2 或特定領域術語）。\n\n';
            prompt += '請嚴格依照以下 JSON Array 格式輸出結果：\n\n';
            prompt += '1.  **id**: 單字的全小寫形式。\n';
            prompt += '2.  **word**: 單字的首字母大寫。\n';
            prompt += '3.  **ipa**: 該單字的 IPA 音標。\n';
            prompt += '4.  **pos**: 詞性 (如 noun, verb, adjective)。\n';
            prompt += '5.  **def**: 簡潔的英文定義。\n';
            prompt += '6.  **cn**: 繁體中文解釋 (若有特定語境請一併標註)。\n';
            prompt += '範例格式：\n';
            prompt += '[\n    {\n        "id": "pareidolia",\n        "word": "Pareidolia",\n        "ipa": "/ˌpær.ɪˈdoʊ.li.ə/",\n        "pos": "noun",\n        "def": "The psychological phenomenon of seeing recognizable shapes, especially faces, in random or vague stimuli.",\n        "cn": "幻想性錯覺 (尤指將模糊圖像看作人臉)",\n     }\n]\n\n';
            prompt += '文章內容如下：\n';
            
            // Add English transcript if available
            if (transcriptData.length > 0) {
                const englishText = transcriptData.map(seg => seg.en).join(' ');
                prompt += englishText + '\n\n';
            } else {
                prompt += '🔻\n\n';
            }
            
            return prompt;
        }

        function generateCEFRAdaptationPrompt(targetLevel, options = {}) {
            let prompt = '# Role: 你是一位資深的英語教材編寫專家，擅長根據 CEFR 標準調整文本難度。\n\n';
            prompt += '# Task: 請將我提供的原始逐字稿，改寫為符合 [' + targetLevel + '] 程度的英文文章。\n\n';
            prompt += '# Requirements by CEFR Level:\n';
            prompt += '- 若目標為 **A2/B1**：使用常用單字（核心 2000-3000 字），句子結構以單句為主，避免複雜的子句。\n';
            prompt += '- 若目標為 **B2**：可以使用較具體的描述性動詞，允許出現複合句，但應保持邏輯結構清晰。\n';
            prompt += '- 若目標為 **C1**：保持原始文章的精確性與修飾語，強化學術或文學性的轉折詞。\n\n';
            prompt += '# Guidelines:\n';
            prompt += '1. **結構優化**：將原本雜亂的口語逐字稿整理成邏輯通順的段落。\n';
            prompt += '2. **語氣保留**：保留原作者的核心觀點、故事與情感色彩，不要刪除重要的例子。\n';
            prompt += '3. **詞彙調整**：[針對目標程度，替換掉過於艱澀或過於簡單的詞彙]。\n';
            
            // Add optional guidelines
            if (options.keepNarrative) {
                prompt += '4. **保持敘事結構**：請保持敘事結構，僅簡化單字與文法。\n';
            }
            if (options.keepCulturalRef) {
                prompt += '5. **保留文化典故**：請保留文章中的文化典故，但請用簡單的英文句子補充解釋該典故的意思。\n';
            }
            
            prompt += '6. **輸出格式**：\n';
            prompt += '   - 標題：[為改寫後的文章起一個標題]\n';
            prompt += '   - 本文：[改寫後的文章內容]\n';
            prompt += '   - 關鍵單字表：[列出 5 個符合該程度、且對理解本文至關重要的單字與中解]\n\n';
            prompt += '# Target Level: ' + targetLevel + '\n\n';
            prompt += '# Original Transcript (原始逐字稿):\n';
            
            if (transcriptData.length > 0) {
                const englishText = transcriptData.map(seg => seg.en).join(' ');
                prompt += englishText;
            } else {
                prompt += '🔻';
            }
            
            return prompt;
        }

        async function openCEFRLevelSelector() {
            // Create a modal for selecting CEFR level with checkboxes
            const levelHTML = `
                <div id="cefr-level-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 9999;">
                    <div style="background: white; border-radius: 16px; padding: 32px; text-align: left; box-shadow: 0 20px 25px rgba(0,0,0,0.15); max-width: 450px;">
                        <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 24px; color: #1f2937; text-align: center;">選擇目標難度等級</h3>
                        
                        <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px;">
                            <button onclick="copyCEFRPrompt('A2')" style="padding: 12px 24px; border: 2px solid #60a5fa; background: #dbeafe; color: #2563eb; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.2s;">
                                A2 (Elementary)
                            </button>
                            <button onclick="copyCEFRPrompt('B1')" style="padding: 12px 24px; border: 2px solid #60a5fa; background: #dbeafe; color: #2563eb; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.2s;">
                                B1 (Intermediate)
                            </button>
                            <button onclick="copyCEFRPrompt('B2')" style="padding: 12px 24px; border: 2px solid #60a5fa; background: #dbeafe; color: #2563eb; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.2s;">
                                B2 (Upper-Intermediate)
                            </button>
                            <button onclick="copyCEFRPrompt('C1')" style="padding: 12px 24px; border: 2px solid #60a5fa; background: #dbeafe; color: #2563eb; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.2s;">
                                C1 (Advanced)
                            </button>
                        </div>
                        
                        <div style="border-top: 2px solid #e5e7eb; padding-top: 24px; margin-bottom: 24px;">
                            <p style="font-size: 14px; font-weight: bold; color: #4b5563; margin-bottom: 12px;">額外選項 (可複選)：</p>
                            <label style="display: flex; align-items: center; margin-bottom: 12px; cursor: pointer;">
                                <input type="checkbox" id="cefr-narrative-checkbox" style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
                                <span style="color: #374151; font-size: 14px;">保持敘事結構</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="cefr-cultural-checkbox" style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
                                <span style="color: #374151; font-size: 14px;">保留文化典故</span>
                            </label>
                        </div>
                        
                        <div style="display: flex; gap: 12px;">
                            <button onclick="closeCEFRModal()" style="flex: 1; padding: 12px 24px; border: 2px solid #d1d5db; background: #f3f4f6; color: #6b7280; border-radius: 8px; font-weight: bold; cursor: pointer;">
                                取消
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', levelHTML);
        }

        function closeCEFRModal() {
            const modal = document.getElementById('cefr-level-modal');
            if (modal) modal.remove();
        }

        async function copyCEFRPrompt(level) {
            // Get checkbox states before closing modal
            const narrativeCheckbox = document.getElementById('cefr-narrative-checkbox');
            const culturalCheckbox = document.getElementById('cefr-cultural-checkbox');
            
            const options = {
                keepNarrative: narrativeCheckbox ? narrativeCheckbox.checked : false,
                keepCulturalRef: culturalCheckbox ? culturalCheckbox.checked : false
            };
            
            closeCEFRModal();
            const promptText = generateCEFRAdaptationPrompt(level, options);
            
            try {
                await navigator.clipboard.writeText(promptText);
                
                // Save CEFR level to localStorage
                localStorage.setItem('cefrLevel', level);
                cefrLevel = level;
                
                // Update transcript title
                const transcriptTitle = document.getElementById('transcript-title');
                if (transcriptTitle) {
                    transcriptTitle.textContent = `摘要（${level}）`;
                }
                
                alert(`✅ CEFR ${level} 難度調整 Prompt 已複製到剪貼簿\n摘要標題已更新為：摘要（${level}）`);
                console.log(`✅ CEFR ${level} Prompt已複製，標題已更新為：摘要（${level}）`);
            } catch (err) {
                console.error('複製失敗:', err);
                alert('複製失敗，請重試');
            }
        }

        function copyPrompt() {
            let promptText = '';
            
            if (window.currentModalMode === 'transcript') {
                promptText = generateTranscriptPrompt();
            } else if (window.currentModalMode === 'vocab') {
                promptText = generateVocabPrompt();
            } else if (window.currentModalMode === 'quiz') {
                promptText = generateQuizPrompt();
            }
            
            if (!promptText) {
                alert('無法生成prompt');
                return;
            }
            
            navigator.clipboard.writeText(promptText).then(() => {
                const copyBtn = document.getElementById('copy-prompt-btn');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span class="material-symbols-outlined">done</span>';
                copyBtn.style.color = '#10b981';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.style.color = '';
                }, 2000);
                
                console.log('✅ Prompt已複製到剪貼簿');
            }).catch(err => {
                console.error('複製失敗:', err);
                alert('複製失敗，請重試');
            });
        }

        async function copyTranscriptPromptFromClipboard() {
            try {
                const clipboardText = await navigator.clipboard.readText();
                const sourceText = clipboardText.trim() ? clipboardText.trim() : '🔻';
                const promptText = `${sourceText}

將以上未經整理的文稿內容，整理成英文和中文隨段落對照的逐字稿，並以以下格式嚴格依照 JSON Array 格式輸出結果：：
{
    en: "When I found out my grandmother, my last living grandparent, was dying, my first thought was, \"I need to draw her hands.\" I'm a visual artist, a cartoonist for The New Yorker, and comics writer, so drawing is how I understand much of the world.",
    cn: "當我得知我的祖母——我最後一位在世的祖父母——即將離世時，我的第一個念頭是：「我需要畫下她的手。」我是一位視覺藝術家，也是《紐約客》的漫畫家和漫畫作者，所以繪畫是我理解這個世界的主要方式。"
},
{
    en: "For a long time, my cartoons had been impersonal. Commentary on the world around me, sure, but not really about me. The closest my personal life got to influencing my cartoons were cartoons I lifted from things my friends and family had said around me. It was only after my daughter Ellika was born that my personal life began to creep into my cartoons more.",
    cn: "很長一段時間以來，我的漫畫都是非個人化的。它們是對周遭世界的評論，沒錯，但並不真正關於我自己。我的個人生活對漫畫最接近的影響，頂多就是從朋友和家人的談話中取材。直到我女兒埃莉卡 (Ellika) 出生後，我的個人生活才開始更多地滲透進我的漫畫中。"
}`;

                await navigator.clipboard.writeText(promptText);
                const originalHTML = transcriptPromptBtn.innerHTML;
                transcriptPromptBtn.innerHTML = '<span class="material-symbols-outlined text-base align-middle">done</span> 已複製';
                transcriptPromptBtn.classList.remove('bg-blue-50', 'text-blue-700');
                transcriptPromptBtn.classList.add('bg-emerald-50', 'text-emerald-700');

                setTimeout(() => {
                    transcriptPromptBtn.innerHTML = originalHTML;
                    transcriptPromptBtn.classList.remove('bg-emerald-50', 'text-emerald-700');
                    transcriptPromptBtn.classList.add('bg-blue-50', 'text-blue-700');
                }, 2000);
            } catch (err) {
                console.error('讀取或複製剪貼簿失敗:', err);
                alert('無法讀取剪貼簿內容，請允許瀏覽器存取剪貼簿後重試。');
            }
        }

        function parseJSON(str) {
            str = str.trim();
            // 如果不是 [ 或 { 開頭，假設為陣列並加上 []
            if (!str.startsWith('[') && !str.startsWith('{')) {
                str = '[' + str + ']';
            }
            return JSON.parse(str);
        }

        function parseVideoUrl() {
            try {
                const input = inputArea.value.trim();
                let id = input;
                
                let m = input.match(/[?&]v=([^&]+)/);
                if (m) id = m[1];
                
                m = input.match(/youtu\.be\/([^?]+)/);
                if (m) id = m[1];
                
                id = id.split('&')[0].split('?')[0];
                
                if (id.length !== 11) throw new Error("無效的影片 ID");
                
                // Save to localStorage
                localStorage.setItem('videoId', id);
                
                // Clear selected words when setting new video
                selectedWords = [];
                localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
                
                console.log(`✅ 影片設定為: ${id}`);
                console.log(`✅ 已清空選取的生字，即將重新整理頁面...`);
                
                // Reload page to reset everything
                setTimeout(() => {
                    location.reload();
                }, 500);
            } catch (e) {
                console.error("錯誤: " + e.message);
            }
        }

        function parseTranscript() {
            try {
                const data = parseJSON(inputArea.value);
                if (!Array.isArray(data)) throw new Error("必須是陣列");
                
                // Auto-add "t" field if missing (set to 0 or incremental)
                data.forEach((item, index) => {
                    if (!item.hasOwnProperty('t')) {
                        item.t = index * 10; // Default: 10 seconds apart
                    }
                });
                
                transcriptData = data;
                localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
                
                // Clear CEFR level when importing new transcript
                localStorage.removeItem('cefrLevel');
                cefrLevel = '';
                const transcriptTitle = document.getElementById('transcript-title');
                if (transcriptTitle) {
                    transcriptTitle.textContent = '逐字稿';
                }
                
                renderTranscript();
                closeModal();
            } catch (e) {
                console.error("格式錯誤: " + e.message);
                alert("匯入失敗：" + e.message + "\n\n請確認 JSON 格式正確");
            }
        }

        function parseVocab() {
            try {
                const data = parseJSON(inputArea.value);
                if (!Array.isArray(data)) throw new Error("必須是陣列");
                vocabData = data;
                localStorage.setItem('vocabData', JSON.stringify(vocabData));
                renderTranscript();
                renderVocab();
                closeModal();
            } catch (e) {
                console.error("格式錯誤: " + e.message);
            }
        }

        function parseQuiz() {
            try {
                const inputValue = inputArea.value.trim();
                if (!inputValue) {
                    alert('請輸入 Quiz 資料');
                    return;
                }
                
                const data = parseJSON(inputValue);
                
                // 檢查是否為雙語格式 { english: [...], chinese: [...] }
                if (typeof data === 'object' && data !== null && !Array.isArray(data) && 'english' in data && 'chinese' in data) {
                    // 雙語格式
                    if (!Array.isArray(data.english) || !Array.isArray(data.chinese)) {
                        alert("錯誤：english 和 chinese 都必須是陣列");
                        return;
                    }
                    if (data.english.length === 0 && data.chinese.length === 0) {
                        alert("錯誤：題庫不能為空");
                        return;
                    }
                    quizData = data; // 保存整個雙語物件
                    localStorage.setItem('quizData', JSON.stringify(quizData));
                    closeModal();
                    alert(`✅ 雙語 Quiz 題庫已匯入\n\n英文：${data.english.length} 題\n中文：${data.chinese.length} 題`);
                    console.log(`✅ 雙語 Quiz 題庫已匯入: 英文 ${data.english.length} 題、中文 ${data.chinese.length} 題`);
                } else if (Array.isArray(data)) {
                    // 傳統格式 - 單一陣列
                    if (data.length === 0) {
                        alert("錯誤：題庫不能為空");
                        return;
                    }
                    quizData = data;
                    localStorage.setItem('quizData', JSON.stringify(quizData));
                    closeModal();
                    alert(`✅ Quiz 題庫已匯入：${quizData.length} 題`);
                    console.log(`✅ Quiz 題庫已匯入: ${quizData.length} 題`);
                } else {
                    alert("格式錯誤：必須是陣列或雙語物件\n\n正確格式：\n{ \"english\": [...], \"chinese\": [...] }\n或\n[{\"q\":\"...\", \"options\":[...], \"correct\":0}]");
                }
            } catch (e) {
                alert("格式錯誤：" + e.message + "\n\n請確認 JSON 格式是否正確");
                console.error("格式錯誤: ", e);
            }
        }

        function clearTranscriptData() {
            transcriptData = [];
            selectedWords = [];
            localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
            localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
            console.log('✅ 逐字稿紀錄已清除');
            setTimeout(() => location.reload(), 500);
        }

        function clearVocabData() {
            vocabData = [];
            localStorage.setItem('vocabData', JSON.stringify(vocabData));
            console.log('✅ 單字紀錄已清除');
            setTimeout(() => location.reload(), 500);
        }

        function clearQuizData() {
            quizData = [];
            localStorage.setItem('quizData', JSON.stringify(quizData));
            console.log('✅ Quiz 題庫已清除');
            setTimeout(() => location.reload(), 500);
        }

        // Render Functions
        function renderTranscript() {
            const container = document.getElementById('transcript-content');
            if (transcriptData.length === 0) return;
            
            container.innerHTML = "";
            const sortedVocab = [...vocabData].sort((a,b) => b.word.length - a.word.length);

            transcriptData.forEach((seg, idx) => {
                let text = seg.en;  // 保持純文本進行替換
                
                // 先進行所有替換，建立標記列表
                const replacements = [];
                
                // Collect all vocab replacements
                sortedVocab.forEach(v => {
                    const roots = v.roots || [v.word];
                    const pattern = roots.map(r => r.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|');
                    const regex = new RegExp(`\\b(${pattern})\\b`, 'gi');
                    let match;
                    while ((match = regex.exec(text)) !== null) {
                        replacements.push({
                            start: match.index,
                            end: match.index + match[0].length,
                            word: match[0],
                            vocab: v,
                            type: 'vocab'
                        });
                    }
                });
                
                // Collect all selected word replacements
                selectedWords.forEach(word => {
                    const escaped = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    const regex = new RegExp(`\\b(${escaped})\\b`, 'gi');
                    let match;
                    while ((match = regex.exec(text)) !== null) {
                        replacements.push({
                            start: match.index,
                            end: match.index + match[0].length,
                            word: match[0],
                            selectedWord: word,
                            type: 'selected'
                        });
                    }
                });
                
                // Sort by start position (descending) to replace from end to start
                replacements.sort((a, b) => b.start - a.start);
                
                // Remove overlapping replacements (keep the first one found)
                const finalReplacements = [];
                replacements.forEach(rep => {
                    const overlaps = finalReplacements.some(r => 
                        (rep.start >= r.start && rep.start < r.end) ||
                        (rep.end > r.start && rep.end <= r.end)
                    );
                    if (!overlaps) {
                        finalReplacements.push(rep);
                    }
                });
                
                // Apply replacements from end to start
                let html = text;
                finalReplacements.forEach(rep => {
                    const before = html.substring(0, rep.start);
                    const after = html.substring(rep.end);
                    let replacement = '';
                    
                    if (rep.type === 'vocab') {
                        const isCustom = rep.vocab.custom ? 'vocab-word-custom' : 'vocab-word';
                        replacement = `<span class="${isCustom}" data-id="${rep.vocab.id || rep.vocab.word}" 
                                           onmouseenter="showCard(event, '${rep.vocab.id || rep.vocab.word}')" 
                                           onmouseleave="hideCard()" 
                                           onclick="toggleCard(event, '${rep.vocab.id || rep.vocab.word}')">${rep.word}</span>`;
                    } else if (rep.type === 'selected') {
                        replacement = `<span class="selected-word" onclick="removeSelectedWord('${rep.selectedWord}')" style="cursor: pointer; text-decoration: underline;" title="點擊取消選取">${rep.word}</span>`;
                    }
                    
                    html = before + replacement + after;
                });

                const hasTime = typeof seg.t === 'number';
                const timeLabel = hasTime ? formatTime(seg.t) : 'Set';
                const timeClass = hasTime ? 'bg-green-50 text-green-700' : 'bg-slate-100 text-slate-600';
                const minutes = hasTime ? Math.floor(seg.t / 60) : '';
                const seconds = hasTime ? seg.t % 60 : '';

                container.innerHTML += `
                    <div class="mb-6" id="seg-${idx}">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 ${timeClass} text-xs font-semibold transition-colors" 
                                    onclick="jumpToTime(${hasTime ? seg.t : 'null'})">
                                ⏵ ${timeLabel}
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-${idx}" min="0" max="999" step="1" 
                                           class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400"
                                           placeholder="0" value="${minutes}"
                                           onchange="setTimeByInput(${idx})"
                                           onkeypress="if(event.key==='Enter') setTimeByInput(${idx})">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-${idx}" min="0" max="59" step="1" 
                                           class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400"
                                           placeholder="00" value="${seconds ? String(seconds).padStart(2, '0') : ''}"
                                           onchange="setTimeByInput(${idx})"
                                           onkeypress="if(event.key==='Enter') setTimeByInput(${idx})">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" 
                                    onclick="editSegment(${idx})">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-${idx}">${html}</p>
                        ${seg.cn ? `<p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-${idx}">${seg.cn}</p>` : ''}
                    </div>`;
            });
            
            applyTranslationState();
        }

        function showAddVocabModal() {
            document.getElementById('add-vocab-modal').classList.remove('hidden');
            document.getElementById('add-vocab-input').focus();
        }

        function closeAddVocabModal() {
            document.getElementById('add-vocab-modal').classList.add('hidden');
            // 清空表單
            document.getElementById('add-vocab-input').value = '';
        }

        function addNewVocabFromJSON() {
            try {
                const input = document.getElementById('add-vocab-input').value.trim();
                if (!input) {
                    alert('請輸入單字資料');
                    return;
                }
                
                const data = parseJSON(input);
                if (!Array.isArray(data)) {
                    alert('格式錯誤：必須是陣列');
                    return;
                }
                
                if (data.length === 0) {
                    alert('請至少新增一個單字');
                    return;
                }
                
                let addedCount = 0;
                data.forEach(item => {
                    if (!item.word) return; // 跳過沒有 word 的項目
                    
                    // 檢查是否重複
                    if (vocabData.some(v => v.word.toLowerCase() === item.word.toLowerCase())) {
                        console.warn(`⚠️ 單字已存在，已跳過: ${item.word}`);
                        return;
                    }
                    
                    // 添加新單字（標記為自訂：custom: true）
                    const newVocab = {
                        id: item.word.toLowerCase(),
                        word: item.word.charAt(0).toUpperCase() + item.word.slice(1).toLowerCase(),
                        def: item.def || '',
                        cn: item.cn || '',
                        pos: item.pos || '',
                        custom: true  // 標記為自訂單字
                    };
                    
                    vocabData.push(newVocab);
                    addedCount++;
                });
                
                if (addedCount === 0) {
                    alert('所有單字都已存在或格式不正確');
                    return;
                }
                
                localStorage.setItem('vocabData', JSON.stringify(vocabData));
                renderVocab();
                renderTranscript();
                closeAddVocabModal();
                
                alert(`✅ 已新增 ${addedCount} 個生字`);
                console.log(`✅ 已新增 ${addedCount} 個生字`);
            } catch (e) {
                alert('格式錯誤：' + e.message + '\n\n請確認 JSON 格式是否正確');
                console.error('格式錯誤: ', e);
            }
        }

        function renderVocab() {
            const list = document.getElementById('vocab-list');
            const count = document.getElementById('vocab-count');
            
            if (vocabData.length === 0) return;
            
            count.textContent = vocabData.length;
            list.innerHTML = "";
            
            const sortedVocab = [...vocabData].sort((a,b) => a.word.localeCompare(b.word));
            sortedVocab.forEach((v, index) => {
                list.innerHTML += `
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" 
                        onclick="scrollToVocab('${v.id || v.word}')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">${index + 1}.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">${v.word}</div>
                                    <button onclick="event.stopPropagation(); speakWord('${v.word}')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                ${v.ipa ? `<div class="text-xs text-blue-600 font-semibold mt-1">${v.ipa}</div>` : ''}
                                ${v.pos ? `<div class="text-xs text-slate-500 mt-0.5">${v.pos}</div>` : ''}
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">${v.def || ''}</div>
                        ${v.cn ? `<div class="text-xs text-blue-700 font-semibold ml-6">${v.cn}</div>` : ''}
                    </li>`;
            });
        }
        
        function speakWord(word) {
            // 使用 Web Speech API 播放發音
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 1;
                utterance.pitch = 1;
                speechSynthesis.speak(utterance);
            } else {
                console.warn('您的瀏覽器不支援語音合成功能');
            }
        }

        // YouTube Player
        function onYouTubeIframeAPIReady() {
            youtubeAPIReady = true;
            console.log('YouTube API Ready');
            // Only initialize player if a valid video ID is set
            if (videoId && videoId.length === 11) {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: { rel: 0, modestbranding: 1 },
                    events: {
                        onReady: () => {
                            playerReady = true;
                            player.setPlaybackRate(currentPlaybackSpeed);
                            console.log('YouTube Player Ready');
                        },
                        onStateChange: (event) => {
                            updatePlayPauseButton();
                        }
                    }
                });
            }
        }
        
        function initializePlayer(id) {
            // Initialize player with a specific video ID
            if (!id || id.length !== 11) return;
            videoId = id;
            localStorage.setItem('videoId', id);
            
            // Wait for YouTube API to be ready
            if (!youtubeAPIReady || typeof YT === 'undefined' || typeof YT.Player === 'undefined') {
                console.log('等待 YouTube API 載入...');
                setTimeout(() => initializePlayer(id), 200);
                return;
            }
            
            if (!player) {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: { rel: 0, modestbranding: 1 },
                    events: {
                        onReady: () => {
                            playerReady = true;
                            player.setPlaybackRate(currentPlaybackSpeed);
                            console.log('YouTube Player Ready');
                        },
                        onStateChange: (event) => {
                            updatePlayPauseButton();
                        }
                    }
                });
            } else if (playerReady) {
                player.loadVideoById(videoId);
            }
        }

        function jumpToTime(seconds) {
            if (!player || !playerReady || typeof seconds !== 'number') return;
            player.seekTo(seconds, true);
            player.playVideo();
        }

        

        function setTimeByInput(idx) {
            if (!transcriptData[idx]) return;
            
            const minInput = document.getElementById(`min-input-${idx}`);
            const secInput = document.getElementById(`sec-input-${idx}`);
            
            const minutes = parseInt(minInput.value, 10) || 0;
            const seconds = parseInt(secInput.value, 10) || 0;
            
            if (minutes < 0 || seconds < 0 || seconds > 59) {
                alert('請輸入有效的時間（秒數必須 0-59）');
                return;
            }
            
            const totalSeconds = minutes * 60 + seconds;
            transcriptData[idx].t = totalSeconds;
            localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
            renderTranscript();
            console.log(`✅ 時間戳記已設定: ${formatTime(totalSeconds)}`);
        }

        // Insert Transcript Modal Functions
        let currentInsertIndex = null;

        function openInsertModal(idx) {
            currentInsertIndex = idx;
            document.getElementById('insert-segment-index').textContent = idx + 1;
            document.getElementById('insert-input').value = '';
            document.getElementById('insert-modal').classList.remove('hidden');
            document.getElementById('insert-input').focus();
        }

        function closeInsertModal() {
            document.getElementById('insert-modal').classList.add('hidden');
            currentInsertIndex = null;
        }

        function copyInsertPrompt() {
            let promptText = '';
            
            // Add video URL if available
            if (videoId && videoId.length === 11) {
                promptText += `https://www.youtube.com/watch?v=${videoId}\n\n`;
            } else {
                promptText += '🔻\n\n';
            }
            
            promptText += `將以上影片從 ${formatTime(transcriptData[currentInsertIndex]?.t || 0)} 開始的演講內容，整理成英文和中文隨段落對照的逐字稿，並以以下格式嚴格依照 JSON Array 格式輸出結果：
{
    en: "When I found out my grandmother, my last living grandparent, was dying, my first thought was, \"I need to draw her hands.\" I'm a visual artist, a cartoonist for The New Yorker, and comics writer, so drawing is how I understand much of the world.",
    cn: "當我得知我的祖母——我最後一位在世的祖父母——即將離世時，我的第一個念頭是：「我需要畫下她的手。」我是一位視覺藝術家，也是《紐約客》的漫畫家和漫畫作者，所以繪畫是我理解這個世界的主要方式。"
},
{
    en: "For a long time, my cartoons had been impersonal. Commentary on the world around me, sure, but not really about me. The closest my personal life got to influencing my cartoons were cartoons I lifted from things my friends and family had said around me. It was only after my daughter Ellika was born that my personal life began to creep into my cartoons more.",
    cn: "很長一段時間以來，我的漫畫都是非個人化的。它們是對周遭世界的評論，沒錯，但並不真正關於我自己。我的個人生活對漫畫最接近的影響，頂多就是從朋友和家人的談話中取材。直到我女兒埃莉卡 (Ellika) 出生後，我的個人生活才開始更多地滲透進我的漫畫中。"
}`;
            
            navigator.clipboard.writeText(promptText).then(() => {
                const copyBtn = document.getElementById('copy-insert-prompt-btn');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span class="material-symbols-outlined">done</span>';
                copyBtn.classList.remove('bg-indigo-50', 'text-indigo-700');
                copyBtn.classList.add('bg-green-50', 'text-green-700');
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.classList.remove('bg-green-50', 'text-green-700');
                    copyBtn.classList.add('bg-indigo-50', 'text-indigo-700');
                }, 2000);
                
                console.log('✅ Insert Prompt已複製到剪貼簿');
            }).catch(err => {
                console.error('複製失敗:', err);
                alert('複製失敗，請重試');
            });
        }

        function insertTranscriptFromIndex() {
            if (currentInsertIndex === null || currentInsertIndex === undefined) return;
            
            try {
                const input = document.getElementById('insert-input').value.trim();
                if (!input) {
                    alert('請輸入逐字稿資料');
                    return;
                }
                
                const newData = parseJSON(input);
                if (!Array.isArray(newData)) {
                    alert('格式錯誤：必須是陣列');
                    return;
                }
                
                if (newData.length === 0) {
                    alert('請至少輸入一段逐字稿');
                    return;
                }
                
                // Preserve segments before currentInsertIndex, replace everything from currentInsertIndex onwards
                const preservedSegments = transcriptData.slice(0, currentInsertIndex);
                transcriptData = [...preservedSegments, ...newData];
                
                localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
                renderTranscript();
                closeInsertModal();
                
                alert(`✅ 已從段落 ${currentInsertIndex + 1} 插入 ${newData.length} 段逐字稿\n保留前 ${currentInsertIndex} 段，總共 ${transcriptData.length} 段`);
                console.log(`✅ 插入逐字稿: 保留 ${currentInsertIndex} 段，新增 ${newData.length} 段，總計 ${transcriptData.length} 段`);
            } catch (e) {
                alert('格式錯誤：' + e.message + '\n\n請確認 JSON 格式是否正確');
                console.error('格式錯誤: ', e);
            }
        }

        function editSegment(idx) {
            const seg = transcriptData[idx];
            if (!seg) return;
            
            // Store current editing index
            window.currentEditIndex = idx;
            
            // Fill in the modal
            document.getElementById('edit-en-input').value = seg.en || '';
            document.getElementById('edit-cn-input').value = seg.cn || '';
            
            // Show modal
            document.getElementById('edit-modal').classList.remove('hidden');
            
            // Focus on English input
            setTimeout(() => {
                document.getElementById('edit-en-input').focus();
            }, 100);
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            window.currentEditIndex = null;
        }

        function saveEdit() {
            const idx = window.currentEditIndex;
            if (idx === null || idx === undefined || !transcriptData[idx]) return;
            
            const enText = document.getElementById('edit-en-input').value.trim();
            const cnText = document.getElementById('edit-cn-input').value.trim();
            
            if (enText) {
                transcriptData[idx].en = enText;
            }
            
            transcriptData[idx].cn = cnText;
            
            localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
            renderTranscript();
            closeEditModal();
        }

        function formatTime(sec) {
            if (typeof sec !== 'number' || sec < 0) return '00:00';
            const m = Math.floor(sec / 60);
            const s = Math.floor(sec % 60);
            return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        // Interaction
        function showCard(e, id) {
            const vocab = vocabData.find(v => (v.id === id) || (v.word === id));
            if (!vocab) return;
            
            floatingCard.dataset.currentId = id;
            floatingCard.innerHTML = `
                <div class="p-4">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="text-xl font-bold flex-1">${vocab.word}</h3>
                        <button onclick="event.stopPropagation(); speakWord('${vocab.word}')" class="ml-2 p-2 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 transition" title="播放發音">
                            <span class="material-symbols-outlined text-lg">volume_up</span>
                        </button>
                    </div>
                    <div class="text-xs text-slate-500 mb-1">${vocab.pos || ''}</div>
                    ${vocab.ipa ? `<div class="text-xs text-blue-600 font-semibold mb-3">${vocab.ipa}</div>` : ''}
                    <p class="text-sm mb-3">${vocab.def}</p>
                    ${vocab.cn ? `<p class="text-xs text-blue-700 font-bold">${vocab.cn}</p>` : ''}
                </div>`;
            
            const rect = e.target.getBoundingClientRect();
            const cardWidth = 320;
            const cardHeight = 200; // 預估高度
            const padding = 10;
            
            // 計算最佳位置（避免超出螢幕）
            let left = rect.left;
            let top = rect.bottom + padding;
            
            // 水平方向調整
            if (left + cardWidth > window.innerWidth) {
                left = window.innerWidth - cardWidth - padding;
            }
            if (left < padding) {
                left = padding;
            }
            
            // 垂直方向調整（如果下方空間不足，顯示在上方）
            if (top + cardHeight > window.innerHeight) {
                top = rect.top - cardHeight - padding;
                if (top < padding) {
                    top = padding;
                }
            }
            
            floatingCard.style.left = left + 'px';
            floatingCard.style.top = top + 'px';
            floatingCard.classList.remove('hidden');
        }
        
        function toggleCard(e, id) {
            e.stopPropagation();
            e.preventDefault();
            
            // 如果已經顯示同一個字卡，則關閉
            if (!floatingCard.classList.contains('hidden') && floatingCard.dataset.currentId === id) {
                hideCard();
            } else {
                showCard(e, id);
            }
        }

        function hideCard() {
            floatingCard.classList.add('hidden');
            floatingCard.dataset.currentId = '';
        }
        
        // 點擊外部關閉字卡
        document.addEventListener('click', function(e) {
            // 延遲執行，讓 toggleCard 先完成
            setTimeout(() => {
                if (!floatingCard.classList.contains('hidden') && 
                    !floatingCard.contains(e.target) && 
                    !e.target.closest('.vocab-word') && 
                    !e.target.closest('.vocab-word-custom')) {
                    hideCard();
                }
            }, 100);
        });

        function toggleTranslations() {
            translationsVisible = !translationsVisible;
            const toggleBtnText = document.getElementById('toggle-btn-text');
            const cnToggleText = document.getElementById('cn-toggle-text');
            
            if (toggleBtnText) {
                toggleBtnText.innerText = translationsVisible ? "Hide CN" : "Show CN";
            }
            if (cnToggleText) {
                cnToggleText.innerText = translationsVisible ? "隱藏" : "中文";
            }
            
            applyTranslationState();
        }

        // Quiz Logic
        function openQuiz() {
            const modal = document.getElementById('quiz-modal');
            modal.classList.remove('hidden');
            
            // 檢查是否為雙語格式
            const isBilingual = typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData;
            
            // 顯示或隱藏語言選擇器
            const languageSelector = document.getElementById('quiz-language-selector');
            if (isBilingual) {
                languageSelector.classList.remove('hidden');
                updateQuizLanguageSelector();
            } else {
                languageSelector.classList.add('hidden');
            }
            
            renderQuizContent();
        }

        function renderQuizContent() {
            const content = document.getElementById('quiz-content');
            const footer = document.getElementById('quiz-footer');

            // 檢查是否為雙語格式或傳統格式
            let questionsToDisplay = [];
            let isBilingual = false;
            
            if (typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData) {
                // 雙語格式
                isBilingual = true;
                questionsToDisplay = quizLanguage === 'english' ? quizData.english : quizData.chinese;
            } else if (Array.isArray(quizData)) {
                // 傳統格式
                questionsToDisplay = quizData;
            }

            if (!Array.isArray(questionsToDisplay) || questionsToDisplay.length === 0) {
                content.innerHTML = `
                    <div class="p-6 rounded-xl border border-slate-200 bg-slate-50 text-slate-700">
                        尚未匯入 Quiz 題庫，請先用上方的 Quiz Data 按鈕貼上題庫。
                    </div>
                `;
                footer.innerHTML = `<button onclick="closeQuiz()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-900 transition">Close</button>`;
                return;
            }

            footer.innerHTML = `<button onclick="submitQuiz()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 shadow-md transition">Submit Answers</button>`;

            content.innerHTML = questionsToDisplay.map((q, i) => `
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors" id="q-block-${i}">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">${i + 1}</span>
                        ${q.q}
                    </p>
                    <div class="space-y-3 pl-9">
                        ${(q.options || []).map((opt, optIdx) => `
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q${i}" value="${optIdx}" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">${opt}</span>
                            </label>
                        `).join('')}
                    </div>
                    <div class="feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2"></div>
                </div>
            `).join('');
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').classList.add('hidden');
        }

        function submitQuiz() {
            let score = 0;
            let allAnswered = true;

            // 決定使用哪份題庫
            let questionsToScore = [];
            if (typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData) {
                // 雙語格式 - 根據選擇的語言取用對應版本
                questionsToScore = quizLanguage === 'english' ? quizData.english : quizData.chinese;
            } else if (Array.isArray(quizData)) {
                // 傳統格式
                questionsToScore = quizData;
            }

            questionsToScore.forEach((q, i) => {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                const block = document.getElementById(`q-block-${i}`);
                const feedback = block ? block.querySelector('.feedback') : null;

                if (!block || !feedback) return;

                block.classList.remove('bg-green-50', 'border-green-200', 'bg-red-50', 'border-red-200');
                feedback.className = 'feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2';

                if (selected) {
                    feedback.classList.remove('hidden');
                    if (parseInt(selected.value, 10) === q.correct) {
                        score++;
                        feedback.innerHTML = `<span class="material-symbols-outlined">check_circle</span> Correct!`;
                        feedback.classList.add('bg-green-100', 'text-green-700');
                        block.classList.add('bg-green-50/50', 'border-green-200');
                    } else {
                        feedback.innerHTML = `<span class="material-symbols-outlined">cancel</span> Incorrect. The correct answer is: <span class="italic">${q.options[q.correct]}</span>`;
                        feedback.classList.add('bg-red-100', 'text-red-700');
                        block.classList.add('bg-red-50/50', 'border-red-200');
                    }
                } else {
                    allAnswered = false;
                }
            });

            const footer = document.getElementById('quiz-footer');
            if (allAnswered || confirm("You haven't answered all questions. Submit anyway?")) {
                let message = '';
                let colorClass = '';

                if (score === questionsToScore.length) {
                    message = 'Perfect Score! 🎉';
                    colorClass = 'text-green-600';
                } else if (score > questionsToScore.length / 2) {
                    message = 'Great Job! 👍';
                    colorClass = 'text-blue-600';
                } else {
                    message = 'Keep Practicing! 💪';
                    colorClass = 'text-orange-500';
                }

                footer.innerHTML = `
                    <div class="flex items-center gap-4 w-full justify-between">
                        <div>
                            <p class="text-sm text-gray-500 uppercase tracking-wider font-bold">Your Score</p>
                            <p class="text-2xl font-bold ${colorClass}">${score} / ${questionsToScore.length} - ${message}</p>
                        </div>
                        <button onclick="closeQuiz()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-900 transition">Close</button>
                    </div>`;
            }
        }

        function applyTranslationState() {
            document.querySelectorAll('.cn-text').forEach(el => {
                if (translationsVisible) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            });
        }

        function scrollToVocab(id) {
            const span = document.querySelector(`.vocab-word[data-id="${id}"]`);
            if (span) {
                span.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function increaseFontSize() {
            if (currentFontSize < 32) {
                currentFontSize += 2;
                applyFontSize();
            }
        }

        function decreaseFontSize() {
            if (currentFontSize > 12) {
                currentFontSize -= 2;
                applyFontSize();
            }
        }

        function applyFontSize() {
            const transcriptContent = document.getElementById('transcript-content');
            if (transcriptContent) {
                transcriptContent.style.fontSize = currentFontSize + 'px';
            }
        }

        function increasePlaybackSpeed() {
            if (!player || !playerReady) return;
            const speeds = [0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];
            const currentIndex = speeds.indexOf(currentPlaybackSpeed);
            if (currentIndex < speeds.length - 1) {
                currentPlaybackSpeed = speeds[currentIndex + 1];
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
        }

        function decreasePlaybackSpeed() {
            if (!player || !playerReady) return;
            const speeds = [0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];
            const currentIndex = speeds.indexOf(currentPlaybackSpeed);
            if (currentIndex > 0) {
                currentPlaybackSpeed = speeds[currentIndex - 1];
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
        }

        function updateSpeedDisplay() {
            const display = document.getElementById('speed-display');
            if (display) {
                display.textContent = currentPlaybackSpeed.toFixed(2) + 'x';
            }
        }

        function togglePlayPause() {
            if (!player || !playerReady) return;
            
            const state = player.getPlayerState();
            const playIcon = document.getElementById('play-icon');
            const playText = document.getElementById('play-text');
            
            // YT.PlayerState: UNSTARTED (-1), ENDED (0), PLAYING (1), PAUSED (2), BUFFERING (3), CUED (5)
            if (state === 1) { // Playing
                player.pauseVideo();
                playIcon.textContent = 'play_arrow';
                playText.textContent = '播放';
            } else { // Paused or other states
                player.playVideo();
                playIcon.textContent = 'pause';
                playText.textContent = '暫停';
            }
        }

        function updatePlayPauseButton() {
            if (!player || !playerReady) return;
            const state = player.getPlayerState();
            const playIcon = document.getElementById('play-icon');
            const playText = document.getElementById('play-text');
            
            if (state === 1) { // Playing
                playIcon.textContent = 'pause';
                playText.textContent = '暫停';
            } else {
                playIcon.textContent = 'play_arrow';
                playText.textContent = '播放';
            }
        }

        function resetSettings() {
            currentFontSize = 18;
            applyFontSize();
            
            if (player && playerReady) {
                currentPlaybackSpeed = 1.0;
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
            
            translationsVisible = false;
            const toggleBtnText = document.getElementById('toggle-btn-text');
            const cnToggleText = document.getElementById('cn-toggle-text');
            if (toggleBtnText) toggleBtnText.innerText = 'Show CN';
            if (cnToggleText) cnToggleText.innerText = '中文';
            applyTranslationState();
        }

        function changeVideoUrl() {
            const newUrl = prompt('貼上 YouTube 網址或影片 ID:', videoId);
            if (!newUrl || newUrl.trim() === '') return;
            
            try {
                let id = newUrl.trim();
                
                // 提取影片 ID
                let m = id.match(/[?&]v=([^&]+)/);
                if (m) id = m[1];
                
                m = id.match(/youtu\.be\/([^?]+)/);
                if (m) id = m[1];
                
                id = id.split('&')[0].split('?')[0];
                
                if (id.length !== 11) throw new Error("無效的影片 ID");
                
                videoId = id;
                if (player && playerReady) {
                    player.loadVideoById(videoId);
                    console.log(`✅ 影片已更換: ${videoId}`);
                }
            } catch (e) {
                console.error("錯誤: " + e.message);
            }
        }

        // Export Function
        function downloadHTML() {
            const clone = document.documentElement.cloneNode(true);
            
            // Replace entire navigation bar with simplified Export-only version
            const nav = clone.querySelector('nav');
            if (nav) {
                nav.innerHTML = `
                    <div class="max-w-7xl mx-auto px-4 sm:px-6">
                        <div class="flex justify-between h-16 items-center">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                    <span class="material-symbols-outlined text-white text-xl">school</span>
                                </div>
                                <div class="flex flex-col">
                                    <div class="font-bold text-lg text-slate-900">StudyEngine</div>
                                    <div class="text-xs text-slate-500 hidden sm:block">英語學習平台</div>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <button onclick="toggleExportMenu()" class="px-3 py-2 rounded-lg border border-purple-200 bg-purple-50 hover:bg-purple-100 text-purple-700 transition text-sm font-medium flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-lg">bookmark</span>
                                    <span class="hidden sm:inline">Export Words (</span><span class="sm:hidden">(</span><span id="selected-count">${selectedWords.length}</span><span>)</span>
                                </button>
                                <div id="export-menu" class="hidden absolute top-full right-0 mt-2 bg-white border border-slate-200 rounded-xl shadow-lg z-50 min-w-max overflow-hidden">
                                    <button onclick="copyExportPrompt()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 border-b border-slate-100 flex items-center gap-2 text-sm" title="複製生成AI指令的Prompt">
                                        <span class="material-symbols-outlined text-sm text-blue-600">content_copy</span> <span>複製 Prompt</span>
                                    </button>
                                    <button onclick="exportSelectedWords()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 flex items-center gap-2 text-sm" title="下載選中的生字">
                                        <span class="material-symbols-outlined text-sm text-blue-600">download</span> <span>下載文字檔</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Remove all Five Server and third-party injected code
            const scriptsToRemove = clone.querySelectorAll('script[data-id="five-server"], script[id="www-widgetapi-script"]');
            scriptsToRemove.forEach(s => s.remove());
            
            // Remove all injected styles (Five Server, Tailwind compiled, third-party)
            const stylesToRemove = clone.querySelectorAll('style[id*="five"], style[class*="five"], style:not([type])');
            stylesToRemove.forEach(s => {
                const content = s.textContent || '';
                if (content.includes('five-server') || 
                    content.includes('fiveserver') || 
                    content.includes('keyword-info') ||
                    content.includes('tippy-') ||
                    content.includes('ubersuggest') ||
                    content.includes('bl-info') ||
                    content.includes('kw-info') ||
                    content.includes('statistics-graph') ||
                    content.includes('ue-sidebar') ||
                    content.includes('tw-border-spacing') ||
                    content.includes('tailwindcss v3.4')) {
                    s.remove();
                }
            });
            
            // Remove Ubersuggest/extension divs
            const extensionDivs = clone.querySelectorAll('.ue-sidebar-container, [class*="ubersuggest"]');
            extensionDivs.forEach(div => div.remove());

            let html = clone.outerHTML;

            // Fix toggleExportMenu function for exported file (use 'export-menu' instead of type parameter)
            html = html.replace(
                /function toggleExportMenu\(type = 'desktop'\) \{\s*const menuId = type === 'mobile' \? 'export-menu-mobile' : 'export-menu-desktop';/,
                `function toggleExportMenu(type = 'desktop') {
            const menuId = 'export-menu';`
            );
            
            // Add toggleMobileMenu function if not present
            if (!html.includes('function toggleMobileMenu()')) {
                const insertPoint = html.indexOf('function toggleExportMenu');
                if (insertPoint !== -1) {
                    html = html.slice(0, insertPoint) + 
                           `function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('hamburger-btn');
            if (!menu || !btn) return;
            menu.classList.toggle('hidden');
            btn.classList.toggle('active');
        }

        ` + 
                           html.slice(insertPoint);
                }
            }

            // Remove Insert button from exported file
            html = html.replace(
                /<button[^>]*onclick="openInsertModal\([^)]*\)"[^>]*>[\s\S]*?<\/button>\s*/g,
                ''
            );

            // Inject data (keep videoId empty for exported files)
            html = html.replace(
                /let transcriptData = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('transcriptData'\) \|\| '\[\]'\));/s,
                `let transcriptData = ${JSON.stringify(transcriptData)};`
            );
            html = html.replace(
                /let vocabData = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('vocabData'\) \|\| '\[\]'\));/s,
                `let vocabData = ${JSON.stringify(vocabData)};`
            );
            html = html.replace(
                /let quizData = (?:\[.*?\]|\{.*?\}|JSON\.parse\(localStorage\.getItem\('quizData'\) \|\| '\[\]'\));/s,
                `let quizData = ${JSON.stringify(quizData)};`
            );
            html = html.replace(
                /let selectedWords = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('selectedWords'\) \|\| '\[\]'\));/s,
                `let selectedWords = ${JSON.stringify(selectedWords)};`
            );
            html = html.replace(
                /let videoId = (?:localStorage\.getItem\('videoId'\) \|\| ''|'[^']*');/,
                `let videoId = localStorage.getItem('videoId') || '';`
            );

            // 確保 player 是空的 div，不要包含 iframe
            html = html.replace(
                /<iframe[^>]*id="player"[^>]*>[\s\S]*?<\/iframe>/,
                '<div id="player" class="absolute inset-0"></div>'
            );
            html = html.replace(
                /<div id="player"[^>]*>[\s\S]*?<\/div>/,
                '<div id="player" class="absolute inset-0"></div>'
            );

            // Remove Capture buttons from exported file
            html = html.replace(
                /<button[^>]*onclick="captureTime\([^)]+\)"[^>]*>[\s\S]*?Capture[\s\S]*?<\/button>/g,
                ''
            );
            
            // Remove captureTime function from exported file
            html = html.replace(
                /function captureTime\([^)]*\) \{[\s\S]*?\n        \}/,
                ''
            );
            
            // Update video section hint text
            html = html.replace(
                /點擊時間標籤跳轉，按 Capture 設定當前播放時間/,
                '點擊時間標籤跳轉到指定時間'
            );

            // Download
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'study_guide.html';
            a.click();
            URL.revokeObjectURL(url);

            console.log(`✅ 匯出成功！\n逐字稿: ${transcriptData.length} 段\n單字: ${vocabData.length} 個\n影片: 需透過「更換影片」按鈕設定`);
        }

        // Load YouTube API
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        document.head.appendChild(tag);

        // Global YouTube Ready handler
        window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

        // Initialize if data exists
        if (transcriptData.length > 0 || vocabData.length > 0) {
            renderTranscript();
            renderVocab();
        }
        
        // Update transcript title if CEFR level is set
        if (cefrLevel) {
            const transcriptTitle = document.getElementById('transcript-title');
            if (transcriptTitle) {
                transcriptTitle.textContent = `摘要（${cefrLevel}）`;
            }
        }
        
        // Update selected word count
        updateSelectedCount();
        
        // Text Selection Handler
        document.addEventListener('mouseup', handleTextSelection);
        
        function handleTextSelection(e) {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();
            
            if (!selectedText || selectedText.length === 0) {
                hideSelectionPopup();
                return;
            }
            
            // Check if selection is within transcript
            const container = document.getElementById('transcript-content');
            if (!container || !container.contains(selection.anchorNode)) {
                hideSelectionPopup();
                return;
            }
            
            // Show popup near cursor
            const popup = document.getElementById('selection-popup');
            const range = selection.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            
            popup.style.left = (rect.left + rect.width / 2 - 60) + 'px';
            popup.style.top = (rect.top - 45) + 'px';
            popup.classList.remove('hidden');
            
            popup.onclick = () => addSelectedWord(selectedText);
        }
        
        function hideSelectionPopup() {
            const popup = document.getElementById('selection-popup');
            if (popup) popup.classList.add('hidden');
        }
        
        function addSelectedWord(word) {
            word = word.trim();
            if (!word || selectedWords.includes(word)) {
                hideSelectionPopup();
                window.getSelection().removeAllRanges();
                return;
            }
            
            selectedWords.push(word);
            localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
            updateSelectedCount();
            highlightSelectedWords();
            hideSelectionPopup();
            window.getSelection().removeAllRanges();
            
            console.log(`✅ 已加入生字: ${word}`);
        }
        
        function removeSelectedWord(word) {
            word = word.trim();
            const index = selectedWords.indexOf(word);
            if (index > -1) {
                selectedWords.splice(index, 1);
                localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
                updateSelectedCount();
                highlightSelectedWords();
                console.log(`❌ 已取消選取: ${word}`);
            }
        }
        
        function updateSelectedCount() {
            const countEl = document.getElementById('selected-count');
            const countElMobile = document.getElementById('selected-count-mobile');
            if (countEl) countEl.textContent = selectedWords.length;
            if (countElMobile) countElMobile.textContent = selectedWords.length;
        }
        
        function highlightSelectedWords() {
            const container = document.getElementById('transcript-content');
            if (!container) return;
            
            // Remove existing highlights
            container.querySelectorAll('.selected-word').forEach(el => {
                el.outerHTML = el.textContent;
            });
            
            // Re-render to apply new highlights
            renderTranscript();
        }
        
        function toggleExportMenu(type = 'desktop') {
            const menuId = 'export-menu';
            const menu = document.getElementById(menuId);
            if (!menu) return;
            
            menu.classList.toggle('hidden');
            
            // 點擊外部時關閉選單
            if (!menu.classList.contains('hidden')) {
                document.addEventListener('click', (e) => {
                    if (!e.target.closest(`#${menuId}`) && !e.target.closest('button[onclick*="toggleExportMenu"]')) {
                        menu.classList.add('hidden');
                    }
                }, { once: true });
            }
        }
        
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('hamburger-btn');
            
            menu.classList.toggle('hidden');
            btn.classList.toggle('active');
            
            // 點擊外部時關閉選單
            if (!menu.classList.contains('hidden')) {
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#mobile-menu') && !e.target.closest('#hamburger-btn')) {
                        menu.classList.add('hidden');
                        btn.classList.remove('active');
                    }
                }, { once: true });
            }
        }

        function generateExportPrompt() {
            if (selectedWords.length === 0) {
                return '';
            }
            
            let prompt = selectedWords.join('\n');
            prompt += '\n\n將以上英文單字嚴格依照以下 JSON Array 格式輸出結果：\n\n';
            prompt += '1.  **id**: 單字的全小寫形式。\n';
            prompt += '2.  **word**: 單字的首字母大寫。\n';
            prompt += '3.  **ipa**: 該單字的 IPA 音標。\n';
            prompt += '4.  **pos**: 詞性 (如 noun, verb, adjective)。\n';
            prompt += '5.  **def**: 簡潔的英文定義。\n';
            prompt += '6.  **cn**: 繁體中文解釋 (若有特定語境請一併標註)。\n';
            prompt += '7.  **image**: 請輸出格式為 `https://source.unsplash.com/featured/?{單字}` 的連結，將 `{單字}` 替換為該單字的英文內容，以便自動抓取相關圖片。\n\n';
            prompt += '範例格式：\n\n';
            prompt += '[\n';
            prompt += '    {\n';
            prompt += '        "id": "pareidolia",\n';
            prompt += '        "word": "Pareidolia",\n';
            prompt += '        "ipa": "/ˌpær.ɪˈdoʊ.li.ə/",\n';
            prompt += '        "pos": "noun",\n';
            prompt += '        "def": "The psychological phenomenon of seeing recognizable shapes, especially faces, in random or vague stimuli.",\n';
            prompt += '        "cn": "幻想性錯覺 (尤指將模糊圖像看作人臉)",\n';
            prompt += '        "image": "https://source.unsplash.com/featured/?pareidolia"\n';
            prompt += '    }\n';
            prompt += ']\n';
            
            return prompt;
        }

        function copyExportPrompt() {
            if (selectedWords.length === 0) {
                alert('尚未選取任何生字');
                return;
            }
            
            const prompt = generateExportPrompt();
            navigator.clipboard.writeText(prompt).then(() => {
                document.getElementById('export-menu').classList.add('hidden');
                console.log(`✅ Export Prompt 已複製 (${selectedWords.length} 個生字)`);
            }).catch(() => {
                alert('複製失敗，請重試');
            });
        }

        function exportSelectedWords() {
            if (selectedWords.length === 0) {
                alert('尚未選取任何生字');
                return;
            }
            
            const text = selectedWords.map((word, i) => `${i + 1}. ${word}`).join('\n');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'selected_words.txt';
            a.click();
            URL.revokeObjectURL(url);
            
            console.log(`✅ 已匯出 ${selectedWords.length} 個生字`);
        }
    </script>


</body></html>
