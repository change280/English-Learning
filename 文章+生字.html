<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Study Guide: How Art Helped Me Grapple with Grief</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400&family=Inter:wght@400;500;600;700&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Google+Symbols:opsz,wght,FILL,GRAD,ROND@24,400,0,0,50&icon_names=link" rel="stylesheet">

    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                    },
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            900: '#0c4a6e',
                        }
                    }
                }
            }
        }
    </script>

    <!-- Custom Styles -->
    <style>
        /* Interactive Vocabulary Styles */
        .vocab-span {
            border-bottom: 2px solid #bae6fd;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .vocab-span:hover, .vocab-span.active {
            background-color: #e0f2fe;
            border-bottom-color: #0284c7;
            color: #0369a1;
        }
        
        /* Translation Text Styles */
        .cn-text {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.95em;
            color: #4b5563;
            border-left: 3px solid #e5e7eb;
            padding-left: 1rem;
            transition: opacity 0.3s ease;
        }
        .cn-text.hidden-trans {
            display: none;
        }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Floating Card Animation - Gentle Float */
        .float-enter {
            opacity: 0;
            transform: translateY(10px) translateX(-50%);
        }
        .float-enter-active {
            opacity: 1;
            transform: translateY(0) translateX(-50%);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }
        .float-exit {
            opacity: 1;
            transform: translateY(0) translateX(-50%);
        }
        .float-exit-active {
            opacity: 0;
            transform: translateY(5px) translateX(-50%);
            transition: opacity 0.2s ease-in, transform 0.2s ease-in;
        }

        /* Toast Notification */
        #toast-container {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            z-index: 100;
            pointer-events: none;
            transition: all 0.3s ease;
            opacity: 0;
        }
        #toast-container.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 font-sans">
    
    <!-- Navigation -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-brand-600 text-3xl">draw</span>
                    <div class="flex flex-col">
                        <span class="font-bold text-gray-900 leading-tight">TED <span class="text-brand-600">Study</span></span>
                        <span class="text-xs text-gray-500">Interactive Transcript</span>
                    </div>
                </div>
                <div class="flex items-center gap-2 md:gap-4">
                    <button class="text-sm font-medium text-gray-600 hover:text-brand-600 flex items-center gap-1 transition-colors hidden md:flex" onclick="toggleAllTranslations()">
                        <span class="material-symbols-outlined text-lg">translate</span>
                        <span id="trans-btn-text">Hide Translations</span>
                    </button>
                    
                    <button class="text-sm font-medium text-gray-600 hover:text-brand-600 flex items-center gap-1 transition-colors border border-gray-200 rounded-lg px-3 py-1.5 hover:bg-gray-50" onclick="copySourceCode()">
                        <span class="material-symbols-outlined text-lg">code</span>
                        <span class="hidden sm:inline">Copy Code</span>
                    </button>

                    <button class="bg-brand-600 text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-brand-700 transition shadow-sm flex items-center gap-1" onclick="openQuiz()">
                        <span class="material-symbols-outlined text-lg">school</span>
                        Quiz
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="relative bg-gray-900 text-white overflow-hidden">
        <div class="absolute inset-0">
            <img src="https://images.unsplash.com/photo-1547891654-e66ed7ebb968?q=80&w=2070&auto=format&fit=crop" alt="Background Art" class="w-full h-full object-cover opacity-30">
            <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent"></div>
        </div>
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24">
            <div class="max-w-3xl">
                <span class="inline-block py-1 px-3 rounded bg-brand-900/50 border border-brand-500/30 text-brand-300 text-xs font-semibold tracking-wider uppercase mb-4 backdrop-blur-sm">
                    Arts & Design
                </span>
                <h1 class="text-3xl md:text-5xl font-serif font-bold mb-6 leading-tight">
                    How Art Helped Me Grapple with Grief
                </h1>
                <p class="text-lg md:text-xl text-gray-300 mb-8 font-light leading-relaxed">
                    Cartoonist Navied Mahdavian explores the profound connection between creativity and loss, sharing how drawing his grandmother's hands allowed him to confront mortality and preserve memory.
                </p>
                <div class="flex flex-wrap gap-4">
                    <div class="flex items-center gap-2 text-sm text-gray-400">
                        <span class="material-symbols-outlined text-base">person</span>
                        Navied Mahdavian
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-400">
                        <span class="material-symbols-outlined text-base">schedule</span>
                        6 min read
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-400">
                        <span class="material-symbols-outlined text-base">auto_stories</span>
                        <span id="vocab-count">0</span> Key Words
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Layout -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        <div class="flex flex-col lg:flex-row gap-8 relative">
            
            <!-- Left Column: Transcript -->
            <main class="lg:w-2/3">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 md:p-10 mb-8">
                    <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-100">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                            <span class="material-symbols-outlined text-brand-500">description</span>
                            Transcript
                        </h2>
                        <div class="flex gap-2">
                            <button class="p-2 text-gray-400 hover:text-gray-700 hover:bg-gray-100 rounded-full" onclick="changeFontSize('minus')" title="Decrease font size">
                                <span class="material-symbols-outlined text-lg">text_decrease</span>
                            </button>
                            <button class="p-2 text-gray-400 hover:text-gray-700 hover:bg-gray-100 rounded-full" onclick="changeFontSize('plus')" title="Increase font size">
                                <span class="material-symbols-outlined text-lg">text_increase</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Transcript Container (Populated by JS) -->
                    <div id="transcript-container" class="space-y-8 font-serif text-lg leading-loose text-gray-800"></div>
                </div>

                <!-- Footer Inspiration -->
                <div class="bg-brand-50 rounded-xl p-8 border border-brand-100 flex flex-col md:flex-row items-center gap-6">
                    <img src="https://images.unsplash.com/photo-1515405295579-ba7f9f92f413?q=80&w=2070&auto=format&fit=crop" alt="Artistic impression" class="w-full md:w-48 h-32 object-cover rounded-lg shadow-sm">
                    <div>
                        <h3 class="font-bold text-gray-900 text-lg mb-2">Why this talk matters</h3>
                        <p class="text-gray-700 leading-relaxed italic">
                            "If a loved one's death makes us confront our own mortality, then the process of physically transforming myself... has made me confront it in a uniquely deep way."
                        </p>
                    </div>
                </div>
            </main>

            <!-- Right Column: Sidebar (Sticky) - Kept as a list/Quiz entry point -->
            <aside class="hidden lg:block lg:w-1/3">
                <div class="sticky top-24 space-y-6">
                    <!-- Vocabulary List (Static Reference) -->
                    <div id="vocab-card-container" class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                        <div class="bg-gray-50 border-b border-gray-100 p-4 flex justify-between items-center">
                            <h3 class="font-bold text-gray-700 flex items-center gap-2">
                                <span class="material-symbols-outlined text-yellow-500">lightbulb</span>
                                Vocabulary List
                            </h3>
                            <span class="text-xs text-gray-400 uppercase tracking-wide">Key Terms</span>
                        </div>
                        
                        <!-- List of all words for reference -->
                        <div class="p-4 max-h-[60vh] overflow-y-auto custom-scroll">
                            <ul id="vocab-sidebar-list" class="space-y-2">
                                <!-- Populated by JS -->
                            </ul>
                        </div>
                    </div>

                    <!-- Mini Quiz Teaser -->
                    <div class="bg-gradient-to-br from-indigo-600 to-purple-700 rounded-xl p-6 text-white shadow-md relative overflow-hidden group cursor-pointer" onclick="openQuiz()">
                        <div class="absolute right-0 top-0 w-32 h-32 bg-white opacity-5 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                        <span class="material-symbols-outlined text-4xl mb-3">quiz</span>
                        <h3 class="text-xl font-bold mb-1">Test Your Knowledge</h3>
                        <p class="text-indigo-100 text-sm mb-4">Master the 10 key terms from this talk.</p>
                        <button class="w-full bg-white/10 hover:bg-white/20 border border-white/30 text-white py-2 rounded-lg text-sm font-semibold transition">Start Quiz</button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Floating Vocab Card (Desktop Hover) -->
    <div id="floating-vocab-card" class="fixed z-50 bg-white rounded-xl shadow-2xl border border-gray-100 p-5 w-80 pointer-events-none hidden transition-all duration-300">
        <!-- Content injected via JS -->
    </div>

    <!-- Mobile Drawer for Vocab (Click) -->
    <div id="mobile-drawer" class="fixed inset-x-0 bottom-0 z-50 transform translate-y-full transition-transform duration-300 lg:hidden rounded-t-2xl shadow-2xl bg-white max-h-[80vh] overflow-y-auto">
        <div class="sticky top-0 bg-white border-b border-gray-100 px-4 py-3 flex justify-between items-center">
            <h3 class="font-bold text-gray-800">Vocabulary Detail</h3>
            <button class="p-1 hover:bg-gray-100 rounded-full" onclick="closeMobileDrawer()">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <div id="mobile-vocab-content" class="p-0"></div>
    </div>
    <div id="mobile-overlay" class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden" onclick="closeMobileDrawer()"></div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm" onclick="closeQuiz()"></div>
        <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-6 bg-brand-600 text-white flex justify-between items-center">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <span class="material-symbols-outlined">school</span> Quiz
                </h3>
                <button class="text-white/80 hover:text-white" onclick="closeQuiz()">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div id="quiz-content" class="p-6 overflow-y-auto custom-scroll">
                <!-- Quiz questions injected here -->
            </div>
            <div id="quiz-footer" class="p-4 border-t border-gray-100 bg-gray-50 flex justify-between items-center">
                <span id="quiz-progress" class="text-sm text-gray-500 font-medium">Question 1 of 5</span>
                <button id="quiz-next-btn" class="bg-gray-800 text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed" onclick="nextQuestion()" disabled>Next</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast-container" class="flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-lg shadow-lg">
        <span class="material-symbols-outlined text-green-400">check_circle</span>
        <span id="toast-message" class="text-sm font-medium">Code copied to clipboard!</span>
    </div>

    <!-- Application Logic -->
    <script>
        // --- Data ---
        
        const segments = [
            {
                en: "When I found out my grandmother, my last living grandparent, was dying, my first thought was, \"I need to draw her hands.\" I'm a visual artist, a cartoonist for The New Yorker, and comics writer, so drawing is how I understand much of the world.",
                cn: "當我得知我的祖母——我最後一位在世的祖父母——即將離世時，我的第一個念頭是：「我需要畫下她的手。」我是一位視覺藝術家，也是《紐約客》的漫畫家和漫畫作者，所以繪畫是我理解這個世界的主要方式。"
            },
            {
                en: "For a long time, my cartoons had been impersonal. Commentary on the world around me, sure, but not really about me. The closest my personal life got to influencing my cartoons were cartoons I lifted from things my friends and family had said around me. It was only after my daughter Ellika was born that my personal life began to creep into my cartoons more.",
                cn: "很長一段時間以來，我的漫畫都是非個人化的。它們是對周遭世界的評論，沒錯，但並不真正關於我自己。我的個人生活對漫畫最接近的影響，頂多就是從朋友和家人的談話中取材。直到我女兒埃莉卡 (Ellika) 出生後，我的個人生活才開始更多地滲透進我的漫畫中。"
            },
            {
                en: "Every artist will tell you that their medium is the highest art form. But they're wrong, because cartooning is in fact the highest art form. (Laughter)",
                cn: "每個藝術家都會告訴你，他們所用的媒介是最高的藝術形式。但他們都錯了，因為漫畫創作才是真正的最高藝術形式。（笑聲）"
            },
            {
                en: "Cartoons can say so much with so little. With just a few lines, you can express happiness, smugness and sadness. This is called face pareidolia. It's the phenomenon where we see faces in inanimate objects. We see ourselves in these cartoonish faces. They're blank canvases onto which we project ourselves.",
                cn: "漫畫可以用極少的筆觸表達極豐富的內涵。只需幾條線條，就能表現出快樂、自鳴得意和悲傷。這被稱為「臉孔幻想性錯覺」(face pareidolia)。這是一種我們在無生命物體中看到臉孔的現象。我們在這些卡通臉孔中看到了自己。它們就像空白的畫布，我們將自己投射其中。"
            },
            {
                en: "We see faces everywhere, ourselves in everything. It's evolutionary, a survival technique. But how do we convey complex emotions using just lines? Emotions like grief. This became really important to me when I found out that my grandmother was dying.",
                cn: "我們隨處可見臉孔，在萬物中看見自己。這是一種演化結果，一種生存技巧。但我們如何僅用線條來傳達複雜的情感？比如悲傷。當我得知祖母即將過世時，這個問題對我來說變得非常重要。"
            },
            {
                en: "I got to know my grandmother, Homa, in a way I didn't get to know any of my other grandparents, because they all lived and died in Iran, a country I've only ever been to twice and not since I was 10.",
                cn: "我對祖母霍瑪 (Homa) 的了解，是我對其他祖父母所沒有的，因為他們都住在伊朗並在那裡過世，那個國家我只去過兩次，而且從十歲以後就沒再去過。"
            },
            {
                en: "But Homa lived with my parents for the last 10 years of her life, and in that time, she danced the funky chicken at my wedding, she got to hold my newborn daughter, and she told me stories about Iran before the revolution over morning tea, which was usually around noon because she liked to sleep in.",
                cn: "但霍瑪在她生命的最後十年與我父母同住，在那段時間裡，她曾在我的婚禮上跳滑稽的雞舞，她抱過我剛出生的女兒，她還會在喝早茶時跟我講革命前伊朗的故事——雖然早茶通常是在中午，因為她喜歡睡懶覺。"
            },
            {
                en: "I can still, even today, recall the physical sensation of them, like the smoothness of her nails and even their smell. But not the way they looked, which is why when I found out that she was dying, my first instinct was to try to preserve that memory, my memory of her, by drawing her hands.",
                cn: "直至今日，我仍能回想起那些身體接觸的感覺，像是她指甲的光滑觸感，甚至是它們的氣味。但我記不清它們的樣子，這就是為什麼當我知道她快不行的時候，我的第一直覺是想通過畫她的手來保存那份記憶，我對她的記憶。"
            },
            {
                en: "Not surprisingly, when I finally made it there to see her, I didn't have a whole lot of time to sit around drawing because I was busy with other things, things like comforting my mom, comforting my grandmother by doing magic and helping my mom and my sister plan for what would come next.",
                cn: "不出所料，當我終於趕到那裡看她時，我並沒有太多時間坐下來畫畫，因為我忙於其他事情，比如安慰我的母親，通過變魔術來安撫祖母，以及幫助母親和姐姐計劃接下來的事宜。"
            },
            {
                en: "It's that classic Proustian experience. Life doesn't mean anything while you're moving through it. It's only when you stop to reflect on it that you can make any sense of it. Sense memory, what Proust calls involuntary memory, contains the essence of the past. And so if I wanted to tell the story of my grandma, Homa, I would have to begin with a sensation of her hands.",
                cn: "這就是經典的普魯斯特式體驗。當你身處生活中時，生活並不代表任何意義。只有當你停下來回顧時，你才能理解它。感官記憶，也就是普魯斯特所說的「非自願記憶」，包含了過去的本質。因此，如果我想講述我祖母霍瑪的故事，我必須從她雙手的觸感開始。"
            },
            {
                en: "When I set out to write this comic, which was published in the L.A. Times, I wanted to take something complicated and big and make it small. Grief is complicated. I needed to reach a point where I could process my loss to distill the experience of losing my last living grandparent into its essential parts and make it clear enough that I could actually grieve.",
                cn: "當我著手創作這篇發表在《洛杉磯時報》上的漫畫時，我想把一些複雜而宏大的東西變小。悲傷是複雜的。我需要達到一個可以處理失落感的階段，將失去最後一位祖父母的經歷提煉成最本質的部分，並使其足夠清晰，以便我能真正地去哀悼。"
            },
            {
                en: "My family doesn't tend to deal well with grief, which isn't great because we have so much experience with it. When we're trying to dodge grief, we caricature those we've lost. We focus on and exaggerate their most obvious features, which is why sometimes we'll hear somebody say something like, \"He was a saint.\" He probably wasn't. (Laughter)",
                cn: "我的家人不太擅長處理悲傷，這並不好，因為我們經歷過太多次了。當我們試圖逃避悲傷時，我們會將逝去的人「漫畫化」。我們專注並誇大他們最明顯的特徵，這就是為什麼有時我們會聽到有人說：「他是個聖人。」但他可能並不是。（笑聲）"
            },
            {
                en: "When we do that, we're not actually grieving. We're not confronting the person we've lost as a complex individual, flaws and all. Cartooning has allowed me to go narrow, to find the details that are emblematic, which opens up into a whole, rich, complex person and to my complicated relationship with them.",
                cn: "當我們那樣做時，我們並不是在真正的哀悼。我們沒有將逝者視為一個包含缺點在內的複雜個體來面對。漫畫創作讓我能夠聚焦於細微之處，找到那些具象徵性的細節，進而展現出一個完整、豐富且複雜的人，以及我與他們之間複雜的關係。"
            },
            {
                en: "It avoids flattening them and leaves them their richness so I can grieve all of them. And so I focused on my grandmother's hands, the quivering lines of her arthritic fingers, the contours of her veins, now pronounced by the thinning of the skin that she spent so much time caring for.",
                cn: "這避免了將他們扁平化，並保留了他們的豐富性，這樣我才能悼念完整的他們。於是我專注於描繪祖母的手：她那因關節炎而顫抖的手指線條，以及因皮膚變薄而凸顯出的血管輪廓——那是她花了很多時間保養的肌膚。"
            },
            {
                en: "They were beautiful hands, soft from years of moisturizing. They were also the hands of someone who was really, really vain, emblematic of the gender norms of an Iranian woman of her period, and as a consequence, incapable of dealing with the process of aging well.",
                cn: "那是一雙美麗的手，因常年保濕而柔軟。這同時也是一雙非常、非常愛慕虛榮之人的手，象徵著那個時代伊朗女性的性別規範，其結果就是無法坦然面對衰老的過程。"
            },
            {
                en: "For example, I can remember this one time she called me into her room, and when I walked in, she was standing there, arms stretched out to her side and topless, and she said, \"Look what I've become.\"",
                cn: "舉個例子，我記得有一次她把我叫進房間，當我走進去時，她站在那裡，雙臂向兩側伸展，上身赤裸，她說：「看看我變成了什麼樣子。」"
            },
            {
                en: "They were also the hands that she used as she got older and was less capable of caring for herself, to hit those around her, the people she loved the most. Because I didn't actually get to draw her hands when I last saw her, and I don't have any photos of them, I had to use my own hands to draw her hands.",
                cn: "當她年事已高，越來越無法照顧自己時，這也是她用來拍打周圍人——那些她最愛的人——的手。因為我最後一次見她時實際上沒能畫下她的手，我也沒有照片，所以我必須用我自己的手來畫她的手。"
            },
            {
                en: "So I drew my hands old and spotted, my knuckles gnarled, and I imagined what it would be like for my hands to no longer be able to perform basic, everyday functions, to no longer be able to draw.",
                cn: "於是我把我的手畫得蒼老且佈滿斑點，指關節粗糙變形，我想像著如果我的手再也無法執行基本的日常功能，再也無法畫畫，那會是什麼樣子。"
            },
            {
                en: "I regularly use myself as a reference for my comics, and through this, I have become my grandmother, I have become my friends and I've even become my five-year-old daughter. It's a process that's allowed me to experience these stories more deeply, in a physical way, allowing me to inhabit them to come to a fuller, richer understanding of them in context.",
                cn: "我經常以自己作為漫畫的參考，通過這種方式，我變成了我的祖母，變成了我的朋友，甚至變成了我五歲的女兒。這是一個讓我能以身體力行的方式更深刻體驗這些故事的過程，讓我棲身其中，從而對其語境有更全面、豐富的理解。"
            },
            {
                en: "If a loved one's death makes us confront our own mortality, then the process of physically transforming myself into my grandmother or my father, who is slowly dying of kidney failure, has made me confront it in a uniquely deep way. It's a process that's also allowed me to reach a place of deeper empathy and of forgiveness.",
                cn: "如果親人的離世迫使我們面對自己的必死性，那麼將我的身體轉化為祖母或正在因腎衰竭慢慢死去的父親的過程，則讓我以一種獨特而深刻的方式面對了死亡。這也是一個讓我達到更深層共情和寬恕的過程。"
            },
            {
                en: "For me, art is about communication. It's about expressing what's most important to us and knowing that other people feel the same way, that we're not alone, which is particularly important when we're grieving.",
                cn: "對我來說，藝術就是溝通。它是關於表達對我們最重要的東西，並知道其他人也有同樣的感受，我們並不孤單，這在我們悲傷時尤為重要。"
            },
            {
                en: "It's that distillation of something complex into its simplest terms. For you to see your grandmother or a parent in the curved lines of my grandmother's beautiful hands, and to communicate without words, because words were never the point anyway.",
                cn: "它是將複雜事物提煉為最簡單形式的過程。是為了讓你從我祖母美麗雙手的彎曲線條中，看到你自己的祖母或父母，並進行無聲的交流，因為語言從來都不是重點。"
            },
            {
                en: "Thank you.",
                cn: "謝謝。"
            }
        ];

        const vocabulary = [
            {
                id: "impersonal",
                word: "Impersonal",
                ipa: "/ɪmˈpɜː.sən.əl/",
                pos: "adj.",
                def: "Lacking human emotion or warmth; not referring to any specific person.",
                cn: "非個人化的；客觀的",
                image: "https://images.unsplash.com/photo-1517457373958-b7bdd4587205?q=80&w=2069&auto=format&fit=crop"
            },
            {
                id: "pareidolia",
                word: "Pareidolia",
                ipa: "/ˌpær.ɪˈdoʊ.li.ə/",
                pos: "noun",
                def: "The psychological phenomenon of seeing recognizable shapes, especially faces, in random or vague stimuli.",
                cn: "幻想性錯覺 (尤指將模糊圖像看作人臉)",
                image: "https://images.unsplash.com/photo-1541888946425-d81bb19240f5?q=80&w=2070&auto=format&fit=crop"
            },
            {
                id: "inanimate",
                word: "Inanimate",
                ipa: "/ɪˈnæn.ə.mət/",
                pos: "adj.",
                def: "Not alive, especially not in the manner of animals and humans.",
                cn: "無生命的；死氣沉沉的",
                image: null
            },
            {
                id: "convey",
                word: "Convey",
                ipa: "/kənˈveɪ/",
                pos: "verb",
                def: "To make an idea, impression, or feeling known or understandable to someone.",
                cn: "傳達；表達",
                image: null
            },
            {
                id: "proustian",
                word: "Proustian",
                ipa: "/ˈpruː.sti.ən/",
                pos: "adj.",
                def: "Relating to Marcel Proust, especially regarding the involuntary recovery of memory through senses (like taste or smell).",
                cn: "普魯斯特式的 (尤指喚起回憶)",
                image: "https://images.unsplash.com/photo-1555562092-2339d6780c65?q=80&w=1974&auto=format&fit=crop"
            },
            {
                id: "distill",
                word: "Distill",
                ipa: "/dɪˈstɪl/",
                pos: "verb",
                def: "To extract the essential meaning or most important aspects of something.",
                cn: "提煉；萃取 (精華)",
                image: null
            },
            {
                id: "caricature",
                word: "Caricature",
                ipa: "/ˈkær.ɪ.kə.tʃʊr/",
                pos: "verb",
                def: "To represent someone with their striking characteristics exaggerated in order to create a comic or grotesque effect.",
                cn: "將...漫畫化；誇張描述",
                image: null
            },
            {
                id: "emblematic",
                word: "Emblematic",
                ipa: "/ˌɛm.bləˈmæt.ɪk/",
                pos: "adj.",
                def: "Serving as a symbol of a particular quality or concept.",
                cn: "象徵性的；典型的",
                image: null
            },
            {
                id: "gnarled",
                word: "Gnarled",
                ipa: "/nɑːrld/",
                pos: "adj.",
                def: "Knobbly, rough, and twisted, especially with age.",
                cn: "粗糙扭曲的；飽經風霜的",
                image: null
            },
            {
                id: "mortality",
                word: "Mortality",
                ipa: "/mɔːrˈtæl.ə.ti/",
                pos: "noun",
                def: "The state of being subject to death.",
                cn: "必死性；生命的有限",
                image: "https://images.unsplash.com/photo-1509653087866-91f6c2ab59f2?q=80&w=2070&auto=format&fit=crop"
            }
        ];

        // Global State
        let currentFontSize = 18; // px
        let translationsVisible = true;
        let activeVocab = null;

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderTranscript();
            renderSidebarList(); // New: Populate sidebar list
            document.getElementById('vocab-count').innerText = vocabulary.length;
        });

        // --- Rendering ---
        function renderTranscript() {
            const container = document.getElementById('transcript-container');
            let html = "";

            segments.forEach((seg, index) => {
                let processedEn = seg.en;
                
                // Highlight vocab words
                vocabulary.forEach(vocab => {
                    const regex = new RegExp(`\\b(${vocab.word})\\b|\\b(${vocab.word.toLowerCase()})\\b|\\b(${vocab.word}s)\\b`, 'gi');
                    processedEn = processedEn.replace(regex, (match) => {
                        // Changed: onclick -> onclick (for mobile) AND onmouseenter/leave (for desktop)
                        // Using 'handleVocabClick' for mobile drawer
                        // Using 'handleMouseEnter' for desktop float
                        return `<span class="vocab-span font-semibold text-brand-700" 
                                onclick="handleVocabClick('${vocab.id}', this)"
                                onmouseenter="handleMouseEnter('${vocab.id}', this)"
                                onmouseleave="handleMouseLeave()"
                                data-id="${vocab.id}">${match}</span>`;
                    });
                });

                html += `
                    <div class="paragraph-block fade-in" style="animation-delay: ${index * 0.05}s">
                        <p class="en-text mb-2 text-gray-800" style="font-size: ${currentFontSize}px;">${processedEn}</p>
                        <p class="cn-text ${translationsVisible ? '' : 'hidden-trans'}">${seg.cn}</p>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderSidebarList() {
            const listEl = document.getElementById('vocab-sidebar-list');
            listEl.innerHTML = vocabulary.map(v => `
                <li class="flex justify-between items-center p-2 rounded hover:bg-gray-50 cursor-default">
                    <span class="font-medium text-gray-700">${v.word}</span>
                    <span class="text-xs text-gray-400 font-mono bg-gray-100 px-1 rounded">${v.pos}</span>
                </li>
            `).join('');
        }

        // --- Interaction Functions ---
        
        function changeFontSize(action) {
            if (action === 'plus' && currentFontSize < 32) currentFontSize += 2;
            if (action === 'minus' && currentFontSize > 14) currentFontSize -= 2;
            
            const paragraphs = document.querySelectorAll('.en-text');
            paragraphs.forEach(p => p.style.fontSize = `${currentFontSize}px`);
        }

        function toggleAllTranslations() {
            translationsVisible = !translationsVisible;
            const els = document.querySelectorAll('.cn-text');
            const btnText = document.getElementById('trans-btn-text');
            
            if (translationsVisible) {
                els.forEach(el => el.classList.remove('hidden-trans'));
                btnText.innerText = "Hide Translations";
            } else {
                els.forEach(el => el.classList.add('hidden-trans'));
                btnText.innerText = "Show Translations";
            }
        }

        // --- Mobile Logic (Click based) ---
        function handleVocabClick(id, element) {
            // Only relevant for mobile or if user explicitly clicks
            // For desktop, hover is primary, but click can still open detail or play sound
            
            if (window.innerWidth < 1024) {
                const vocab = vocabulary.find(v => v.id === id);
                if (!vocab) return;
                
                // Find context (simple fallback)
                const segment = segments.find(s => s.en.toLowerCase().includes(vocab.word.toLowerCase()));
                const contextText = segment ? `"...${segment.en.substring(0, 100)}..."` : "";
                
                openMobileDrawer(vocab, contextText);
            }
        }

        // --- Desktop Logic (Hover/Float based) ---
        const floatingCard = document.getElementById('floating-vocab-card');
        let hoverTimeout;

        function handleMouseEnter(id, element) {
            // Only for desktop
            if (window.innerWidth < 1024) return;

            const vocab = vocabulary.find(v => v.id === id);
            if (!vocab) return;

            // Clear any pending hide
            clearTimeout(hoverTimeout);

            // Populate Card
            floatingCard.innerHTML = `
                ${vocab.image ? `<img src="${vocab.image}" class="w-full h-32 object-cover rounded-lg mb-3 shadow-sm border border-gray-100">` : ''}
                <div class="flex justify-between items-start mb-1">
                    <h3 class="text-xl font-bold text-brand-700 leading-none">${vocab.word}</h3>
                    <span class="text-xs bg-gray-100 px-2 py-1 rounded font-mono text-gray-500">${vocab.pos}</span>
                </div>
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-sm text-gray-500 italic font-serif">${vocab.ipa}</span>
                    <button class="text-brand-500 hover:text-brand-600 pointer-events-auto">
                        <span class="material-symbols-outlined text-lg">volume_up</span>
                    </button>
                </div>
                <p class="text-sm text-gray-700 leading-snug mb-2">${vocab.def}</p>
                <p class="text-sm text-brand-600 font-bold">${vocab.cn}</p>
            `;

            // Position Logic
            const rect = element.getBoundingClientRect();
            const cardWidth = 320; // w-80 is 20rem = 320px
            const gap = 10;

            // Default: Top centered
            let top = rect.top - gap; 
            let left = rect.left + (rect.width / 2) - (cardWidth / 2);

            // Boundary checks
            if (left < 10) left = 10;
            if (left + cardWidth > window.innerWidth - 10) left = window.innerWidth - cardWidth - 10;
            
            // Note: We need to translate Y up by 100% to sit *above* the word
            // But since we can't easily calculate height before render, we use bottom positioning or transform
            // Easier: Set top to rect.top and use transform: translateY(-100%) - gap
            
            floatingCard.style.top = `${rect.top}px`; 
            floatingCard.style.left = `${left}px`;
            
            // Apply a specific class for "Above" positioning logic using transform
            // We use JS to set explicit transform to handle the "above" placement dynamically
            floatingCard.style.transform = `translateY(calc(-100% - ${gap}px))`;

            // Show and Animate
            floatingCard.style.display = 'block';
            
            // Small delay to allow display:block to apply before animating opacity
            requestAnimationFrame(() => {
                floatingCard.classList.remove('float-exit', 'float-exit-active');
                floatingCard.classList.add('float-enter');
                
                requestAnimationFrame(() => {
                    floatingCard.classList.remove('float-enter');
                    floatingCard.classList.add('float-enter-active');
                });
            });
            
            // Update active state style on word
            document.querySelectorAll('.vocab-span').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
        }

        function handleMouseLeave() {
            if (window.innerWidth < 1024) return;

            // Animate out
            floatingCard.classList.remove('float-enter-active');
            floatingCard.classList.add('float-exit-active');

            // Wait for animation then hide
            hoverTimeout = setTimeout(() => {
                floatingCard.style.display = 'none';
                floatingCard.classList.remove('float-exit-active');
                
                // Clear active state on word
                document.querySelectorAll('.vocab-span').forEach(el => el.classList.remove('active'));
            }, 200); // match css transition duration
        }

        // --- Copy Source Code Functionality ---
        async function copySourceCode() {
            try {
                const htmlContent = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
                await navigator.clipboard.writeText(htmlContent);
                showToast("Code copied successfully! You can now save it as an .html file.");
            } catch (err) {
                console.error('Failed to copy: ', err);
                showToast("Failed to copy code. Please try again.");
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast-container');
            const msg = document.getElementById('toast-message');
            
            msg.innerText = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // --- Mobile Drawer ---
        function openMobileDrawer(vocab, context) {
            const drawer = document.getElementById('mobile-drawer');
            const overlay = document.getElementById('mobile-overlay');
            const content = document.getElementById('mobile-vocab-content');

            content.innerHTML = `
                <div class="p-6">
                    ${vocab.image ? `<img src="${vocab.image}" class="w-full h-40 object-cover rounded-lg mb-4 shadow-sm">` : ''}
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-2xl font-bold text-brand-700">${vocab.word}</h2>
                        <span class="text-xs bg-gray-100 px-2 py-1 rounded font-mono">${vocab.pos}</span>
                    </div>
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-gray-500 italic font-serif">${vocab.ipa}</span>
                        <button onclick="playWord('${vocab.word}')" class="p-1 text-brand-500 bg-brand-50 rounded-full">
                            <span class="material-symbols-outlined">volume_up</span>
                        </button>
                    </div>
                    <p class="mb-2 text-gray-800">${vocab.def}</p>
                    <p class="mb-4 text-brand-600 font-medium">${vocab.cn}</p>
                </div>
            `;

            drawer.classList.remove('translate-y-full');
            overlay.classList.remove('hidden');
        }

        function closeMobileDrawer() {
            document.getElementById('mobile-drawer').classList.add('translate-y-full');
            document.getElementById('mobile-overlay').classList.add('hidden');
        }

        function playWord(word) {
             const utterance = new SpeechSynthesisUtterance(word || "");
             utterance.lang = 'en-US';
             window.speechSynthesis.speak(utterance);
        }

        // --- Quiz Logic ---
        const quizQuestions = [
            { q: "Which word best describes seeing faces in clouds?", a: 1, options: ["Caricature", "Pareidolia", "Distill", "Emblematic"] },
            { q: "If something is 'inanimate', it is:", a: 2, options: ["Full of energy", "Highly emotional", "Not alive", "Very colorful"] },
            { q: "What does 'distill' mean in the context of memory?", a: 0, options: ["To extract the essential meaning", "To forget completely", "To water down", "To make complex"] },
            { q: "A 'caricature' typically involves:", a: 1, options: ["Realistic detail", "Exaggeration of features", "Scientific accuracy", "Lack of emotion"] },
            { q: "'Visceral' feelings are related to:", a: 3, options: ["Logic", "Vision", "Outer space", "Deep inward instincts"] }
        ];

        let currentQIndex = 0;
        let score = 0;

        function openQuiz() {
            currentQIndex = 0;
            score = 0;
            document.getElementById('quiz-modal').classList.remove('hidden');
            renderQuizQuestion();
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').classList.add('hidden');
        }

        function renderQuizQuestion() {
            const container = document.getElementById('quiz-content');
            const progress = document.getElementById('quiz-progress');
            const nextBtn = document.getElementById('quiz-next-btn');
            
            if (currentQIndex >= quizQuestions.length) {
                // Results
                container.innerHTML = `
                    <div class="text-center py-10">
                        <div class="inline-block p-4 rounded-full bg-brand-100 text-brand-600 mb-4">
                            <span class="material-symbols-outlined text-5xl">emoji_events</span>
                        </div>
                        <h3 class="text-2xl font-bold mb-2">Quiz Complete!</h3>
                        <p class="text-gray-600">You scored <strong class="text-brand-600">${score}</strong> out of ${quizQuestions.length}.</p>
                        <button onclick="closeQuiz()" class="mt-6 text-brand-600 font-semibold hover:underline">Return to Transcript</button>
                    </div>
                `;
                progress.innerText = "";
                nextBtn.classList.add('hidden');
                return;
            }

            nextBtn.classList.remove('hidden');
            nextBtn.innerText = "Next";
            nextBtn.disabled = true;

            const q = quizQuestions[currentQIndex];
            progress.innerText = `Question ${currentQIndex + 1} of ${quizQuestions.length}`;

            let optionsHtml = q.options.map((opt, i) => `
                <button onclick="checkAnswer(${i}, this)" class="quiz-opt w-full text-left p-4 rounded-xl border-2 border-gray-100 hover:border-brand-200 hover:bg-brand-50 transition-all mb-3 flex items-center justify-between group">
                    <span class="font-medium text-gray-700 group-hover:text-brand-700">${opt}</span>
                    <span class="material-symbols-outlined text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity">circle</span>
                </button>
            `).join('');

            container.innerHTML = `
                <h4 class="text-xl font-bold text-gray-800 mb-6">${q.q}</h4>
                <div class="space-y-2">
                    ${optionsHtml}
                </div>
            `;
        }

        function checkAnswer(selectedIndex, btn) {
            // Disable all buttons
            const buttons = document.querySelectorAll('.quiz-opt');
            buttons.forEach(b => b.disabled = true);

            const q = quizQuestions[currentQIndex];
            const isCorrect = selectedIndex === q.a;

            if (isCorrect) {
                score++;
                btn.classList.add('border-green-500', 'bg-green-50');
                btn.querySelector('.material-symbols-outlined').innerText = 'check_circle';
                btn.querySelector('.material-symbols-outlined').classList.add('text-green-500', 'opacity-100');
            } else {
                btn.classList.add('border-red-500', 'bg-red-50');
                btn.querySelector('.material-symbols-outlined').innerText = 'cancel';
                btn.querySelector('.material-symbols-outlined').classList.add('text-red-500', 'opacity-100');
                
                // Highlight correct one
                const correctBtn = buttons[q.a];
                correctBtn.classList.add('border-green-500', 'bg-green-50');
                correctBtn.querySelector('.material-symbols-outlined').innerText = 'check_circle';
                correctBtn.querySelector('.material-symbols-outlined').classList.add('text-green-500', 'opacity-100');
            }

            document.getElementById('quiz-next-btn').disabled = false;
        }

        function nextQuestion() {
            currentQIndex++;
            renderQuizQuestion();
        }

    </script>
</body>
</html>