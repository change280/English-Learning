<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>完整學習網頁生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&amp;family=Inter:wght@400;500;600;700&amp;family=Material+Symbols+Outlined" rel="stylesheet">
    <style>
        * { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        
        body {
            background: linear-gradient(135deg, #f8fafb 0%, #f0f4f8 100%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        .vocab-word { 
            border-bottom: 2px solid #60a5fa; 
            cursor: pointer; 
            color: #2563eb; 
            font-weight: 600; 
            transition: all 0.2s ease; 
            padding: 2px 4px;
            border-radius: 2px;
        }
        .vocab-word:hover { 
            background-color: #dbeafe;
            border-bottom-color: #2563eb;
        }
        .vocab-word-custom { 
            border-bottom: 2px solid #f87171; 
            cursor: pointer; 
            color: #dc2626; 
            font-weight: 600; 
            transition: all 0.2s ease; 
            padding: 2px 4px;
            border-radius: 2px;
        }
        .vocab-word-custom:hover { 
            background-color: #fee2e2;
            border-bottom-color: #991b1b;
        }
        #floating-card { 
            transition: opacity 0.2s, transform 0.2s ease; 
            pointer-events: none; 
            z-index: 9999;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal { transition: all 0.3s ease-in-out; }
        .modal.hidden { opacity: 0; pointer-events: none; }
        #quiz-modal { transition: all 0.3s ease-in-out; }
        #quiz-modal.hidden { opacity: 0; pointer-events: none; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .selected-word { 
            background-color: #fef3c7; 
            border-bottom: 2px solid #eab308; 
            font-weight: 600;
            padding: 2px 4px;
            border-radius: 2px;
        }
        #selection-popup { 
            transition: all 0.2s ease; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .learning-card {
            transition: all 0.3s ease;
        }
        .learning-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.08);
        }
        
        /* Sticky video styles */
        #video-container.sticky-video {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 480px;
            height: 270px;
            padding-top: 0 !important;
            max-width: 90vw;
            z-index: 1000;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.3), 0 8px 10px -6px rgb(0 0 0 / 0.3);
            border: 2px solid #fff;
        }
        
        #video-container.sticky-video #player {
            pointer-events: auto;
        }

        #floating-close-btn {
            position: fixed;
            top: 45px;
            right: 20px;
            z-index: 1001;
        }

        @media (max-width: 768px) {
            #video-container.sticky-video {
                width: 320px;
                height: 180px;
                right: 10px;
                top: 70px;
            }
            
            #floating-close-btn {
                top: 35px;
                right: 10px;
            }
        }
        
        /* 漢堡選單樣式 */
        #mobile-menu {
            transition: all 0.3s ease;
        }
        #mobile-menu.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .hamburger-line {
            transition: all 0.3s ease;
        }
        #hamburger-btn.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        #hamburger-btn.active .hamburger-line:nth-child(2) {
            opacity: 0;
        }
        #hamburger-btn.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
    </style>
<script src="https://www.youtube.com/iframe_api"></script><style id="_goober"> @keyframes go2264125279{from{transform:scale(0) rotate(45deg);opacity:0;}to{transform:scale(1) rotate(45deg);opacity:1;}}@keyframes go3020080000{from{transform:scale(0);opacity:0;}to{transform:scale(1);opacity:1;}}@keyframes go463499852{from{transform:scale(0) rotate(90deg);opacity:0;}to{transform:scale(1) rotate(90deg);opacity:1;}}@keyframes go1268368563{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}@keyframes go1310225428{from{transform:scale(0) rotate(45deg);opacity:0;}to{transform:scale(1) rotate(45deg);opacity:1;}}@keyframes go651618207{0%{height:0;width:0;opacity:0;}40%{height:0;width:6px;opacity:1;}100%{opacity:1;height:10px;}}@keyframes go901347462{from{transform:scale(0.6);opacity:0.4;}to{transform:scale(1);opacity:1;}}.go4109123758{z-index:9999;}.go4109123758 > *{pointer-events:auto;}</style><style>.rr--group{display:flex;width:100%;position:relative}.rr--box{display:flex;width:100%;flex-grow:1;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rr--svg{display:flex;aspect-ratio:1;width:100%;flex-grow:1;overflow:clip;pointer-events:none}@supports not (overflow: clip){.rr--svg{overflow:auto}}.rr--box:focus,.rr--box:focus-visible,.rr-reset:focus-visible,.rr-reset:focus{outline:none;box-shadow:none}.rr--focus-reset{outline:6px double #0079ff}.rr--box:focus-visible .rr--svg{outline:6px double #0079ff;isolation:isolate}.rr--reset{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0;right:0;bottom:50%}[dir=rtl] .rr--reset{left:0;right:auto}.rr--dir-y .rr--reset{bottom:0;right:50%}.rr--disabled{opacity:.5;cursor:not-allowed}.rr--disabled .rr--svg{pointer-events:none}.rr--pointer .rr--box{cursor:pointer}.rr--dir-x{flex-direction:row}.rr--dir-y{flex-direction:column}.rr--space-sm .rr--svg{padding:8%}.rr--space-md .rr--svg{padding:12.5%}.rr--space-lg .rr--svg{padding:17.5%}.rr--dir-x.rr--gap-sm .rr--svg{margin:0 6.25%}.rr--dir-x.rr--gap-sm .rr--box:focus-visible:after{width:87.5%;left:6.25%}.rr--dir-x.rr--gap-md .rr--svg{margin:0 12.5%}.rr--dir-x.rr--gap-md .rr--box:focus-visible:after{width:75%;left:12.5%}.rr--dir-x.rr--gap-lg .rr--svg{margin:0 25%}.rr--dir-x.rr--gap-lg .rr--box:focus-visible:after{width:50%;left:25%}.rr--dir-y.rr--gap-sm .rr--svg{margin:6.25% 0}.rr--dir-y.rr--gap-md .rr--svg{margin:12.5% 0}.rr--dir-y.rr--gap-lg .rr--svg{margin:25% 0}.rr--rx-sm .rr--svg{border-radius:5%}.rr--rx-md .rr--svg{border-radius:15%}.rr--rx-lg .rr--svg{border-radius:20%}.rr--rx-full .rr--svg{border-radius:100%}.rr--has-stroke .rr--svg{stroke-linecap:round;stroke-linejoin:round}.rr--has-border .rr--svg{border-width:var(--rr--border-width);border-style:solid}.rr--on .rr--svg{fill:var(--rr--fill-on-color, none)}.rr--off .rr--svg{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--on .rr--svg{stroke:var(--rr--stroke-on-color, currentColor)}.rr--has-stroke .rr--off .rr--svg{stroke:var(--rr--stroke-off-color, currentColor)}.rr--on .rr--svg{background-color:var(--rr--box-on-color, none)}.rr--off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--has-border .rr--off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}.rr--has-border .rr--on .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--fx-colors{--rr--easing: .2s cubic-bezier(.61, 1, .88, 1)}.rr--fx-colors .rr--svg{transition-duration:.2s;transition-timing-function:var(--rr--easing);transition-property:background-color,border-color,fill,stroke}.rr--fx-opacity .rr--off{opacity:.35;transition:opacity var(--rr--easing)}.rr--fx-opacity .rr--on{opacity:1}@media(hover: hover){.rr--fx-opacity .rr--box:hover{opacity:1}}@media(hover: hover){.rr--fx-zoom .rr--box{transition:transform var(--rr--easing);transform:scale(1)}.rr--fx-zoom .rr--box:hover{transform:scale(1.2)}}@media(hover: hover)and (prefers-reduced-motion){.rr--fx-zoom .rr--box:hover{transform:scale(1)}}@media(hover: hover){.rr--fx-position .rr--box{transition:transform var(--rr--easing);transform:translateY(0)}.rr--fx-position .rr--box:hover{transform:translateY(-15%)}}@media(hover: hover)and (prefers-reduced-motion){.rr--fx-position .rr--box:hover{transform:translateY(0)}}.rr--svg-stop-1{stop-color:var(--rr--fill-on-color, rgba(0, 0, 0, 0))}[dir=rtl] .rr--svg-stop-1,.rr--svg-stop-2{stop-color:var(--rr--fill-off-color, rgba(0, 0, 0, 0))}[dir=rtl] .rr--svg-stop-2{stop-color:var(--rr--fill-on-color, rgba(0, 0, 0, 0))}.rr--hf-svg-on{fill:var(--rr--fill-on-color, none)}.rr--hf-svg-off{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--hf-svg-on{stroke:var(--rr--stroke-on-color, currentColor)}.rr--has-stroke .rr--hf-svg-off{stroke:var(--rr--stroke-off-color, currentColor)}.rr--hf-svg-on .rr--svg,.rr--hf-svg-off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--has-border .rr--hf-svg-on .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--has-border .rr--hf-svg-off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}.rr--dir-x .rr--hf-box-int .rr--svg{background:linear-gradient(to right, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}[dir=rtl] .rr--dir-x .rr--hf-box-int .rr--svg{background:linear-gradient(to left, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}.rr--dir-y .rr--hf-box-int .rr--svg{background:linear-gradient(to bottom, var(--rr--box-on-color, none) 50%, var(--rr--box-off-color, none) 50%)}.rr--hf-box-on .rr--svg{background-color:var(--rr--box-on-color, none)}.rr--hf-box-off .rr--svg{background-color:var(--rr--box-off-color, none)}.rr--hf-box-on .rr--svg,.rr--hf-box-off .rr--svg,.rr--hf-box-int .rr--svg{fill:var(--rr--fill-off-color, none)}.rr--has-stroke .rr--hf-box-on .rr--svg,.rr--has-stroke .rr--hf-box-off .rr--svg,.rr--has-stroke .rr--hf-box-int .rr--svg{stroke:var(--rr--stroke-off-color, currentColor)}.rr--has-border .rr--hf-box-on .rr--svg,.rr--has-border .rr--hf-box-int .rr--svg{border-color:var(--rr--border-on-color, currentColor)}.rr--has-border .rr--hf-box-off .rr--svg{border-color:var(--rr--border-off-color, currentColor)}</style><style>.kw-overview-container{box-sizing:border-box;width:673px;padding:0;margin:0;margin-top:14px;font-size:12px;font-family:Figtree;-webkit-font-smoothing:antialiased}.kw-overview-container.youtube{box-sizing:border-box;width:645px;padding:0;margin:0;font-size:12px}</style></head>
<body class="text-slate-700">

    <nav class="bg-white border-b border-slate-100 sticky top-0 z-40 shadow-sm">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6">
                        <div class="flex justify-between h-16 items-center">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                    <span class="material-symbols-outlined text-white text-xl">school</span>
                                </div>
                                <div class="flex flex-col">
                                    <div class="font-bold text-lg text-slate-900">StudyEngine</div>
                                    <div class="text-xs text-slate-500 hidden sm:block">英語學習平台</div>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <button onclick="toggleExportMenu()" class="px-3 py-2 rounded-lg border border-purple-200 bg-purple-50 hover:bg-purple-100 text-purple-700 transition text-sm font-medium flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-lg">bookmark</span>
                                    <span class="hidden sm:inline">Export Words (</span><span class="sm:hidden">(</span><span id="selected-count">2</span><span>)</span>
                                </button>
                                <div id="export-menu" class="hidden absolute top-full right-0 mt-2 bg-white border border-slate-200 rounded-xl shadow-lg z-50 min-w-max overflow-hidden">
                                    <button onclick="copyExportPrompt()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 border-b border-slate-100 flex items-center gap-2 text-sm" title="複製生成AI指令的Prompt">
                                        <span class="material-symbols-outlined text-sm text-blue-600">content_copy</span> <span>複製 Prompt</span>
                                    </button>
                                    <button onclick="exportSelectedWords()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 flex items-center gap-2 text-sm" title="下載選中的生字">
                                        <span class="material-symbols-outlined text-sm text-blue-600">download</span> <span>下載文字檔</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>

    <div class="max-w-7xl mx-auto px-6 py-8 pb-32 space-y-8">
        
        <!-- Video Section (Will be included in export) -->
        <section id="video-section" class="bg-white rounded-2xl p-8 shadow-sm border border-slate-100 learning-card">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold flex items-center gap-3 text-slate-900">
                    <div class="p-2 bg-red-100 rounded-lg">
                        <span class="material-symbols-outlined text-red-600 text-2xl">play_circle</span>
                    </div>
                    影片播放
                </h3>
                <div class="flex items-center gap-2">
                    <button onclick="openModal('video')" class="px-4 py-2 rounded-lg border border-slate-200 bg-slate-50 hover:bg-slate-100 text-slate-700 text-sm font-medium transition flex items-center gap-2">
                        <span class="material-symbols-outlined text-base">edit</span> 更換影片
                    </button>
                    <button onclick="manualToggleSticky()" class="px-4 py-2 rounded-lg border border-blue-200 bg-blue-50 hover:bg-blue-100 text-blue-700 text-sm font-medium transition flex items-center gap-2" title="切換浮動模式">
                        <span class="material-symbols-outlined text-base">picture_in_picture_alt</span> 浮動
                    </button>
                </div>
            </div>
            <div id="video-container" class="relative w-full bg-black rounded-xl overflow-hidden" style="padding-top: 56.25%;">
                <div id="player" class="absolute inset-0"></div>
                <button id="close-sticky-video" class="absolute top-2 right-2 z-10 p-1.5 bg-black/70 hover:bg-black/90 rounded-lg text-white transition hidden">
                </button>
            </div>
            <div id="video-placeholder" class="w-full hidden" style="padding-top: 30%;"></div>
            <p class="text-sm text-slate-600 mt-3">
                點擊時間標籤跳轉到指定時間
            </p>
        </section>

        <!-- Floating close button -->
        <button id="floating-close-btn" class="p-2 bg-white/95 hover:bg-white rounded-full text-slate-700 hover:text-slate-900 shadow-lg hover:shadow-xl transition-all hover:scale-110 hidden">
            <span class="material-symbols-outlined text-xl">close</span>
        </button>

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Transcript -->
            <main class="lg:w-2/3 bg-white p-8 rounded-2xl shadow-lg">
                <div class="flex justify-between items-center mb-6 border-b pb-4">
                    <h2 class="text-2xl font-bold text-slate-900">逐字稿</h2>
                    <button onclick="toggleTranslations()" class="px-3 py-2 rounded-lg border border-slate-200 bg-slate-50 hover:bg-slate-100 text-slate-600 text-sm font-medium transition flex items-center gap-2">
                        <span class="material-symbols-outlined text-base">translate</span> <span id="toggle-btn-text">顯示中文</span>
                    </button>
                </div>
                
                <div id="transcript-content" class="space-y-8 text-lg leading-relaxed text-slate-700">
                    <div class="mb-6" id="seg-0">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(3)">
                                ⏵ 00:03
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-0" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="0" onchange="setTimeByInput(0)" onkeypress="if(event.key==='Enter') setTimeByInput(0)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-0" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="03" onchange="setTimeByInput(0)" onkeypress="if(event.key==='Enter') setTimeByInput(0)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(0)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-0">Raise your hand if you don't know what this is. That is a human brain that turned to glass during the Mount <span class="vocab-word" data-id="vesuvius" onmouseenter="showCard(event, 'vesuvius')" onmouseleave="hideCard()" onclick="toggleCard(event, 'vesuvius')">Vesuvius</span> eruption in 79 AD. But it gets weirder—only this man's brain turned to glass, not his other organs, leaving scientists <span class="vocab-word" data-id="baffled" onmouseenter="showCard(event, 'baffled')" onmouseleave="hideCard()" onclick="toggleCard(event, 'baffled')">baffled</span> for centuries about how volcanic ash clouds could create the precise temperature conditions to <span class="vocab-word" data-id="forge" onmouseenter="showCard(event, 'forge')" onmouseleave="hideCard()" onclick="toggleCard(event, 'forge')">forge</span> glass from living tissue.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-0">如果你不知道這是什麼，請舉手。那是一個人類的大腦，在西元 79 年維蘇威火山噴發期間變成了玻璃。但更奇怪的是——只有這個人的大腦變成了玻璃，他的其他器官卻沒有。這讓科學家們困惑了幾個世紀：火山灰雲究竟如何創造出精確的溫度條件，將活體組織鍛造成玻璃。</p>
                    </div>
                    <div class="mb-6" id="seg-1">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(30)">
                                ⏵ 00:30
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-1" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="0" onchange="setTimeByInput(1)" onkeypress="if(event.key==='Enter') setTimeByInput(1)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-1" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="30" onchange="setTimeByInput(1)" onkeypress="if(event.key==='Enter') setTimeByInput(1)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(1)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-1">If you didn't know what this was, then you're exactly where you should be, because this talk is about the power of not knowing. Now, this matters more than ever because we live in a culture that is absolutely obsessed with having the right answer immediately.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-1">如果你不知道這是什麼，那麼你正處於最理想的狀態，因為這場演講的主題就是關於「不知道」的力量。這在現今比以往任何時候都更重要，因為我們生活在一個絕對痴迷於立即獲得正確答案的文化中。</p>
                    </div>
                    <div class="mb-6" id="seg-2">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(46)">
                                ⏵ 00:46
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-2" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="0" onchange="setTimeByInput(2)" onkeypress="if(event.key==='Enter') setTimeByInput(2)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-2" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="46" onchange="setTimeByInput(2)" onkeypress="if(event.key==='Enter') setTimeByInput(2)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(2)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-2">Our <span class="vocab-word" data-id="algorithms" onmouseenter="showCard(event, 'algorithms')" onmouseleave="hideCard()" onclick="toggleCard(event, 'algorithms')">algorithms</span> on social media reward the loudest, most confident hot takes over the most curious questions. Everyone is supposed to be an expert in everything all the time. And if you get something remotely wrong? Cancelled. It's exhausting. But I think I found another way.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-2">社群媒體的演算法獎勵那些最大聲、最自信的辛辣觀點，而非充滿好奇的提問。每個人都被要求隨時成為所有領域的專家。而如果你出一點點錯？你就被封殺了。這讓人精疲力竭。但我認為我找到了另一條路。</p>
                    </div>
                    <div class="mb-6" id="seg-3">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(61)">
                                ⏵ 01:01
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-3" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="1" onchange="setTimeByInput(3)" onkeypress="if(event.key==='Enter') setTimeByInput(3)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-3" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="01" onchange="setTimeByInput(3)" onkeypress="if(event.key==='Enter') setTimeByInput(3)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(3)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-3">When I started my channel, Today I Learned, in two years, over two million people followed. Not for expert opinions or hot takes, but for something much simpler: shared curiosity. Which is <span class="vocab-word" data-id="ironic" onmouseenter="showCard(event, 'ironic')" onmouseleave="hideCard()" onclick="toggleCard(event, 'ironic')">ironic</span>, because for a long time, I was the complete opposite. I was a recovering know-it-all.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-3">當我創立我的頻道「今天我學到了」（Today I Learned）時，兩年內有超過兩百萬人追蹤。不是為了專家意見或尖銳評論，而是為了更簡單的東西：共同的好奇心。這很諷刺，因為很長一段時間以來，我完全相反。我是一個正在戒斷中的「萬事通」。</p>
                    </div>
                    <div class="mb-6" id="seg-4">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(85)">
                                ⏵ 01:25
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-4" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="1" onchange="setTimeByInput(4)" onkeypress="if(event.key==='Enter') setTimeByInput(4)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-4" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="25" onchange="setTimeByInput(4)" onkeypress="if(event.key==='Enter') setTimeByInput(4)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(4)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-4">During my <span class="vocab-word" data-id="doctorate" onmouseenter="showCard(event, 'doctorate')" onmouseleave="hideCard()" onclick="toggleCard(event, 'doctorate')">doctorate</span> at UCSF, I was obsessed with certainty. I wanted to have the right answer before anyone even asked the question. When COVID hit, I started posting science videos as a creative outlet, but even then, I constrained myself. I thought, 'Only post about things you know, Harini.' So I stuck rigidly to <span class="vocab-word" data-id="pharmacy" onmouseenter="showCard(event, 'pharmacy')" onmouseleave="hideCard()" onclick="toggleCard(event, 'pharmacy')">pharmacy</span> topics.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-4">在加州大學舊金山分校（UCSF）攻讀博士期間，我痴迷於確定性。我想在別人提問之前就先掌握正確答案。當新冠疫情爆發時，我開始發布科學影片作為創意出口，但即便如此，我也限制了自己。我心想：「Harini，只發布你懂的東西。」所以我死板地守在藥學話題上。</p>
                    </div>
                    <div class="mb-6" id="seg-5">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(111)">
                                ⏵ 01:51
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-5" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="1" onchange="setTimeByInput(5)" onkeypress="if(event.key==='Enter') setTimeByInput(5)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-5" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="51" onchange="setTimeByInput(5)" onkeypress="if(event.key==='Enter') setTimeByInput(5)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(5)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-5">Then I went to Mexico. I was standing in front of the pyramids in the blazing heat when I realized something <span class="vocab-word" data-id="profound" onmouseenter="showCard(event, 'profound')" onmouseleave="hideCard()" onclick="toggleCard(event, 'profound')">profound</span>: I had no idea what I was looking at. Who built this? Why here? Where did they go? Instead of feeling embarrassed that I didn't know, for the first time in a long time, I felt alive.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-5">後來我去了墨西哥。在烈日下站在金字塔前，我意識到了一件深刻的事：我完全不知道自己在看什麼。誰建造了它？為什麼在這裡？他們去哪了？我非但沒有因為不知道而感到尷尬，反而長時間以來第一次感到自己充滿活力。</p>
                    </div>
                    <div class="mb-6" id="seg-6">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(134)">
                                ⏵ 02:14
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-6" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="2" onchange="setTimeByInput(6)" onkeypress="if(event.key==='Enter') setTimeByInput(6)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-6" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="14" onchange="setTimeByInput(6)" onkeypress="if(event.key==='Enter') setTimeByInput(6)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(6)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-6">Every carving was a mystery that made my brain tingle in ways that pharmaceutical calculations never did. That night, I couldn't stop researching—not to become an expert, but to feed my curiosity. I made a video about Teotihuacán, posted it, and went to sleep.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-6">每一處雕刻都是一個謎，讓我的大腦產生了藥學計算從未帶給我的興奮感。那天晚上，我無法停止研究——不是為了成為專家，而是為了餵養我的好奇心。我製作了一段關於特奧蒂瓦坎的影片，發布後就去睡覺了。</p>
                    </div>
                    <div class="mb-6" id="seg-7">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(159)">
                                ⏵ 02:39
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-7" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="2" onchange="setTimeByInput(7)" onkeypress="if(event.key==='Enter') setTimeByInput(7)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-7" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="39" onchange="setTimeByInput(7)" onkeypress="if(event.key==='Enter') setTimeByInput(7)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(7)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-7">I woke up to 40,000 new followers. My first viral video had nothing to do with my eight years of higher education. It was about me, a human being, nerding out over ancient architecture and sharing the incredible work of <span class="vocab-word" data-id="archaeologists" onmouseenter="showCard(event, 'archaeologists')" onmouseleave="hideCard()" onclick="toggleCard(event, 'archaeologists')">archaeologists</span>. People weren't following me because I was an expert; they were following me because I was curious.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-7">醒來後，我發現多了四萬名追蹤者。我的第一支爆紅影片與我八年的高等教育毫無關係。那是關於我——一個普通人，對古代建築著迷，並分享考古學家們令人驚嘆的研究成果。人們追蹤我不是因為我是專家，而是因為我充滿好奇。</p>
                    </div>
                    <div class="mb-6" id="seg-8">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(191)">
                                ⏵ 03:11
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-8" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="3" onchange="setTimeByInput(8)" onkeypress="if(event.key==='Enter') setTimeByInput(8)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-8" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="11" onchange="setTimeByInput(8)" onkeypress="if(event.key==='Enter') setTimeByInput(8)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(8)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-8">And curiosity is contagious. Because here is the paradox of our time. We have infinite access to information, but also infinite misinformation. Conspiracy theories get more clicks than peer-reviewed studies. Confident nonsense spreads faster than careful science.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-8">好奇心是會傳染的。因為這就是我們時代的悖論：我們擁有無限的信息獲取管道，但同時也有無限的錯誤信息。陰謀論獲得的點擊量比同行評審的研究還要多，自信的胡說八道比嚴謹的科學傳播得更快。</p>
                    </div>
                    <div class="mb-6" id="seg-9">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(209)">
                                ⏵ 03:29
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-9" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="3" onchange="setTimeByInput(9)" onkeypress="if(event.key==='Enter') setTimeByInput(9)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-9" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="29" onchange="setTimeByInput(9)" onkeypress="if(event.key==='Enter') setTimeByInput(9)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(9)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-9">In that chaos, championing credible voices and making that work accessible seem to unlock something in people. Because after that, my comments exploded with TIL: Today I Learned. In that moment, my mission became clear.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-9">在混亂之中，擁護可靠的聲音並讓這些成果變得易於理解，似乎能激發人們內心的某種共鳴。在那之後，我的評論區爆發了大量的『TIL：今天我學到了』。就在那一刻，我的使命變得清晰。</p>
                    </div>
                    <div class="mb-6" id="seg-10">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(227)">
                                ⏵ 03:47
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-10" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="3" onchange="setTimeByInput(10)" onkeypress="if(event.key==='Enter') setTimeByInput(10)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-10" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="47" onchange="setTimeByInput(10)" onkeypress="if(event.key==='Enter') setTimeByInput(10)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(10)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-10">Take the most <span class="vocab-word" data-id="rigorous" onmouseenter="showCard(event, 'rigorous')" onmouseleave="hideCard()" onclick="toggleCard(event, 'rigorous')">rigorous</span>, mind-blowing research and make it so <span class="vocab-word" data-id="captivating" onmouseenter="showCard(event, 'captivating')" onmouseleave="hideCard()" onclick="toggleCard(event, 'captivating')">captivating</span> that someone scrolling at 2am stops and goes, 'Wait, what?' Because science is for everyone, not dumbed down, but translated with the excitement it deserves. I changed my channel name that night and didn't look back.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-10">將最嚴謹、最震撼的研究轉化得如此吸引人，讓凌晨兩點滑手機的人也會停下來驚呼：『等一下，什麼？』因為科學是屬於每個人的，不是將其『弱智化』，而是以它應有的興奮感來轉譯。那天晚上我更改了頻道名稱，從此勇往直前。</p>
                    </div>
                    <div class="mb-6" id="seg-11">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(246)">
                                ⏵ 04:06
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-11" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="4" onchange="setTimeByInput(11)" onkeypress="if(event.key==='Enter') setTimeByInput(11)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-11" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="06" onchange="setTimeByInput(11)" onkeypress="if(event.key==='Enter') setTimeByInput(11)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(11)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-11">Here's where my curiosity has taken me. There is a 72-year-old geologist who rewrote the origins of life, before GTA 6. Juan Manuel Garcia Ruiz could have retired, but instead he chose to recreate the famous 1952 primordial soup experiment, the one that showed us how life began on Earth.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-11">這就是好奇心帶領我到達的地方。有一位 72 歲的地質學家，在《俠盜獵車手 6》發售前就改寫了生命的起源。胡安·曼努埃爾·加西亞·魯伊斯本可以退休，但他卻選擇重現著名的 1952 年『原始湯』實驗，那個向我們展示地球生命如何起源的實驗。</p>
                    </div>
                    <div class="mb-6" id="seg-12">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(263)">
                                ⏵ 04:23
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-12" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="4" onchange="setTimeByInput(12)" onkeypress="if(event.key==='Enter') setTimeByInput(12)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-12" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="23" onchange="setTimeByInput(12)" onkeypress="if(event.key==='Enter') setTimeByInput(12)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(12)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-12">But with one tiny change. Instead of using a glass container like the original, he used Teflon. The result? Nothing. Turns out the glass, specifically the silica, was key. When he added silica back in, he didn't just get amino acids, he got all five DNA building blocks and protocells.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-12">但只做了一個微小的改變：他沒有像最初那樣使用玻璃容器，而是使用了特氟龍。結果呢？一無所獲。事實證明，玻璃（特別是其中的二氧化矽）才是關鍵。當他重新加入二氧化矽時，他不僅得到了氨基酸，還得到了所有五種 DNA 組成部分和原細胞。</p>
                    </div>
                    <div class="mb-6" id="seg-13">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(301)">
                                ⏵ 05:01
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-13" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="5" onchange="setTimeByInput(13)" onkeypress="if(event.key==='Enter') setTimeByInput(13)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-13" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="01" onchange="setTimeByInput(13)" onkeypress="if(event.key==='Enter') setTimeByInput(13)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(13)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-13">The self-organizing structures that came right before actual life. Translation? Life on Earth may have started hundreds of millions of years earlier than we thought. This should be breaking the internet, but most people will never hear about it. That is the gap I'm trying to bridge.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-13">這些是在真正生命出現之前的自組織結構。這意味著什麼？地球上的生命起源可能比我們想像的要早幾億年。這本該轟動全網，但大多數人卻聞所未聞。這正是我試圖彌補的鴻溝。</p>
                    </div>
                    <div class="mb-6" id="seg-14">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(323)">
                                ⏵ 05:23
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-14" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="5" onchange="setTimeByInput(14)" onkeypress="if(event.key==='Enter') setTimeByInput(14)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-14" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="23" onchange="setTimeByInput(14)" onkeypress="if(event.key==='Enter') setTimeByInput(14)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(14)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-14">Because science isn't just for scientists. When researchers discover how life began or unlock how ancient brains turned to glass, these are ultimately human stories about curiosity, <span class="vocab-word" data-id="perseverance" onmouseenter="showCard(event, 'perseverance')" onmouseleave="hideCard()" onclick="toggleCard(event, 'perseverance')">perseverance</span>, asking brave questions. And everyone deserves to feel that electrifying, 'I can’t believe we just learned that' moment.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-14">因為科學不只是給科學家看的。當研究人員發現生命如何開始，或揭開古代大腦如何變成玻璃時，這些最終都是關於好奇心、毅力和勇敢提問的人類故事。每個人都值得感受那種觸電般的『不敢相信我們剛學到了這個』的時刻。</p>
                    </div>
                    <div class="mb-6" id="seg-15">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(346)">
                                ⏵ 05:46
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-15" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="5" onchange="setTimeByInput(15)" onkeypress="if(event.key==='Enter') setTimeByInput(15)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-15" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="46" onchange="setTimeByInput(15)" onkeypress="if(event.key==='Enter') setTimeByInput(15)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(15)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-15">Like this. For the first time in 2025, we got to witness a human embryo implanting into uterine-like tissue in real time. From this, we learn embryos aggressively burrow, possibly following uterine contractions like GPS signals. This process is actually physically painful.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-15">就像這樣。在 2025 年，我們首次親眼目睹了人類胚胎實時植入類子宮組織的過程。從中我們了解到胚胎會激進地鑽入，可能像 GPS 信號一樣遵循子宮收縮的方向。這個過程實際上會帶來生理上的疼痛。</p>
                    </div>
                    <div class="mb-6" id="seg-16">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(368)">
                                ⏵ 06:08
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-16" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="6" onchange="setTimeByInput(16)" onkeypress="if(event.key==='Enter') setTimeByInput(16)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-16" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="08" onchange="setTimeByInput(16)" onkeypress="if(event.key==='Enter') setTimeByInput(16)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(16)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-16">The countless women who felt a sharp twinge and wondered if they'd imagined it, they didn't. Science just caught up to what their bodies already knew. We finally answered one of human development's biggest black boxes, while validating millions of women's experiences in the process.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-16">無數感到劇烈刺痛並懷疑是否是幻覺的女性，其實那並不是幻覺。科學終於趕上了她們身體早已知曉的事實。我們終於破解了人類發育中最大的黑盒子之一，並在此過程中驗證了數百萬女性的親身經歷。</p>
                    </div>
                    <div class="mb-6" id="seg-17">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(388)">
                                ⏵ 06:28
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-17" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="6" onchange="setTimeByInput(17)" onkeypress="if(event.key==='Enter') setTimeByInput(17)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-17" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="28" onchange="setTimeByInput(17)" onkeypress="if(event.key==='Enter') setTimeByInput(17)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(17)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-17">After doing this for a few years, here's what I've learned. People don't make discoveries because they already know things. They make discoveries because they get obsessed with the stuff they don't know. And learning isn't linear. It's a beautiful, endless loop.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-17">在從事這件事幾年後，這是我學到的：人們之所以能有所發現，並不是因為他們已經掌握了知識，而是因為他們對未知的事物感到著迷。學習並非線性的，而是一個美麗且永無止境的循環。</p>
                    </div>
                    <div class="mb-6" id="seg-18">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(406)">
                                ⏵ 06:46
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-18" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="6" onchange="setTimeByInput(18)" onkeypress="if(event.key==='Enter') setTimeByInput(18)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-18" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="46" onchange="setTimeByInput(18)" onkeypress="if(event.key==='Enter') setTimeByInput(18)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(18)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-18">When I shared my Teotihuacán obsession, I was inviting 40,000 other people to be curious with me and showing them that science can be as <span class="vocab-word" data-id="captivating" onmouseenter="showCard(event, 'captivating')" onmouseleave="hideCard()" onclick="toggleCard(event, 'captivating')">captivating</span> as any Netflix series. See, my <span class="vocab-word" data-id="doctorate" onmouseenter="showCard(event, 'doctorate')" onmouseleave="hideCard()" onclick="toggleCard(event, 'doctorate')">doctorate</span> taught me how to read studies and think critically. But my channel taught me that everyone deserves access to that knowledge.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-18">當我分享我對特奧蒂瓦坎的痴迷時，我是在邀請其他四萬人與我一起保持好奇，並向他們展示科學可以像任何 Netflix 影集一樣迷人。你看，我的博士學位教會了我如何閱讀研究報告和批判性思考，但我的頻道教會了我，每個人都有權獲得這些知識。</p>
                    </div>
                    <div class="mb-6" id="seg-19">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(420)">
                                ⏵ 07:00
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-19" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="7" onchange="setTimeByInput(19)" onkeypress="if(event.key==='Enter') setTimeByInput(19)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-19" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="" onchange="setTimeByInput(19)" onkeypress="if(event.key==='Enter') setTimeByInput(19)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(19)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-19">So here's my challenge for you. Find your Teotihuacán. Find the thing that lights you up from the inside, not because you understand it, but because you don't. Maybe it's quantum physics. Maybe it's how sourdough starter is basically a pet you can eat.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-19">所以，我對各位的挑戰是：找到屬於你的『特奧蒂瓦坎』。找到那件能從內心點亮你的事物，不是因為你了解它，而是因為你不了解。也許是量子物理，也許是酸種發酵劑基本上就是一種可以吃的寵物。</p>
                    </div>
                    <div class="mb-6" id="seg-20">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(430)">
                                ⏵ 07:10
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-20" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="7" onchange="setTimeByInput(20)" onkeypress="if(event.key==='Enter') setTimeByInput(20)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-20" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="10" onchange="setTimeByInput(20)" onkeypress="if(event.key==='Enter') setTimeByInput(20)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(20)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-20">Whatever makes you feel like that kid that asked 'why' over and over until your parents wanted to scream. When I first started dating my husband, he called me '20 questions.' Bring that energy to the table. TLDR: stay gloriously, unapologetically curious.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-20">無論是什麼，只要能讓你感覺像那個不停問『為什麼』直到父母想尖叫的小孩。當我剛開始和丈夫約會時，他叫我『問題妹』。請展現出那樣的能量。總結來說：保持那份燦爛、理直氣壯的好奇心吧。</p>
                    </div>
                    <div class="mb-6" id="seg-21">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 bg-green-50 text-green-700 text-xs font-semibold transition-colors" onclick="jumpToTime(446)">
                                ⏵ 07:26
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-21" min="0" max="999" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="0" value="7" onchange="setTimeByInput(21)" onkeypress="if(event.key==='Enter') setTimeByInput(21)">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-21" min="0" max="59" step="1" class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="00" value="26" onchange="setTimeByInput(21)" onkeypress="if(event.key==='Enter') setTimeByInput(21)">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" onclick="editSegment(21)">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-21">All right, that's it from me, I've got to go research how the real city Atlanta is buried beneath our feet. Thank you.</p>
                        <p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-21">好了，我的演講到此結束。我要去研究真正的亞特蘭大城是如何埋在我們腳下的了。謝謝各位。</p>
                    </div></div>
            </main>

            <!-- Vocab + Quiz Sidebar -->
            <aside class="lg:w-1/3">
                <div class="sticky top-24 space-y-6">
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 learning-card p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="font-bold text-xl flex items-center gap-3 text-slate-900">
                                <div class="p-2 bg-amber-100 rounded-lg">
                                    <span class="material-symbols-outlined text-amber-600 text-2xl">verified</span>
                                </div>
                                詞彙表
                                <span class="text-sm bg-slate-200 px-2.5 py-1 rounded-full font-semibold" id="vocab-count">13</span>
                            </h3>
                            <button onclick="showAddVocabModal()" class="text-blue-600 hover:bg-blue-50 rounded-full p-2 transition hover:scale-110" title="新增生字">
                                <span class="material-symbols-outlined text-2xl">add_circle</span>
                            </button>
                        </div>
                        <ul id="vocab-list" class="divide-y max-h-[60vh] overflow-y-auto">
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('algorithms')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">1.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Algorithms</div>
                                    <button onclick="event.stopPropagation(); speakWord('Algorithms')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈæl.ɡə.rɪ.ðəmz/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A process or set of rules to be followed in calculations or other problem-solving operations, especially by a computer.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">演算法 (文中指社群媒體的推送機制)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('archaeologists')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">2.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Archaeologists</div>
                                    <button onclick="event.stopPropagation(); speakWord('Archaeologists')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˌɑːr.kiˈɑː.lə.dʒɪsts/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">People who study human history and prehistory through the excavation of sites and the analysis of artifacts.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">考古學家</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('baffled')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">3.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Baffled</div>
                                    <button onclick="event.stopPropagation(); speakWord('Baffled')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈbæf.əld/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Totally bewildered or perplexed; extremely confused.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">感到困惑的、難倒的</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('captivating')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">4.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Captivating</div>
                                    <button onclick="event.stopPropagation(); speakWord('Captivating')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈkæp.tɪ.veɪ.tɪŋ/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Capable of attracting and holding interest; charming.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">迷人的、吸引人的</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('doctorate')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">5.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Doctorate</div>
                                    <button onclick="event.stopPropagation(); speakWord('Doctorate')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈdɑːk.tɚ.ət/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">The highest degree from a university, awarded after a long period of study and research.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">博士學位</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('forge')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">6.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Forge</div>
                                    <button onclick="event.stopPropagation(); speakWord('Forge')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/fɔːrdʒ/</div>
                                <div class="text-xs text-slate-500 mt-0.5">verb</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">To create or shape (a metal object) by heating it in a fire or furnace and beating it.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">鍛造、鑄就 (文中指將組織鍛造成玻璃)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('ironic')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">7.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Ironic</div>
                                    <button onclick="event.stopPropagation(); speakWord('Ironic')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/aɪˈrɑː.nɪk/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Happening in a way contrary to what is expected, and typically causing wry amusement because of this.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">諷刺的、出乎意料的</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('perseverance')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">8.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Perseverance</div>
                                    <button onclick="event.stopPropagation(); speakWord('Perseverance')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˌpɝː.səˈvɪr.əns/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Persistence in doing something despite difficulty or delay in achieving success.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">毅力、堅持不懈</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('pharmacy')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">9.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Pharmacy</div>
                                    <button onclick="event.stopPropagation(); speakWord('Pharmacy')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈfɑːr.mə.si/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">The science or practice of the preparation and dispensing of medicinal drugs.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">藥學、藥理學</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('profound')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">10.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Profound</div>
                                    <button onclick="event.stopPropagation(); speakWord('Profound')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/prəˈfaʊnd/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Very great or intense; showing great knowledge or insight.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">深刻的、深奧的</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('rigorous')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">11.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Rigorous</div>
                                    <button onclick="event.stopPropagation(); speakWord('Rigorous')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/ˈrɪɡ.ɚ.əs/</div>
                                <div class="text-xs text-slate-500 mt-0.5">adjective</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">Extremely thorough, exhaustive, or accurate.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">嚴謹的、嚴格的</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('teotihuacan')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">12.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Teotihuacan</div>
                                    <button onclick="event.stopPropagation(); speakWord('Teotihuacan')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/teɪˌoʊ.tiː.wəˈkɑːn/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">An ancient Mesoamerican city located in a sub-valley of the Valley of Mexico, known for its large pyramids.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">特奧蒂瓦坎 (墨西哥著名的古文明遺址)</div>
                    </li>
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" onclick="scrollToVocab('vesuvius')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">13.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">Vesuvius</div>
                                    <button onclick="event.stopPropagation(); speakWord('Vesuvius')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                <div class="text-xs text-blue-600 font-semibold mt-1">/vəˈsuː.vi.əs/</div>
                                <div class="text-xs text-slate-500 mt-0.5">noun</div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">A stratovolcano in the Gulf of Naples, Italy, best known for its eruption in 79 AD that destroyed Pompeii.</div>
                        <div class="text-xs text-blue-700 font-semibold ml-6">維蘇威火山 (義大利著名的活火山)</div>
                    </li></ul>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-600 rounded-2xl p-8 shadow-lg text-white learning-card">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="p-2 bg-white/20 rounded-lg">
                                <span class="material-symbols-outlined text-2xl">quiz</span>
                            </div>
                            <h3 class="font-bold text-xl">知識檢測</h3>
                        </div>
                        <p class="text-blue-100 text-sm mb-6 leading-relaxed">通過測驗鞏固所學，評估學習進度。</p>
                        <button onclick="openQuiz()" class="w-full bg-white text-blue-600 py-3 px-4 rounded-xl font-bold shadow-md hover:shadow-lg hover:bg-blue-50 transition transform hover:scale-[1.02] flex justify-center items-center gap-2">
                            <span class="material-symbols-outlined">play_circle</span>
                            <span>開始測驗</span>
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Mobile Floating Action Button for Quiz -->
    <button onclick="openQuiz()" class="lg:hidden fixed bottom-20 right-6 bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-4 rounded-full shadow-xl hover:shadow-2xl hover:scale-110 z-50 flex items-center justify-center transition">
        <span class="material-symbols-outlined text-2xl">quiz</span>
    </button>

    <!-- Bottom Control Bar (Will be kept in export) -->
    <div id="bottom-controls" class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 shadow-lg z-40 px-3 py-3">
        <div class="flex flex-nowrap justify-center gap-2">
            <button id="play-pause-btn" onclick="togglePlayPause()" class="flex items-center gap-1.5 px-4 py-3 rounded-lg bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold shadow-md hover:shadow-lg active:scale-95 transition-all min-h-[44px]">
                <span class="material-symbols-outlined text-xl" id="play-icon">play_arrow</span>
                <span id="play-text" class="hidden sm:inline text-sm">播放</span>
            </button>
            
            <div class="flex items-center rounded-xl border border-slate-300 bg-slate-100 overflow-hidden min-h-[44px]">
                <button onclick="decreaseFontSize()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-200 active:bg-slate-300 transition">
                    <span class="material-symbols-outlined text-lg">text_decrease</span>
                </button>
                <div class="w-px h-8 bg-slate-300"></div>
                <button onclick="increaseFontSize()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-200 active:bg-slate-300 transition">
                    <span class="material-symbols-outlined text-lg">text_increase</span>
                </button>
            </div>
            
            <div class="flex items-center rounded-xl border border-slate-300 bg-white overflow-hidden min-h-[44px]">
                <button onclick="decreasePlaybackSpeed()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-100 active:bg-slate-200 transition">
                    <span class="material-symbols-outlined text-lg">remove</span>
                </button>
                <div class="w-px h-8 bg-slate-300"></div>
                <div class="flex items-center px-3 py-3 text-sm font-bold min-w-[50px] justify-center text-slate-700">
                    <span id="speed-display">1.0x</span>
                </div>
                <div class="w-px h-8 bg-slate-300"></div>
                <button onclick="increasePlaybackSpeed()" class="px-3 py-3 text-sm text-slate-700 hover:bg-slate-100 active:bg-slate-200 transition">
                    <span class="material-symbols-outlined text-lg">add</span>
                </button>
            </div>
            
            <button onclick="toggleTranslations()" class="flex items-center px-4 py-3 rounded-lg border border-blue-300 bg-blue-50 text-blue-700 text-sm font-medium active:bg-blue-100 hover:bg-blue-100 transition min-h-[44px]">
                <span class="material-symbols-outlined text-lg">translate</span> <span id="cn-toggle-text">中文</span>
            </button>
            <button onclick="resetSettings()" class="hidden sm:block px-4 py-3 rounded-lg border border-slate-300 bg-slate-50 text-slate-600 text-sm font-medium hover:bg-slate-100 active:bg-slate-200 transition min-h-[44px]">
                <span class="material-symbols-outlined text-lg">restart_alt</span>
            </button>
        </div>
    </div>

    <!-- Floating Card -->
    <div id="floating-card" class="fixed bg-white rounded-xl shadow-2xl w-80 border z-50 hidden" data-current-id="" style="left: 233.711px; top: 475.125px;">
                <div class="p-4">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="text-xl font-bold flex-1">Perseverance</h3>
                        <button onclick="event.stopPropagation(); speakWord('Perseverance')" class="ml-2 p-2 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 transition" title="播放發音">
                            <span class="material-symbols-outlined text-lg">volume_up</span>
                        </button>
                    </div>
                    <div class="text-xs text-slate-500 mb-1">noun</div>
                    <div class="text-xs text-blue-600 font-semibold mb-3">/ˌpɝː.səˈvɪr.əns/</div>
                    <p class="text-sm mb-3">Persistence in doing something despite difficulty or delay in achieving success.</p>
                    <p class="text-xs text-blue-700 font-bold">毅力、堅持不懈</p>
                </div></div>

    <!-- Selection Popup -->
    <div id="selection-popup" class="fixed bg-purple-600 text-white px-4 py-2 rounded-lg shadow-xl z-50 text-sm font-semibold cursor-pointer hover:bg-purple-700 active:scale-95 transition-all hidden" style="left: 241.316px; top: 495.625px;">
        <span class="material-symbols-outlined text-base" style="vertical-align: middle;">add_circle</span> 加入生字
    </div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="hidden fixed inset-0 z-[60] bg-slate-900/80 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden">
            <div class="p-6 border-b border-gray-100 bg-gray-50">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-blue-600">psychology</span>
                        <h3 class="text-xl font-bold text-slate-800">Knowledge Check</h3>
                    </div>
                    <button onclick="closeQuiz()" class="text-gray-400 hover:text-gray-600 hover:bg-gray-200 rounded-full p-1 transition"><span class="material-symbols-outlined">close</span></button>
                </div>
                <div id="quiz-language-selector" class="hidden flex items-center gap-2 p-3 bg-white border-2 border-slate-200 rounded-lg">
                    <span class="text-sm font-semibold text-slate-700">Quiz Language:</span>
                    <button onclick="selectQuizLanguage('english')" class="px-4 py-2 rounded-lg text-sm font-semibold border-2 transition" id="quiz-select-en">
                        <span class="material-symbols-outlined text-sm align-middle">language</span> English
                    </button>
                    <button onclick="selectQuizLanguage('chinese')" class="px-4 py-2 rounded-lg text-sm font-semibold border-2 transition" id="quiz-select-zh">
                        <span class="material-symbols-outlined text-sm align-middle">translate</span> 中文
                    </button>
                </div>
            </div>
            <div id="quiz-content" class="p-8 overflow-y-auto space-y-8 bg-white"></div>
            <div id="quiz-footer" class="p-6 border-t border-gray-100 bg-gray-50 flex justify-end"></div>
        </div>
    </div>

    <!-- Add Vocab Modal -->
    <div id="add-vocab-modal" class="modal hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl w-full max-w-3xl flex flex-col h-[80vh]">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg">新增生字</h3>
                <button onclick="closeAddVocabModal()" class="text-gray-400 hover:text-gray-700 rounded p-1">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="p-4 flex-1 flex flex-col gap-3">
                <div id="add-vocab-hint" class="bg-blue-50 text-blue-800 p-3 rounded text-xs">
                    格式：[{ "word": "...", "def": "...", "pos": "n." }, ...]
                </div>
                <textarea id="add-vocab-input" class="flex-1 border rounded p-4 font-mono text-xs resize-none" placeholder="[{&quot;word&quot;:&quot;Example&quot;,&quot;def&quot;:&quot;範例&quot;,&quot;pos&quot;:&quot;n.&quot;}]"></textarea>
            </div>
            
            <div class="p-4 border-t flex justify-between gap-3">
                <div></div>
                <div class="flex gap-3">
                    <button onclick="closeAddVocabModal()" class="px-4 py-2 rounded border border-slate-300 hover:bg-slate-50 font-medium">Cancel</button>
                    <button onclick="addNewVocabFromJSON()" class="bg-indigo-600 text-white px-6 py-2 rounded font-bold hover:bg-indigo-700">Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->

    <div id="edit-modal" class="modal hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl w-full max-w-4xl flex flex-col h-[85vh]">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg">編輯逐字稿段落</h3>
                <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-700 rounded p-1">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="p-6 flex-1 flex flex-col gap-4 overflow-y-auto">
                <div class="flex-1 flex flex-col">
                    <label class="font-semibold mb-2 text-sm text-slate-700">英文內容</label>
                    <textarea id="edit-en-input" class="flex-1 border-2 border-slate-300 rounded-lg p-4 font-sans text-base resize-none focus:border-blue-500 focus:outline-none min-h-[200px]" placeholder="輸入英文內容..."></textarea>
                </div>
                
                <div class="flex-1 flex flex-col">
                    <label class="font-semibold mb-2 text-sm text-slate-700">中文翻譯</label>
                    <textarea id="edit-cn-input" class="flex-1 border-2 border-slate-300 rounded-lg p-4 font-sans text-base resize-none focus:border-blue-500 focus:outline-none min-h-[200px]" placeholder="輸入中文翻譯（可選）..."></textarea>
                </div>
            </div>
            
            <div class="p-4 border-t flex justify-end gap-3">
                <button onclick="closeEditModal()" class="px-6 py-2.5 rounded-lg border border-slate-300 hover:bg-slate-50 font-medium">取消</button>
                <button onclick="saveEdit()" class="bg-blue-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-blue-700">儲存</button>
            </div>
        </div>
    </div>

    <!-- Insert Transcript Modal -->
    <div id="insert-modal" class="modal fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-2xl w-full max-w-3xl flex flex-col h-[80vh]">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg">從段落 <span id="insert-segment-index">9</span> 插入逐字稿</h3>
                <div class="flex items-center gap-2">
                    <button id="copy-insert-prompt-btn" onclick="copyInsertPrompt()" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 hover:border-indigo-300 text-xs font-semibold transition" title="複製 AI Prompt">
                        <span class="material-symbols-outlined text-sm">auto_awesome</span>
                        AI Prompt
                    </button>
                    <button onclick="closeInsertModal()" class="text-gray-400 hover:text-gray-700 rounded p-1">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
            </div>
            
            <div class="p-4 flex-1 flex flex-col gap-3">
                <div class="bg-purple-50 text-purple-800 p-3 rounded text-xs">
                    格式：[{ "en": "...", "cn": "...", "t": 0 }, ...]<br>
                    <strong>注意：</strong>此功能會從選定的段落開始，用新資料<strong>取代</strong>之後所有段落，但保留之前的段落。
                </div>
                <textarea id="insert-input" class="flex-1 border rounded p-4 font-mono text-xs resize-none" placeholder="[{&quot;en&quot;:&quot;Hello&quot;,&quot;cn&quot;:&quot;你好&quot;,&quot;t&quot;:0}]"></textarea>
            </div>
            
            <div class="p-4 border-t flex justify-end gap-3">
                <button onclick="closeInsertModal()" class="px-4 py-2 rounded hover:bg-gray-100">Cancel</button>
                <button onclick="insertTranscriptFromIndex()" class="bg-purple-600 text-white px-6 py-2 rounded font-bold hover:bg-purple-700">插入逐字稿</button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="import-modal" class="modal hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl w-full max-w-3xl flex flex-col h-[80vh]">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg" id="modal-title">Import</h3>
                <div class="flex items-center gap-2">
                    <button id="copy-transcript-prompt-btn" onclick="copyTranscriptPromptFromClipboard()" class="hidden inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 hover:border-emerald-300 text-xs font-semibold transition" title="複製剪貼簿 Prompt">
                        <span class="material-symbols-outlined text-sm">content_paste</span>
                        剪貼簿 Prompt
                    </button>
                    <button id="copy-prompt-btn" onclick="copyPrompt()" class="hidden inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 hover:border-indigo-300 text-xs font-semibold transition" title="複製 AI Prompt">
                        <span class="material-symbols-outlined text-sm">auto_awesome</span>
                        AI Prompt
                    </button>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-700 rounded p-1">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
            </div>
            
            <div class="p-4 flex-1 flex flex-col gap-3">
                <div id="modal-hint" class="bg-blue-50 text-blue-800 p-3 rounded text-xs"></div>
                <textarea id="import-input" class="flex-1 border rounded p-4 font-mono text-xs resize-none"></textarea>
            </div>
            
            <div class="p-4 border-t flex justify-between gap-3">
                <div class="flex gap-2">
                    <button id="clear-data-btn" class="px-4 py-2 rounded border border-red-300 bg-red-50 text-red-700 hover:bg-red-100 font-medium text-sm hidden">
                        <span class="material-symbols-outlined text-base align-middle">delete_outline</span> 清除所有紀錄
                    </button>
                </div>
                <div class="flex gap-3">
                    <button onclick="closeModal()" class="px-4 py-2 rounded hover:bg-gray-100">Cancel</button>
                    <button id="import-action-btn" class="bg-blue-600 text-white px-6 py-2 rounded font-bold">Load</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global State - Load from localStorage
        let transcriptData = [{"en":"Raise your hand if you don't know what this is. That is a human brain that turned to glass during the Mount Vesuvius eruption in 79 AD. But it gets weirder—only this man's brain turned to glass, not his other organs, leaving scientists baffled for centuries about how volcanic ash clouds could create the precise temperature conditions to forge glass from living tissue.","cn":"如果你不知道這是什麼，請舉手。那是一個人類的大腦，在西元 79 年維蘇威火山噴發期間變成了玻璃。但更奇怪的是——只有這個人的大腦變成了玻璃，他的其他器官卻沒有。這讓科學家們困惑了幾個世紀：火山灰雲究竟如何創造出精確的溫度條件，將活體組織鍛造成玻璃。","t":3},{"en":"If you didn't know what this was, then you're exactly where you should be, because this talk is about the power of not knowing. Now, this matters more than ever because we live in a culture that is absolutely obsessed with having the right answer immediately.","cn":"如果你不知道這是什麼，那麼你正處於最理想的狀態，因為這場演講的主題就是關於「不知道」的力量。這在現今比以往任何時候都更重要，因為我們生活在一個絕對痴迷於立即獲得正確答案的文化中。","t":30},{"en":"Our algorithms on social media reward the loudest, most confident hot takes over the most curious questions. Everyone is supposed to be an expert in everything all the time. And if you get something remotely wrong? Cancelled. It's exhausting. But I think I found another way.","cn":"社群媒體的演算法獎勵那些最大聲、最自信的辛辣觀點，而非充滿好奇的提問。每個人都被要求隨時成為所有領域的專家。而如果你出一點點錯？你就被封殺了。這讓人精疲力竭。但我認為我找到了另一條路。","t":46},{"en":"When I started my channel, Today I Learned, in two years, over two million people followed. Not for expert opinions or hot takes, but for something much simpler: shared curiosity. Which is ironic, because for a long time, I was the complete opposite. I was a recovering know-it-all.","cn":"當我創立我的頻道「今天我學到了」（Today I Learned）時，兩年內有超過兩百萬人追蹤。不是為了專家意見或尖銳評論，而是為了更簡單的東西：共同的好奇心。這很諷刺，因為很長一段時間以來，我完全相反。我是一個正在戒斷中的「萬事通」。","t":61},{"en":"During my doctorate at UCSF, I was obsessed with certainty. I wanted to have the right answer before anyone even asked the question. When COVID hit, I started posting science videos as a creative outlet, but even then, I constrained myself. I thought, 'Only post about things you know, Harini.' So I stuck rigidly to pharmacy topics.","cn":"在加州大學舊金山分校（UCSF）攻讀博士期間，我痴迷於確定性。我想在別人提問之前就先掌握正確答案。當新冠疫情爆發時，我開始發布科學影片作為創意出口，但即便如此，我也限制了自己。我心想：「Harini，只發布你懂的東西。」所以我死板地守在藥學話題上。","t":85},{"en":"Then I went to Mexico. I was standing in front of the pyramids in the blazing heat when I realized something profound: I had no idea what I was looking at. Who built this? Why here? Where did they go? Instead of feeling embarrassed that I didn't know, for the first time in a long time, I felt alive.","cn":"後來我去了墨西哥。在烈日下站在金字塔前，我意識到了一件深刻的事：我完全不知道自己在看什麼。誰建造了它？為什麼在這裡？他們去哪了？我非但沒有因為不知道而感到尷尬，反而長時間以來第一次感到自己充滿活力。","t":111},{"en":"Every carving was a mystery that made my brain tingle in ways that pharmaceutical calculations never did. That night, I couldn't stop researching—not to become an expert, but to feed my curiosity. I made a video about Teotihuacán, posted it, and went to sleep.","cn":"每一處雕刻都是一個謎，讓我的大腦產生了藥學計算從未帶給我的興奮感。那天晚上，我無法停止研究——不是為了成為專家，而是為了餵養我的好奇心。我製作了一段關於特奧蒂瓦坎的影片，發布後就去睡覺了。","t":134},{"en":"I woke up to 40,000 new followers. My first viral video had nothing to do with my eight years of higher education. It was about me, a human being, nerding out over ancient architecture and sharing the incredible work of archaeologists. People weren't following me because I was an expert; they were following me because I was curious.","cn":"醒來後，我發現多了四萬名追蹤者。我的第一支爆紅影片與我八年的高等教育毫無關係。那是關於我——一個普通人，對古代建築著迷，並分享考古學家們令人驚嘆的研究成果。人們追蹤我不是因為我是專家，而是因為我充滿好奇。","t":159},{"en":"And curiosity is contagious. Because here is the paradox of our time. We have infinite access to information, but also infinite misinformation. Conspiracy theories get more clicks than peer-reviewed studies. Confident nonsense spreads faster than careful science.","cn":"好奇心是會傳染的。因為這就是我們時代的悖論：我們擁有無限的信息獲取管道，但同時也有無限的錯誤信息。陰謀論獲得的點擊量比同行評審的研究還要多，自信的胡說八道比嚴謹的科學傳播得更快。","t":191},{"en":"In that chaos, championing credible voices and making that work accessible seem to unlock something in people. Because after that, my comments exploded with TIL: Today I Learned. In that moment, my mission became clear.","cn":"在混亂之中，擁護可靠的聲音並讓這些成果變得易於理解，似乎能激發人們內心的某種共鳴。在那之後，我的評論區爆發了大量的『TIL：今天我學到了』。就在那一刻，我的使命變得清晰。","t":209},{"en":"Take the most rigorous, mind-blowing research and make it so captivating that someone scrolling at 2am stops and goes, 'Wait, what?' Because science is for everyone, not dumbed down, but translated with the excitement it deserves. I changed my channel name that night and didn't look back.","cn":"將最嚴謹、最震撼的研究轉化得如此吸引人，讓凌晨兩點滑手機的人也會停下來驚呼：『等一下，什麼？』因為科學是屬於每個人的，不是將其『弱智化』，而是以它應有的興奮感來轉譯。那天晚上我更改了頻道名稱，從此勇往直前。","t":227},{"en":"Here's where my curiosity has taken me. There is a 72-year-old geologist who rewrote the origins of life, before GTA 6. Juan Manuel Garcia Ruiz could have retired, but instead he chose to recreate the famous 1952 primordial soup experiment, the one that showed us how life began on Earth.","cn":"這就是好奇心帶領我到達的地方。有一位 72 歲的地質學家，在《俠盜獵車手 6》發售前就改寫了生命的起源。胡安·曼努埃爾·加西亞·魯伊斯本可以退休，但他卻選擇重現著名的 1952 年『原始湯』實驗，那個向我們展示地球生命如何起源的實驗。","t":246},{"en":"But with one tiny change. Instead of using a glass container like the original, he used Teflon. The result? Nothing. Turns out the glass, specifically the silica, was key. When he added silica back in, he didn't just get amino acids, he got all five DNA building blocks and protocells.","cn":"但只做了一個微小的改變：他沒有像最初那樣使用玻璃容器，而是使用了特氟龍。結果呢？一無所獲。事實證明，玻璃（特別是其中的二氧化矽）才是關鍵。當他重新加入二氧化矽時，他不僅得到了氨基酸，還得到了所有五種 DNA 組成部分和原細胞。","t":263},{"en":"The self-organizing structures that came right before actual life. Translation? Life on Earth may have started hundreds of millions of years earlier than we thought. This should be breaking the internet, but most people will never hear about it. That is the gap I'm trying to bridge.","cn":"這些是在真正生命出現之前的自組織結構。這意味著什麼？地球上的生命起源可能比我們想像的要早幾億年。這本該轟動全網，但大多數人卻聞所未聞。這正是我試圖彌補的鴻溝。","t":301},{"en":"Because science isn't just for scientists. When researchers discover how life began or unlock how ancient brains turned to glass, these are ultimately human stories about curiosity, perseverance, asking brave questions. And everyone deserves to feel that electrifying, 'I can’t believe we just learned that' moment.","cn":"因為科學不只是給科學家看的。當研究人員發現生命如何開始，或揭開古代大腦如何變成玻璃時，這些最終都是關於好奇心、毅力和勇敢提問的人類故事。每個人都值得感受那種觸電般的『不敢相信我們剛學到了這個』的時刻。","t":323},{"en":"Like this. For the first time in 2025, we got to witness a human embryo implanting into uterine-like tissue in real time. From this, we learn embryos aggressively burrow, possibly following uterine contractions like GPS signals. This process is actually physically painful.","cn":"就像這樣。在 2025 年，我們首次親眼目睹了人類胚胎實時植入類子宮組織的過程。從中我們了解到胚胎會激進地鑽入，可能像 GPS 信號一樣遵循子宮收縮的方向。這個過程實際上會帶來生理上的疼痛。","t":346},{"en":"The countless women who felt a sharp twinge and wondered if they'd imagined it, they didn't. Science just caught up to what their bodies already knew. We finally answered one of human development's biggest black boxes, while validating millions of women's experiences in the process.","cn":"無數感到劇烈刺痛並懷疑是否是幻覺的女性，其實那並不是幻覺。科學終於趕上了她們身體早已知曉的事實。我們終於破解了人類發育中最大的黑盒子之一，並在此過程中驗證了數百萬女性的親身經歷。","t":368},{"en":"After doing this for a few years, here's what I've learned. People don't make discoveries because they already know things. They make discoveries because they get obsessed with the stuff they don't know. And learning isn't linear. It's a beautiful, endless loop.","cn":"在從事這件事幾年後，這是我學到的：人們之所以能有所發現，並不是因為他們已經掌握了知識，而是因為他們對未知的事物感到著迷。學習並非線性的，而是一個美麗且永無止境的循環。","t":388},{"en":"When I shared my Teotihuacán obsession, I was inviting 40,000 other people to be curious with me and showing them that science can be as captivating as any Netflix series. See, my doctorate taught me how to read studies and think critically. But my channel taught me that everyone deserves access to that knowledge.","cn":"當我分享我對特奧蒂瓦坎的痴迷時，我是在邀請其他四萬人與我一起保持好奇，並向他們展示科學可以像任何 Netflix 影集一樣迷人。你看，我的博士學位教會了我如何閱讀研究報告和批判性思考，但我的頻道教會了我，每個人都有權獲得這些知識。","t":406},{"en":"So here's my challenge for you. Find your Teotihuacán. Find the thing that lights you up from the inside, not because you understand it, but because you don't. Maybe it's quantum physics. Maybe it's how sourdough starter is basically a pet you can eat.","cn":"所以，我對各位的挑戰是：找到屬於你的『特奧蒂瓦坎』。找到那件能從內心點亮你的事物，不是因為你了解它，而是因為你不了解。也許是量子物理，也許是酸種發酵劑基本上就是一種可以吃的寵物。","t":420},{"en":"Whatever makes you feel like that kid that asked 'why' over and over until your parents wanted to scream. When I first started dating my husband, he called me '20 questions.' Bring that energy to the table. TLDR: stay gloriously, unapologetically curious.","cn":"無論是什麼，只要能讓你感覺像那個不停問『為什麼』直到父母想尖叫的小孩。當我剛開始和丈夫約會時，他叫我『問題妹』。請展現出那樣的能量。總結來說：保持那份燦爛、理直氣壯的好奇心吧。","t":430},{"en":"All right, that's it from me, I've got to go research how the real city Atlanta is buried beneath our feet. Thank you.","cn":"好了，我的演講到此結束。我要去研究真正的亞特蘭大城是如何埋在我們腳下的了。謝謝各位。","t":446}];
        let vocabData = [{"id":"vesuvius","word":"Vesuvius","ipa":"/vəˈsuː.vi.əs/","pos":"noun","def":"A stratovolcano in the Gulf of Naples, Italy, best known for its eruption in 79 AD that destroyed Pompeii.","cn":"維蘇威火山 (義大利著名的活火山)","image":"https://source.unsplash.com/featured/?vesuvius"},{"id":"baffled","word":"Baffled","ipa":"/ˈbæf.əld/","pos":"adjective","def":"Totally bewildered or perplexed; extremely confused.","cn":"感到困惑的、難倒的","image":"https://source.unsplash.com/featured/?confused"},{"id":"forge","word":"Forge","ipa":"/fɔːrdʒ/","pos":"verb","def":"To create or shape (a metal object) by heating it in a fire or furnace and beating it.","cn":"鍛造、鑄就 (文中指將組織鍛造成玻璃)","image":"https://source.unsplash.com/featured/?forge"},{"id":"algorithms","word":"Algorithms","ipa":"/ˈæl.ɡə.rɪ.ðəmz/","pos":"noun","def":"A process or set of rules to be followed in calculations or other problem-solving operations, especially by a computer.","cn":"演算法 (文中指社群媒體的推送機制)","image":"https://source.unsplash.com/featured/?algorithm"},{"id":"ironic","word":"Ironic","ipa":"/aɪˈrɑː.nɪk/","pos":"adjective","def":"Happening in a way contrary to what is expected, and typically causing wry amusement because of this.","cn":"諷刺的、出乎意料的","image":"https://source.unsplash.com/featured/?ironic"},{"id":"doctorate","word":"Doctorate","ipa":"/ˈdɑːk.tɚ.ət/","pos":"noun","def":"The highest degree from a university, awarded after a long period of study and research.","cn":"博士學位","image":"https://source.unsplash.com/featured/?graduation"},{"id":"pharmacy","word":"Pharmacy","ipa":"/ˈfɑːr.mə.si/","pos":"noun","def":"The science or practice of the preparation and dispensing of medicinal drugs.","cn":"藥學、藥理學","image":"https://source.unsplash.com/featured/?pharmacy"},{"id":"profound","word":"Profound","ipa":"/prəˈfaʊnd/","pos":"adjective","def":"Very great or intense; showing great knowledge or insight.","cn":"深刻的、深奧的","image":"https://source.unsplash.com/featured/?deep"},{"id":"teotihuacan","word":"Teotihuacan","ipa":"/teɪˌoʊ.tiː.wəˈkɑːn/","pos":"noun","def":"An ancient Mesoamerican city located in a sub-valley of the Valley of Mexico, known for its large pyramids.","cn":"特奧蒂瓦坎 (墨西哥著名的古文明遺址)","image":"https://source.unsplash.com/featured/?pyramid"},{"id":"archaeologists","word":"Archaeologists","ipa":"/ˌɑːr.kiˈɑː.lə.dʒɪsts/","pos":"noun","def":"People who study human history and prehistory through the excavation of sites and the analysis of artifacts.","cn":"考古學家","image":"https://source.unsplash.com/featured/?archaeology"},{"id":"rigorous","word":"Rigorous","ipa":"/ˈrɪɡ.ɚ.əs/","pos":"adjective","def":"Extremely thorough, exhaustive, or accurate.","cn":"嚴謹的、嚴格的","image":"https://source.unsplash.com/featured/?strict"},{"id":"captivating","word":"Captivating","ipa":"/ˈkæp.tɪ.veɪ.tɪŋ/","pos":"adjective","def":"Capable of attracting and holding interest; charming.","cn":"迷人的、吸引人的","image":"https://source.unsplash.com/featured/?captivating"},{"id":"perseverance","word":"Perseverance","ipa":"/ˌpɝː.səˈvɪr.əns/","pos":"noun","def":"Persistence in doing something despite difficulty or delay in achieving success.","cn":"毅力、堅持不懈","image":"https://source.unsplash.com/featured/?perseverance"}];
        let quizData = {"english":[{"q":"According to the prediction by the WHO mentioned in the talk, what will be the cost of the modern sedentary lifestyle by the end of the decade?","options":["It will result in a global decrease in chronic illnesses.","It will lead to 500 million new cases of preventable conditions.","It will cost governments 500 billion dollars a year.","It will primarily affect the elderly population only."],"correct":1},{"q":"What did physiologist Keith Diaz discover about the effectiveness of working out once a day or using a standing desk?","options":["They are sufficient to completely offset the dangers of sitting.","Standing desks are significantly better than taking movement breaks.","Your health is still in jeopardy if you remain sedentary for the majority of the day.","Working out in the morning creates a permanent buffer against sitting."],"correct":2},{"q":"In the speaker's personal experiment, how did her vital signs change on the day she took movement breaks compared to the day she sat for eight hours?","options":["Her glucose levels increased, but her mood improved.","Her blood pressure dropped by five points and glucose was cut nearly in half.","Her vital signs remained exactly the same, but she felt less tired.","Her blood pressure increased due to the stress of moving."],"correct":1},{"q":"What was the surprising finding regarding productivity in the 'Body Electric Study'?","options":["The breaks did not hurt productivity and often improved focus and quality.","Participants struggled to focus after returning to their desks.","Most people had to work longer hours to finish their tasks.","Productivity dropped by 18% due to constant interruptions."],"correct":0},{"q":"How does the speaker describe the physiological effect of sitting on the arteries in our hips and knees?","options":["They expand to allow better blood flow.","They become stiff like a frozen pipe.","They get bent like a kinked vacuum hose, causing blood to pool.","They disconnect from the nervous system temporarily."],"correct":2},{"q":"According to the speaker, what is 'interoception' and how do screens impact it?","options":["It is a vision problem caused by blue light.","It is the body's ability to focus, which screens enhance.","It is the body's way of signaling needs, which screens cause us to ignore.","It is a mental state of anxiety caused by social media."],"correct":2},{"q":"What was the outcome for Dana, the 43-year-old woman who joined the study?","options":["She saw no change in her health despite walking every morning.","She lowered her blood pressure and was able to stop taking her medications.","She decided to quit her job to focus on her health.","She increased her insulin dosage to manage the stress."],"correct":1}],"chinese":[{"q":"根據演講中提到的世界衛生組織（WHO）預測，到了這十年末，現代久坐的生活方式將帶來什麼代價？","options":["這將導致全球慢性疾病減少。","這將導致 5 億個可預防疾病的新病例。","這將使政府每年花費 5000 億美元。","這將主要只影響老年人口。"],"correct":1},{"q":"生理學家 Keith Diaz 對於每天運動一次或使用站立式辦公桌的成效有何發現？","options":["它們足以完全抵消久坐的危險。","站立式辦公桌比進行運動休息明顯更好。","如果你一天中大部分時間仍保持久坐，你的健康依然岌岌可危。","早上運動可以建立對抗久坐的永久緩衝。"],"correct":2},{"q":"在講者的個人實驗中，與連續坐著八小時的那天相比，她在進行運動休息的那天生命徵象有何變化？","options":["她的血糖升高，但心情變好了。","她的血壓下降了五點，且血糖幾乎減半。","她的生命徵象完全保持不變，但她感覺比較不累。","因為移動的壓力，她的血壓升高了。"],"correct":1},{"q":"在「人體電流研究」（Body Electric Study）中，關於生產力有什麼令人驚訝的發現？","options":["休息並沒有損害生產力，反而通常能改善專注力和品質。","參與者回到座位後難以集中注意力。","大多數人必須工作更長的時間來完成任務。","由於不斷的干擾，生產力下降了 18%。"],"correct":0},{"q":"講者如何描述久坐對我們臀部和膝蓋動脈的生理影響？","options":["它們會擴張以允許更好的血液流動。","它們會像冷凍的水管一樣變硬。","它們會像扭結的真空吸塵器軟管一樣彎曲，導致血液淤積。","它們會暫時與神經系統斷開連接。"],"correct":2},{"q":"根據講者的說法，什麼是「內感受」（interoception），螢幕又是如何影響它的？","options":["這是一種由藍光引起的視力問題。","這是身體集中注意力的能力，螢幕會增強這種能力。","這是身體發出需求訊號的方式，而螢幕會導致我們忽略它。","這是一種由社群媒體引起的焦慮心理狀態。"],"correct":2},{"q":"對於參加這項研究的 43 歲女性 Dana 來說，結果如何？","options":["儘管她每天早上散步，健康狀況卻沒有變化。","她降低了血壓，並且能夠停止服用藥物。","她決定辭職以專注於自己的健康。","她增加了胰島素劑量來控制壓力。"],"correct":1}]};
        let quizLanguage = 'english'; // 'english' or 'chinese'
        let videoId = localStorage.getItem('videoId') || '';
        let selectedWords = ["pandemic","premature"];
        let translationsVisible = false;
        let player;
        let playerReady = false;

        // Sticky video functionality
        const videoContainer = document.getElementById('video-container');
        const videoSection = document.getElementById('video-section');
        const videoPlaceholder = document.getElementById('video-placeholder');
        const closeBtn = document.getElementById('close-sticky-video');
        const floatingCloseBtn = document.getElementById('floating-close-btn');
        let isSticky = false;
        let manuallyHidden = false;
        let initialTop = 0;

        // Calculate initial position once
        if (videoSection) {
            setTimeout(() => {
                initialTop = videoSection.getBoundingClientRect().top + window.scrollY;
            }, 100);
        }

        function updateStickyVideo() {
            if (!videoSection || manuallyHidden) return;
            
            const shouldBeSticky = window.scrollY > initialTop + 100;
            
            if (shouldBeSticky && !isSticky) {
                videoContainer.classList.add('sticky-video');
                videoPlaceholder.classList.remove('hidden');
                closeBtn.classList.remove('hidden');
                floatingCloseBtn.classList.remove('hidden');
                isSticky = true;
            } else if (!shouldBeSticky && isSticky) {
                videoContainer.classList.remove('sticky-video');
                videoPlaceholder.classList.add('hidden');
                closeBtn.classList.add('hidden');
                floatingCloseBtn.classList.add('hidden');
                isSticky = false;
            }
        }

        function closeStickyVideo() {
            videoContainer.classList.remove('sticky-video');
            videoPlaceholder.classList.add('hidden');
            closeBtn.classList.add('hidden');
            floatingCloseBtn.classList.add('hidden');
            isSticky = false;
            manuallyHidden = true;
        }

        function manualToggleSticky() {
            if (isSticky) {
                // 如果已經是浮動狀態，關閉它
                closeStickyVideo();
            } else {
                // 開啟浮動模式
                videoContainer.classList.add('sticky-video');
                videoPlaceholder.classList.remove('hidden');
                closeBtn.classList.remove('hidden');
                floatingCloseBtn.classList.remove('hidden');
                isSticky = true;
                manuallyHidden = false;
            }
        }

        closeBtn.addEventListener('click', closeStickyVideo);
        floatingCloseBtn.addEventListener('click', closeStickyVideo);

        window.addEventListener('scroll', updateStickyVideo);
        window.addEventListener('resize', () => {
            if (videoSection && !manuallyHidden) {
                initialTop = videoSection.getBoundingClientRect().top + window.scrollY;
                updateStickyVideo();
            }
        });

        let youtubeAPIReady = false;
        let currentFontSize = 18; // base font size in px
        let currentPlaybackSpeed = 1.0;

        const modal = document.getElementById('import-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalHint = document.getElementById('modal-hint');
        const inputArea = document.getElementById('import-input');
        const actionBtn = document.getElementById('import-action-btn');
        const floatingCard = document.getElementById('floating-card');
        const transcriptPromptBtn = document.getElementById('copy-transcript-prompt-btn');

        // Modal Functions
        function openModal(mode) {
            modal.classList.remove('hidden');
            inputArea.value = '';
            inputArea.focus();
            const clearBtn = document.getElementById('clear-data-btn');
            const copyBtn = document.getElementById('copy-prompt-btn');
            window.currentModalMode = mode;
            
            if (mode === 'video') {
                modalTitle.innerText = "設定 YouTube 影片";
                modalHint.innerText = '貼上 YouTube 網址或影片 ID';
                inputArea.placeholder = 'https://www.youtube.com/watch?v=...';
                actionBtn.onclick = parseVideoUrl;
                clearBtn.classList.add('hidden');
                copyBtn.classList.add('hidden');
                transcriptPromptBtn.classList.add('hidden');
            } else if (mode === 'transcript') {
                modalTitle.innerText = "匯入逐字稿";
                modalHint.innerText = '格式：[{ "en": "...", "cn": "...", "t": 0 }, ...]';
                inputArea.placeholder = '[{"en":"Hello","cn":"你好","t":0}]';
                actionBtn.onclick = parseTranscript;
                clearBtn.classList.remove('hidden');
                copyBtn.classList.remove('hidden');
                transcriptPromptBtn.classList.remove('hidden');
                clearBtn.onclick = () => {
                    if (confirm('確定要清除所有逐字稿紀錄嗎？')) {
                        clearTranscriptData();
                    }
                };
            } else if (mode === 'vocab') {
                modalTitle.innerText = "匯入單字";
                modalHint.innerText = '格式：[{ "word": "...", "def": "...", "pos": "n." }, ...]';
                inputArea.placeholder = '[{"word":"Example","def":"範例"}]';
                actionBtn.onclick = parseVocab;
                clearBtn.classList.remove('hidden');
                copyBtn.classList.remove('hidden');
                transcriptPromptBtn.classList.add('hidden');
                clearBtn.onclick = () => {
                    if (confirm('確定要清除所有單字紀錄嗎？')) {
                        clearVocabData();
                    }
                };
            } else {
                modalTitle.innerText = "匯入 Quiz（雙語格式）";
                modalHint.innerText = '格式：{ "english": [{"q":"...", "options":[...], "correct":0}], "chinese": [{"q":"...", "options":[...], "correct":0}] }';
                inputArea.placeholder = '{"english":[{"q":"Question?","options":["A","B","C","D"],"correct":0}],"chinese":[{"q":"題目?","options":["A","B","C","D"],"correct":0}]}';
                actionBtn.onclick = parseQuiz;
                clearBtn.classList.remove('hidden');
                copyBtn.classList.remove('hidden');
                transcriptPromptBtn.classList.add('hidden');
                clearBtn.onclick = () => {
                    if (confirm('確定要清除所有 Quiz 題庫嗎？')) {
                        clearQuizData();
                    }
                };
            }
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        function selectQuizLanguage(lang) {
            quizLanguage = lang;
            updateQuizLanguageSelector();
            renderQuizContent(); // 重新渲染題目
        }

        function updateQuizLanguageSelector() {
            const btnEn = document.getElementById('quiz-select-en');
            const btnZh = document.getElementById('quiz-select-zh');
            
            if (!btnEn || !btnZh) return;
            
            if (quizLanguage === 'english') {
                btnEn.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                btnEn.classList.remove('bg-white', 'text-slate-700', 'border-slate-300');
                btnZh.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                btnZh.classList.add('bg-white', 'text-slate-700', 'border-slate-300');
            } else {
                btnZh.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                btnZh.classList.remove('bg-white', 'text-slate-700', 'border-slate-300');
                btnEn.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                btnEn.classList.add('bg-white', 'text-slate-700', 'border-slate-300');
            }
        }


        function generateTranscriptPrompt() {
            let prompt = '';
            
            // Add video URL if available
            if (videoId && videoId.length === 11) {
                prompt += `https://www.youtube.com/watch?v=${videoId}\n\n`;
            } else {
                prompt += '🔻\n\n';
            }
            
            prompt += `將以上影片的演講內容，整理成英文和中文隨段落對照的逐字稿，並以以下格式嚴格依照 JSON Array 格式輸出結果：：
{
    en: "When I found out my grandmother, my last living grandparent, was dying, my first thought was, \"I need to draw her hands.\" I'm a visual artist, a cartoonist for The New Yorker, and comics writer, so drawing is how I understand much of the world.",
    cn: "當我得知我的祖母——我最後一位在世的祖父母——即將離世時，我的第一個念頭是：「我需要畫下她的手。」我是一位視覺藝術家，也是《紐約客》的漫畫家和漫畫作者，所以繪畫是我理解這個世界的主要方式。"
},
{
    en: "For a long time, my cartoons had been impersonal. Commentary on the world around me, sure, but not really about me. The closest my personal life got to influencing my cartoons were cartoons I lifted from things my friends and family had said around me. It was only after my daughter Ellika was born that my personal life began to creep into my cartoons more.",
    cn: "很長一段時間以來，我的漫畫都是非個人化的。它們是對周遭世界的評論，沒錯，但並不真正關於我自己。我的個人生活對漫畫最接近的影響，頂多就是從朋友和家人的談話中取材。直到我女兒埃莉卡 (Ellika) 出生後，我的個人生活才開始更多地滲透進我的漫畫中。"
}`;
            
            return prompt;
        }

        function generateQuizPrompt() {
            let prompt = 'You are an English teaching and quiz design expert. Based on the English transcript I provide, generate 5~10 comprehension quiz questions in BOTH English and Chinese.\n\n';
            prompt += 'Please output a JSON object with TWO keys: "english" and "chinese", each containing a JSON Array of questions.\n';
            prompt += 'Format specifications:\n\n';
            prompt += '{\n';
            prompt += '  "english": [\n';
            prompt += '    { "q": "Question in English", "options": ["Option A", "Option B", "Option C", "Option D"], "correct": 0 },\n';
            prompt += '    ...\n';
            prompt += '  ],\n';
            prompt += '  "chinese": [\n';
            prompt += '    { "q": "題目中文翻譯", "options": ["選項A", "選項B", "選項C", "選項D"], "correct": 0 },\n';
            prompt += '    ...\n';
            prompt += '  ]\n';
            prompt += '}\n\n';
            prompt += 'Requirements:\n';
            prompt += '- Both English and Chinese versions must have the SAME questions with the SAME correct answers (index).\n';
            prompt += '- English: questions and options in English\n';
            prompt += '- Chinese: complete translation of questions and options to Traditional Chinese\n';
            prompt += '- Output ONLY the JSON object, no explanations or extra text.\n';
            prompt += '- Questions should cover content comprehension, key details, main idea, and inference.\n';
            prompt += '- Avoid duplicate questions or overly similar options.\n';
            prompt += '- Content must be faithful to the transcript; do not add information not present in it.\n\n';
            prompt += 'English transcript:';
            
            if (transcriptData.length > 0) {
                const englishText = transcriptData.map(seg => seg.en).join(' ');
                prompt += englishText;
            } else {
                prompt += '🔻';
            }
            
            return prompt;
        }

        function generateVocabPrompt() {
            let prompt = '你是一位專業的英語教學專家與程式開發輔助者。請分析我提供的文章，並從中挑選出對讀者可能較難、冷僻或具備學習價值的生字（建議難度 B2-C2 或特定領域術語）。\n\n';
            prompt += '請嚴格依照以下 JSON Array 格式輸出結果：\n\n';
            prompt += '1.  **id**: 單字的全小寫形式。\n';
            prompt += '2.  **word**: 單字的首字母大寫。\n';
            prompt += '3.  **ipa**: 該單字的 IPA 音標。\n';
            prompt += '4.  **pos**: 詞性 (如 noun, verb, adjective)。\n';
            prompt += '5.  **def**: 簡潔的英文定義。\n';
            prompt += '6.  **cn**: 繁體中文解釋 (若有特定語境請一併標註)。\n';
            prompt += '範例格式：\n';
            prompt += '[\n    {\n        "id": "pareidolia",\n        "word": "Pareidolia",\n        "ipa": "/ˌpær.ɪˈdoʊ.li.ə/",\n        "pos": "noun",\n        "def": "The psychological phenomenon of seeing recognizable shapes, especially faces, in random or vague stimuli.",\n        "cn": "幻想性錯覺 (尤指將模糊圖像看作人臉)",\n     }\n]\n\n';
            prompt += '文章內容如下：\n';
            
            // Add English transcript if available
            if (transcriptData.length > 0) {
                const englishText = transcriptData.map(seg => seg.en).join(' ');
                prompt += englishText + '\n\n';
            } else {
                prompt += '🔻\n\n';
            }
            
            return prompt;
        }

        function copyPrompt() {
            let promptText = '';
            
            if (window.currentModalMode === 'transcript') {
                promptText = generateTranscriptPrompt();
            } else if (window.currentModalMode === 'vocab') {
                promptText = generateVocabPrompt();
            } else if (window.currentModalMode === 'quiz') {
                promptText = generateQuizPrompt();
            }
            
            if (!promptText) {
                alert('無法生成prompt');
                return;
            }
            
            navigator.clipboard.writeText(promptText).then(() => {
                const copyBtn = document.getElementById('copy-prompt-btn');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span class="material-symbols-outlined">done</span>';
                copyBtn.style.color = '#10b981';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.style.color = '';
                }, 2000);
                
                console.log('✅ Prompt已複製到剪貼簿');
            }).catch(err => {
                console.error('複製失敗:', err);
                alert('複製失敗，請重試');
            });
        }

        async function copyTranscriptPromptFromClipboard() {
            try {
                const clipboardText = await navigator.clipboard.readText();
                const sourceText = clipboardText.trim() ? clipboardText.trim() : '🔻';
                const promptText = `${sourceText}

將以上未經整理的文稿內容，整理成英文和中文隨段落對照的逐字稿，並以以下格式嚴格依照 JSON Array 格式輸出結果：：
{
    en: "When I found out my grandmother, my last living grandparent, was dying, my first thought was, \"I need to draw her hands.\" I'm a visual artist, a cartoonist for The New Yorker, and comics writer, so drawing is how I understand much of the world.",
    cn: "當我得知我的祖母——我最後一位在世的祖父母——即將離世時，我的第一個念頭是：「我需要畫下她的手。」我是一位視覺藝術家，也是《紐約客》的漫畫家和漫畫作者，所以繪畫是我理解這個世界的主要方式。"
},
{
    en: "For a long time, my cartoons had been impersonal. Commentary on the world around me, sure, but not really about me. The closest my personal life got to influencing my cartoons were cartoons I lifted from things my friends and family had said around me. It was only after my daughter Ellika was born that my personal life began to creep into my cartoons more.",
    cn: "很長一段時間以來，我的漫畫都是非個人化的。它們是對周遭世界的評論，沒錯，但並不真正關於我自己。我的個人生活對漫畫最接近的影響，頂多就是從朋友和家人的談話中取材。直到我女兒埃莉卡 (Ellika) 出生後，我的個人生活才開始更多地滲透進我的漫畫中。"
}`;

                await navigator.clipboard.writeText(promptText);
                const originalHTML = transcriptPromptBtn.innerHTML;
                transcriptPromptBtn.innerHTML = '<span class="material-symbols-outlined text-base align-middle">done</span> 已複製';
                transcriptPromptBtn.classList.remove('bg-blue-50', 'text-blue-700');
                transcriptPromptBtn.classList.add('bg-emerald-50', 'text-emerald-700');

                setTimeout(() => {
                    transcriptPromptBtn.innerHTML = originalHTML;
                    transcriptPromptBtn.classList.remove('bg-emerald-50', 'text-emerald-700');
                    transcriptPromptBtn.classList.add('bg-blue-50', 'text-blue-700');
                }, 2000);
            } catch (err) {
                console.error('讀取或複製剪貼簿失敗:', err);
                alert('無法讀取剪貼簿內容，請允許瀏覽器存取剪貼簿後重試。');
            }
        }

        function parseJSON(str) {
            str = str.trim();
            // 如果不是 [ 或 { 開頭，假設為陣列並加上 []
            if (!str.startsWith('[') && !str.startsWith('{')) {
                str = '[' + str + ']';
            }
            return JSON.parse(str);
        }

        function parseVideoUrl() {
            try {
                const input = inputArea.value.trim();
                let id = input;
                
                let m = input.match(/[?&]v=([^&]+)/);
                if (m) id = m[1];
                
                m = input.match(/youtu\.be\/([^?]+)/);
                if (m) id = m[1];
                
                id = id.split('&')[0].split('?')[0];
                
                if (id.length !== 11) throw new Error("無效的影片 ID");
                
                // Save to localStorage
                localStorage.setItem('videoId', id);
                
                // Clear selected words when setting new video
                selectedWords = [];
                localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
                
                console.log(`✅ 影片設定為: ${id}`);
                console.log(`✅ 已清空選取的生字，即將重新整理頁面...`);
                
                // Reload page to reset everything
                setTimeout(() => {
                    location.reload();
                }, 500);
            } catch (e) {
                console.error("錯誤: " + e.message);
            }
        }

        function parseTranscript() {
            try {
                const data = parseJSON(inputArea.value);
                if (!Array.isArray(data)) throw new Error("必須是陣列");
                transcriptData = data;
                localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
                renderTranscript();
                closeModal();
            } catch (e) {
                console.error("格式錯誤: " + e.message);
            }
        }

        function parseVocab() {
            try {
                const data = parseJSON(inputArea.value);
                if (!Array.isArray(data)) throw new Error("必須是陣列");
                vocabData = data;
                localStorage.setItem('vocabData', JSON.stringify(vocabData));
                renderTranscript();
                renderVocab();
                closeModal();
            } catch (e) {
                console.error("格式錯誤: " + e.message);
            }
        }

        function parseQuiz() {
            try {
                const inputValue = inputArea.value.trim();
                if (!inputValue) {
                    alert('請輸入 Quiz 資料');
                    return;
                }
                
                const data = parseJSON(inputValue);
                
                // 檢查是否為雙語格式 { english: [...], chinese: [...] }
                if (typeof data === 'object' && data !== null && !Array.isArray(data) && 'english' in data && 'chinese' in data) {
                    // 雙語格式
                    if (!Array.isArray(data.english) || !Array.isArray(data.chinese)) {
                        alert("錯誤：english 和 chinese 都必須是陣列");
                        return;
                    }
                    if (data.english.length === 0 && data.chinese.length === 0) {
                        alert("錯誤：題庫不能為空");
                        return;
                    }
                    quizData = data; // 保存整個雙語物件
                    localStorage.setItem('quizData', JSON.stringify(quizData));
                    closeModal();
                    alert(`✅ 雙語 Quiz 題庫已匯入\n\n英文：${data.english.length} 題\n中文：${data.chinese.length} 題`);
                    console.log(`✅ 雙語 Quiz 題庫已匯入: 英文 ${data.english.length} 題、中文 ${data.chinese.length} 題`);
                } else if (Array.isArray(data)) {
                    // 傳統格式 - 單一陣列
                    if (data.length === 0) {
                        alert("錯誤：題庫不能為空");
                        return;
                    }
                    quizData = data;
                    localStorage.setItem('quizData', JSON.stringify(quizData));
                    closeModal();
                    alert(`✅ Quiz 題庫已匯入：${quizData.length} 題`);
                    console.log(`✅ Quiz 題庫已匯入: ${quizData.length} 題`);
                } else {
                    alert("格式錯誤：必須是陣列或雙語物件\n\n正確格式：\n{ \"english\": [...], \"chinese\": [...] }\n或\n[{\"q\":\"...\", \"options\":[...], \"correct\":0}]");
                }
            } catch (e) {
                alert("格式錯誤：" + e.message + "\n\n請確認 JSON 格式是否正確");
                console.error("格式錯誤: ", e);
            }
        }

        function clearTranscriptData() {
            transcriptData = [];
            selectedWords = [];
            localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
            localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
            console.log('✅ 逐字稿紀錄已清除');
            setTimeout(() => location.reload(), 500);
        }

        function clearVocabData() {
            vocabData = [];
            localStorage.setItem('vocabData', JSON.stringify(vocabData));
            console.log('✅ 單字紀錄已清除');
            setTimeout(() => location.reload(), 500);
        }

        function clearQuizData() {
            quizData = [];
            localStorage.setItem('quizData', JSON.stringify(quizData));
            console.log('✅ Quiz 題庫已清除');
            setTimeout(() => location.reload(), 500);
        }

        // Render Functions
        function renderTranscript() {
            const container = document.getElementById('transcript-content');
            if (transcriptData.length === 0) return;
            
            container.innerHTML = "";
            const sortedVocab = [...vocabData].sort((a,b) => b.word.length - a.word.length);

            transcriptData.forEach((seg, idx) => {
                let text = seg.en;  // 保持純文本進行替換
                
                // 先進行所有替換，建立標記列表
                const replacements = [];
                
                // Collect all vocab replacements
                sortedVocab.forEach(v => {
                    const roots = v.roots || [v.word];
                    const pattern = roots.map(r => r.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|');
                    const regex = new RegExp(`\\b(${pattern})\\b`, 'gi');
                    let match;
                    while ((match = regex.exec(text)) !== null) {
                        replacements.push({
                            start: match.index,
                            end: match.index + match[0].length,
                            word: match[0],
                            vocab: v,
                            type: 'vocab'
                        });
                    }
                });
                
                // Collect all selected word replacements
                selectedWords.forEach(word => {
                    const escaped = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    const regex = new RegExp(`\\b(${escaped})\\b`, 'gi');
                    let match;
                    while ((match = regex.exec(text)) !== null) {
                        replacements.push({
                            start: match.index,
                            end: match.index + match[0].length,
                            word: match[0],
                            selectedWord: word,
                            type: 'selected'
                        });
                    }
                });
                
                // Sort by start position (descending) to replace from end to start
                replacements.sort((a, b) => b.start - a.start);
                
                // Remove overlapping replacements (keep the first one found)
                const finalReplacements = [];
                replacements.forEach(rep => {
                    const overlaps = finalReplacements.some(r => 
                        (rep.start >= r.start && rep.start < r.end) ||
                        (rep.end > r.start && rep.end <= r.end)
                    );
                    if (!overlaps) {
                        finalReplacements.push(rep);
                    }
                });
                
                // Apply replacements from end to start
                let html = text;
                finalReplacements.forEach(rep => {
                    const before = html.substring(0, rep.start);
                    const after = html.substring(rep.end);
                    let replacement = '';
                    
                    if (rep.type === 'vocab') {
                        const isCustom = rep.vocab.custom ? 'vocab-word-custom' : 'vocab-word';
                        replacement = `<span class="${isCustom}" data-id="${rep.vocab.id || rep.vocab.word}" 
                                           onmouseenter="showCard(event, '${rep.vocab.id || rep.vocab.word}')" 
                                           onmouseleave="hideCard()" 
                                           onclick="toggleCard(event, '${rep.vocab.id || rep.vocab.word}')">${rep.word}</span>`;
                    } else if (rep.type === 'selected') {
                        replacement = `<span class="selected-word" onclick="removeSelectedWord('${rep.selectedWord}')" style="cursor: pointer; text-decoration: underline;" title="點擊取消選取">${rep.word}</span>`;
                    }
                    
                    html = before + replacement + after;
                });

                const hasTime = typeof seg.t === 'number';
                const timeLabel = hasTime ? formatTime(seg.t) : 'Set';
                const timeClass = hasTime ? 'bg-green-50 text-green-700' : 'bg-slate-100 text-slate-600';
                const minutes = hasTime ? Math.floor(seg.t / 60) : '';
                const seconds = hasTime ? seg.t % 60 : '';

                container.innerHTML += `
                    <div class="mb-6" id="seg-${idx}">
                        <div class="flex gap-2 mb-2 flex-wrap items-center">
                            <button class="px-3 py-1.5 rounded-lg border-2 ${timeClass} text-xs font-semibold transition-colors" 
                                    onclick="jumpToTime(${hasTime ? seg.t : 'null'})">
                                ⏵ ${timeLabel}
                            </button>
                            <div class="flex items-center gap-0 bg-blue-50 rounded-lg border-2 border-blue-200 overflow-hidden">

                                <div class="flex items-center gap-0.5 px-2 py-1.5">
                                    <input type="number" id="min-input-${idx}" min="0" max="999" step="1" 
                                           class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400"
                                           placeholder="0" value="${minutes}"
                                           onchange="setTimeByInput(${idx})"
                                           onkeypress="if(event.key==='Enter') setTimeByInput(${idx})">
                                    <span class="text-xs font-bold text-blue-700">:</span>
                                    <input type="number" id="sec-input-${idx}" min="0" max="59" step="1" 
                                           class="w-14 px-2 py-0.5 rounded border border-blue-300 bg-white text-sm font-semibold text-center focus:outline-none focus:ring-2 focus:ring-blue-400"
                                           placeholder="00" value="${seconds ? String(seconds).padStart(2, '0') : ''}"
                                           onchange="setTimeByInput(${idx})"
                                           onkeypress="if(event.key==='Enter') setTimeByInput(${idx})">
                                <div class="h-6 w-px bg-blue-200 ml-3"></div>
                                
                                   </div>
                            </div>
                            <button class="px-3 py-1.5 rounded-lg border-2 border-amber-200 bg-amber-50 text-amber-700 text-xs font-semibold hover:bg-amber-100 transition-colors" 
                                    onclick="editSegment(${idx})">
                                ✏️ Edit
                            </button>
                            </div>
                        <p class="mb-2 text-slate-800 leading-relaxed" id="en-${idx}">${html}</p>
                        ${seg.cn ? `<p class="cn-text hidden text-slate-600 pl-4 border-l-4 border-blue-200 italic text-base" id="cn-${idx}">${seg.cn}</p>` : ''}
                    </div>`;
            });
            
            applyTranslationState();
        }

        function showAddVocabModal() {
            document.getElementById('add-vocab-modal').classList.remove('hidden');
            document.getElementById('add-vocab-input').focus();
        }

        function closeAddVocabModal() {
            document.getElementById('add-vocab-modal').classList.add('hidden');
            // 清空表單
            document.getElementById('add-vocab-input').value = '';
        }

        function addNewVocabFromJSON() {
            try {
                const input = document.getElementById('add-vocab-input').value.trim();
                if (!input) {
                    alert('請輸入單字資料');
                    return;
                }
                
                const data = parseJSON(input);
                if (!Array.isArray(data)) {
                    alert('格式錯誤：必須是陣列');
                    return;
                }
                
                if (data.length === 0) {
                    alert('請至少新增一個單字');
                    return;
                }
                
                let addedCount = 0;
                data.forEach(item => {
                    if (!item.word) return; // 跳過沒有 word 的項目
                    
                    // 檢查是否重複
                    if (vocabData.some(v => v.word.toLowerCase() === item.word.toLowerCase())) {
                        console.warn(`⚠️ 單字已存在，已跳過: ${item.word}`);
                        return;
                    }
                    
                    // 添加新單字（標記為自訂：custom: true）
                    const newVocab = {
                        id: item.word.toLowerCase(),
                        word: item.word.charAt(0).toUpperCase() + item.word.slice(1).toLowerCase(),
                        def: item.def || '',
                        cn: item.cn || '',
                        pos: item.pos || '',
                        custom: true  // 標記為自訂單字
                    };
                    
                    vocabData.push(newVocab);
                    addedCount++;
                });
                
                if (addedCount === 0) {
                    alert('所有單字都已存在或格式不正確');
                    return;
                }
                
                localStorage.setItem('vocabData', JSON.stringify(vocabData));
                renderVocab();
                renderTranscript();
                closeAddVocabModal();
                
                alert(`✅ 已新增 ${addedCount} 個生字`);
                console.log(`✅ 已新增 ${addedCount} 個生字`);
            } catch (e) {
                alert('格式錯誤：' + e.message + '\n\n請確認 JSON 格式是否正確');
                console.error('格式錯誤: ', e);
            }
        }

        function renderVocab() {
            const list = document.getElementById('vocab-list');
            const count = document.getElementById('vocab-count');
            
            if (vocabData.length === 0) return;
            
            count.textContent = vocabData.length;
            list.innerHTML = "";
            
            const sortedVocab = [...vocabData].sort((a,b) => a.word.localeCompare(b.word));
            sortedVocab.forEach((v, index) => {
                list.innerHTML += `
                    <li class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-200 last:border-b-0" 
                        onclick="scrollToVocab('${v.id || v.word}')">
                        <div class="flex items-start gap-3 mb-2">
                            <div class="text-sm font-bold text-slate-400 flex-shrink-0">${index + 1}.</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <div class="font-bold text-base">${v.word}</div>
                                    <button onclick="event.stopPropagation(); speakWord('${v.word}')" class="text-slate-400 hover:text-blue-600 transition" title="播放發音">
                                        <span class="material-symbols-outlined text-sm">volume_up</span>
                                    </button>
                                </div>
                                ${v.ipa ? `<div class="text-xs text-blue-600 font-semibold mt-1">${v.ipa}</div>` : ''}
                                ${v.pos ? `<div class="text-xs text-slate-500 mt-0.5">${v.pos}</div>` : ''}
                            </div>
                        </div>
                        <div class="text-xs text-slate-600 mb-2 ml-6">${v.def || ''}</div>
                        ${v.cn ? `<div class="text-xs text-blue-700 font-semibold ml-6">${v.cn}</div>` : ''}
                    </li>`;
            });
        }
        
        function speakWord(word) {
            // 使用 Web Speech API 播放發音
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 1;
                utterance.pitch = 1;
                speechSynthesis.speak(utterance);
            } else {
                console.warn('您的瀏覽器不支援語音合成功能');
            }
        }

        // YouTube Player
        function onYouTubeIframeAPIReady() {
            youtubeAPIReady = true;
            console.log('YouTube API Ready');
            // Only initialize player if a valid video ID is set
            if (videoId && videoId.length === 11) {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: { rel: 0, modestbranding: 1 },
                    events: {
                        onReady: () => {
                            playerReady = true;
                            player.setPlaybackRate(currentPlaybackSpeed);
                            console.log('YouTube Player Ready');
                        },
                        onStateChange: (event) => {
                            updatePlayPauseButton();
                        }
                    }
                });
            }
        }
        
        function initializePlayer(id) {
            // Initialize player with a specific video ID
            if (!id || id.length !== 11) return;
            videoId = id;
            localStorage.setItem('videoId', id);
            
            // Wait for YouTube API to be ready
            if (!youtubeAPIReady || typeof YT === 'undefined' || typeof YT.Player === 'undefined') {
                console.log('等待 YouTube API 載入...');
                setTimeout(() => initializePlayer(id), 200);
                return;
            }
            
            if (!player) {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: { rel: 0, modestbranding: 1 },
                    events: {
                        onReady: () => {
                            playerReady = true;
                            player.setPlaybackRate(currentPlaybackSpeed);
                            console.log('YouTube Player Ready');
                        },
                        onStateChange: (event) => {
                            updatePlayPauseButton();
                        }
                    }
                });
            } else if (playerReady) {
                player.loadVideoById(videoId);
            }
        }

        function jumpToTime(seconds) {
            if (!player || !playerReady || typeof seconds !== 'number') return;
            player.seekTo(seconds, true);
            player.playVideo();
        }

        

        function setTimeByInput(idx) {
            if (!transcriptData[idx]) return;
            
            const minInput = document.getElementById(`min-input-${idx}`);
            const secInput = document.getElementById(`sec-input-${idx}`);
            
            const minutes = parseInt(minInput.value, 10) || 0;
            const seconds = parseInt(secInput.value, 10) || 0;
            
            if (minutes < 0 || seconds < 0 || seconds > 59) {
                alert('請輸入有效的時間（秒數必須 0-59）');
                return;
            }
            
            const totalSeconds = minutes * 60 + seconds;
            transcriptData[idx].t = totalSeconds;
            localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
            renderTranscript();
            console.log(`✅ 時間戳記已設定: ${formatTime(totalSeconds)}`);
        }

        // Insert Transcript Modal Functions
        let currentInsertIndex = null;

        function openInsertModal(idx) {
            currentInsertIndex = idx;
            document.getElementById('insert-segment-index').textContent = idx + 1;
            document.getElementById('insert-input').value = '';
            document.getElementById('insert-modal').classList.remove('hidden');
            document.getElementById('insert-input').focus();
        }

        function closeInsertModal() {
            document.getElementById('insert-modal').classList.add('hidden');
            currentInsertIndex = null;
        }

        function copyInsertPrompt() {
            let promptText = '';
            
            // Add video URL if available
            if (videoId && videoId.length === 11) {
                promptText += `https://www.youtube.com/watch?v=${videoId}\n\n`;
            } else {
                promptText += '🔻\n\n';
            }
            
            promptText += `將以上影片從 ${formatTime(transcriptData[currentInsertIndex]?.t || 0)} 開始的演講內容，整理成英文和中文隨段落對照的逐字稿，並以以下格式嚴格依照 JSON Array 格式輸出結果：
{
    en: "When I found out my grandmother, my last living grandparent, was dying, my first thought was, \"I need to draw her hands.\" I'm a visual artist, a cartoonist for The New Yorker, and comics writer, so drawing is how I understand much of the world.",
    cn: "當我得知我的祖母——我最後一位在世的祖父母——即將離世時，我的第一個念頭是：「我需要畫下她的手。」我是一位視覺藝術家，也是《紐約客》的漫畫家和漫畫作者，所以繪畫是我理解這個世界的主要方式。"
},
{
    en: "For a long time, my cartoons had been impersonal. Commentary on the world around me, sure, but not really about me. The closest my personal life got to influencing my cartoons were cartoons I lifted from things my friends and family had said around me. It was only after my daughter Ellika was born that my personal life began to creep into my cartoons more.",
    cn: "很長一段時間以來，我的漫畫都是非個人化的。它們是對周遭世界的評論，沒錯，但並不真正關於我自己。我的個人生活對漫畫最接近的影響，頂多就是從朋友和家人的談話中取材。直到我女兒埃莉卡 (Ellika) 出生後，我的個人生活才開始更多地滲透進我的漫畫中。"
}`;
            
            navigator.clipboard.writeText(promptText).then(() => {
                const copyBtn = document.getElementById('copy-insert-prompt-btn');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span class="material-symbols-outlined">done</span>';
                copyBtn.classList.remove('bg-indigo-50', 'text-indigo-700');
                copyBtn.classList.add('bg-green-50', 'text-green-700');
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.classList.remove('bg-green-50', 'text-green-700');
                    copyBtn.classList.add('bg-indigo-50', 'text-indigo-700');
                }, 2000);
                
                console.log('✅ Insert Prompt已複製到剪貼簿');
            }).catch(err => {
                console.error('複製失敗:', err);
                alert('複製失敗，請重試');
            });
        }

        function insertTranscriptFromIndex() {
            if (currentInsertIndex === null || currentInsertIndex === undefined) return;
            
            try {
                const input = document.getElementById('insert-input').value.trim();
                if (!input) {
                    alert('請輸入逐字稿資料');
                    return;
                }
                
                const newData = parseJSON(input);
                if (!Array.isArray(newData)) {
                    alert('格式錯誤：必須是陣列');
                    return;
                }
                
                if (newData.length === 0) {
                    alert('請至少輸入一段逐字稿');
                    return;
                }
                
                // Preserve segments before currentInsertIndex, replace everything from currentInsertIndex onwards
                const preservedSegments = transcriptData.slice(0, currentInsertIndex);
                transcriptData = [...preservedSegments, ...newData];
                
                localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
                renderTranscript();
                closeInsertModal();
                
                alert(`✅ 已從段落 ${currentInsertIndex + 1} 插入 ${newData.length} 段逐字稿\n保留前 ${currentInsertIndex} 段，總共 ${transcriptData.length} 段`);
                console.log(`✅ 插入逐字稿: 保留 ${currentInsertIndex} 段，新增 ${newData.length} 段，總計 ${transcriptData.length} 段`);
            } catch (e) {
                alert('格式錯誤：' + e.message + '\n\n請確認 JSON 格式是否正確');
                console.error('格式錯誤: ', e);
            }
        }

        function editSegment(idx) {
            const seg = transcriptData[idx];
            if (!seg) return;
            
            // Store current editing index
            window.currentEditIndex = idx;
            
            // Fill in the modal
            document.getElementById('edit-en-input').value = seg.en || '';
            document.getElementById('edit-cn-input').value = seg.cn || '';
            
            // Show modal
            document.getElementById('edit-modal').classList.remove('hidden');
            
            // Focus on English input
            setTimeout(() => {
                document.getElementById('edit-en-input').focus();
            }, 100);
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            window.currentEditIndex = null;
        }

        function saveEdit() {
            const idx = window.currentEditIndex;
            if (idx === null || idx === undefined || !transcriptData[idx]) return;
            
            const enText = document.getElementById('edit-en-input').value.trim();
            const cnText = document.getElementById('edit-cn-input').value.trim();
            
            if (enText) {
                transcriptData[idx].en = enText;
            }
            
            transcriptData[idx].cn = cnText;
            
            localStorage.setItem('transcriptData', JSON.stringify(transcriptData));
            renderTranscript();
            closeEditModal();
        }

        function formatTime(sec) {
            if (typeof sec !== 'number' || sec < 0) return '00:00';
            const m = Math.floor(sec / 60);
            const s = Math.floor(sec % 60);
            return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        // Interaction
        function showCard(e, id) {
            const vocab = vocabData.find(v => (v.id === id) || (v.word === id));
            if (!vocab) return;
            
            floatingCard.dataset.currentId = id;
            floatingCard.innerHTML = `
                <div class="p-4">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="text-xl font-bold flex-1">${vocab.word}</h3>
                        <button onclick="event.stopPropagation(); speakWord('${vocab.word}')" class="ml-2 p-2 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 transition" title="播放發音">
                            <span class="material-symbols-outlined text-lg">volume_up</span>
                        </button>
                    </div>
                    <div class="text-xs text-slate-500 mb-1">${vocab.pos || ''}</div>
                    ${vocab.ipa ? `<div class="text-xs text-blue-600 font-semibold mb-3">${vocab.ipa}</div>` : ''}
                    <p class="text-sm mb-3">${vocab.def}</p>
                    ${vocab.cn ? `<p class="text-xs text-blue-700 font-bold">${vocab.cn}</p>` : ''}
                </div>`;
            
            const rect = e.target.getBoundingClientRect();
            const cardWidth = 320;
            const cardHeight = 200; // 預估高度
            const padding = 10;
            
            // 計算最佳位置（避免超出螢幕）
            let left = rect.left;
            let top = rect.bottom + padding;
            
            // 水平方向調整
            if (left + cardWidth > window.innerWidth) {
                left = window.innerWidth - cardWidth - padding;
            }
            if (left < padding) {
                left = padding;
            }
            
            // 垂直方向調整（如果下方空間不足，顯示在上方）
            if (top + cardHeight > window.innerHeight) {
                top = rect.top - cardHeight - padding;
                if (top < padding) {
                    top = padding;
                }
            }
            
            floatingCard.style.left = left + 'px';
            floatingCard.style.top = top + 'px';
            floatingCard.classList.remove('hidden');
        }
        
        function toggleCard(e, id) {
            e.stopPropagation();
            e.preventDefault();
            
            // 如果已經顯示同一個字卡，則關閉
            if (!floatingCard.classList.contains('hidden') && floatingCard.dataset.currentId === id) {
                hideCard();
            } else {
                showCard(e, id);
            }
        }

        function hideCard() {
            floatingCard.classList.add('hidden');
            floatingCard.dataset.currentId = '';
        }
        
        // 點擊外部關閉字卡
        document.addEventListener('click', function(e) {
            // 延遲執行，讓 toggleCard 先完成
            setTimeout(() => {
                if (!floatingCard.classList.contains('hidden') && 
                    !floatingCard.contains(e.target) && 
                    !e.target.closest('.vocab-word') && 
                    !e.target.closest('.vocab-word-custom')) {
                    hideCard();
                }
            }, 100);
        });

        function toggleTranslations() {
            translationsVisible = !translationsVisible;
            const toggleBtnText = document.getElementById('toggle-btn-text');
            const cnToggleText = document.getElementById('cn-toggle-text');
            
            if (toggleBtnText) {
                toggleBtnText.innerText = translationsVisible ? "Hide CN" : "Show CN";
            }
            if (cnToggleText) {
                cnToggleText.innerText = translationsVisible ? "隱藏" : "中文";
            }
            
            applyTranslationState();
        }

        // Quiz Logic
        function openQuiz() {
            const modal = document.getElementById('quiz-modal');
            modal.classList.remove('hidden');
            
            // 檢查是否為雙語格式
            const isBilingual = typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData;
            
            // 顯示或隱藏語言選擇器
            const languageSelector = document.getElementById('quiz-language-selector');
            if (isBilingual) {
                languageSelector.classList.remove('hidden');
                updateQuizLanguageSelector();
            } else {
                languageSelector.classList.add('hidden');
            }
            
            renderQuizContent();
        }

        function renderQuizContent() {
            const content = document.getElementById('quiz-content');
            const footer = document.getElementById('quiz-footer');

            // 檢查是否為雙語格式或傳統格式
            let questionsToDisplay = [];
            let isBilingual = false;
            
            if (typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData) {
                // 雙語格式
                isBilingual = true;
                questionsToDisplay = quizLanguage === 'english' ? quizData.english : quizData.chinese;
            } else if (Array.isArray(quizData)) {
                // 傳統格式
                questionsToDisplay = quizData;
            }

            if (!Array.isArray(questionsToDisplay) || questionsToDisplay.length === 0) {
                content.innerHTML = `
                    <div class="p-6 rounded-xl border border-slate-200 bg-slate-50 text-slate-700">
                        尚未匯入 Quiz 題庫，請先用上方的 Quiz Data 按鈕貼上題庫。
                    </div>
                `;
                footer.innerHTML = `<button onclick="closeQuiz()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-900 transition">Close</button>`;
                return;
            }

            footer.innerHTML = `<button onclick="submitQuiz()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 shadow-md transition">Submit Answers</button>`;

            content.innerHTML = questionsToDisplay.map((q, i) => `
                <div class="mb-6 p-5 rounded-xl border border-gray-100 hover:border-blue-100 transition-colors" id="q-block-${i}">
                    <p class="font-bold text-lg mb-4 text-slate-800 flex gap-2">
                        <span class="bg-blue-100 text-blue-700 w-7 h-7 flex items-center justify-center rounded-full text-sm shrink-0">${i + 1}</span>
                        ${q.q}
                    </p>
                    <div class="space-y-3 pl-9">
                        ${(q.options || []).map((opt, optIdx) => `
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                                <input type="radio" name="q${i}" value="${optIdx}" class="mr-3 w-4 h-4 text-blue-600 focus:ring-blue-500">
                                <span class="text-slate-600 group-hover:text-slate-900">${opt}</span>
                            </label>
                        `).join('')}
                    </div>
                    <div class="feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2"></div>
                </div>
            `).join('');
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').classList.add('hidden');
        }

        function submitQuiz() {
            let score = 0;
            let allAnswered = true;

            // 決定使用哪份題庫
            let questionsToScore = [];
            if (typeof quizData === 'object' && quizData !== null && !Array.isArray(quizData) && 'english' in quizData && 'chinese' in quizData) {
                // 雙語格式 - 根據選擇的語言取用對應版本
                questionsToScore = quizLanguage === 'english' ? quizData.english : quizData.chinese;
            } else if (Array.isArray(quizData)) {
                // 傳統格式
                questionsToScore = quizData;
            }

            questionsToScore.forEach((q, i) => {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                const block = document.getElementById(`q-block-${i}`);
                const feedback = block ? block.querySelector('.feedback') : null;

                if (!block || !feedback) return;

                block.classList.remove('bg-green-50', 'border-green-200', 'bg-red-50', 'border-red-200');
                feedback.className = 'feedback hidden mt-4 ml-9 p-3 rounded-lg text-sm font-bold flex items-center gap-2';

                if (selected) {
                    feedback.classList.remove('hidden');
                    if (parseInt(selected.value, 10) === q.correct) {
                        score++;
                        feedback.innerHTML = `<span class="material-symbols-outlined">check_circle</span> Correct!`;
                        feedback.classList.add('bg-green-100', 'text-green-700');
                        block.classList.add('bg-green-50/50', 'border-green-200');
                    } else {
                        feedback.innerHTML = `<span class="material-symbols-outlined">cancel</span> Incorrect. The correct answer is: <span class="italic">${q.options[q.correct]}</span>`;
                        feedback.classList.add('bg-red-100', 'text-red-700');
                        block.classList.add('bg-red-50/50', 'border-red-200');
                    }
                } else {
                    allAnswered = false;
                }
            });

            const footer = document.getElementById('quiz-footer');
            if (allAnswered || confirm("You haven't answered all questions. Submit anyway?")) {
                let message = '';
                let colorClass = '';

                if (score === questionsToScore.length) {
                    message = 'Perfect Score! 🎉';
                    colorClass = 'text-green-600';
                } else if (score > questionsToScore.length / 2) {
                    message = 'Great Job! 👍';
                    colorClass = 'text-blue-600';
                } else {
                    message = 'Keep Practicing! 💪';
                    colorClass = 'text-orange-500';
                }

                footer.innerHTML = `
                    <div class="flex items-center gap-4 w-full justify-between">
                        <div>
                            <p class="text-sm text-gray-500 uppercase tracking-wider font-bold">Your Score</p>
                            <p class="text-2xl font-bold ${colorClass}">${score} / ${questionsToScore.length} - ${message}</p>
                        </div>
                        <button onclick="closeQuiz()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-900 transition">Close</button>
                    </div>`;
            }
        }

        function applyTranslationState() {
            document.querySelectorAll('.cn-text').forEach(el => {
                if (translationsVisible) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            });
        }

        function scrollToVocab(id) {
            const span = document.querySelector(`.vocab-word[data-id="${id}"]`);
            if (span) {
                span.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function increaseFontSize() {
            if (currentFontSize < 32) {
                currentFontSize += 2;
                applyFontSize();
            }
        }

        function decreaseFontSize() {
            if (currentFontSize > 12) {
                currentFontSize -= 2;
                applyFontSize();
            }
        }

        function applyFontSize() {
            const transcriptContent = document.getElementById('transcript-content');
            if (transcriptContent) {
                transcriptContent.style.fontSize = currentFontSize + 'px';
            }
        }

        function increasePlaybackSpeed() {
            if (!player || !playerReady) return;
            const speeds = [0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];
            const currentIndex = speeds.indexOf(currentPlaybackSpeed);
            if (currentIndex < speeds.length - 1) {
                currentPlaybackSpeed = speeds[currentIndex + 1];
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
        }

        function decreasePlaybackSpeed() {
            if (!player || !playerReady) return;
            const speeds = [0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];
            const currentIndex = speeds.indexOf(currentPlaybackSpeed);
            if (currentIndex > 0) {
                currentPlaybackSpeed = speeds[currentIndex - 1];
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
        }

        function updateSpeedDisplay() {
            const display = document.getElementById('speed-display');
            if (display) {
                display.textContent = currentPlaybackSpeed.toFixed(2) + 'x';
            }
        }

        function togglePlayPause() {
            if (!player || !playerReady) return;
            
            const state = player.getPlayerState();
            const playIcon = document.getElementById('play-icon');
            const playText = document.getElementById('play-text');
            
            // YT.PlayerState: UNSTARTED (-1), ENDED (0), PLAYING (1), PAUSED (2), BUFFERING (3), CUED (5)
            if (state === 1) { // Playing
                player.pauseVideo();
                playIcon.textContent = 'play_arrow';
                playText.textContent = '播放';
            } else { // Paused or other states
                player.playVideo();
                playIcon.textContent = 'pause';
                playText.textContent = '暫停';
            }
        }

        function updatePlayPauseButton() {
            if (!player || !playerReady) return;
            const state = player.getPlayerState();
            const playIcon = document.getElementById('play-icon');
            const playText = document.getElementById('play-text');
            
            if (state === 1) { // Playing
                playIcon.textContent = 'pause';
                playText.textContent = '暫停';
            } else {
                playIcon.textContent = 'play_arrow';
                playText.textContent = '播放';
            }
        }

        function resetSettings() {
            currentFontSize = 18;
            applyFontSize();
            
            if (player && playerReady) {
                currentPlaybackSpeed = 1.0;
                player.setPlaybackRate(currentPlaybackSpeed);
                updateSpeedDisplay();
            }
            
            translationsVisible = false;
            const toggleBtnText = document.getElementById('toggle-btn-text');
            const cnToggleText = document.getElementById('cn-toggle-text');
            if (toggleBtnText) toggleBtnText.innerText = 'Show CN';
            if (cnToggleText) cnToggleText.innerText = '中文';
            applyTranslationState();
        }

        function changeVideoUrl() {
            const newUrl = prompt('貼上 YouTube 網址或影片 ID:', videoId);
            if (!newUrl || newUrl.trim() === '') return;
            
            try {
                let id = newUrl.trim();
                
                // 提取影片 ID
                let m = id.match(/[?&]v=([^&]+)/);
                if (m) id = m[1];
                
                m = id.match(/youtu\.be\/([^?]+)/);
                if (m) id = m[1];
                
                id = id.split('&')[0].split('?')[0];
                
                if (id.length !== 11) throw new Error("無效的影片 ID");
                
                videoId = id;
                if (player && playerReady) {
                    player.loadVideoById(videoId);
                    console.log(`✅ 影片已更換: ${videoId}`);
                }
            } catch (e) {
                console.error("錯誤: " + e.message);
            }
        }

        // Export Function
        function downloadHTML() {
            const clone = document.documentElement.cloneNode(true);
            
            // Replace entire navigation bar with simplified Export-only version
            const nav = clone.querySelector('nav');
            if (nav) {
                nav.innerHTML = `
                    <div class="max-w-7xl mx-auto px-4 sm:px-6">
                        <div class="flex justify-between h-16 items-center">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                    <span class="material-symbols-outlined text-white text-xl">school</span>
                                </div>
                                <div class="flex flex-col">
                                    <div class="font-bold text-lg text-slate-900">StudyEngine</div>
                                    <div class="text-xs text-slate-500 hidden sm:block">英語學習平台</div>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <button onclick="toggleExportMenu()" class="px-3 py-2 rounded-lg border border-purple-200 bg-purple-50 hover:bg-purple-100 text-purple-700 transition text-sm font-medium flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-lg">bookmark</span>
                                    <span class="hidden sm:inline">Export Words (</span><span class="sm:hidden">(</span><span id="selected-count">${selectedWords.length}</span><span>)</span>
                                </button>
                                <div id="export-menu" class="hidden absolute top-full right-0 mt-2 bg-white border border-slate-200 rounded-xl shadow-lg z-50 min-w-max overflow-hidden">
                                    <button onclick="copyExportPrompt()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 border-b border-slate-100 flex items-center gap-2 text-sm" title="複製生成AI指令的Prompt">
                                        <span class="material-symbols-outlined text-sm text-blue-600">content_copy</span> <span>複製 Prompt</span>
                                    </button>
                                    <button onclick="exportSelectedWords()" class="w-full px-4 py-2.5 text-left hover:bg-blue-50 flex items-center gap-2 text-sm" title="下載選中的生字">
                                        <span class="material-symbols-outlined text-sm text-blue-600">download</span> <span>下載文字檔</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Remove all Five Server and third-party injected code
            const scriptsToRemove = clone.querySelectorAll('script[data-id="five-server"], script[id="www-widgetapi-script"]');
            scriptsToRemove.forEach(s => s.remove());
            
            // Remove all injected styles (Five Server, Tailwind compiled, third-party)
            const stylesToRemove = clone.querySelectorAll('style[id*="five"], style[class*="five"], style:not([type])');
            stylesToRemove.forEach(s => {
                const content = s.textContent || '';
                if (content.includes('five-server') || 
                    content.includes('fiveserver') || 
                    content.includes('keyword-info') ||
                    content.includes('tippy-') ||
                    content.includes('ubersuggest') ||
                    content.includes('bl-info') ||
                    content.includes('kw-info') ||
                    content.includes('statistics-graph') ||
                    content.includes('ue-sidebar') ||
                    content.includes('tw-border-spacing') ||
                    content.includes('tailwindcss v3.4')) {
                    s.remove();
                }
            });
            
            // Remove Ubersuggest/extension divs
            const extensionDivs = clone.querySelectorAll('.ue-sidebar-container, [class*="ubersuggest"]');
            extensionDivs.forEach(div => div.remove());

            let html = clone.outerHTML;

            // Fix toggleExportMenu function for exported file (use 'export-menu' instead of type parameter)
            html = html.replace(
                /function toggleExportMenu\(type = 'desktop'\) \{\s*const menuId = type === 'mobile' \? 'export-menu-mobile' : 'export-menu-desktop';/,
                `function toggleExportMenu(type = 'desktop') {
            const menuId = 'export-menu';`
            );
            
            // Add toggleMobileMenu function if not present
            if (!html.includes('function toggleMobileMenu()')) {
                const insertPoint = html.indexOf('function toggleExportMenu');
                if (insertPoint !== -1) {
                    html = html.slice(0, insertPoint) + 
                           `function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('hamburger-btn');
            if (!menu || !btn) return;
            menu.classList.toggle('hidden');
            btn.classList.toggle('active');
        }

        ` + 
                           html.slice(insertPoint);
                }
            }

            // Remove Insert button from exported file
            html = html.replace(
                /<button[^>]*onclick="openInsertModal\([^)]*\)"[^>]*>[\s\S]*?<\/button>\s*/g,
                ''
            );

            // Inject data (keep videoId empty for exported files)
            html = html.replace(
                /let transcriptData = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('transcriptData'\) \|\| '\[\]'\));/s,
                `let transcriptData = ${JSON.stringify(transcriptData)};`
            );
            html = html.replace(
                /let vocabData = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('vocabData'\) \|\| '\[\]'\));/s,
                `let vocabData = ${JSON.stringify(vocabData)};`
            );
            html = html.replace(
                /let quizData = (?:\[.*?\]|\{.*?\}|JSON\.parse\(localStorage\.getItem\('quizData'\) \|\| '\[\]'\));/s,
                `let quizData = ${JSON.stringify(quizData)};`
            );
            html = html.replace(
                /let selectedWords = (?:\[.*?\]|JSON\.parse\(localStorage\.getItem\('selectedWords'\) \|\| '\[\]'\));/s,
                `let selectedWords = ${JSON.stringify(selectedWords)};`
            );
            html = html.replace(
                /let videoId = (?:localStorage\.getItem\('videoId'\) \|\| ''|'[^']*');/,
                `let videoId = localStorage.getItem('videoId') || '';`
            );

            // 確保 player 是空的 div，不要包含 iframe
            html = html.replace(
                /<iframe[^>]*id="player"[^>]*>[\s\S]*?<\/iframe>/,
                '<div id="player" class="absolute inset-0"></div>'
            );
            html = html.replace(
                /<div id="player"[^>]*>[\s\S]*?<\/div>/,
                '<div id="player" class="absolute inset-0"></div>'
            );

            // Remove Capture buttons from exported file
            html = html.replace(
                /<button[^>]*onclick="captureTime\([^)]+\)"[^>]*>[\s\S]*?Capture[\s\S]*?<\/button>/g,
                ''
            );
            
            // Remove captureTime function from exported file
            html = html.replace(
                /function captureTime\([^)]*\) \{[\s\S]*?\n        \}/,
                ''
            );
            
            // Update video section hint text
            html = html.replace(
                /點擊時間標籤跳轉，按 Capture 設定當前播放時間/,
                '點擊時間標籤跳轉到指定時間'
            );

            // Download
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'study_guide.html';
            a.click();
            URL.revokeObjectURL(url);

            console.log(`✅ 匯出成功！\n逐字稿: ${transcriptData.length} 段\n單字: ${vocabData.length} 個\n影片: 需透過「更換影片」按鈕設定`);
        }

        // Load YouTube API
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        document.head.appendChild(tag);

        // Global YouTube Ready handler
        window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

        // Initialize if data exists
        if (transcriptData.length > 0 || vocabData.length > 0) {
            renderTranscript();
            renderVocab();
        }
        
        // Update selected word count
        updateSelectedCount();
        
        // Text Selection Handler
        document.addEventListener('mouseup', handleTextSelection);
        
        function handleTextSelection(e) {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();
            
            if (!selectedText || selectedText.length === 0) {
                hideSelectionPopup();
                return;
            }
            
            // Check if selection is within transcript
            const container = document.getElementById('transcript-content');
            if (!container || !container.contains(selection.anchorNode)) {
                hideSelectionPopup();
                return;
            }
            
            // Show popup near cursor
            const popup = document.getElementById('selection-popup');
            const range = selection.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            
            popup.style.left = (rect.left + rect.width / 2 - 60) + 'px';
            popup.style.top = (rect.top - 45) + 'px';
            popup.classList.remove('hidden');
            
            popup.onclick = () => addSelectedWord(selectedText);
        }
        
        function hideSelectionPopup() {
            const popup = document.getElementById('selection-popup');
            if (popup) popup.classList.add('hidden');
        }
        
        function addSelectedWord(word) {
            word = word.trim();
            if (!word || selectedWords.includes(word)) {
                hideSelectionPopup();
                window.getSelection().removeAllRanges();
                return;
            }
            
            selectedWords.push(word);
            localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
            updateSelectedCount();
            highlightSelectedWords();
            hideSelectionPopup();
            window.getSelection().removeAllRanges();
            
            console.log(`✅ 已加入生字: ${word}`);
        }
        
        function removeSelectedWord(word) {
            word = word.trim();
            const index = selectedWords.indexOf(word);
            if (index > -1) {
                selectedWords.splice(index, 1);
                localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
                updateSelectedCount();
                highlightSelectedWords();
                console.log(`❌ 已取消選取: ${word}`);
            }
        }
        
        function updateSelectedCount() {
            const countEl = document.getElementById('selected-count');
            const countElMobile = document.getElementById('selected-count-mobile');
            if (countEl) countEl.textContent = selectedWords.length;
            if (countElMobile) countElMobile.textContent = selectedWords.length;
        }
        
        function highlightSelectedWords() {
            const container = document.getElementById('transcript-content');
            if (!container) return;
            
            // Remove existing highlights
            container.querySelectorAll('.selected-word').forEach(el => {
                el.outerHTML = el.textContent;
            });
            
            // Re-render to apply new highlights
            renderTranscript();
        }
        
        function toggleExportMenu(type = 'desktop') {
            const menuId = 'export-menu';
            const menu = document.getElementById(menuId);
            if (!menu) return;
            
            menu.classList.toggle('hidden');
            
            // 點擊外部時關閉選單
            if (!menu.classList.contains('hidden')) {
                document.addEventListener('click', (e) => {
                    if (!e.target.closest(`#${menuId}`) && !e.target.closest('button[onclick*="toggleExportMenu"]')) {
                        menu.classList.add('hidden');
                    }
                }, { once: true });
            }
        }
        
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('hamburger-btn');
            
            menu.classList.toggle('hidden');
            btn.classList.toggle('active');
            
            // 點擊外部時關閉選單
            if (!menu.classList.contains('hidden')) {
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#mobile-menu') && !e.target.closest('#hamburger-btn')) {
                        menu.classList.add('hidden');
                        btn.classList.remove('active');
                    }
                }, { once: true });
            }
        }

        function generateExportPrompt() {
            if (selectedWords.length === 0) {
                return '';
            }
            
            let prompt = selectedWords.join('\n');
            prompt += '\n\n將以上英文單字嚴格依照以下 JSON Array 格式輸出結果：\n\n';
            prompt += '1.  **id**: 單字的全小寫形式。\n';
            prompt += '2.  **word**: 單字的首字母大寫。\n';
            prompt += '3.  **ipa**: 該單字的 IPA 音標。\n';
            prompt += '4.  **pos**: 詞性 (如 noun, verb, adjective)。\n';
            prompt += '5.  **def**: 簡潔的英文定義。\n';
            prompt += '6.  **cn**: 繁體中文解釋 (若有特定語境請一併標註)。\n';
            prompt += '7.  **image**: 請輸出格式為 `https://source.unsplash.com/featured/?{單字}` 的連結，將 `{單字}` 替換為該單字的英文內容，以便自動抓取相關圖片。\n\n';
            prompt += '範例格式：\n\n';
            prompt += '[\n';
            prompt += '    {\n';
            prompt += '        "id": "pareidolia",\n';
            prompt += '        "word": "Pareidolia",\n';
            prompt += '        "ipa": "/ˌpær.ɪˈdoʊ.li.ə/",\n';
            prompt += '        "pos": "noun",\n';
            prompt += '        "def": "The psychological phenomenon of seeing recognizable shapes, especially faces, in random or vague stimuli.",\n';
            prompt += '        "cn": "幻想性錯覺 (尤指將模糊圖像看作人臉)",\n';
            prompt += '        "image": "https://source.unsplash.com/featured/?pareidolia"\n';
            prompt += '    }\n';
            prompt += ']\n';
            
            return prompt;
        }

        function copyExportPrompt() {
            if (selectedWords.length === 0) {
                alert('尚未選取任何生字');
                return;
            }
            
            const prompt = generateExportPrompt();
            navigator.clipboard.writeText(prompt).then(() => {
                document.getElementById('export-menu').classList.add('hidden');
                console.log(`✅ Export Prompt 已複製 (${selectedWords.length} 個生字)`);
            }).catch(() => {
                alert('複製失敗，請重試');
            });
        }

        function exportSelectedWords() {
            if (selectedWords.length === 0) {
                alert('尚未選取任何生字');
                return;
            }
            
            const text = selectedWords.map((word, i) => `${i + 1}. ${word}`).join('\n');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'selected_words.txt';
            a.click();
            URL.revokeObjectURL(url);
            
            console.log(`✅ 已匯出 ${selectedWords.length} 個生字`);
        }
    </script>


</body></html>